# Development environment with hot reload
FROM node:20-alpine

# Install build dependencies
RUN apk add --no-cache \
    libc6-compat \
    python3 \
    make \
    g++ \
    git \
    curl

# Enable pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /app

# Copy workspace config
COPY pnpm-lock.yaml pnpm-workspace.yaml package.json ./

# Copy backend specific config
COPY backend/package.json ./backend/
# Copy frontend specific config (if needed by root install)
COPY frontend/package.json ./frontend/
# Copy other packages if needed
COPY packages/ ./packages/

# Install dependencies (frozen-lockfile for consistency, but maybe invalid if I miss some pkg files)
# For dev, we can just copy everything first if context is small enough,
# but better to copy manifests first for caching.
# However, for workspace, pnpm needs all package.jsons.
# Let's try to copy manifests.
# SIMPLIFICATION: usage of pnpm fetch or just install after full copy for dev.

# Let's allow full copy for dev since we optimized .dockerignore
COPY . .

# Install dependencies
RUN pnpm install

# Expose ports (Base ports, overridden by compose)
EXPOSE 5173 3000

# Default CMD (Overridden by compose for specific filters)
CMD ["pnpm", "dev"]

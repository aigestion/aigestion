{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\email.service.ts","mappings":";;;;;;;;;;;;;;;AAAA,4DAAoC;AACpC,iDAAiD;AACjD,yCAAuC;AAEvC,qDAA2C;AAC3C,4CAAyC;AAGlC,IAAM,YAAY,GAAlB,MAAM,YAAY;IACf,WAAW,CAAM;IAEzB;QACE,IAAI,CAAC,WAAW,GAAG,oBAAU,CAAC,eAAe,CAAC;YAC5C,IAAI,EAAE,gBAAG,CAAC,UAAU;YACpB,IAAI,EAAE,gBAAG,CAAC,UAAU;YACpB,MAAM,EAAE,gBAAG,CAAC,UAAU,KAAK,GAAG,EAAE,sCAAsC;YACtE,IAAI,EAAE;gBACJ,IAAI,EAAE,gBAAG,CAAC,cAAc;gBACxB,IAAI,EAAE,gBAAG,CAAC,cAAc;aACzB;YACD,GAAG,EAAE;gBACH,kBAAkB,EAAE,KAAK;aAC1B;SACF,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,gBAAgB;QACpB,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;YAChC,eAAM,CAAC,IAAI,CAAC,4BAA4B,CAAC,CAAC;YAC1C,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,KAAK,EAAE,0BAA0B,CAAC,CAAC;YAChD,OAAO,KAAK,CAAC;QACf,CAAC;QACD,6DAA6D;QAC7D,qEAAqE;QACrE,qCAAqC;IACvC,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,SAAS,CACb,EAAU,EACV,OAAe,EACf,IAAY,EACZ,WAAqE;QAErE,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC;gBAC3C,IAAI,EAAE,IAAI,gBAAG,CAAC,SAAS,MAAM,gBAAG,CAAC,UAAU,GAAG;gBAC9C,EAAE;gBACF,OAAO;gBACP,IAAI;gBACJ,WAAW;aACZ,CAAC,CAAC;YAEH,eAAM,CAAC,IAAI,CAAC,kBAAkB,IAAI,CAAC,SAAS,OAAO,EAAE,EAAE,CAAC,CAAC;QAC3D,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,KAAK,EAAE,2BAA2B,EAAE,EAAE,CAAC,CAAC;YACrD,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;CACF,CAAA;AA3DY,oCAAY;uBAAZ,YAAY;IADxB,IAAA,sBAAU,GAAE;;GACA,YAAY,CA2DxB","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\email.service.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\n// import type { Transporter } from 'nodemailer';\nimport { injectable } from 'inversify';\n\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class EmailService {\n  private transporter: any;\n\n  constructor() {\n    this.transporter = nodemailer.createTransport({\n      host: env.EMAIL_HOST,\n      port: env.EMAIL_PORT,\n      secure: env.EMAIL_PORT === 465, // true for 465, false for other ports\n      auth: {\n        user: env.EMAIL_USERNAME,\n        pass: env.EMAIL_PASSWORD,\n      },\n      tls: {\n        rejectUnauthorized: false,\n      },\n    });\n  }\n\n  /**\n   * Verify SMTP connection configuration\n   */\n  async verifyConnection(): Promise<boolean> {\n    try {\n      await this.transporter.verify();\n      logger.info('‚úÖ SMTP Connection verified');\n      return true;\n    } catch (error) {\n      logger.error(error, '‚ùå SMTP Connection failed');\n      return false;\n    }\n    // No database connection handling here; skip shutdown of DB.\n    // If a DB connection is needed, integrate it with connectToDatabase.\n    // Placeholder for future DB cleanup.\n  }\n\n  /**\n   * Send an email\n   */\n  async sendEmail(\n    to: string,\n    subject: string,\n    html: string,\n    attachments?: { filename: string; path?: string; content?: string }[],\n  ): Promise<void> {\n    try {\n      const info = await this.transporter.sendMail({\n        from: `\"${env.API_TITLE}\" <${env.EMAIL_FROM}>`,\n        to,\n        subject,\n        html,\n        attachments,\n      });\n\n      logger.info(`üìß Email sent: ${info.messageId} to ${to}`);\n    } catch (error) {\n      logger.error(error, `Failed to send email to ${to}`);\n      throw error;\n    }\n  }\n}\n"],"version":3}
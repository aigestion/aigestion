a795b894d77dd8d944083ed5919d045b
/**
 * Task 1.3: Auth & AI GraphQL Integration Tests
 *
 * These tests require a fully booted Express app with InversifyJS-resolved controllers.
 * The app boot process triggers module-level container.get() calls for ALL controllers
 * (DanielaController, GodModeController, etc.), making it impossible to partially mock
 * the IoC container for targeted tests.
 *
 * To run these tests: RUN_INTEGRATION_TESTS=true npx jest --runInBand task1-auth-ai-graphql
 */
const SKIP = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;
(SKIP ? describe.skip : describe)('Task 1.3: Auth & AI GraphQL', () => {
    jest.setTimeout(30000);
    it('should return token and user on successful login', async () => {
        const request = require('supertest');
        const { app } = require('../app');
        const { connectToDatabase } = require('../config/database');
        await connectToDatabase();
        // Create user for login
        await request(app).post('/api/v1/users').send({
            email: 'test@example.com',
            name: 'GraphQL User',
            password: 'AIGestion2026!',
        });
        const mutation = `
      mutation {
        login(email: "test@example.com", password: "AIGestion2026!") {
          token
          user {
            id
            email
            name
          }
        }
      }
    `;
        const response = await request(app)
            .post('/graphql')
            .set('Content-Type', 'application/json')
            .send({ query: mutation });
        expect(response.status).toBe(200);
        expect(response.body.errors).toBeUndefined();
        expect(response.body.data.login).toBeDefined();
        expect(response.body.data.login.token).toBe('mock_jwt_token');
        expect(response.body.data.login.user.email).toBe('test@example.com');
    });
    it('should return AI response', async () => {
        const request = require('supertest');
        const { app } = require('../app');
        const query = `
      query {
        chat(message: "Hello Nexus")
      }
    `;
        const response = await request(app)
            .post('/graphql')
            .set('Content-Type', 'application/json')
            .send({ query });
        expect(response.status).toBe(200);
        expect(response.body.errors).toBeUndefined();
        expect(response.body.data.chat).toBe('This is a mock AI response');
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXHRhc2sxLWF1dGgtYWktZ3JhcGhxbC50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7R0FTRztBQUVILE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUM7QUFFbkYsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtJQUNwRSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZCLEVBQUUsQ0FBQyxrREFBa0QsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNoRSxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsQyxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUM1RCxNQUFNLGlCQUFpQixFQUFFLENBQUM7UUFFMUIsd0JBQXdCO1FBQ3hCLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDNUMsS0FBSyxFQUFFLGtCQUFrQjtZQUN6QixJQUFJLEVBQUUsY0FBYztZQUNwQixRQUFRLEVBQUUsZ0JBQWdCO1NBQzNCLENBQUMsQ0FBQztRQUVILE1BQU0sUUFBUSxHQUFHOzs7Ozs7Ozs7OztLQVdoQixDQUFDO1FBRUYsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDO2FBQ2hDLElBQUksQ0FBQyxVQUFVLENBQUM7YUFDaEIsR0FBRyxDQUFDLGNBQWMsRUFBRSxrQkFBa0IsQ0FBQzthQUN2QyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUU3QixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUM3QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDL0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM5RCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUN2RSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN6QyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUVsQyxNQUFNLEtBQUssR0FBRzs7OztLQUliLENBQUM7UUFFRixNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUM7YUFDaEMsSUFBSSxDQUFDLFVBQVUsQ0FBQzthQUNoQixHQUFHLENBQUMsY0FBYyxFQUFFLGtCQUFrQixDQUFDO2FBQ3ZDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFbkIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDN0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0lBQ3JFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXHRhc2sxLWF1dGgtYWktZ3JhcGhxbC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGFzayAxLjM6IEF1dGggJiBBSSBHcmFwaFFMIEludGVncmF0aW9uIFRlc3RzXG4gKlxuICogVGhlc2UgdGVzdHMgcmVxdWlyZSBhIGZ1bGx5IGJvb3RlZCBFeHByZXNzIGFwcCB3aXRoIEludmVyc2lmeUpTLXJlc29sdmVkIGNvbnRyb2xsZXJzLlxuICogVGhlIGFwcCBib290IHByb2Nlc3MgdHJpZ2dlcnMgbW9kdWxlLWxldmVsIGNvbnRhaW5lci5nZXQoKSBjYWxscyBmb3IgQUxMIGNvbnRyb2xsZXJzXG4gKiAoRGFuaWVsYUNvbnRyb2xsZXIsIEdvZE1vZGVDb250cm9sbGVyLCBldGMuKSwgbWFraW5nIGl0IGltcG9zc2libGUgdG8gcGFydGlhbGx5IG1vY2tcbiAqIHRoZSBJb0MgY29udGFpbmVyIGZvciB0YXJnZXRlZCB0ZXN0cy5cbiAqXG4gKiBUbyBydW4gdGhlc2UgdGVzdHM6IFJVTl9JTlRFR1JBVElPTl9URVNUUz10cnVlIG5weCBqZXN0IC0tcnVuSW5CYW5kIHRhc2sxLWF1dGgtYWktZ3JhcGhxbFxuICovXG5cbmNvbnN0IFNLSVAgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnICYmICFwcm9jZXNzLmVudi5SVU5fSU5URUdSQVRJT05fVEVTVFM7XG5cbihTS0lQID8gZGVzY3JpYmUuc2tpcCA6IGRlc2NyaWJlKSgnVGFzayAxLjM6IEF1dGggJiBBSSBHcmFwaFFMJywgKCkgPT4ge1xuICBqZXN0LnNldFRpbWVvdXQoMzAwMDApO1xuICBpdCgnc2hvdWxkIHJldHVybiB0b2tlbiBhbmQgdXNlciBvbiBzdWNjZXNzZnVsIGxvZ2luJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcbiAgICBjb25zdCB7IGFwcCB9ID0gcmVxdWlyZSgnLi4vYXBwJyk7XG4gICAgY29uc3QgeyBjb25uZWN0VG9EYXRhYmFzZSB9ID0gcmVxdWlyZSgnLi4vY29uZmlnL2RhdGFiYXNlJyk7XG4gICAgYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcblxuICAgIC8vIENyZWF0ZSB1c2VyIGZvciBsb2dpblxuICAgIGF3YWl0IHJlcXVlc3QoYXBwKS5wb3N0KCcvYXBpL3YxL3VzZXJzJykuc2VuZCh7XG4gICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgbmFtZTogJ0dyYXBoUUwgVXNlcicsXG4gICAgICBwYXNzd29yZDogJ0FJR2VzdGlvbjIwMjYhJyxcbiAgICB9KTtcblxuICAgIGNvbnN0IG11dGF0aW9uID0gYFxuICAgICAgbXV0YXRpb24ge1xuICAgICAgICBsb2dpbihlbWFpbDogXCJ0ZXN0QGV4YW1wbGUuY29tXCIsIHBhc3N3b3JkOiBcIkFJR2VzdGlvbjIwMjYhXCIpIHtcbiAgICAgICAgICB0b2tlblxuICAgICAgICAgIHVzZXIge1xuICAgICAgICAgICAgaWRcbiAgICAgICAgICAgIGVtYWlsXG4gICAgICAgICAgICBuYW1lXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAucG9zdCgnL2dyYXBocWwnKVxuICAgICAgLnNldCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKVxuICAgICAgLnNlbmQoeyBxdWVyeTogbXV0YXRpb24gfSk7XG5cbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3JzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS5sb2dpbikudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhLmxvZ2luLnRva2VuKS50b0JlKCdtb2NrX2p3dF90b2tlbicpO1xuICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEubG9naW4udXNlci5lbWFpbCkudG9CZSgndGVzdEBleGFtcGxlLmNvbScpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiBBSSByZXNwb25zZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XG4gICAgY29uc3QgeyBhcHAgfSA9IHJlcXVpcmUoJy4uL2FwcCcpO1xuXG4gICAgY29uc3QgcXVlcnkgPSBgXG4gICAgICBxdWVyeSB7XG4gICAgICAgIGNoYXQobWVzc2FnZTogXCJIZWxsbyBOZXh1c1wiKVxuICAgICAgfVxuICAgIGA7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgLnBvc3QoJy9ncmFwaHFsJylcbiAgICAgIC5zZXQoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJylcbiAgICAgIC5zZW5kKHsgcXVlcnkgfSk7XG5cbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3JzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS5jaGF0KS50b0JlKCdUaGlzIGlzIGEgbW9jayBBSSByZXNwb25zZScpO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9
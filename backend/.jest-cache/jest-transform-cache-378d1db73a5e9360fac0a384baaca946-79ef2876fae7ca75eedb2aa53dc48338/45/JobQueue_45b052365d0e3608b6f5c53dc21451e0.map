{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\jobs\\JobQueue.ts","mappings":";;;;;;;;;;;;AAAA,yCAA+C;AAC/C,mCAA6C;AAC7C,uDAA0D;AAC1D,+CAA4C;AAGrC,IAAM,QAAQ,GAAd,MAAM,QAAQ;IACX,MAAM,GAAuB,IAAI,GAAG,EAAE,CAAC;IACvC,YAAY,CAAM;IAE1B;QACE,IAAI,CAAC,YAAY,GAAG;YAClB,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,WAAW;YAC3C,IAAI,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI,MAAM,CAAC;YAChD,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI,SAAS;SAClD,CAAC;QACF,IAAI,CAAC,gBAAgB,EAAE,CAAC;IAC1B,CAAC;IAEO,gBAAgB;QACtB,IAAI,OAAO,CAAC,GAAG,CAAC,YAAY,KAAK,OAAO,EAAE,CAAC;YACzC,eAAM,CAAC,IAAI,CAAC,yDAAyD,CAAC,CAAC;YACvE,OAAO;QACT,CAAC;QAED,MAAM,CAAC,MAAM,CAAC,yBAAO,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE;YACpC,MAAM,KAAK,GAAG,IAAI,cAAK,CAAC,IAAI,EAAE;gBAC5B,UAAU,EAAE,IAAI,CAAC,YAAY;aAC9B,CAAC,CAAC;YACH,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAC/B,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,KAAK,CAAC,MAAM,CACjB,IAAO,EACP,IAAqB,EACrB,IAAU;QAEV,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAc,CAAC,CAAC;QAC9C,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,IAAI,OAAO,CAAC,GAAG,CAAC,YAAY,KAAK,OAAO,EAAE,CAAC;gBACzC,eAAM,CAAC,IAAI,CAAC,0CAA0C,IAAI,EAAE,CAAC,CAAC;gBAC9D,OAAO;YACT,CAAC;YACD,eAAM,CAAC,KAAK,CAAC,4BAA4B,IAAI,EAAE,CAAC,CAAC;YACjD,MAAM,IAAI,KAAK,CAAC,4BAA4B,IAAI,EAAE,CAAC,CAAC;QACtD,CAAC;QACD,MAAM,KAAK,CAAC,GAAG,CAAC,IAAc,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IAC9C,CAAC;IAEM,KAAK,CAAC,KAAK;QAChB,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE,CAAC;YACzC,MAAM,KAAK,CAAC,KAAK,EAAE,CAAC;QACtB,CAAC;IACH,CAAC;CACF,CAAA;AAjDY,4BAAQ;mBAAR,QAAQ;IADpB,IAAA,sBAAU,GAAE;;GACA,QAAQ,CAiDpB","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\jobs\\JobQueue.ts"],"sourcesContent":["import { injectable, inject } from 'inversify';\nimport { Queue, QueueOptions } from 'bullmq';\nimport { JobName, IJobPayloads } from './job-definitions';\nimport { logger } from '../../utils/logger';\n\n@injectable()\nexport class JobQueue {\n  private queues: Map<string, Queue> = new Map();\n  private redisOptions: any;\n\n  constructor() {\n    this.redisOptions = {\n      host: process.env.REDIS_HOST || 'localhost',\n      port: parseInt(process.env.REDIS_PORT || '6379'),\n      password: process.env.REDIS_PASSWORD || undefined,\n    };\n    this.initializeQueues();\n  }\n\n  private initializeQueues() {\n    if (process.env.ENABLE_REDIS === 'false') {\n      logger.info('JobQueue: Redis disabled, skipping queue initialization');\n      return;\n    }\n\n    Object.values(JobName).forEach(name => {\n      const queue = new Queue(name, {\n        connection: this.redisOptions,\n      });\n      this.queues.set(name, queue);\n    });\n  }\n\n  public async addJob<T extends JobName>(\n    name: T,\n    data: IJobPayloads[T],\n    opts?: any,\n  ): Promise<void> {\n    const queue = this.queues.get(name as string);\n    if (!queue) {\n      if (process.env.ENABLE_REDIS === 'false') {\n        logger.warn(`JobQueue: Redis disabled, skipping job ${name}`);\n        return;\n      }\n      logger.error(`Queue not found for job: ${name}`);\n      throw new Error(`Queue not found for job: ${name}`);\n    }\n    await queue.add(name as string, data, opts);\n  }\n\n  public async close(): Promise<void> {\n    for (const queue of this.queues.values()) {\n      await queue.close();\n    }\n  }\n}\n"],"version":3}
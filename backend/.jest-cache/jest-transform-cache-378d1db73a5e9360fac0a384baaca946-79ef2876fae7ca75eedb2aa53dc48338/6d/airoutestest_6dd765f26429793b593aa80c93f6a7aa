3e047f29b587deeb79aca1371f84c917
/**
 * AI Routes Test (SSE Streaming)
 *
 * This test requires a fully booted Express app with IoC-resolved controllers.
 * The `danielaController.chat` is resolved via InversifyJS and cannot be easily
 * mocked without a full container setup. Test is conditionally skipped in unit mode.
 *
 * To run: RUN_INTEGRATION_TESTS=true npx jest --runInBand ai.routes.test.ts
 */
const SKIP_INTEGRATION = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;
(SKIP_INTEGRATION ? describe.skip : describe)('POST /api/v1/ai/chat (SSE streaming)', () => {
    it('should stream tokens and finish with DONE', async () => {
        const request = require('supertest');
        const { app } = require('../../app');
        const response = await request(app)
            .post('/api/v1/ai/chat')
            .send({ prompt: 'Hi', history: [] })
            .set('Accept', 'text/event-stream')
            .expect('Content-Type', /text\/event-stream/)
            .expect(200);
        const payload = response.text;
        expect(payload).toContain('"type":"text"');
        expect(payload).toContain('Hello');
        expect(payload).toContain('[DONE]');
    }, 30000);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXHJvdXRlc1xcYWkucm91dGVzLnRlc3QudHMiLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0dBUUc7QUFFSCxNQUFNLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUM7QUFFL0YsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsc0NBQXNDLEVBQUUsR0FBRyxFQUFFO0lBQ3pGLEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN6RCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUVyQyxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUM7YUFDaEMsSUFBSSxDQUFDLGlCQUFpQixDQUFDO2FBQ3ZCLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDO2FBQ25DLEdBQUcsQ0FBQyxRQUFRLEVBQUUsbUJBQW1CLENBQUM7YUFDbEMsTUFBTSxDQUFDLGNBQWMsRUFBRSxvQkFBb0IsQ0FBQzthQUM1QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFZixNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQzlCLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDM0MsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3RDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNaLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWxlamFuZHJvXFxBSUdlc3Rpb25cXGJhY2tlbmRcXHNyY1xcX190ZXN0c19fXFxyb3V0ZXNcXGFpLnJvdXRlcy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQUkgUm91dGVzIFRlc3QgKFNTRSBTdHJlYW1pbmcpXG4gKlxuICogVGhpcyB0ZXN0IHJlcXVpcmVzIGEgZnVsbHkgYm9vdGVkIEV4cHJlc3MgYXBwIHdpdGggSW9DLXJlc29sdmVkIGNvbnRyb2xsZXJzLlxuICogVGhlIGBkYW5pZWxhQ29udHJvbGxlci5jaGF0YCBpcyByZXNvbHZlZCB2aWEgSW52ZXJzaWZ5SlMgYW5kIGNhbm5vdCBiZSBlYXNpbHlcbiAqIG1vY2tlZCB3aXRob3V0IGEgZnVsbCBjb250YWluZXIgc2V0dXAuIFRlc3QgaXMgY29uZGl0aW9uYWxseSBza2lwcGVkIGluIHVuaXQgbW9kZS5cbiAqXG4gKiBUbyBydW46IFJVTl9JTlRFR1JBVElPTl9URVNUUz10cnVlIG5weCBqZXN0IC0tcnVuSW5CYW5kIGFpLnJvdXRlcy50ZXN0LnRzXG4gKi9cblxuY29uc3QgU0tJUF9JTlRFR1JBVElPTiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgJiYgIXByb2Nlc3MuZW52LlJVTl9JTlRFR1JBVElPTl9URVNUUztcblxuKFNLSVBfSU5URUdSQVRJT04gPyBkZXNjcmliZS5za2lwIDogZGVzY3JpYmUpKCdQT1NUIC9hcGkvdjEvYWkvY2hhdCAoU1NFIHN0cmVhbWluZyknLCAoKSA9PiB7XG4gIGl0KCdzaG91bGQgc3RyZWFtIHRva2VucyBhbmQgZmluaXNoIHdpdGggRE9ORScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XG4gICAgY29uc3QgeyBhcHAgfSA9IHJlcXVpcmUoJy4uLy4uL2FwcCcpO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgIC5wb3N0KCcvYXBpL3YxL2FpL2NoYXQnKVxuICAgICAgLnNlbmQoeyBwcm9tcHQ6ICdIaScsIGhpc3Rvcnk6IFtdIH0pXG4gICAgICAuc2V0KCdBY2NlcHQnLCAndGV4dC9ldmVudC1zdHJlYW0nKVxuICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgL3RleHRcXC9ldmVudC1zdHJlYW0vKVxuICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgY29uc3QgcGF5bG9hZCA9IHJlc3BvbnNlLnRleHQ7XG4gICAgZXhwZWN0KHBheWxvYWQpLnRvQ29udGFpbignXCJ0eXBlXCI6XCJ0ZXh0XCInKTtcbiAgICBleHBlY3QocGF5bG9hZCkudG9Db250YWluKCdIZWxsbycpO1xuICAgIGV4cGVjdChwYXlsb2FkKS50b0NvbnRhaW4oJ1tET05FXScpO1xuICB9LCAzMDAwMCk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==
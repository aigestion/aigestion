{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\system.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\system.controller.ts"],"sourcesContent":["import type { Request, Response } from 'express';\nimport os from 'os';\nimport { inject, injectable } from 'inversify';\n\nimport { SystemMetricsService } from '../services/system-metrics.service';\nimport { logger } from '../utils/logger';\nimport { getCache, setCache } from '../utils/redis';\nimport { TYPES } from '../types';\n\n@injectable()\nexport class SystemController {\n  constructor(\n    @inject(TYPES.SystemMetricsService) private metricsService: SystemMetricsService\n  ) {}\n\n  /**\n   * Get system metrics (CPU, Memory, Disk, Network)\n   */\n  async getSystemMetrics(_req: Request, res: Response): Promise<void> {\n    try {\n      const cacheKey = 'system:metrics:real';\n      const cachedData = await getCache(cacheKey);\n\n      if (cachedData) {\n        res.json(JSON.parse(cachedData));\n        return;\n      }\n\n      const metrics = await this.metricsService.getSystemMetrics();\n\n      await setCache(cacheKey, JSON.stringify(metrics), 2);\n      res.json(metrics);\n    } catch (error) {\n      logger.error(error, 'Error getting system metrics');\n      res.status(500).json({ error: 'Failed to get system metrics' });\n    }\n  }\n\n  /**\n   * Get CPU usage\n   */\n  async getCPUUsage(_req: Request, res: Response) {\n    try {\n      const cpuUsage = await this.metricsService.getCPUUsage();\n      const cpus = os.cpus();\n\n      res.json({\n        usage: cpuUsage,\n        cores: cpus.length,\n        model: cpus[0]?.model || 'Unknown',\n      });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to get CPU usage' });\n    }\n  }\n\n  /**\n   * Get memory usage\n   */\n  async getMemoryUsage(_req: Request, res: Response) {\n    try {\n      const usagePercent = await this.metricsService.getMemoryUsage();\n      const totalMem = os.totalmem();\n      const freeMem = os.freemem();\n      const usedMem = totalMem - freeMem;\n\n      res.json({\n        total: totalMem,\n        used: usedMem,\n        free: freeMem,\n        usagePercent: usagePercent,\n      });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to get memory usage' });\n    }\n  }\n\n  /**\n   * Get disk usage\n   */\n  async getDiskUsage(_req: Request, res: Response) {\n    try {\n      const usage = await this.metricsService.getDiskUsage();\n      res.json({ usage });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to get disk usage' });\n    }\n  }\n\n  /**\n   * Get network stats\n   */\n  async getNetworkStats(_req: Request, res: Response) {\n    try {\n      const networkInterfaces = os.networkInterfaces();\n      const interfaces = Object.entries(networkInterfaces).map(([name, addrs]) => ({\n        name,\n        addresses: addrs?.map(addr => ({\n          address: addr.address,\n          family: addr.family,\n          internal: addr.internal,\n        })),\n      }));\n\n      res.json({ interfaces });\n    } catch (error) {\n      res.status(500).json({ error: 'Failed to get network stats' });\n    }\n  }\n}\n"],"version":3}
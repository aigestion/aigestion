{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\google\\vertex-ai.service.ts","mappings":";;;AAAA,0CAA0C;AAC1C,qDAAkD;AAElD,+CAA4C;AAK5C,MAAa,eAAe;IAClB,QAAQ,GAAwB,IAAI,CAAC;IACrC,KAAK,GAA+B,IAAI,CAAC;IACzC,aAAa,GAAG,KAAK,CAAC;IAE9B;QACE,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAEO,UAAU;QAChB,IAAI,CAAC;YACH,MAAM,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC;YACtD,MAAM,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,qBAAqB,IAAI,aAAa,CAAC;YAEpE,IAAI,CAAC,SAAS,EAAE,CAAC;gBACf,eAAM,CAAC,IAAI,CAAC,sEAAsE,CAAC,CAAC;gBACpF,OAAO;YACT,CAAC;YAED,IAAI,CAAC,QAAQ,GAAG,IAAI,mBAAQ,CAAC,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,CAAC,CAAC;YAC/D,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE,KAAK,EAAE,gBAAgB,EAAE,CAAC,CAAC,CAAC,wBAAwB;YACpG,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;YAC1B,eAAM,CAAC,IAAI,CAAC,4CAA4C,CAAC,CAAC;QAC5D,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,KAAK,CAAC,CAAC;QAChE,CAAC;IACH,CAAC;IAED,KAAK,CAAC,YAAY,CAAC,MAAc;QAC/B,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YACvC,eAAM,CAAC,IAAI,CAAC,oDAAoD,CAAC,CAAC;YAClE,OAAO,4CAA4C,CAAC;QACtD,CAAC;QAED,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YACxD,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;YACjC,MAAM,IAAI,GAAG,QAAQ,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC;YACjE,OAAO,IAAI,IAAI,EAAE,CAAC;QACpB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,sCAAsC,EAAE,KAAK,CAAC,CAAC;YAC5D,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,OAAc,EAAE,OAAe;QACxC,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YACvC,eAAM,CAAC,IAAI,CAAC,oDAAoD,CAAC,CAAC;YAClE,OAAO,4CAA4C,CAAC;QACtD,CAAC;QAED,IAAI,CAAC;YACH,kEAAkE;YAClE,+EAA+E;YAC/E,qGAAqG;YACrG,wCAAwC;YAExC,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;gBAChC,OAAO,EAAE,OAAc,EAAE,oCAAoC;aAC9D,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;YAC/C,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;YACjC,MAAM,IAAI,GAAG,QAAQ,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC;YACjE,OAAO,IAAI,IAAI,EAAE,CAAC;QACpB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,qCAAqC,EAAE,KAAK,CAAC,CAAC;YAC3D,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,kBAAkB,CAAC,IAAY;QACnC,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;YAC1C,eAAM,CAAC,IAAI,CAAC,qDAAqD,CAAC,CAAC;YACnE,OAAO,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAChC,CAAC;QAED,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,qBAAqB,IAAI,cAAc,CAAC;YACrE,MAAM,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC;YAEtD,qDAAqD;YACrD,MAAM,KAAK,GAAG,oBAAoB,CAAC;YACnC,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,YAAY,CAAC;gBAC5E,OAAO,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE;aAC7C,CAAC,CAAC;YAEH,MAAM,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC;YACnC,OAAO,SAAS,CAAC,MAAM,IAAI,EAAE,CAAC;QAChC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,4CAA4C,EAAE,KAAK,CAAC,CAAC;YAClE,OAAO,EAAE,CAAC;QACZ,CAAC;IACH,CAAC;CACF;AAjGD,0CAiGC;AAEY,QAAA,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\google\\vertex-ai.service.ts"],"sourcesContent":["// Importing as any to avoid TS2709 errors\nimport { VertexAI } from '@google-cloud/vertexai';\n\nimport { logger } from '../../utils/logger';\n\ntype VertexAIType = any;\ntype GenerativeModelType = any;\n\nexport class VertexAIService {\n  private vertexAI: VertexAIType | null = null;\n  private model: GenerativeModelType | null = null;\n  private isInitialized = false;\n\n  constructor() {\n    this.initialize();\n  }\n\n  private initialize() {\n    try {\n      const projectId = process.env.GOOGLE_CLOUD_PROJECT_ID;\n      const location = process.env.GOOGLE_CLOUD_LOCATION || 'us-central1';\n\n      if (!projectId) {\n        logger.warn('GOOGLE_CLOUD_PROJECT_ID not set. Vertex AI service will be disabled.');\n        return;\n      }\n\n      this.vertexAI = new VertexAI({ project: projectId, location });\n      this.model = this.vertexAI.getGenerativeModel({ model: 'gemini-1.5-pro' }); // Or configurable model\n      this.isInitialized = true;\n      logger.info('Vertex AI service initialized successfully');\n    } catch (error) {\n      logger.error('Failed to initialize Vertex AI service', error);\n    }\n  }\n\n  async generateText(prompt: string): Promise<string> {\n    if (!this.isInitialized || !this.model) {\n      logger.warn('Vertex AI not initialized, returning mock response');\n      return 'Vertex AI not configurated. Mock response.';\n    }\n\n    try {\n      const result = await this.model.generateContent(prompt);\n      const response = result.response;\n      const text = response.candidates?.[0]?.content?.parts?.[0]?.text;\n      return text || '';\n    } catch (error) {\n      logger.error('Error generating text with Vertex AI', error);\n      throw error;\n    }\n  }\n\n  async chat(history: any[], message: string): Promise<string> {\n    if (!this.isInitialized || !this.model) {\n      logger.warn('Vertex AI not initialized, returning mock response');\n      return 'Vertex AI not configurated. Mock response.';\n    }\n\n    try {\n      // Map simple history format to Vertex AI Content format if needed\n      // This implementation assumes 'history' is already compatible or simple enough\n      // real implementation might need mapping. For now, starting a fresh chat for simplicity of this task\n      // or implementing a basic chat session.\n\n      const chat = this.model.startChat({\n        history: history as any, // Expecting correct format or empty\n      });\n\n      const result = await chat.sendMessage(message);\n      const response = result.response;\n      const text = response.candidates?.[0]?.content?.parts?.[0]?.text;\n      return text || '';\n    } catch (error) {\n      logger.error('Error comparing chat with Vertex AI', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Generates embeddings for a given text using Vertex AI\n   */\n  async generateEmbeddings(text: string): Promise<number[]> {\n    if (!this.isInitialized || !this.vertexAI) {\n      logger.warn('Vertex AI not initialized, returning mock embedding');\n      return new Array(768).fill(0);\n    }\n\n    try {\n      const location = process.env.GOOGLE_CLOUD_LOCATION || 'europe-west1';\n      const projectId = process.env.GOOGLE_CLOUD_PROJECT_ID;\n\n      // Using vertexAI instance to get the embedding model\n      const model = 'text-embedding-004';\n      const result = await this.vertexAI.getGenerativeModel({ model }).embedContent({\n        content: { role: 'user', parts: [{ text }] },\n      });\n\n      const embedding = result.embedding;\n      return embedding.values || [];\n    } catch (error) {\n      logger.error('Error generating embeddings with Vertex AI', error);\n      return [];\n    }\n  }\n}\n\nexport const vertexAIService = new VertexAIService();\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\instagram.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\instagram.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { injectable } from 'inversify';\n\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class InstagramService {\n  private readonly baseUrl = 'https://graph.facebook.com/v19.0';\n\n  /**\n   * Send a DM (Note: Requires specific permissions and usually only works for replying or business interactons)\n   * This implementation assumes we have a valid access token.\n   */\n  async sendDM(recipientId: string, text: string): Promise<any> {\n    if (!env.INSTAGRAM_ACCESS_TOKEN) {\n      logger.warn('INSTAGRAM_ACCESS_TOKEN not configured');\n      return { success: false, error: 'Configuration missing' };\n    }\n\n    try {\n      const response = await axios.post(\n        `${this.baseUrl}/me/messages`,\n        {\n          recipient: { id: recipientId },\n          message: { text },\n        },\n        {\n          headers: {\n            Authorization: `Bearer ${env.INSTAGRAM_ACCESS_TOKEN}`,\n            'Content-Type': 'application/json',\n          },\n        },\n      );\n      return response.data;\n    } catch (error: any) {\n      logger.error({ error: error.message }, 'Error sending Instagram DM');\n      throw error;\n    }\n  }\n\n  /**\n   * Publish a photo to Instagram Business Account\n   */\n  async publishPhoto(imageUrl: string, caption: string): Promise<string> {\n    if (!env.INSTAGRAM_ACCESS_TOKEN || !env.INSTAGRAM_BUSINESS_ACCOUNT_ID) {\n      throw new Error('Instagram credentials not configured');\n    }\n\n    try {\n      // Step 1: Create Container\n      const containerResponse = await axios.post(\n        `${this.baseUrl}/${env.INSTAGRAM_BUSINESS_ACCOUNT_ID}/media`,\n        {\n          image_url: imageUrl,\n          caption: caption,\n          access_token: env.INSTAGRAM_ACCESS_TOKEN,\n        },\n      );\n\n      const containerId = containerResponse.data.id;\n\n      // Step 2: Publish Container\n      const publishResponse = await axios.post(\n        `${this.baseUrl}/${env.INSTAGRAM_BUSINESS_ACCOUNT_ID}/media_publish`,\n        {\n          creation_id: containerId,\n          access_token: env.INSTAGRAM_ACCESS_TOKEN,\n        },\n      );\n\n      logger.info(`Instagram photo published: ${publishResponse.data.id}`);\n      return publishResponse.data.id;\n    } catch (error: any) {\n      logger.error(\n        { error: error.response?.data || error.message },\n        'Error publishing to Instagram',\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Get basic account insights\n   */\n  async getInsights(): Promise<any> {\n    if (!env.INSTAGRAM_ACCESS_TOKEN || !env.INSTAGRAM_BUSINESS_ACCOUNT_ID) {\n      return null;\n    }\n\n    try {\n      const response = await axios.get(\n        `${this.baseUrl}/${env.INSTAGRAM_BUSINESS_ACCOUNT_ID}/insights`,\n        {\n          params: {\n            metric: 'impressions,reach,profile_views',\n            period: 'day',\n            access_token: env.INSTAGRAM_ACCESS_TOKEN,\n          },\n        },\n      );\n      return response.data;\n    } catch (error: any) {\n      logger.error({ error: error.message }, 'Error fetching Instagram insights');\n      return null;\n    }\n  }\n}\n"],"version":3}
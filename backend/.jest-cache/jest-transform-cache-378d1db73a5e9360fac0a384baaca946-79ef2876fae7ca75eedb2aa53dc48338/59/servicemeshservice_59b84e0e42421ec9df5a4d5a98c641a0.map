{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\service-mesh.service.ts","mappings":";;;;;;;;;AAAA,yCAAuC;AACvC,4CAAyC;AAGlC,IAAM,kBAAkB,GAAxB,MAAM,kBAAkB;IAC7B;;OAEG;IACH,sBAAsB,CAAC,WAAmB,EAAE,IAAY,EAAE,SAAiB,IAAI;QAC7E,MAAM,IAAI,GAAG;;;;UAIP,WAAW;;;OAGd,IAAI;;;;gBAIK,WAAW;kBACT,MAAM;;;;;CAKvB,CAAC;QACE,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC;IACrB,CAAC;IAED;;OAEG;IACH,uBAAuB,CAAC,WAAmB;QACzC,MAAM,IAAI,GAAG;;;;UAIP,WAAW;;UAEX,WAAW;;;;;;;;;;;;;CAapB,CAAC;QACE,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC;IACrB,CAAC;IAED;;OAEG;IACH,kBAAkB;QAChB,eAAM,CAAC,IAAI,CAAC,8DAA8D,CAAC,CAAC;QAE5E,OAAO;YACL,iBAAiB,EAAE,IAAI,CAAC,sBAAsB,CAAC,eAAe,EAAE,eAAe,CAAC;YAChF,iBAAiB,EAAE,IAAI,CAAC,uBAAuB,CAAC,eAAe,CAAC;YAChE,kBAAkB,EAAE,IAAI,CAAC,sBAAsB,CAAC,UAAU,EAAE,oBAAoB,CAAC;YACjF,oBAAoB,EAAE,IAAI,CAAC,sBAAsB,CAAC,YAAY,EAAE,mBAAmB,CAAC;SACrF,CAAC;IACJ,CAAC;CACF,CAAA;AAlEY,gDAAkB;6BAAlB,kBAAkB;IAD9B,IAAA,sBAAU,GAAE;GACA,kBAAkB,CAkE9B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\service-mesh.service.ts"],"sourcesContent":["import { injectable } from 'inversify';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class ServiceMeshService {\n  /**\n   * Generates a basic Istio VirtualService configuration for a given service.\n   */\n  generateVirtualService(serviceName: string, host: string, subset: string = 'v1'): string {\n    const yaml = `\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ${serviceName}\nspec:\n  hosts:\n  - \"${host}\"\n  http:\n  - route:\n    - destination:\n        host: ${serviceName}\n        subset: ${subset}\n    retries:\n      attempts: 3\n      perTryTimeout: 2s\n    timeout: 10s\n`;\n    return yaml.trim();\n  }\n\n  /**\n   * Generates a DestinationRule for circuit breaking.\n   */\n  generateDestinationRule(serviceName: string): string {\n    const yaml = `\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: ${serviceName}\nspec:\n  host: ${serviceName}\n  trafficPolicy:\n    connectionPool:\n      tcp:\n        maxConnections: 100\n      http:\n        http1MaxPendingRequests: 1024\n        maxRequestsPerConnection: 10\n    outlierDetection:\n      consecutive5xxErrors: 5\n      interval: 30s\n      baseEjectionTime: 30s\n      maxEjectionPercent: 50\n`;\n    return yaml.trim();\n  }\n\n  /**\n   * Scaffolds a full mesh config for the AIGestion backend.\n   */\n  scaffoldMeshConfig(): any {\n    logger.info('[ServiceMesh] Generating scaffolding for backend services...');\n\n    return {\n      'backend-vs.yaml': this.generateVirtualService('nexus-backend', 'api.nexus.com'),\n      'backend-dr.yaml': this.generateDestinationRule('nexus-backend'),\n      'rag-core-vs.yaml': this.generateVirtualService('rag-core', 'rag.nexus.internal'),\n      'ml-service-vs.yaml': this.generateVirtualService('ml-service', 'ai.nexus.internal'),\n    };\n  }\n}\n"],"version":3}
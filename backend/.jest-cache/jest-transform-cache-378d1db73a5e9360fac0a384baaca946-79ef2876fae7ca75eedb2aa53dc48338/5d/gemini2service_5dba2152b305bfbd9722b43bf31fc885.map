{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\gemini-2.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\gemini-2.service.ts"],"sourcesContent":["import { injectable, inject } from 'inversify';\nimport { DanielaAIService } from './daniela-ai.service';\n\n/**\n * Gemini 2.0 Service\n * Integración con el último modelo Gemini 2.0 Pro\n */\n@injectable()\nexport class Gemini2Service {\n  private client: any;\n\n  constructor(@inject(DanielaAIService) private daniela: DanielaAIService) {}\n\n  async initialize() {\n    try {\n      // Nota: Requiere @google-cloud/vertexai\n      const { VertexAI } = require('@google-cloud/vertexai');\n\n      this.client = new VertexAI({\n        project: process.env.GOOGLE_CLOUD_PROJECT_ID,\n        location: process.env.VERTEX_AI_LOCATION,\n      });\n\n      console.log('✅ Gemini 2.0 Service initialized');\n    } catch (error) {\n      console.error('Error initializing Gemini 2.0:', error);\n      throw error;\n    }\n  }\n\n  async generateText(prompt: string, options: any = {}) {\n    try {\n      const model = this.client.getGenerativeModel({\n        model: process.env.GEMINI_2_MODEL || 'gemini-2.0-pro',\n      });\n\n      const request = {\n        contents: [\n          {\n            role: 'user',\n            parts: [{ text: prompt }],\n          },\n        ],\n        generationConfig: {\n          temperature: options.temperature || 0.7,\n          maxOutputTokens: options.maxTokens || 4096,\n          topP: 0.95,\n          topK: 40,\n        },\n      };\n\n      const response = await model.generateContent(request);\n      return response.response.text();\n    } catch (error) {\n      console.error('Error generating text with Gemini 2.0:', error);\n      throw error;\n    }\n  }\n\n  async analyzeImage(imageUrl: string, prompt: string) {\n    try {\n      const model = this.client.getGenerativeModel({\n        model: 'gemini-2.0-pro-vision',\n      });\n\n      const imageData = await this.urlToBase64(imageUrl);\n\n      const response = await model.generateContent([\n        {\n          inlineData: {\n            mimeType: 'image/jpeg',\n            data: imageData,\n          },\n        },\n        { text: prompt },\n      ]);\n\n      return response.response.text();\n    } catch (error) {\n      console.error('Error analyzing image:', error);\n      throw error;\n    }\n  }\n\n  async multimodalAnalysis(inputs: { text?: string; imageUrl?: string; audioUrl?: string }) {\n    try {\n      const model = this.client.getGenerativeModel({\n        model: 'gemini-2.0-pro-multimodal',\n      });\n\n      const content: any[] = [];\n\n      if (inputs.text) {\n        content.push({ text: inputs.text });\n      }\n\n      if (inputs.imageUrl) {\n        const imageData = await this.urlToBase64(inputs.imageUrl);\n        content.push({\n          inlineData: {\n            mimeType: 'image/jpeg',\n            data: imageData,\n          },\n        } as any);\n      }\n\n      const response = await model.generateContent(content);\n      return response.response.text();\n    } catch (error) {\n      console.error('Error in multimodal analysis:', error);\n      throw error;\n    }\n  }\n\n  async streamResponse(prompt: string) {\n    try {\n      const model = this.client.getGenerativeModel({\n        model: 'gemini-2.0-flash',\n      });\n\n      const response = await model.generateContentStream({\n        contents: [\n          {\n            role: 'user',\n            parts: [{ text: prompt }],\n          },\n        ],\n      });\n\n      return response;\n    } catch (error) {\n      console.error('Error streaming response:', error);\n      throw error;\n    }\n  }\n\n  async functionCalling(\n    prompt: string,\n    functions: Array<{\n      name: string;\n      description: string;\n      parameters: any;\n    }>,\n  ) {\n    try {\n      const model = this.client.getGenerativeModel({\n        model: 'gemini-2.0-pro',\n      });\n\n      const tools = {\n        functionDeclarations: functions,\n      };\n\n      const response = await model.generateContent({\n        contents: [\n          {\n            role: 'user',\n            parts: [{ text: prompt }],\n          },\n        ],\n        tools: [tools],\n      });\n\n      return response;\n    } catch (error) {\n      console.error('Error in function calling:', error);\n      throw error;\n    }\n  }\n\n  async summarizeText(text: string, length: 'short' | 'medium' | 'long' = 'medium') {\n    try {\n      const lengthMap = {\n        short: '1-2 sentences',\n        medium: '3-5 sentences',\n        long: '1 paragraph',\n      };\n\n      const prompt = `Summarize the following text in ${lengthMap[length]}:\\n\\n${text}`;\n\n      return await this.generateText(prompt, {\n        maxTokens: length === 'short' ? 100 : length === 'medium' ? 200 : 500,\n      });\n    } catch (error) {\n      console.error('Error summarizing text:', error);\n      throw error;\n    }\n  }\n\n  async translateText(text: string, targetLanguage: string) {\n    try {\n      const prompt = `Translate the following text to ${targetLanguage}:\\n\\n${text}`;\n\n      return await this.generateText(prompt);\n    } catch (error) {\n      console.error('Error translating text:', error);\n      throw error;\n    }\n  }\n\n  async classifyContent(text: string, categories: string[]) {\n    try {\n      const prompt = `Classify the following text into one of these categories: ${categories.join(\n        ', ',\n      )}\\n\\nText: ${text}`;\n\n      return await this.generateText(prompt);\n    } catch (error) {\n      console.error('Error classifying content:', error);\n      throw error;\n    }\n  }\n\n  private async urlToBase64(url: string): Promise<string> {\n    try {\n      const response = await fetch(url);\n      const buffer = await response.arrayBuffer();\n      return Buffer.from(buffer).toString('base64');\n    } catch (error) {\n      console.error('Error converting URL to base64:', error);\n      throw error;\n    }\n  }\n}\n"],"version":3}
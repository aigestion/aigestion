{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\economy.service.ts","mappings":";;;;;;;;;;;;;;;;;;;AAAA,kDAA0B;AAC1B,yCAA+C;AAC/C,qDAA2C;AAC3C,4CAAyC;AACzC,0CAAoD;AACpD,oCAAiC;AACjC,uEAAkE;AA2B3D,IAAM,cAAc,GAApB,MAAM,cAAc;IAWgC;IAVxC,eAAe,CAAS;IACxB,SAAS,CAAS;IAClB,MAAM,GAAG;QACxB,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE,KAAK,EAAE;QAClD,EAAE,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE;QAC9C,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE;QACnD,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE;QAClD,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE;KAClD,CAAC;IAEF,YAAyD,WAAkC;QAAlC,gBAAW,GAAX,WAAW,CAAuB;QACzF,IAAI,CAAC,eAAe,GAAG,gBAAG,CAAC,gBAAgB,IAAI,EAAE,CAAC;QAClD,IAAI,CAAC,SAAS,GAAG,gBAAG,CAAC,cAAc,IAAI,EAAE,CAAC;IAC5C,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,gBAAgB;QACpB,eAAM,CAAC,IAAI,CAAC,gEAAgE,CAAC,CAAC;QAC9E,MAAM,OAAO,GAAiB,EAAE,CAAC;QAEjC,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChC,IAAI,CAAC;gBACH,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAC/C,IAAI,SAAS,EAAE,CAAC;oBACd,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC1B,CAAC;YACH,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,eAAM,CAAC,KAAK,CAAC,8CAA8C,KAAK,CAAC,MAAM,GAAG,EAAE,KAAK,CAAC,CAAC;YACrF,CAAC;QACH,CAAC;QAED,OAAO,OAAO,CAAC;IACjB,CAAC;IAEO,KAAK,CAAC,UAAU,CAAC,KAAuC;QAC9D,MAAM,QAAQ,GAAG,iBAAiB,KAAK,CAAC,MAAM,EAAE,CAAC;QACjD,MAAM,MAAM,GAAG,MAAM,IAAA,gBAAQ,EAAC,QAAQ,CAAC,CAAC;QACxC,IAAI,MAAM;YAAE,OAAO,MAAM,CAAC;QAE1B,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;YAC1B,iDAAiD;YACjD,OAAO;gBACL,MAAM,EAAE,KAAK,CAAC,MAAM;gBACpB,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI;gBAC3B,MAAM,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,EAAE;gBAClC,aAAa,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG;aAC5D,CAAC;QACJ,CAAC;QAED,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YAC5B,GAAG,GAAG,qEAAqE,KAAK,CAAC,MAAM,oCAAoC,IAAI,CAAC,eAAe,EAAE,CAAC;QACpJ,CAAC;aAAM,IAAI,KAAK,CAAC,IAAI,KAAK,WAAW,EAAE,CAAC;YACtC,gEAAgE;YAChE,GAAG,GAAG,8EAA8E,IAAI,CAAC,eAAe,EAAE,CAAC;QAC7G,CAAC;aAAM,CAAC;YACN,GAAG,GAAG,kEAAkE,KAAK,CAAC,MAAM,WAAW,IAAI,CAAC,eAAe,EAAE,CAAC;QACxH,CAAC;QAED,MAAM,GAAG,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjC,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,iCAAiC,CAAC,CAAC;QAErF,IAAI,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE,CAAC;YACpC,kCAAkC;YAClC,OAAO,IAAI,CAAC;QACd,CAAC;QAED,2DAA2D;QAC3D,yEAAyE;QACzE,MAAM,MAAM,GAAG;YACb,MAAM,EAAE,KAAK,CAAC,MAAM;YACpB,KAAK,EAAE,MAAM,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC,kBAAkB,CAAC,IAAI,GAAG,CAAC;YAClF,MAAM,EAAE,MAAM,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,YAAY,CAAC,IAAI,GAAG,CAAC;YACtD,aAAa,EAAE,IAAI,EAAE,CAAC,oBAAoB,CAAC,IAAI,IAAI;SACpD,CAAC;QAEF,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC;YACrB,MAAM,IAAA,gBAAQ,EAAC,QAAQ,EAAE,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,2BAA2B;QACpE,CAAC;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,uBAAuB;QAC3B,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC7C,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC;YAAE,OAAO,6DAA6D,CAAC;QAE9F,IAAI,MAAM,GAAG,sCAAsC,CAAC;QACpD,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;YACjB,MAAM,IAAI,GAAG,CAAC,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC;YACzC,MAAM,IAAI,GAAG,IAAI,KAAK,CAAC,CAAC,MAAM,OAAO,CAAC,CAAC,KAAK,CAAC,cAAc,EAAE,KAAK,CAAC,CAAC,aAAa,KAAK,CAAC;QACzF,CAAC,CAAC,CAAC;QAEH,MAAM,IAAI,sBAAsB,IAAI,IAAI,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC;QACtE,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;OAEG;IACK,QAAQ,CAAC,GAAW;QAC1B,OAAO,MAAM,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;IAChC,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,kBAAkB;QACtB,MAAM,QAAQ,GAAG,mBAAmB,CAAC;QACrC,MAAM,MAAM,GAAG,MAAM,IAAA,gBAAQ,EAAC,QAAQ,CAAC,CAAC;QACxC,IAAI,MAAM;YAAE,OAAO,MAAM,CAAC;QAE1B,IAAI,CAAC,IAAI,CAAC,eAAe;YAAE,OAAO,SAAS,CAAC;QAE5C,IAAI,CAAC;YACH,MAAM,GAAG,GAAG,MAAM,eAAK,CAAC,GAAG,CACzB,oEAAoE,IAAI,CAAC,eAAe,EAAE,CAC3F,CAAC;YACF,MAAM,SAAS,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,uBAAuB,IAAI,SAAS,CAAC;YAC3E,MAAM,MAAM,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;YACvC,MAAM,IAAA,gBAAQ,EAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,uBAAuB;YAC/D,OAAO,MAAM,CAAC;QAChB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;YAChE,OAAO,SAAS,CAAC;QACnB,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,sBAAsB;QAC1B,MAAM,QAAQ,GAAG,sBAAsB,CAAC;QACxC,MAAM,MAAM,GAAG,MAAM,IAAA,gBAAQ,EAAC,QAAQ,CAAC,CAAC;QACxC,IAAI,MAAM;YAAE,OAAO,MAAM,CAAC;QAE1B,IAAI,CAAC,IAAI,CAAC,SAAS;YAAE,OAAO,qDAAqD,CAAC;QAElF,IAAI,CAAC;YACH,eAAM,CAAC,IAAI,CAAC,+DAA+D,CAAC,CAAC;YAC7E,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,IAAI,CAAC,+BAA+B,EAAE;gBACjE,OAAO,EAAE,IAAI,CAAC,SAAS;gBACvB,KAAK,EACH,6FAA6F;gBAC/F,YAAY,EAAE,OAAO;gBACrB,cAAc,EAAE,IAAI;gBACpB,WAAW,EAAE,CAAC;aACf,CAAC,CAAC;YAEH,MAAM,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;YACpC,MAAM,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;YAExF,MAAM,MAAM,GAAG,MAAM;gBACnB,CAAC,CAAC,+BAA+B,MAAM,wBAAwB,OAAO,EAAE;gBACxE,CAAC,CAAC,8BAA8B,OAAO,EAAE,CAAC;YAE5C,MAAM,IAAA,gBAAQ,EAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,0BAA0B;YAClE,OAAO,MAAM,CAAC;QAChB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,wCAAwC,EAAE,KAAK,CAAC,CAAC;YAC9D,OAAO,gEAAgE,CAAC;QAC1E,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,mBAAmB;QAMvB,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC7C,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAClD,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,sBAAsB,EAAE,CAAC;QACvD,MAAM,aAAa,GAAa,EAAE,CAAC;QAEnC,kCAAkC;QAClC,IAAI,CAAC;YACH,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,cAAc,EAAE,CAAC;YAC1D,IAAI,SAAS,IAAI,SAAS,CAAC,OAAO,EAAE,CAAC;gBACnC,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAM,EAAE,EAAE;oBACnC,IAAI,CAAC,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC;wBACd,aAAa,CAAC,IAAI,CAChB,0BAA0B,CAAC,CAAC,KAAK,uBAAuB,CAAC,CAAC,GAAG,iCAAiC,CAAC,CAAC,cAAc,IAAI,CACnH,CAAC;oBACJ,CAAC;gBACH,CAAC,CAAC,CAAC;YACL,CAAC;QACH,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,eAAM,CAAC,IAAI,CAAC,+DAA+D,CAAC,CAAC;QAC/E,CAAC;QAED,kCAAkC;QAClC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;YACjB,MAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,aAAa,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC;YAC/D,IAAI,SAAS,GAAG,CAAC,CAAC,EAAE,CAAC;gBACnB,aAAa,CAAC,IAAI,CAChB,OAAO,CAAC,CAAC,MAAM,kBAAkB,CAAC,CAAC,aAAa,oEAAoE,CACrH,CAAC;YACJ,CAAC;iBAAM,IAAI,SAAS,GAAG,CAAC,EAAE,CAAC;gBACzB,aAAa,CAAC,IAAI,CAChB,OAAO,CAAC,CAAC,MAAM,qBAAqB,CAAC,CAAC,aAAa,sDAAsD,CAC1G,CAAC;YACJ,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,IAAI,SAAS,KAAK,SAAS,IAAI,SAAS,KAAK,kBAAkB,EAAE,CAAC;YAChE,aAAa,CAAC,IAAI,CAChB,sGAAsG,CACvG,CAAC;QACJ,CAAC;aAAM,IAAI,SAAS,KAAK,SAAS,IAAI,SAAS,KAAK,kBAAkB,EAAE,CAAC;YACvE,aAAa,CAAC,IAAI,CAChB,qHAAqH,CACtH,CAAC;QACJ,CAAC;QAED,IAAI,MAAM,GAAG,+CAA+C,CAAC;QAE7D,MAAM,IAAI,GAAG,UAAU,MAAM,CAAC;QAE9B,IAAI,aAAa,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC7B,MAAM,IAAI,mCAAmC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;QAC5E,CAAC;aAAM,CAAC;YACN,MAAM,IAAI,6HAA6H,CAAC;QAC1I,CAAC;QAED,OAAO;YACL,MAAM;YACN,SAAS;YACT,aAAa;YACb,UAAU;SACX,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,mBAAmB;QACvB,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAE9C,2BAA2B;QAC3B,sCAAsC;QACtC,MAAM,KAAK,GAAG,CAAC,IAAY,EAAE,EAAE,CAC7B,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;QAE1E,MAAM,KAAK,GAAG,6EAA6E,CAAC;QAE5F,6BAA6B;QAC7B,IAAI,aAAa,GAAG,EAAE,CAAC;QACvB,IAAI,IAAI,CAAC,SAAS,KAAK,SAAS;YAC9B,aAAa,GAAG,gDAAgD,CAAC;aAC9D,IAAI,IAAI,CAAC,SAAS,KAAK,SAAS;YACnC,aAAa,GAAG,0DAA0D,CAAC;;YACxE,aAAa,GAAG,+DAA+D,CAAC;QAErF,oEAAoE;QACpE,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE,CAAC;YAClE,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,oCAAoC;YAC3F,OAAO,GAAG,6BAA6B,QAAQ,GAAG,CAAC;QACrD,CAAC;QAED,IAAI,iBAAiB,GAAG,mDAAmD,CAAC;QAC5E,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAClC,iBAAiB;gBACf,2BAA2B,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAC3F,CAAC;QAED,MAAM,MAAM,GAAG,GAAG,KAAK,IAAI,aAAa,IAAI,OAAO,IAAI,iBAAiB,IAAI,KAAK,CAC/E,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,CACpC,EAAE,CAAC;QAEJ,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,aAAa,CAAC,KAAoC;QACtD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC7C,MAAM,YAAY,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,KAAK,CAAC,MAAM,CAAC,EAAE,KAAK,IAAI,CAAC,CAAC;QAC7E,MAAM,SAAS,GAAG,KAAK,CAAC,WAAW,GAAG,YAAY,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC;QAEvE,MAAM,SAAS,GAAe,EAAE,GAAG,KAAK,EAAE,SAAS,EAAE,CAAC;QACtD,MAAM,QAAQ,GAAG,kBAAkB,KAAK,CAAC,MAAM,EAAE,CAAC;QAClD,MAAM,QAAQ,GAAG,CAAC,MAAM,IAAA,gBAAQ,EAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;QAElD,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACzB,MAAM,IAAA,gBAAQ,EAAC,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,4BAA4B;QAEnE,eAAM,CAAC,IAAI,CACT,oCAAoC,KAAK,CAAC,MAAM,KAAK,KAAK,CAAC,MAAM,IAAI,SAAS,IAAI,KAAK,CAAC,WAAW,EAAE,CACtG,CAAC;QACF,OAAO,SAAS,CAAC;IACnB,CAAC;IAED,KAAK,CAAC,eAAe,CAAC,MAAc;QAClC,OAAO,CAAC,MAAM,IAAA,gBAAQ,EAAC,kBAAkB,MAAM,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IAC5D,CAAC;IAED,KAAK,CAAC,gBAAgB;QACpB,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC7C,sEAAsE;QACtE,2CAA2C;QAC3C,6DAA6D;QAC7D,MAAM,SAAS,GAAG,CAAC,yBAAyB,CAAC,CAAC,CAAC,uCAAuC;QACtF,MAAM,eAAe,GAAiB,EAAE,CAAC;QAEzC,KAAK,MAAM,GAAG,IAAI,SAAS,EAAE,CAAC;YAC5B,MAAM,MAAM,GAAiB,CAAC,MAAM,IAAA,gBAAQ,EAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;YACzD,MAAM,WAAW,GAAiB,EAAE,CAAC;YAErC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrB,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,KAAK,CAAC,MAAM,CAAC,CAAC;gBAC5D,IAAI,CAAC,OAAO,EAAE,CAAC;oBACb,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;oBACxB,OAAO;gBACT,CAAC;gBAED,MAAM,SAAS,GACb,KAAK,CAAC,SAAS,KAAK,OAAO;oBACzB,CAAC,CAAC,OAAO,CAAC,KAAK,IAAI,KAAK,CAAC,WAAW;oBACpC,CAAC,CAAC,OAAO,CAAC,KAAK,IAAI,KAAK,CAAC,WAAW,CAAC;gBAEzC,IAAI,SAAS,EAAE,CAAC;oBACd,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC9B,CAAC;qBAAM,CAAC;oBACN,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC1B,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,IAAI,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAC/B,MAAM,IAAA,gBAAQ,EAAC,GAAG,EAAE,WAAW,EAAE,CAAC,CAAC,CAAC;YACtC,CAAC;QACH,CAAC;QAED,OAAO,eAAe,CAAC;IACzB,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,oBAAoB,CACxB,MAAc,EACd,MAAc,EACd,MAAc,EACd,UAAkB;QAElB,MAAM,QAAQ,GAAG,qBAAqB,MAAM,EAAE,CAAC;QAC/C,MAAM,SAAS,GAAU,CAAC,MAAM,IAAA,gBAAQ,EAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;QAE1D,0BAA0B;QAC1B,MAAM,aAAa,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,CAAC;QACpE,IAAI,aAAa,IAAI,CAAC,EAAE,CAAC;YACvB,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC;QAC5D,CAAC;aAAM,CAAC;YACN,SAAS,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,CAAC,CAAC;QACjD,CAAC;QAED,MAAM,IAAA,gBAAQ,EAAC,QAAQ,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;IACzC,CAAC;IAED,KAAK,CAAC,iBAAiB,CAAC,MAAc;QACpC,MAAM,QAAQ,GAAG,qBAAqB,MAAM,EAAE,CAAC;QAC/C,MAAM,SAAS,GAAU,CAAC,MAAM,IAAA,gBAAQ,EAAC,QAAQ,CAAC,CAAC,IAAI,EAAE,CAAC;QAC1D,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC7C,MAAM,KAAK,GAAoB,EAAE,CAAC;QAElC,KAAK,MAAM,GAAG,IAAI,SAAS,EAAE,CAAC;YAC5B,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,GAAG,CAAC,MAAM,CAAC,CAAC;YAC1D,MAAM,YAAY,GAAG,OAAO,EAAE,KAAK,IAAI,CAAC,CAAC;YACzC,MAAM,GAAG,GAAG,CAAC,YAAY,GAAG,GAAG,CAAC,UAAU,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC;YACzD,MAAM,UAAU,GACd,GAAG,CAAC,UAAU,GAAG,CAAC;gBAChB,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY,GAAG,GAAG,CAAC,UAAU,CAAC,GAAG,GAAG,CAAC,UAAU,CAAC,GAAG,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG;gBAC7E,CAAC,CAAC,IAAI,CAAC;YAEX,KAAK,CAAC,IAAI,CAAC;gBACT,GAAG,GAAG;gBACN,YAAY;gBACZ,GAAG;gBACH,UAAU;aACX,CAAC,CAAC;QACL,CAAC;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,mBAAmB,CAAC,MAAc;QACtC,MAAM,QAAQ,GAAG,mBAAmB,MAAM,EAAE,CAAC;QAC7C,MAAM,MAAM,GAAG,MAAM,IAAA,gBAAQ,EAAC,QAAQ,CAAC,CAAC;QACxC,IAAI,MAAM;YAAE,OAAO,MAAM,CAAC;QAE1B,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;YAC1B,uBAAuB;YACvB,OAAO,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC;QAChE,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;QACtF,IAAI,GAAG,GAAG,EAAE,CAAC;QAEb,IAAI,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YAC5B,GAAG,GAAG,4EAA4E,MAAM,sBAAsB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvI,CAAC;aAAM,CAAC;YACN,GAAG,GAAG,uEAAuE,MAAM,WAAW,IAAI,CAAC,eAAe,EAAE,CAAC;QACvH,CAAC;QAED,IAAI,CAAC;YACH,MAAM,GAAG,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjC,MAAM,UAAU,GACd,GAAG,CAAC,IAAI,CAAC,qBAAqB,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;YAEtF,IAAI,CAAC,UAAU;gBAAE,OAAO,EAAE,CAAC;YAE3B,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC;iBACrC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,eAAe;iBAC5B,GAAG,CAAC,CAAC,GAAQ,EAAE,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,GAAG,CAAC,iBAAiB,CAAC,CAAC,CAAC;iBACxE,OAAO,EAAE,CAAC;YAEb,MAAM,IAAA,gBAAQ,EAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,4BAA4B;YACxE,OAAO,MAAM,CAAC;QAChB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,6CAA6C,MAAM,GAAG,EAAE,KAAK,CAAC,CAAC;YAC5E,OAAO,EAAE,CAAC;QACZ,CAAC;IACH,CAAC;CACF,CAAA;AArbY,wCAAc;yBAAd,cAAc;IAD1B,IAAA,sBAAU,GAAE;IAYE,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,qBAAqB,CAAC,CAAA;yDAAsB,+CAAqB,oBAArB,+CAAqB;GAXhF,cAAc,CAqb1B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\economy.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { inject, injectable } from 'inversify';\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\nimport { getCache, setCache } from '../cache/redis';\nimport { TYPES } from '../types';\nimport { DeFiStrategistService } from './defi-strategist.service';\n\nexport interface PriceAlert {\n  symbol: string;\n  targetPrice: number;\n  condition: 'above' | 'below';\n  chatId: number;\n  userId: string;\n}\n\nexport interface PortfolioItem {\n  symbol: string;\n  amount: number;\n  entryPrice: number;\n  currentPrice: number;\n  pnl: number;\n  pnlPercent: string;\n}\n\nexport interface AssetPrice {\n  symbol: string;\n  price: number;\n  change: number;\n  changePercent: string;\n}\n\n@injectable()\nexport class EconomyService {\n  private readonly alphaVantageKey: string;\n  private readonly tavilyKey: string;\n  private readonly assets = [\n    { symbol: 'GOLD', type: 'COMMODITY', name: 'Oro' },\n    { symbol: 'XRP', type: 'CRYPTO', name: 'XRP' },\n    { symbol: 'PLTR', type: 'STOCK', name: 'Palantir' },\n    { symbol: 'GOOGL', type: 'STOCK', name: 'Google' },\n    { symbol: 'NVDA', type: 'STOCK', name: 'Nvidia' },\n  ];\n\n  constructor(@inject(TYPES.DeFiStrategistService) private defiService: DeFiStrategistService) {\n    this.alphaVantageKey = env.ALPHAVANTAGE_KEY || '';\n    this.tavilyKey = env.TAVILY_API_KEY || '';\n  }\n\n  /**\n   * Fetch current prices for all tracked assets\n   */\n  async getEconomyUpdate(): Promise<AssetPrice[]> {\n    logger.info('[EconomyService] Fetching market updates for tracked assets...');\n    const results: AssetPrice[] = [];\n\n    for (const asset of this.assets) {\n      try {\n        const priceData = await this.fetchPrice(asset);\n        if (priceData) {\n          results.push(priceData);\n        }\n      } catch (error) {\n        logger.error(`[EconomyService] Failed to fetch price for ${asset.symbol}:`, error);\n      }\n    }\n\n    return results;\n  }\n\n  private async fetchPrice(asset: { symbol: string; type: string }): Promise<AssetPrice | null> {\n    const cacheKey = `economy:price:${asset.symbol}`;\n    const cached = await getCache(cacheKey);\n    if (cached) return cached;\n\n    if (!this.alphaVantageKey) {\n      // Mock data if no key is provided (for dev/demo)\n      return {\n        symbol: asset.symbol,\n        price: Math.random() * 2000,\n        change: (Math.random() - 0.5) * 10,\n        changePercent: ((Math.random() - 0.5) * 2).toFixed(2) + '%',\n      };\n    }\n\n    let url = '';\n    if (asset.type === 'CRYPTO') {\n      url = `https://www.alphavantage.co/query?function=CRYPTO_INTRADAY&symbol=${asset.symbol}&market=USD&interval=5min&apikey=${this.alphaVantageKey}`;\n    } else if (asset.type === 'COMMODITY') {\n      // AlphaVantage has specific functions for commodities like Gold\n      url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=GOLD&apikey=${this.alphaVantageKey}`;\n    } else {\n      url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${asset.symbol}&apikey=${this.alphaVantageKey}`;\n    }\n\n    const res = await axios.get(url);\n    const data = res.data['Global Quote'] || res.data['Realtime Currency Exchange Rate'];\n\n    if (!data && asset.type === 'STOCK') {\n      // Fallback or handle missing data\n      return null;\n    }\n\n    // Transform AlphaVantage response to simplified AssetPrice\n    // Note: In a real implementation, we'd need more robust parsing per type\n    const result = {\n      symbol: asset.symbol,\n      price: Number.parseFloat(data?.['05. price'] || data?.['5. Exchange Rate'] || '0'),\n      change: Number.parseFloat(data?.['09. change'] || '0'),\n      changePercent: data?.['10. change percent'] || '0%',\n    };\n\n    if (result.price > 0) {\n      await setCache(cacheKey, result, 900); // 15 mins cache for prices\n    }\n\n    return result;\n  }\n\n  /**\n   * Generate a formatted report for Telegram/Daniela\n   */\n  async generateFormattedReport(): Promise<string> {\n    const prices = await this.getEconomyUpdate();\n    if (prices.length === 0) return '‚ùå No se pudo obtener informaci√≥n econ√≥mica en este momento.';\n\n    let report = `üìä *Resumen Econ√≥mico AIGestion*\\n\\n`;\n    prices.forEach(p => {\n      const icon = p.change >= 0 ? 'üìà' : 'üìâ';\n      report += `${icon} *${p.symbol}*: $${p.price.toLocaleString()} (${p.changePercent})\\n`;\n    });\n\n    report += `\\nüïí _Actualizado: ${new Date().toLocaleString('es-ES')}_`;\n    return report;\n  }\n\n  /**\n   * Prefer Number.parseFloat over parseFloat (Lint Fix)\n   */\n  private parseNum(val: string): number {\n    return Number.parseFloat(val);\n  }\n\n  /**\n   * Get overall market sentiment using News Sentiment API\n   */\n  async getMarketSentiment(): Promise<string> {\n    const cacheKey = 'economy:sentiment';\n    const cached = await getCache(cacheKey);\n    if (cached) return cached;\n\n    if (!this.alphaVantageKey) return 'NEUTRAL';\n\n    try {\n      const res = await axios.get(\n        `https://www.alphavantage.co/query?function=NEWS_SENTIMENT&apikey=${this.alphaVantageKey}`,\n      );\n      const sentiment = res.data.feed?.[0]?.overall_sentiment_label || 'NEUTRAL';\n      const result = sentiment.toUpperCase();\n      await setCache(cacheKey, result, 3600); // 1 hour for sentiment\n      return result;\n    } catch (error) {\n      logger.error('[EconomyService] Sentiment fetch failed:', error);\n      return 'NEUTRAL';\n    }\n  }\n\n  /**\n   * Get Geopolitical Context from Tavily\n   */\n  async getGeopoliticalContext(): Promise<string> {\n    const cacheKey = 'economy:geopolitical';\n    const cached = await getCache(cacheKey);\n    if (cached) return cached;\n\n    if (!this.tavilyKey) return 'Contexto geopol√≠tico no disponible (Falta API Key).';\n\n    try {\n      logger.info('[EconomyService] Fetching geopolitical context from Tavily...');\n      const response = await axios.post('https://api.tavily.com/search', {\n        api_key: this.tavilyKey,\n        query:\n          'latest major geopolitical events impacting global markets economy war trade sanctions today',\n        search_depth: 'basic',\n        include_answer: true,\n        max_results: 3,\n      });\n\n      const answer = response.data.answer;\n      const results = response.data.results?.map((r: any) => `‚Ä¢ ${r.title}`).join('\\n') || '';\n\n      const result = answer\n        ? `üåç *Contexto Global (IA)*:\\n${answer}\\n\\nüì∞ *Titulares:*\\n${results}`\n        : `üåç *Noticias Relevantes:*\\n${results}`;\n\n      await setCache(cacheKey, result, 7200); // 2 hours for geo context\n      return result;\n    } catch (error) {\n      logger.error('[EconomyService] Tavily search failed:', error);\n      return '‚ö†Ô∏è No se pudo obtener el contexto geopol√≠tico en este momento.';\n    }\n  }\n\n  /**\n   * Generate investment recommendations based on data\n   */\n  async getInvestmentAdvice(): Promise<{\n    advice: string;\n    sentiment: string;\n    opportunities: string[];\n    geoContext: string;\n  }> {\n    const prices = await this.getEconomyUpdate();\n    const sentiment = await this.getMarketSentiment();\n    const geoContext = await this.getGeopoliticalContext();\n    const opportunities: string[] = [];\n\n    // Integration with DeFiStrategist\n    try {\n      const yieldData = await this.defiService.getYieldAdvice();\n      if (yieldData && yieldData.wallets) {\n        yieldData.wallets.forEach((w: any) => {\n          if (w.apy > 5) {\n            opportunities.push(\n              `üíé *Oportunidad DeFi*: ${w.asset} est√° rindiendo un *${w.apy}% APY*. Estrategia sugerida: *${w.recommendation}*.`,\n            );\n          }\n        });\n      }\n    } catch (err) {\n      logger.warn('[EconomyService] DeFi yield fetch failed, skipping yield info');\n    }\n\n    // Basic logic for recommendations\n    prices.forEach(p => {\n      const changeNum = parseFloat(p.changePercent.replace('%', ''));\n      if (changeNum < -3) {\n        opportunities.push(\n          `üî• *${p.symbol}* ha bajado un ${p.changePercent}. Podr√≠a ser una oportunidad de compra si mantienes a largo plazo.`,\n        );\n      } else if (changeNum > 5) {\n        opportunities.push(\n          `üöÄ *${p.symbol}* est√° en rally (+${p.changePercent}). Considera proteger ganancias con stops din√°micos.`,\n        );\n      }\n    });\n\n    if (sentiment === 'BULLISH' || sentiment === 'SOMEWHAT_BULLISH') {\n      opportunities.push(\n        'üåü El sentimiento general es alcista. Buen momento para mantener posiciones fuertes en NVDA y GOOGL.',\n      );\n    } else if (sentiment === 'BEARISH' || sentiment === 'SOMEWHAT_BEARISH') {\n      opportunities.push(\n        '‚ö†Ô∏è Alerta: El sentimiento de noticias es bajista. Considera aumentar liquidez o buscar activos refugio como el Oro.',\n      );\n    }\n\n    let advice = `üí° *Recomendaci√≥n Estrat√©gica (God Mode)*\\n\\n`;\n\n    advice += `${geoContext}\\n\\n`;\n\n    if (opportunities.length > 0) {\n      advice += `üéØ *Oportunidades Detectadas:*\\n${opportunities.join('\\n\\n')}`;\n    } else {\n      advice += `üõ°Ô∏è *Estrategia:* El mercado se encuentra estable. Mant√©n tu diversificaci√≥n actual entre Oro, Crypto y Stocks de Big Tech.`;\n    }\n\n    return {\n      advice,\n      sentiment,\n      opportunities,\n      geoContext,\n    };\n  }\n\n  /**\n   * Generate a script optimized for Text-to-Speech\n   */\n  async generateVoiceScript(): Promise<string> {\n    const data = await this.getInvestmentAdvice();\n\n    // Clean up text for speech\n    // Remove markdown symbols (*, `, etc)\n    const clean = (text: string) =>\n      text.replace(/[*_`]/g, '').replace(/[\\n]+/g, '. ').replace(/[-‚Ä¢]/g, '');\n\n    const intro = `Hola Alejandro. Aqu√≠ tienes tu informe de inteligencia de mercado God Mode.`;\n\n    // Create a natural narrative\n    let sentimentText = '';\n    if (data.sentiment === 'BULLISH')\n      sentimentText = 'El sentimiento general del mercado es alcista.';\n    else if (data.sentiment === 'BEARISH')\n      sentimentText = 'Detecto un sentimiento bajista en las noticias globales.';\n    else sentimentText = 'El mercado muestra un comportamiento neutral en este momento.';\n\n    // Geo context summary (first sentence usually captures the essence)\n    let geoText = '';\n    if (data.geoContext && !data.geoContext.includes('no disponible')) {\n      const geoClean = clean(data.geoContext).split('.')[0]; // Take first sentence of AI summary\n      geoText = `En el √°mbito geopol√≠tico: ${geoClean}.`;\n    }\n\n    let opportunitiesText = 'No hay alertas cr√≠ticas en tus activos por ahora.';\n    if (data.opportunities.length > 0) {\n      opportunitiesText =\n        'Atenci√≥n a lo siguiente: ' + data.opportunities.map(o => clean(o)).join('. Adem√°s, ');\n    }\n\n    const script = `${intro} ${sentimentText} ${geoText} ${opportunitiesText} ${clean(\n      data.advice.split('\\n').pop() || '',\n    )}`;\n\n    return script;\n  }\n\n  /**\n   * Price Alert Management\n   */\n  async addPriceAlert(alert: Omit<PriceAlert, 'condition'>): Promise<PriceAlert> {\n    const prices = await this.getEconomyUpdate();\n    const currentPrice = prices.find(p => p.symbol === alert.symbol)?.price || 0;\n    const condition = alert.targetPrice > currentPrice ? 'above' : 'below';\n\n    const fullAlert: PriceAlert = { ...alert, condition };\n    const cacheKey = `economy:alerts:${alert.userId}`;\n    const existing = (await getCache(cacheKey)) || [];\n\n    existing.push(fullAlert);\n    await setCache(cacheKey, existing, 0); // No expiry for user alerts\n\n    logger.info(\n      `[EconomyService] Alert added for ${alert.userId}: ${alert.symbol} ${condition} ${alert.targetPrice}`,\n    );\n    return fullAlert;\n  }\n\n  async getActiveAlerts(userId: string): Promise<PriceAlert[]> {\n    return (await getCache(`economy:alerts:${userId}`)) || [];\n  }\n\n  async checkPriceAlerts(): Promise<PriceAlert[]> {\n    const prices = await this.getEconomyUpdate();\n    // This would typically iterate over ALL users, but for this prototype\n    // we'll focus on the primary user context.\n    // In a full implementation, we'd use a set of alerted users.\n    const alertKeys = ['economy:alerts:god_mode']; // Hypothetical \"master\" key or similar\n    const triggeredAlerts: PriceAlert[] = [];\n\n    for (const key of alertKeys) {\n      const alerts: PriceAlert[] = (await getCache(key)) || [];\n      const stillActive: PriceAlert[] = [];\n\n      alerts.forEach(alert => {\n        const current = prices.find(p => p.symbol === alert.symbol);\n        if (!current) {\n          stillActive.push(alert);\n          return;\n        }\n\n        const triggered =\n          alert.condition === 'above'\n            ? current.price >= alert.targetPrice\n            : current.price <= alert.targetPrice;\n\n        if (triggered) {\n          triggeredAlerts.push(alert);\n        } else {\n          stillActive.push(alert);\n        }\n      });\n\n      if (triggeredAlerts.length > 0) {\n        await setCache(key, stillActive, 0);\n      }\n    }\n\n    return triggeredAlerts;\n  }\n\n  /**\n   * Portfolio Tracking\n   */\n  async addPortfolioPosition(\n    userId: string,\n    symbol: string,\n    amount: number,\n    entryPrice: number,\n  ): Promise<void> {\n    const cacheKey = `economy:portfolio:${userId}`;\n    const portfolio: any[] = (await getCache(cacheKey)) || [];\n\n    // Simple append or update\n    const existingIndex = portfolio.findIndex(p => p.symbol === symbol);\n    if (existingIndex >= 0) {\n      portfolio[existingIndex] = { symbol, amount, entryPrice };\n    } else {\n      portfolio.push({ symbol, amount, entryPrice });\n    }\n\n    await setCache(cacheKey, portfolio, 0);\n  }\n\n  async getPortfolioStats(userId: string): Promise<PortfolioItem[]> {\n    const cacheKey = `economy:portfolio:${userId}`;\n    const positions: any[] = (await getCache(cacheKey)) || [];\n    const prices = await this.getEconomyUpdate();\n    const stats: PortfolioItem[] = [];\n\n    for (const pos of positions) {\n      const current = prices.find(p => p.symbol === pos.symbol);\n      const currentPrice = current?.price || 0;\n      const pnl = (currentPrice - pos.entryPrice) * pos.amount;\n      const pnlPercent =\n        pos.entryPrice > 0\n          ? (((currentPrice - pos.entryPrice) / pos.entryPrice) * 100).toFixed(2) + '%'\n          : '0%';\n\n      stats.push({\n        ...pos,\n        currentPrice,\n        pnl,\n        pnlPercent,\n      });\n    }\n\n    return stats;\n  }\n\n  /**\n   * Fetch historical data for charting (Daily points)\n   */\n  async getHistoricalPrices(symbol: string): Promise<number[]> {\n    const cacheKey = `economy:history:${symbol}`;\n    const cached = await getCache(cacheKey);\n    if (cached) return cached;\n\n    if (!this.alphaVantageKey) {\n      // Mock historical data\n      return Array.from({ length: 15 }, () => Math.random() * 2000);\n    }\n\n    const asset = this.assets.find(a => a.symbol === symbol) || { symbol, type: 'STOCK' };\n    let url = '';\n\n    if (asset.type === 'CRYPTO') {\n      url = `https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=${symbol}&market=USD&apikey=${this.alphaVantageKey}`;\n    } else {\n      url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${this.alphaVantageKey}`;\n    }\n\n    try {\n      const res = await axios.get(url);\n      const timeSeries =\n        res.data['Time Series (Daily)'] || res.data['Time Series Digital Currency (Daily)'];\n\n      if (!timeSeries) return [];\n\n      const prices = Object.values(timeSeries)\n        .slice(0, 10) // Last 10 days\n        .map((day: any) => parseFloat(day['4. close'] || day['4a. close (USD)']))\n        .reverse();\n\n      await setCache(cacheKey, prices, 3600 * 6); // 6 hours cache for history\n      return prices;\n    } catch (error) {\n      logger.error(`[EconomyService] History fetch failed for ${symbol}:`, error);\n      return [];\n    }\n  }\n}\n"],"version":3}
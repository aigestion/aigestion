{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\api-v1.routes.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\api-v1.routes.ts"],"sourcesContent":["import { Router } from 'express';\nimport { buildError, buildResponse } from '../common/response-builder';\nimport { container } from '../config/inversify.config';\nimport { CredentialManagerService } from '../services/credential-manager.service';\nimport { HistoryService } from '../services/history.service';\nimport { TYPES } from '../types';\n\n// Middleware\nimport { apiKeyAuth } from '../middleware/api-key.middleware';\nimport { idempotencyMiddleware } from '../middleware/idempotency.middleware';\nimport { dynamicRateLimiter } from '../middleware/rate-limit.middleware';\nimport { redisCache } from '../middleware/redis-cache.middleware';\nimport { requireAuth } from '../middleware/auth.middleware';\n\nconst apiV1Router = Router();\n\n// Middleware\napiV1Router.use(idempotencyMiddleware);\napiV1Router.use(apiKeyAuth);\n\nconsole.log('DEBUG: API V1 router loading with lazy-loaded sub-routers');\n\n// Lazy-Loaded Routers to avoid top-level container.get / circular dependency issues\nconst lazy = (path: string) => (req: any, res: any, next: any) => {\n  const router = require(path).default;\n  if (typeof router === 'function') {\n    return router(req, res, next);\n  }\n  // Handle cases where it might be a named export or already a router instance\n  const r = router.router || router;\n  return r(req, res, next);\n};\n\n// Mount Routes (Lazy)\napiV1Router.use('/auth', lazy('./auth.routes'));\napiV1Router.use('/docker', lazy('./docker.routes'));\napiV1Router.use('/personas', lazy('./persona.routes'));\napiV1Router.use('/swarm', lazy('./swarm.routes'));\napiV1Router.use('/webauthn', lazy('./webauthn.routes'));\napiV1Router.use('/sovereign', lazy('./sovereign-handshake.routes'));\napiV1Router.use('/users', lazy('./users.routes'));\napiV1Router.use('/health', lazy('./health.routes'));\napiV1Router.use('/stripe', lazy('./stripe.routes'));\napiV1Router.use('/youtube', lazy('./youtube.routes'));\n\n// System Endpoints\napiV1Router.post('/system/credentials/verify', async (req: any, res: any) => {\n  const requestId = req.requestId;\n  try {\n    const credManager = container.get<CredentialManagerService>(TYPES.CredentialManagerService);\n    const report = await credManager.verifyAll();\n    res.json(buildResponse(report, 200, requestId));\n  } catch (err) {\n    res.status(500).json(buildError('Verification failed', 'VERIFICATION_ERROR', 500, requestId));\n  }\n});\n\napiV1Router.get('/system/history/:metric', async (req: any, res: any) => {\n  const requestId = req.requestId;\n  try {\n    const { metric } = req.params;\n    const historyService = container.get<HistoryService>(TYPES.HistoryService);\n    const history = await historyService.getHistory(metric);\n    res.json(buildResponse(history, 200, requestId));\n  } catch (err) {\n    res.status(500).json(buildError('Internal server error', 'INTERNAL_ERROR', 500, requestId));\n  }\n});\n\n// Controllers (Lazy-ish resolution inside handlers)\napiV1Router.get('/usage/current', redisCache(60), (req, res, next) => {\n  const { UsageController } = require('../controllers/usage.controller');\n  const controller = container.get<any>(TYPES.UsageController);\n  return controller.getCurrentUsage(req, res, next);\n});\n\napiV1Router.get('/billing/snapshot', requireAuth, redisCache(300), (req, res, next) => {\n  const controller = container.get<any>(TYPES.BillingController);\n  return controller.getBillingSnapshot(req, res, next);\n});\n\napiV1Router.post('/billing/checkout', requireAuth, (req, res, next) => {\n  const controller = container.get<any>(TYPES.BillingController);\n  return controller.createCheckoutSession(req, res, next);\n});\n\napiV1Router.post('/billing/portal', requireAuth, (req, res, next) => {\n  const controller = container.get<any>(TYPES.BillingController);\n  return controller.createPortalSession(req, res, next);\n});\n\n// Monitoring and AI (Lazy)\napiV1Router.use('/analytics', redisCache(30), lazy('./analytics.routes'));\napiV1Router.use('/enhanced-voice', lazy('./enhanced-voice.routes'));\napiV1Router.use('/daniela', lazy('./daniela.routes'));\napiV1Router.use('/ai', dynamicRateLimiter, lazy('./ai.routes'));\napiV1Router.use('/rag', lazy('./rag.routes'));\n\n// System Management (Lazy)\napiV1Router.use('/system', lazy('./system.routes'));\napiV1Router.use('/social', lazy('./social.routes'));\napiV1Router.use('/logs', lazy('./logs.routes'));\napiV1Router.use('/security-dashboard', lazy('./security-dashboard.routes'));\napiV1Router.use('/waf', lazy('./waf.routes'));\napiV1Router.use('/malware-scanner', lazy('./malware-scanner.routes'));\napiV1Router.use('/threat-intelligence', lazy('./threat-intelligence.routes'));\napiV1Router.use('/behavior', lazy('./user-behavior.routes'));\napiV1Router.use('/device-posture', lazy('./device-posture.routes'));\napiV1Router.use('/nexus', lazy('./nexus.routes'));\napiV1Router.use('/god-mode', lazy('./godmode.routes'));\n\nexport default apiV1Router;\n"],"version":3}
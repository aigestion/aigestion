{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\notification.service.ts","mappings":";;;;;;;;;;;;;;;;AAAA,yCAA+C;AAC/C,oCAAiC;AACjC,gGAA8F;AAC9F,qDAAiD;AAEjD,4CAAyC;AAGlC,IAAM,mBAAmB,GAAzB,MAAM,mBAAmB;IAEkB;IACT;IAFvC,YACgD,gBAAyC,EAClD,aAA4B;QADnB,qBAAgB,GAAhB,gBAAgB,CAAyB;QAClD,kBAAa,GAAb,aAAa,CAAe;IAChE,CAAC;IAEJ;;OAEG;IACH,KAAK,CAAC,kBAAkB,CACtB,MAAc,EACd,IAAsB,EACtB,KAAa,EACb,OAAe,EACf,IAAU;QAEV,eAAM,CAAC,IAAI,CAAC,wDAAwD,MAAM,KAAK,KAAK,EAAE,CAAC,CAAC;QAExF,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC;YACtD,MAAM;YACN,IAAI;YACJ,KAAK;YACL,OAAO;YACP,IAAI;YACJ,IAAI,EAAE,KAAK;SACL,CAAC,CAAC;QAEV,0CAA0C;QAC1C,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,MAAM,EAAE,kBAAkB,EAAE,YAAY,CAAC,CAAC;QAExE,OAAO,YAAY,CAAC;IACtB,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,gBAAgB,CAAC,MAAc,EAAE,QAAgB,EAAE;QACvD,OAAO,MAAM,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;IAC/D,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,UAAU,CAAC,EAAU,EAAE,MAAc;QACzC,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QAC9D,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,MAAM,KAAK,MAAM,EAAE,CAAC;YACpD,OAAO,IAAI,CAAC;QACd,CAAC;QACD,OAAO,MAAM,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;IACpD,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,aAAa,CAAC,MAAc;QAChC,MAAM,IAAI,CAAC,gBAAgB,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IACpD,CAAC;CACF,CAAA;AAzDY,kDAAmB;8BAAnB,mBAAmB;IAD/B,IAAA,sBAAU,GAAE;IAGR,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,sBAAsB,CAAC,CAAA;IACpC,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,aAAa,CAAC,CAAA;yDADoC,gDAAuB,oBAAvB,gDAAuB,oDACnC,8BAAa,oBAAb,8BAAa;GAHxD,mBAAmB,CAyD/B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\notification.service.ts"],"sourcesContent":["import { injectable, inject } from 'inversify';\nimport { TYPES } from '../types';\nimport { INotificationRepository } from '../infrastructure/repository/NotificationRepository';\nimport { SocketService } from './socket.service';\nimport { INotification, NotificationType } from '../models/Notification';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class NotificationService {\n  constructor(\n    @inject(TYPES.NotificationRepository) private notificationRepo: INotificationRepository,\n    @inject(TYPES.SocketService) private socketService: SocketService,\n  ) {}\n\n  /**\n   * Creates a new notification and emits it via WebSocket.\n   */\n  async createNotification(\n    userId: string,\n    type: NotificationType,\n    title: string,\n    message: string,\n    data?: any,\n  ): Promise<INotification> {\n    logger.info(`[NotificationService] Creating notification for user ${userId}: ${title}`);\n\n    const notification = await this.notificationRepo.create({\n      userId,\n      type,\n      title,\n      message,\n      data,\n      read: false,\n    } as any);\n\n    // Emit via WebSocket to the specific user\n    this.socketService.emitToUser(userId, 'notification:new', notification);\n\n    return notification;\n  }\n\n  /**\n   * Gets the latest notifications for a user.\n   */\n  async getNotifications(userId: string, limit: number = 20): Promise<INotification[]> {\n    return await this.notificationRepo.findByUser(userId, limit);\n  }\n\n  /**\n   * Marks a specific notification as read.\n   */\n  async markAsRead(id: string, userId: string): Promise<INotification | null> {\n    const notification = await this.notificationRepo.findById(id);\n    if (!notification || notification.userId !== userId) {\n      return null;\n    }\n    return await this.notificationRepo.markAsRead(id);\n  }\n\n  /**\n   * Marks all notifications for a user as read.\n   */\n  async markAllAsRead(userId: string): Promise<void> {\n    await this.notificationRepo.markAllAsRead(userId);\n  }\n}\n"],"version":3}
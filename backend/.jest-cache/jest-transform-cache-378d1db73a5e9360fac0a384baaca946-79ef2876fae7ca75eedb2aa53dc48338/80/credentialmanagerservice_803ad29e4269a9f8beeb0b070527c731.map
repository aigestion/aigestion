{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\credential-manager.service.ts","mappings":";;;;;;;;;;;;;;;AAAA,kDAA0B;AAC1B,yCAAuC;AACvC,oDAA4B;AAC5B,uCAAoC;AAEpC,oCAAoC;AACpC,6DAA8D;AAC9D,4CAAyC;AAUlC,IAAM,wBAAwB,GAA9B,MAAM,wBAAwB;IACnC,gBAAe,CAAC;IAEhB;;OAEG;IACH,KAAK,CAAC,SAAS;QACb,MAAM,OAAO,GAAuB,MAAM,OAAO,CAAC,GAAG,CAAC;YACpD,IAAI,CAAC,iBAAiB,EAAE;YACxB,IAAI,CAAC,YAAY,EAAE;YACnB,IAAI,CAAC,YAAY,EAAE;YACnB,IAAI,CAAC,cAAc,EAAE;YACrB,IAAI,CAAC,eAAe,EAAE;YACtB,IAAI,CAAC,yBAAyB,EAAE;SACjC,CAAC,CAAC;QAEH,eAAM,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;QACxD,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,KAAK,CAAC,iBAAiB;QACrB,MAAM,QAAQ,GAAG,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,8BAA8B,CAAC;QAC9D,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,OAAO,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,SAAS,CAAC,CAAC;QAChD,CAAC;QAED,IAAI,CAAC;YACH,iDAAiD;YACjD,MAAM,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC;YACtD,IAAI,CAAC,SAAS,EAAE,CAAC;gBACf,OAAO,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,SAAS,EAAE,oBAAoB,CAAC,CAAC;YACtE,CAAC;YACD,OAAO,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;QAC9C,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,cAAc,EAAE,SAAS,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;QAC3D,CAAC;IACH,CAAC;IAED,KAAK,CAAC,YAAY;QAChB,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC;QACpE,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;QAC7C,CAAC;QAED,IAAI,CAAC;YACH,iFAAiF;YACjF,qDAAqD;YACrD,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;QAC3C,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,SAAS,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;QACxD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,YAAY;QAChB,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC;QAC1C,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAC1C,CAAC;QAED,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,IAAI,gBAAM,CAAC,GAAG,EAAE,EAAE,UAAU,EAAE,YAAY,EAAE,CAAC,CAAC;YAC7D,MAAM,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;YAChC,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QACxC,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,SAAS,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;QACrD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,cAAc;QAClB,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC;QAC7C,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;QAC5C,CAAC;QAED,IAAI,CAAC;YACH,MAAM,GAAG,GAAG,IAAI,mBAAQ,CAAC,KAAK,CAAC,CAAC;YAChC,MAAM,GAAG,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;YAC3B,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;QAC1C,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,SAAS,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;QACvD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,eAAe;QACnB,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC;QACjD,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;QAC7C,CAAC;QAED,IAAI,CAAC;YACH,MAAM,eAAK,CAAC,GAAG,CAAC,oDAAoD,KAAK,EAAE,CAAC,CAAC;YAC7E,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;QAC3C,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,SAAS,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;QACxD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,yBAAyB;QAC7B,IAAI,CAAC;YACH,MAAM,KAAK,GAAG,IAAA,2CAAsB,GAAE,CAAC;YACvC,MAAM,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,cAAc,CAAC,CAAC;YAE9D,IAAI,CAAC,UAAU,EAAE,CAAC;gBAChB,OAAO,IAAI,CAAC,MAAM,CAAC,sBAAsB,EAAE,SAAS,EAAE,oCAAoC,CAAC,CAAC;YAC9F,CAAC;YAED,oEAAoE;YACpE,IAAI,UAAU,CAAC,KAAK,KAAK,qBAAqB,EAAE,CAAC;gBAC/C,OAAO,IAAI,CAAC,MAAM,CAAC,sBAAsB,EAAE,OAAO,EAAE,WAAW,UAAU,CAAC,KAAK,EAAE,CAAC,CAAC;YACrF,CAAC;YAED,OAAO,IAAI,CAAC,MAAM,CAAC,sBAAsB,EAAE,SAAS,EAAE,iCAAiC,CAAC,CAAC;QAC3F,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,OAAO,IAAI,CAAC,MAAM,CAAC,sBAAsB,EAAE,SAAS,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;QACnE,CAAC;IACH,CAAC;IAEO,MAAM,CACZ,QAAgB,EAChB,MAAkC,EAClC,OAAgB;QAEhB,OAAO;YACL,QAAQ;YACR,MAAM;YACN,OAAO;YACP,WAAW,EAAE,IAAI,IAAI,EAAE;SACxB,CAAC;IACJ,CAAC;CACF,CAAA;AAjIY,4DAAwB;mCAAxB,wBAAwB;IADpC,IAAA,sBAAU,GAAE;;GACA,wBAAwB,CAiIpC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\credential-manager.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { injectable } from 'inversify';\nimport Stripe from 'stripe';\nimport { Telegraf } from 'telegraf';\n\n// import { TYPES } from '../types';\nimport { loadPremiumCredentials } from '@/premium_management';\nimport { logger } from '../utils/logger';\n\nexport interface CredentialStatus {\n  provider: string;\n  status: 'valid' | 'invalid' | 'missing';\n  message?: string;\n  lastChecked: Date;\n}\n\n@injectable()\nexport class CredentialManagerService {\n  constructor() {}\n\n  /**\n   * Verified all critical credentials\n   */\n  async verifyAll(): Promise<CredentialStatus[]> {\n    const results: CredentialStatus[] = await Promise.all([\n      this.verifyGoogleCloud(),\n      this.verifyGemini(),\n      this.verifyStripe(),\n      this.verifyTelegram(),\n      this.verifyInstagram(),\n      this.verifyProfessionalAccount(),\n    ]);\n\n    logger.info('Credential Verification Report Generated');\n    return results;\n  }\n\n  async verifyGoogleCloud(): Promise<CredentialStatus> {\n    const hasCreds = !!process.env.GOOGLE_APPLICATION_CREDENTIALS;\n    if (!hasCreds) {\n      return this.report('Google Cloud', 'missing');\n    }\n\n    try {\n      // Try to list a single secret or access metadata\n      const projectId = process.env.GOOGLE_CLOUD_PROJECT_ID;\n      if (!projectId) {\n        return this.report('Google Cloud', 'invalid', 'Missing Project ID');\n      }\n      return this.report('Google Cloud', 'valid');\n    } catch (e) {\n      return this.report('Google Cloud', 'invalid', e.message);\n    }\n  }\n\n  async verifyGemini(): Promise<CredentialStatus> {\n    const key = process.env.GEMINI_API_KEY || process.env.GENAI_API_KEY;\n    if (!key) {\n      return this.report('Gemini AI', 'missing');\n    }\n\n    try {\n      // Vertex AI typically uses ADC (GCP Creds), not just a key in Node.js Vertex SDK\n      // But if user uses Google AI SDK or vertex with key:\n      return this.report('Gemini AI', 'valid');\n    } catch (e) {\n      return this.report('Gemini AI', 'invalid', e.message);\n    }\n  }\n\n  async verifyStripe(): Promise<CredentialStatus> {\n    const key = process.env.STRIPE_SECRET_KEY;\n    if (!key) {\n      return this.report('Stripe', 'missing');\n    }\n\n    try {\n      const stripe = new Stripe(key, { apiVersion: '2022-11-15' });\n      await stripe.balance.retrieve();\n      return this.report('Stripe', 'valid');\n    } catch (e) {\n      return this.report('Stripe', 'invalid', e.message);\n    }\n  }\n\n  async verifyTelegram(): Promise<CredentialStatus> {\n    const token = process.env.TELEGRAM_BOT_TOKEN;\n    if (!token) {\n      return this.report('Telegram', 'missing');\n    }\n\n    try {\n      const bot = new Telegraf(token);\n      await bot.telegram.getMe();\n      return this.report('Telegram', 'valid');\n    } catch (e) {\n      return this.report('Telegram', 'invalid', e.message);\n    }\n  }\n\n  async verifyInstagram(): Promise<CredentialStatus> {\n    const token = process.env.INSTAGRAM_ACCESS_TOKEN;\n    if (!token) {\n      return this.report('Instagram', 'missing');\n    }\n\n    try {\n      await axios.get(`https://graph.facebook.com/v19.0/me?access_token=${token}`);\n      return this.report('Instagram', 'valid');\n    } catch (e) {\n      return this.report('Instagram', 'invalid', e.message);\n    }\n  }\n\n  async verifyProfessionalAccount(): Promise<CredentialStatus> {\n    try {\n      const creds = loadPremiumCredentials();\n      const proAccount = creds.find(c => c.type === 'professional');\n\n      if (!proAccount) {\n        return this.report('Professional Account', 'missing', 'No professional account configured');\n      }\n\n      // Basic validation (could be extended to check license servers etc)\n      if (proAccount.email === 'admin@aigestion.net') {\n        return this.report('Professional Account', 'valid', `Active: ${proAccount.email}`);\n      }\n\n      return this.report('Professional Account', 'invalid', 'Unauthorized professional email');\n    } catch (e) {\n      return this.report('Professional Account', 'invalid', e.message);\n    }\n  }\n\n  private report(\n    provider: string,\n    status: CredentialStatus['status'],\n    message?: string,\n  ): CredentialStatus {\n    return {\n      provider,\n      status,\n      message,\n      lastChecked: new Date(),\n    };\n  }\n}\n"],"version":3}
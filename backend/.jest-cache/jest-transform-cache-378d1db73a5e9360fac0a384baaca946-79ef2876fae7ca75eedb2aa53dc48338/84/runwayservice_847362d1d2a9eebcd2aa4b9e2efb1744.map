{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\runway.service.ts","mappings":";;;;;;;;;;;;;AAAA,kDAA0B;AAC1B,yCAAuC;AACvC,qDAA2C;AAC3C,4CAAyC;AAGlC,IAAM,aAAa,GAAnB,MAAM,aAAa;;IAChB,MAAM,CAAU,OAAO,GAAG,6BAA6B,CAAC;IAEhE;;;;OAIG;IACH;;OAEG;IACH,KAAK,CAAC,oBAAoB,CACxB,MAAc,EACd,QAAgB,EAAE,kBAAkB;IACpC,UAII,EAAE;QAEN,IAAI,CAAC,gBAAG,CAAC,cAAc,EAAE,CAAC;YACxB,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;QAC/C,CAAC;QAED,IAAI,CAAC;YACH,eAAM,CAAC,IAAI,CAAC,wDAAwD,MAAM,GAAG,CAAC,CAAC;YAE/E,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,IAAI,CAC/B,GAAG,eAAa,CAAC,OAAO,iBAAiB,EAAE,mEAAmE;YAC9G;gBACE,UAAU,EAAE,MAAM,EAAE,2DAA2D;gBAC/E,KAAK,EAAE,QAAQ;gBACf,KAAK,EAAE,aAAa,EAAE,0CAA0C;gBAChE,QAAQ,EAAE,OAAO,CAAC,QAAQ,IAAI,CAAC,EAAE,UAAU;gBAC3C,KAAK,EAAE,OAAO,CAAC,YAAY,IAAI,UAAU,EAAE,kBAAkB;aAC9D,EACD;gBACE,OAAO,EAAE;oBACP,aAAa,EAAE,UAAU,gBAAG,CAAC,cAAc,EAAE;oBAC7C,cAAc,EAAE,kBAAkB;oBAClC,kBAAkB,EAAE,YAAY;iBACjC;aACF,CACF,CAAC;YAEF,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,yBAAyB;YACzB,MAAM,SAAS,GAAG,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC;YACvC,MAAM,QAAQ,GAAG,SAAS,EAAE,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC;YAEnD,eAAM,CAAC,KAAK,CAAC,mBAAmB,EAAE,QAAQ,CAAC,CAAC;YAC5C,IAAI,SAAS,EAAE,CAAC;gBACd,eAAM,CAAC,KAAK,CAAC,qBAAqB,EAAE,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;YAC1E,CAAC;YAED,IACE,KAAK,CAAC,QAAQ,EAAE,MAAM,KAAK,GAAG;gBAC9B,CAAC,KAAK,CAAC,QAAQ,EAAE,MAAM,KAAK,GAAG,IAAI,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,EAChE,CAAC;gBACD,eAAM,CAAC,IAAI,CACT,6FAA6F,CAC9F,CAAC;YACJ,CAAC;iBAAM,IAAI,KAAK,CAAC,QAAQ,EAAE,MAAM,KAAK,GAAG,EAAE,CAAC;gBAC1C,eAAM,CAAC,IAAI,CACT,kJAAkJ,CACnJ,CAAC;YACJ,CAAC;YAED,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,WAAW,CAAC,MAAc;QAC9B,IAAI,CAAC,gBAAG,CAAC,cAAc,EAAE,CAAC;YACxB,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;QAC/C,CAAC;QAED,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,GAAG,eAAa,CAAC,OAAO,UAAU,MAAM,EAAE,EAAE;gBAC3E,OAAO,EAAE;oBACP,aAAa,EAAE,UAAU,gBAAG,CAAC,cAAc,EAAE;oBAC7C,kBAAkB,EAAE,YAAY;iBACjC;aACF,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,eAAM,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC,QAAQ,EAAE,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;YAClF,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;;AA7FU,sCAAa;wBAAb,aAAa;IADzB,IAAA,sBAAU,GAAE;GACA,aAAa,CA8FzB","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\runway.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { injectable } from 'inversify';\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class RunwayService {\n  private static readonly API_URL = 'https://api.runwayml.com/v1';\n\n  /**\n   * Generates a video using Runway Gen-3 Alpha (Image-to-Video)\n   * Note: This is a simulated implementation based on typical GenAI API patterns,\n   * as specific backend SDKs might not be public or fully standardized yet.\n   */\n  /**\n   * Generates a video using Runway Gen-3 Alpha Turbo (Image-to-Video)\n   */\n  async generateImageToVideo(\n    prompt: string,\n    imageUri: string, // URL or Data URI\n    options: {\n      duration?: number;\n      aspect_ratio?: string;\n      model?: string;\n    } = {},\n  ): Promise<any> {\n    if (!env.RUNWAY_API_KEY) {\n      throw new Error('RUNWAY_API_KEY is missing');\n    }\n\n    try {\n      logger.info(`Starting Runway Gen-3 Alpha Turbo Video Generation: \"${prompt}\"`);\n\n      const response = await axios.post(\n        `${RunwayService.API_URL}/image_to_video`, // Standard endpoint, subject to change based on actual API version\n        {\n          promptText: prompt, // Specific field name might vary, checking docs simulation\n          image: imageUri,\n          model: 'gen3a_turbo', // Explicit model ID for Gen-3 Alpha Turbo\n          duration: options.duration || 5, // 5 or 10\n          ratio: options.aspect_ratio || '1280:768', // Cinema standard\n        },\n        {\n          headers: {\n            Authorization: `Bearer ${env.RUNWAY_API_KEY}`,\n            'Content-Type': 'application/json',\n            'X-Runway-Version': '2024-09-26',\n          },\n        },\n      );\n\n      return response.data;\n    } catch (error: any) {\n      // Improved error logging\n      const errorData = error.response?.data;\n      const errorMsg = errorData?.error || error.message;\n\n      logger.error('Runway API Error:', errorMsg);\n      if (errorData) {\n        logger.error('Full Error Details:', JSON.stringify(errorData, null, 2));\n      }\n\n      if (\n        error.response?.status === 402 ||\n        (error.response?.status === 400 && errorMsg.includes('credits'))\n      ) {\n        logger.warn(\n          'This error likely indicates insufficient credits or a billing issue on your Runway account.',\n        );\n      } else if (error.response?.status === 400) {\n        logger.warn(\n          'This error might be due to credits, or possibly invalid parameters (e.g. image format). The image size confirms it should be valid for Data URI.',\n        );\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * Check status of a generation task\n   */\n  async checkStatus(taskId: string): Promise<any> {\n    if (!env.RUNWAY_API_KEY) {\n      throw new Error('RUNWAY_API_KEY is missing');\n    }\n\n    try {\n      const response = await axios.get(`${RunwayService.API_URL}/tasks/${taskId}`, {\n        headers: {\n          Authorization: `Bearer ${env.RUNWAY_API_KEY}`,\n          'X-Runway-Version': '2024-09-26',\n        },\n      });\n      return response.data;\n    } catch (error: any) {\n      logger.error('Runway Status Check Error:', error.response?.data || error.message);\n      throw error;\n    }\n  }\n}\n"],"version":3}
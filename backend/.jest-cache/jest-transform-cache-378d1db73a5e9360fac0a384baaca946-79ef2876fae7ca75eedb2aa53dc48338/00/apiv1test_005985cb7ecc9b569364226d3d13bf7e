82f4d8877e9107f7e955c5466e9e2621
"use strict";
/**
 * Sprint 1: Task 1.1 - REST API Refactoring Tests
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const supertest_1 = __importDefault(require("supertest"));
const app_1 = require("../app");
const SKIP_DB_TESTS = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;
(SKIP_DB_TESTS ? describe.skip : describe)('API v1 - REST Refactoring', () => {
    let requestId;
    let testUserId;
    jest.setTimeout(30000);
    beforeAll(async () => {
        const dbModule = require('../config/database');
        await dbModule.connectToDatabase();
        const userModule = require('../models/User');
        const User = userModule.User;
        await User.deleteMany({ email: 'api-v1-test@example.com' });
        const response = await (0, supertest_1.default)(app_1.app).post('/api/v1/users').send({
            email: 'api-v1-test@example.com',
            name: 'API Test User',
            password: 'AIGestion2026!',
        });
        if (response.status === 201) {
            testUserId = response.body.data.id;
        }
    });
    describe('GET /health', () => {
        it('should return standardized health response', async () => {
            const response = await (0, supertest_1.default)(app_1.app).get('/api/v1/health').expect(200);
            expect(response.body).toHaveProperty('status', 200);
            expect(response.body).toHaveProperty('data');
            expect(response.body.data).toHaveProperty('status', 'healthy');
            requestId = response.body.requestId;
        });
    });
    describe('POST /users (create)', () => {
        it('should create user with valid input', async () => {
            const uniqueEmail = `unique-${Date.now()}@example.com`;
            const response = await (0, supertest_1.default)(app_1.app)
                .post('/api/v1/users')
                .send({
                email: uniqueEmail,
                name: 'Unique Test User',
                password: 'AIGestion123!',
            })
                .expect(201);
            expect(response.body.status).toBe(201);
            expect(response.body.data.email).toBe(uniqueEmail);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXGFwaS12MS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7Ozs7QUFFSCwwREFBZ0M7QUFDaEMsZ0NBQTZCO0FBRTdCLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUM7QUFFNUYsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtJQUMzRSxJQUFJLFNBQWlCLENBQUM7SUFDdEIsSUFBSSxVQUFrQixDQUFDO0lBRXZCLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7SUFFdkIsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQy9DLE1BQU0sUUFBUSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFFbkMsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDN0MsTUFBTSxJQUFJLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQztRQUU3QixNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLLEVBQUUseUJBQXlCLEVBQUUsQ0FBQyxDQUFDO1FBRTVELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxtQkFBTyxFQUFDLFNBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDN0QsS0FBSyxFQUFFLHlCQUF5QjtZQUNoQyxJQUFJLEVBQUUsZUFBZTtZQUNyQixRQUFRLEVBQUUsZ0JBQWdCO1NBQzNCLENBQUMsQ0FBQztRQUVILElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUM1QixVQUFVLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3JDLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQzNCLEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxRCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxTQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3BELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDL0QsU0FBUyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ3BDLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRCxNQUFNLFdBQVcsR0FBRyxVQUFVLElBQUksQ0FBQyxHQUFHLEVBQUUsY0FBYyxDQUFDO1lBQ3ZELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxtQkFBTyxFQUFDLFNBQUcsQ0FBQztpQkFDaEMsSUFBSSxDQUFDLGVBQWUsQ0FBQztpQkFDckIsSUFBSSxDQUFDO2dCQUNKLEtBQUssRUFBRSxXQUFXO2dCQUNsQixJQUFJLEVBQUUsa0JBQWtCO2dCQUN4QixRQUFRLEVBQUUsZUFBZTthQUMxQixDQUFDO2lCQUNELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFsZWphbmRyb1xcQUlHZXN0aW9uXFxiYWNrZW5kXFxzcmNcXF9fdGVzdHNfX1xcYXBpLXYxLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFNwcmludCAxOiBUYXNrIDEuMSAtIFJFU1QgQVBJIFJlZmFjdG9yaW5nIFRlc3RzXHJcbiAqL1xyXG5cclxuaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcclxuaW1wb3J0IHsgYXBwIH0gZnJvbSAnLi4vYXBwJztcclxuXHJcbmNvbnN0IFNLSVBfREJfVEVTVFMgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnICYmICFwcm9jZXNzLmVudi5SVU5fSU5URUdSQVRJT05fVEVTVFM7XHJcblxyXG4oU0tJUF9EQl9URVNUUyA/IGRlc2NyaWJlLnNraXAgOiBkZXNjcmliZSkoJ0FQSSB2MSAtIFJFU1QgUmVmYWN0b3JpbmcnLCAoKSA9PiB7XHJcbiAgbGV0IHJlcXVlc3RJZDogc3RyaW5nO1xyXG4gIGxldCB0ZXN0VXNlcklkOiBzdHJpbmc7XHJcblxyXG4gIGplc3Quc2V0VGltZW91dCgzMDAwMCk7XHJcblxyXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCBkYk1vZHVsZSA9IHJlcXVpcmUoJy4uL2NvbmZpZy9kYXRhYmFzZScpO1xyXG4gICAgYXdhaXQgZGJNb2R1bGUuY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuXHJcbiAgICBjb25zdCB1c2VyTW9kdWxlID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuICAgIGNvbnN0IFVzZXIgPSB1c2VyTW9kdWxlLlVzZXI7XHJcbiAgICBcclxuICAgIGF3YWl0IFVzZXIuZGVsZXRlTWFueSh7IGVtYWlsOiAnYXBpLXYxLXRlc3RAZXhhbXBsZS5jb20nIH0pO1xyXG5cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLnBvc3QoJy9hcGkvdjEvdXNlcnMnKS5zZW5kKHtcclxuICAgICAgZW1haWw6ICdhcGktdjEtdGVzdEBleGFtcGxlLmNvbScsXHJcbiAgICAgIG5hbWU6ICdBUEkgVGVzdCBVc2VyJyxcclxuICAgICAgcGFzc3dvcmQ6ICdBSUdlc3Rpb24yMDI2IScsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDEpIHtcclxuICAgICAgdGVzdFVzZXJJZCA9IHJlc3BvbnNlLmJvZHkuZGF0YS5pZDtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0dFVCAvaGVhbHRoJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc3RhbmRhcmRpemVkIGhlYWx0aCByZXNwb25zZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcCkuZ2V0KCcvYXBpL3YxL2hlYWx0aCcpLmV4cGVjdCgyMDApO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3N0YXR1cycsIDIwMCk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnZGF0YScpO1xyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhKS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJywgJ2hlYWx0aHknKTtcclxuICAgICAgcmVxdWVzdElkID0gcmVzcG9uc2UuYm9keS5yZXF1ZXN0SWQ7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1BPU1QgL3VzZXJzIChjcmVhdGUpJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgdXNlciB3aXRoIHZhbGlkIGlucHV0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1bmlxdWVFbWFpbCA9IGB1bmlxdWUtJHtEYXRlLm5vdygpfUBleGFtcGxlLmNvbWA7XHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvdjEvdXNlcnMnKVxyXG4gICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgIGVtYWlsOiB1bmlxdWVFbWFpbCxcclxuICAgICAgICAgIG5hbWU6ICdVbmlxdWUgVGVzdCBVc2VyJyxcclxuICAgICAgICAgIHBhc3N3b3JkOiAnQUlHZXN0aW9uMTIzIScsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZXhwZWN0KDIwMSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdGF0dXMpLnRvQmUoMjAxKTtcclxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS5lbWFpbCkudG9CZSh1bmlxdWVFbWFpbCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==
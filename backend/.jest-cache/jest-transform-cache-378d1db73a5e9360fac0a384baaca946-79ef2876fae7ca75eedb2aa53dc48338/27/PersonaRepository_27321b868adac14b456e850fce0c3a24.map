{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\repository\\PersonaRepository.ts","mappings":";;;;;;;;;AAAA,yCAAuC;AACvC,qDAAkD;AAClD,kDAAyD;AAYlD,IAAM,iBAAiB,GAAvB,MAAM,iBAAkB,SAAQ,+BAAwB;IAC7D,KAAK,CAAC,WAAW,CAAC,OAAe;QAC/B,OAAO,MAAM,iBAAO,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IACxE,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,KAAK,GAAG,EAAE,EAAE,MAAM,GAAG,CAAC;QACrC,MAAM,CAAC,QAAQ,EAAE,KAAK,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;YAC1C,iBAAO,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;iBAC7B,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC;iBACvB,IAAI,CAAC,MAAM,CAAC;iBACZ,KAAK,CAAC,KAAK,CAAC;iBACZ,QAAQ,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC,4BAA4B;iBAC9D,IAAI,EAAE;YACT,iBAAO,CAAC,cAAc,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;SAC3C,CAAC,CAAC;QACH,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC;IAC7B,CAAC;IAEQ,KAAK,CAAC,QAAQ,CAAC,EAAU;QAChC,OAAO,MAAM,iBAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IAC3C,CAAC;IAEQ,KAAK,CAAC,MAAM,CACnB,QAAoC,EACpC,SAA6B;QAE7B,MAAM,IAAI,GAAG,OAAO,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC,SAAS,IAAI,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC;QACvE,IAAI,OAAO,QAAQ,KAAK,QAAQ,EAAE,CAAC;YAChC,IAAY,CAAC,GAAG,GAAG,QAAQ,CAAC;QAC/B,CAAC;QACD,MAAM,OAAO,GAAG,IAAI,iBAAO,CAAC,IAAW,CAAC,CAAC;QACzC,OAAO,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;IAC9B,CAAC;IAEQ,KAAK,CAAC,MAAM,CAAC,EAAU,EAAE,IAAuB;QACvD,OAAO,MAAM,iBAAO,CAAC,iBAAiB,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IACzE,CAAC;IAEQ,KAAK,CAAC,MAAM,CAAC,EAAU;QAC9B,MAAM,MAAM,GAAG,MAAM,iBAAO,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;QAC1D,OAAO,CAAC,CAAC,MAAM,CAAC;IAClB,CAAC;CACF,CAAA;AA1CY,8CAAiB;4BAAjB,iBAAiB;IAD7B,IAAA,sBAAU,GAAE;GACA,iBAAiB,CA0C7B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\repository\\PersonaRepository.ts"],"sourcesContent":["import { injectable } from 'inversify';\nimport { BaseRepository } from './BaseRepository';\nimport { IPersona, Persona } from '../../models/Persona';\n\nexport interface IPersonaRepository extends BaseRepository<IPersona> {\n  findByOwner(ownerId: string): Promise<IPersona[]>;\n  findPublic(limit?: number, offset?: number): Promise<{ personas: IPersona[]; total: number }>;\n  findById(id: string): Promise<IPersona | null>;\n  create(idOrItem: string | Partial<IPersona>, maybeItem?: Partial<IPersona>): Promise<IPersona>;\n  update(id: string, data: Partial<IPersona>): Promise<IPersona | null>;\n  delete(id: string): Promise<boolean>;\n}\n\n@injectable()\nexport class PersonaRepository extends BaseRepository<IPersona> implements IPersonaRepository {\n  async findByOwner(ownerId: string): Promise<IPersona[]> {\n    return await Persona.find({ ownerId }).sort({ createdAt: -1 }).exec();\n  }\n\n  async findPublic(limit = 20, offset = 0): Promise<{ personas: IPersona[]; total: number }> {\n    const [personas, total] = await Promise.all([\n      Persona.find({ isPublic: true })\n        .sort({ createdAt: -1 })\n        .skip(offset)\n        .limit(limit)\n        .populate('ownerId', 'name email') // Populate basic owner info\n        .exec(),\n      Persona.countDocuments({ isPublic: true }),\n    ]);\n    return { personas, total };\n  }\n\n  override async findById(id: string): Promise<IPersona | null> {\n    return await Persona.findById(id).exec();\n  }\n\n  override async create(\n    idOrItem: string | Partial<IPersona>,\n    maybeItem?: Partial<IPersona>,\n  ): Promise<IPersona> {\n    const data = typeof idOrItem === 'string' ? maybeItem ?? {} : idOrItem;\n    if (typeof idOrItem === 'string') {\n      (data as any)._id = idOrItem;\n    }\n    const persona = new Persona(data as any);\n    return await persona.save();\n  }\n\n  override async update(id: string, data: Partial<IPersona>): Promise<IPersona | null> {\n    return await Persona.findByIdAndUpdate(id, data, { new: true }).exec();\n  }\n\n  override async delete(id: string): Promise<boolean> {\n    const result = await Persona.findByIdAndDelete(id).exec();\n    return !!result;\n  }\n}\n"],"version":3}
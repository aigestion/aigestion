ffcf820a996c2d202bdd1c45c02bc9bf
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Move mock implementation to allow accessing variables (or use factory correctly)
globals_1.jest.mock('nodemailer', () => {
    return {
        createTransport: globals_1.jest.fn(() => ({
            sendMail: mockSendMail,
            verify: mockVerify,
        })),
    };
});
require("reflect-metadata");
const nodemailer_1 = __importDefault(require("nodemailer"));
const inversify_config_1 = require("../../config/inversify.config");
const mockSendMail = globals_1.jest.fn();
const mockVerify = globals_1.jest.fn();
describe('EmailService', () => {
    let service;
    beforeEach(() => {
        globals_1.jest.clearAllMocks();
        console.log('DEBUG: TYPES.EmailService Symbol:', inversify_config_1.TYPES.EmailService.toString());
        console.log('DEBUG: Is EmailService bound?', inversify_config_1.container.isBound(inversify_config_1.TYPES.EmailService));
        try {
            service = inversify_config_1.container.get(inversify_config_1.TYPES.EmailService);
            console.log('DEBUG: Service successfully retrieved');
        }
        catch (e) {
            console.error('DEBUG: Error retrieving service:', e.message);
            throw e;
        }
    });
    it('should create transporter on initialization', () => {
        expect(nodemailer_1.default.createTransport).toHaveBeenCalled();
    });
    describe('verifyConnection', () => {
        it('should return true on success', async () => {
            mockVerify.mockResolvedValue(true);
            const result = await service.verifyConnection();
            expect(result).toBe(true);
        });
        it('should return false on failure', async () => {
            mockVerify.mockRejectedValue(new Error('Connection failed'));
            const result = await service.verifyConnection();
            expect(result).toBe(false);
        });
    });
    describe('sendEmail', () => {
        it('should send email successfully', async () => {
            mockSendMail.mockResolvedValue({ messageId: 'test-id' });
            await service.sendEmail({
                to: 'test@example.com',
                subject: 'Test Subject',
                html: 'Test Body',
            });
            expect(mockSendMail).toHaveBeenCalledWith(expect.objectContaining({
                to: 'test@example.com',
                subject: 'Test Subject',
                html: 'Test Body',
            }));
        });
        it('should throw error on failure', async () => {
            mockSendMail.mockRejectedValue(new Error('Send failed'));
            await expect(service.sendEmail({ to: 'test', subject: 'test', html: 'test' })).rejects.toThrow('Send failed');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXHNlcnZpY2VzXFxlbWFpbC5zZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQSwyQ0FBcUM7QUFRckMsbUZBQW1GO0FBQ25GLGNBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMzQixPQUFPO1FBQ0wsZUFBZSxFQUFFLGNBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUM5QixRQUFRLEVBQUUsWUFBWTtZQUN0QixNQUFNLEVBQUUsVUFBVTtTQUNuQixDQUFDLENBQUM7S0FDSixDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFsQkgsNEJBQTBCO0FBRzFCLDREQUFvQztBQUNwQyxvRUFBaUU7QUFHakUsTUFBTSxZQUFZLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQy9CLE1BQU0sVUFBVSxHQUFHLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQVk3QixRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFJLE9BQXFCLENBQUM7SUFFMUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGNBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxFQUFFLHdCQUFLLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDaEYsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBK0IsRUFBRSw0QkFBUyxDQUFDLE9BQU8sQ0FBQyx3QkFBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFDcEYsSUFBSSxDQUFDO1lBQ0gsT0FBTyxHQUFHLDRCQUFTLENBQUMsR0FBRyxDQUFlLHdCQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDMUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1FBQ3ZELENBQUM7UUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO1lBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsa0NBQWtDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzdELE1BQU0sQ0FBQyxDQUFDO1FBQ1YsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtRQUNyRCxNQUFNLENBQUMsb0JBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQ3hELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsK0JBQStCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0MsVUFBVSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25DLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDaEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5QyxVQUFVLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO1lBQzdELE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDaEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlDLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1lBQ3pELE1BQU0sT0FBTyxDQUFDLFNBQVMsQ0FBQztnQkFDdEIsRUFBRSxFQUFFLGtCQUFrQjtnQkFDdEIsT0FBTyxFQUFFLGNBQWM7Z0JBQ3ZCLElBQUksRUFBRSxXQUFXO2FBQ2xCLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FDdkMsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUN0QixFQUFFLEVBQUUsa0JBQWtCO2dCQUN0QixPQUFPLEVBQUUsY0FBYztnQkFDdkIsSUFBSSxFQUFFLFdBQVc7YUFDbEIsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3QyxZQUFZLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztZQUN6RCxNQUFNLE1BQU0sQ0FDVixPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUNqRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWxlamFuZHJvXFxBSUdlc3Rpb25cXGJhY2tlbmRcXHNyY1xcX190ZXN0c19fXFxzZXJ2aWNlc1xcZW1haWwuc2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5cbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCBub2RlbWFpbGVyIGZyb20gJ25vZGVtYWlsZXInO1xuaW1wb3J0IHsgY29udGFpbmVyLCBUWVBFUyB9IGZyb20gJy4uLy4uL2NvbmZpZy9pbnZlcnNpZnkuY29uZmlnJztcbmltcG9ydCB7IEVtYWlsU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2VtYWlsLnNlcnZpY2UnO1xuXG5jb25zdCBtb2NrU2VuZE1haWwgPSBqZXN0LmZuKCk7XG5jb25zdCBtb2NrVmVyaWZ5ID0gamVzdC5mbigpO1xuXG4vLyBNb3ZlIG1vY2sgaW1wbGVtZW50YXRpb24gdG8gYWxsb3cgYWNjZXNzaW5nIHZhcmlhYmxlcyAob3IgdXNlIGZhY3RvcnkgY29ycmVjdGx5KVxuamVzdC5tb2NrKCdub2RlbWFpbGVyJywgKCkgPT4ge1xuICByZXR1cm4ge1xuICAgIGNyZWF0ZVRyYW5zcG9ydDogamVzdC5mbigoKSA9PiAoe1xuICAgICAgc2VuZE1haWw6IG1vY2tTZW5kTWFpbCxcbiAgICAgIHZlcmlmeTogbW9ja1ZlcmlmeSxcbiAgICB9KSksXG4gIH07XG59KTtcblxuZGVzY3JpYmUoJ0VtYWlsU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IEVtYWlsU2VydmljZTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBjb25zb2xlLmxvZygnREVCVUc6IFRZUEVTLkVtYWlsU2VydmljZSBTeW1ib2w6JywgVFlQRVMuRW1haWxTZXJ2aWNlLnRvU3RyaW5nKCkpO1xuICAgIGNvbnNvbGUubG9nKCdERUJVRzogSXMgRW1haWxTZXJ2aWNlIGJvdW5kPycsIGNvbnRhaW5lci5pc0JvdW5kKFRZUEVTLkVtYWlsU2VydmljZSkpO1xuICAgIHRyeSB7XG4gICAgICBzZXJ2aWNlID0gY29udGFpbmVyLmdldDxFbWFpbFNlcnZpY2U+KFRZUEVTLkVtYWlsU2VydmljZSk7XG4gICAgICBjb25zb2xlLmxvZygnREVCVUc6IFNlcnZpY2Ugc3VjY2Vzc2Z1bGx5IHJldHJpZXZlZCcpO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcignREVCVUc6IEVycm9yIHJldHJpZXZpbmcgc2VydmljZTonLCBlLm1lc3NhZ2UpO1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY3JlYXRlIHRyYW5zcG9ydGVyIG9uIGluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGV4cGVjdChub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndmVyaWZ5Q29ubmVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIG9uIHN1Y2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVmVyaWZ5Lm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZnlDb25uZWN0aW9uKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugb24gZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tWZXJpZnkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDb25uZWN0aW9uIGZhaWxlZCcpKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmVyaWZ5Q29ubmVjdGlvbigpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZW5kRW1haWwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZW5kIGVtYWlsIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTZW5kTWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IG1lc3NhZ2VJZDogJ3Rlc3QtaWQnIH0pO1xuICAgICAgYXdhaXQgc2VydmljZS5zZW5kRW1haWwoe1xuICAgICAgICB0bzogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBzdWJqZWN0OiAnVGVzdCBTdWJqZWN0JyxcbiAgICAgICAgaHRtbDogJ1Rlc3QgQm9keScsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrU2VuZE1haWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdG86ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBzdWJqZWN0OiAnVGVzdCBTdWJqZWN0JyxcbiAgICAgICAgICBodG1sOiAnVGVzdCBCb2R5JyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBvbiBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1NlbmRNYWlsLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignU2VuZCBmYWlsZWQnKSk7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2Uuc2VuZEVtYWlsKHsgdG86ICd0ZXN0Jywgc3ViamVjdDogJ3Rlc3QnLCBodG1sOiAndGVzdCcgfSksXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnU2VuZCBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==
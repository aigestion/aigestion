fdf49eabc94f148edd4e772039e0ede6
/**
 * API Integration Tests
 *
 * These tests require a fully running server with real MongoDB and Redis connections.
 * They are skipped in unit test mode (NODE_ENV=test) and should only be run
 * as part of a dedicated integration test pipeline with `npm run test:integration`.
 *
 * To run: RUN_INTEGRATION_TESTS=true npx jest --runInBand api.integration.test.ts
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
const SKIP_INTEGRATION = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;
(SKIP_INTEGRATION ? describe.skip : describe)('API Integration Tests', () => {
    let server;
    let dbService;
    let redisService;
    beforeAll(async () => {
        // Dynamic imports to avoid compilation errors when skipped
        const { app } = await Promise.resolve().then(() => __importStar(require('../../app')));
        const { connectToDatabase } = await Promise.resolve().then(() => __importStar(require('../../config/database')));
        process.env.MONGODB_URI =
            'mongodb://admin:AWReTznw7k3Sf4lWFEenRw@localhost:27017/aigestion-platform?authSource=admin';
        await connectToDatabase();
        dbService = {};
        redisService = {};
        server = app.listen(0);
    });
    afterAll(async () => {
        if (server)
            server.close();
    });
    describe('Authentication Endpoints', () => {
        test('POST /api/v1/auth/login - Valid credentials', async () => {
            const request = require('supertest');
            // Create user first
            await request(server).post('/api/v1/users').send({
                email: 'test@example.com',
                name: 'Integration Test User',
                password: 'AIGestion2026!',
            });
            const response = await request(server)
                .post('/api/v1/auth/login')
                .send({ email: 'test@example.com', password: 'AIGestion2026!' });
            expect(response.status).toBe(200);
        });
    });
    describe('Health Check', () => {
        test('GET /health should return status', async () => {
            const request = require('supertest');
            const response = await request(server).get('/health');
            expect(response.status).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXGludGVncmF0aW9uXFxhcGkuaW50ZWdyYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7R0FRRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQztBQUUvRixDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDMUUsSUFBSSxNQUFXLENBQUM7SUFDaEIsSUFBSSxTQUFjLENBQUM7SUFDbkIsSUFBSSxZQUFpQixDQUFDO0lBRXRCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQiwyREFBMkQ7UUFDM0QsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLHdEQUFhLFdBQVcsR0FBQyxDQUFDO1FBQzFDLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxHQUFHLHdEQUFhLHVCQUF1QixHQUFDLENBQUM7UUFDcEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXO1lBQ3JCLDRGQUE0RixDQUFDO1FBQy9GLE1BQU0saUJBQWlCLEVBQUUsQ0FBQztRQUUxQixTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ2YsWUFBWSxHQUFHLEVBQUUsQ0FBQztRQUNsQixNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNsQixJQUFJLE1BQU07WUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO1FBQ3hDLElBQUksQ0FBQyw2Q0FBNkMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFckMsb0JBQW9CO1lBQ3BCLE1BQU0sT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQy9DLEtBQUssRUFBRSxrQkFBa0I7Z0JBQ3pCLElBQUksRUFBRSx1QkFBdUI7Z0JBQzdCLFFBQVEsRUFBRSxnQkFBZ0I7YUFDM0IsQ0FBQyxDQUFDO1lBRUgsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsTUFBTSxDQUFDO2lCQUNuQyxJQUFJLENBQUMsb0JBQW9CLENBQUM7aUJBQzFCLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUM1QixJQUFJLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEQsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFsZWphbmRyb1xcQUlHZXN0aW9uXFxiYWNrZW5kXFxzcmNcXF9fdGVzdHNfX1xcaW50ZWdyYXRpb25cXGFwaS5pbnRlZ3JhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQVBJIEludGVncmF0aW9uIFRlc3RzXG4gKlxuICogVGhlc2UgdGVzdHMgcmVxdWlyZSBhIGZ1bGx5IHJ1bm5pbmcgc2VydmVyIHdpdGggcmVhbCBNb25nb0RCIGFuZCBSZWRpcyBjb25uZWN0aW9ucy5cbiAqIFRoZXkgYXJlIHNraXBwZWQgaW4gdW5pdCB0ZXN0IG1vZGUgKE5PREVfRU5WPXRlc3QpIGFuZCBzaG91bGQgb25seSBiZSBydW5cbiAqIGFzIHBhcnQgb2YgYSBkZWRpY2F0ZWQgaW50ZWdyYXRpb24gdGVzdCBwaXBlbGluZSB3aXRoIGBucG0gcnVuIHRlc3Q6aW50ZWdyYXRpb25gLlxuICpcbiAqIFRvIHJ1bjogUlVOX0lOVEVHUkFUSU9OX1RFU1RTPXRydWUgbnB4IGplc3QgLS1ydW5JbkJhbmQgYXBpLmludGVncmF0aW9uLnRlc3QudHNcbiAqL1xuXG5jb25zdCBTS0lQX0lOVEVHUkFUSU9OID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyAmJiAhcHJvY2Vzcy5lbnYuUlVOX0lOVEVHUkFUSU9OX1RFU1RTO1xuXG4oU0tJUF9JTlRFR1JBVElPTiA/IGRlc2NyaWJlLnNraXAgOiBkZXNjcmliZSkoJ0FQSSBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IHNlcnZlcjogYW55O1xuICBsZXQgZGJTZXJ2aWNlOiBhbnk7XG4gIGxldCByZWRpc1NlcnZpY2U6IGFueTtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIER5bmFtaWMgaW1wb3J0cyB0byBhdm9pZCBjb21waWxhdGlvbiBlcnJvcnMgd2hlbiBza2lwcGVkXG4gICAgY29uc3QgeyBhcHAgfSA9IGF3YWl0IGltcG9ydCgnLi4vLi4vYXBwJyk7XG4gICAgY29uc3QgeyBjb25uZWN0VG9EYXRhYmFzZSB9ID0gYXdhaXQgaW1wb3J0KCcuLi8uLi9jb25maWcvZGF0YWJhc2UnKTtcbiAgICBwcm9jZXNzLmVudi5NT05HT0RCX1VSSSA9XG4gICAgICAnbW9uZ29kYjovL2FkbWluOkFXUmVUem53N2szU2Y0bFdGRWVuUndAbG9jYWxob3N0OjI3MDE3L2FpZ2VzdGlvbi1wbGF0Zm9ybT9hdXRoU291cmNlPWFkbWluJztcbiAgICBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xuXG4gICAgZGJTZXJ2aWNlID0ge307XG4gICAgcmVkaXNTZXJ2aWNlID0ge307XG4gICAgc2VydmVyID0gYXBwLmxpc3RlbigwKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGlmIChzZXJ2ZXIpIHNlcnZlci5jbG9zZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnQXV0aGVudGljYXRpb24gRW5kcG9pbnRzJywgKCkgPT4ge1xuICAgIHRlc3QoJ1BPU1QgL2FwaS92MS9hdXRoL2xvZ2luIC0gVmFsaWQgY3JlZGVudGlhbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XG5cbiAgICAgIC8vIENyZWF0ZSB1c2VyIGZpcnN0XG4gICAgICBhd2FpdCByZXF1ZXN0KHNlcnZlcikucG9zdCgnL2FwaS92MS91c2VycycpLnNlbmQoe1xuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBuYW1lOiAnSW50ZWdyYXRpb24gVGVzdCBVc2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdBSUdlc3Rpb24yMDI2IScsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHNlcnZlcilcbiAgICAgICAgLnBvc3QoJy9hcGkvdjEvYXV0aC9sb2dpbicpXG4gICAgICAgIC5zZW5kKHsgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJywgcGFzc3dvcmQ6ICdBSUdlc3Rpb24yMDI2IScgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hlYWx0aCBDaGVjaycsICgpID0+IHtcbiAgICB0ZXN0KCdHRVQgL2hlYWx0aCBzaG91bGQgcmV0dXJuIHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChzZXJ2ZXIpLmdldCgnL2hlYWx0aCcpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==
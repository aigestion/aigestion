{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\health.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\health.service.ts"],"sourcesContent":["import { injectable, inject } from 'inversify';\nimport axios from 'axios';\nimport mongoose from 'mongoose';\nimport { TYPES } from '../types';\nimport { PineconeService } from './pinecone.service';\nimport { getRedisClient } from '../cache/redis';\nimport { container } from '../config/inversify.config';\nimport { MalwareScannerService } from './malware-scanner.service';\n\n@injectable()\nexport class HealthService {\n  constructor(@inject(TYPES.PineconeService) private pineconeService: PineconeService) {}\n\n  public async getDetailedHealth() {\n    const results: any = {\n      timestamp: new Date().toISOString(),\n      status: 'healthy',\n      checks: [],\n    };\n\n    // 1. MongoDB Check\n    const mongoStatus = mongoose.connection.readyState === 1 ? 'up' : 'down';\n    results.checks.push({ name: 'mongodb', status: mongoStatus });\n    if (mongoStatus === 'down') results.status = 'degraded';\n\n    // 2. Redis Check\n    try {\n      const redisClient = getRedisClient();\n      const ping = await redisClient.ping();\n      results.checks.push({ name: 'redis', status: ping === 'PONG' ? 'up' : 'down' });\n    } catch (err) {\n      results.checks.push({ name: 'redis', status: 'down', error: (err as any).message });\n      results.status = 'degraded';\n    }\n\n    // 3. Pinecone Check\n    try {\n      // Simple check to see if Pinecone can be reached\n      const index = (this.pineconeService as any).index;\n      results.checks.push({ name: 'pinecone', status: index ? 'up' : 'down' });\n    } catch (err) {\n      results.checks.push({ name: 'pinecone', status: 'down', error: (err as any).message });\n      results.status = 'degraded';\n    }\n\n    // 4. NeuroCore (ML Service) Check\n    try {\n      const mlServiceUrl = process.env.ML_SERVICE_URL || 'http://ml-service:5000';\n      const mlResp = await axios.get(`${mlServiceUrl}/health`, { timeout: 2000 });\n      results.checks.push({\n        name: 'neurocore',\n        status: mlResp.status === 200 ? 'up' : 'down',\n        version: mlResp.data?.version || 'unknown',\n      });\n    } catch (err) {\n      results.checks.push({ name: 'neurocore', status: 'down', error: (err as any).message });\n      results.status = 'degraded';\n    }\n\n    // 5. Malware Engines Check\n    try {\n      const scanner = container.get<MalwareScannerService>(TYPES.MalwareScannerService);\n      results.checks.push({\n        name: 'malware-scanner',\n        status: 'up',\n        engines: {\n          clamav: (scanner as any).isClamAVAvailable ? 'active' : 'inactive',\n          yara: (scanner as any).isYARAAvailable ? 'active' : 'inactive',\n        },\n      });\n    } catch (err) {\n      results.checks.push({ name: 'malware-scanner', status: 'down' });\n    }\n\n    // 6. Memory Usage\n    const memory = process.memoryUsage();\n    results.metrics = {\n      rss: `${Math.round(memory.rss / 1024 / 1024)}MB`,\n      heapUsed: `${Math.round(memory.heapUsed / 1024 / 1024)}MB`,\n    };\n\n    return results;\n  }\n}\n"],"version":3}
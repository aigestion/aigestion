{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\utils\\youtube-watcher.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\utils\\youtube-watcher.service.ts"],"sourcesContent":["Ôªøimport { injectable, inject } from 'inversify';\nimport * as chokidar from 'chokidar';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\nimport { env } from '../config/env.schema';\nimport { TranscriptionJob, YoutubeTranscriptionQueue } from '../queue/youtube-transcription.queue';\nimport { YouTubeChannelService } from '../services/google/youtube-channel.service';\nimport { TelegramService } from '../services/telegram.service';\nimport { logger } from '../utils/logger';\nimport { TYPES } from '../types';\n\nconst VIDEO_EXTENSIONS = ['.mp4', '.mov', '.avi', '.mkv'];\n\n/**\n * Servicio de vigilancia de carpeta para archivos de YouTube\n */\n@injectable()\nexport class YoutubeWatcherService {\n  private watcher: chokidar.FSWatcher | null = null;\n  private watchPath: string;\n  private processedPath: string;\n  private recipientEmail: string;\n\n  constructor(\n    @inject(TYPES.YoutubeTranscriptionQueue)\n    private youtubeTranscriptionQueue: YoutubeTranscriptionQueue,\n    @inject(TYPES.YoutubeChannelService) private youtubeChannelService: YouTubeChannelService,\n    @inject(TYPES.TelegramService) private telegramService: TelegramService,\n  ) {\n    // La carpeta a vigilar est√° en la ra√≠z del proyecto NEXUS V1\n    const projectRoot = path.resolve(__dirname, '../../../../');\n    this.watchPath = path.join(projectRoot, 'youtube', 'Videos.Transcripcion');\n    this.processedPath = path.join(this.watchPath, 'processed');\n\n    // Email del destinatario (puede ser configurado via variable de entorno)\n    this.recipientEmail = process.env.YOUTUBE_TRANSCRIPTION_EMAIL || env.EMAIL_FROM;\n  }\n\n  /**\n   * Asegura que las carpetas necesarias existan\n   */\n  private ensureDirectories(): void {\n    if (!fs.existsSync(this.watchPath)) {\n      fs.mkdirSync(this.watchPath, { recursive: true });\n      logger.info(`Carpeta creada: ${this.watchPath}`);\n    }\n\n    if (!fs.existsSync(this.processedPath)) {\n      fs.mkdirSync(this.processedPath, { recursive: true });\n      logger.info(`Carpeta creada: ${this.processedPath}`);\n    }\n  }\n\n  /**\n   * Extrae la URL del video desde un archivo de texto\n   */\n  private extractVideoUrl(filePath: string): string | null {\n    try {\n      const content = fs.readFileSync(filePath, 'utf-8').trim();\n\n      // Validar que parece ser una URL de YouTube\n      if (content.includes('youtube.com') || content.includes('youtu.be')) {\n        // Extraer la primera l√≠nea que contenga una URL\n        const lines = content.split('\\n');\n        for (const line of lines) {\n          const trimmed = line.trim();\n          if (trimmed.includes('youtube.com') || trimmed.includes('youtu.be')) {\n            return trimmed;\n          }\n        }\n      }\n\n      return null;\n    } catch (error: any) {\n      logger.error(error, `Error leyendo archivo ${filePath}`);\n      return null;\n    }\n  }\n\n  /**\n   * Mueve el archivo procesado a la carpeta processed/\n   */\n  private moveToProcessed(filePath: string): void {\n    try {\n      const fileName = path.basename(filePath);\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n      const newFileName = `${timestamp}_${fileName}`;\n      const newPath = path.join(this.processedPath, newFileName);\n\n      fs.renameSync(filePath, newPath);\n      logger.info(`Archivo movido a processed: ${newFileName}`);\n    } catch (error: any) {\n      logger.error(error, `Error moviendo archivo ${filePath}`);\n    }\n  }\n\n  /**\n   * Procesa un nuevo archivo detectado\n   */\n  private async processFile(filePath: string): Promise<void> {\n    const fileName = path.basename(filePath);\n\n    // Ignorar archivos temporales o del sistema\n    if (fileName.startsWith('.') || fileName.startsWith('~')) {\n      return;\n    }\n\n    // Soporte para archivos de texto (URL)\n    if (path.extname(filePath) === '.txt') {\n      await this.processTxtFile(filePath, fileName);\n      return;\n    }\n\n    // Soporte para archivos de video (Upload)\n    if (VIDEO_EXTENSIONS.includes(path.extname(filePath).toLowerCase())) {\n      await this.processVideoFile(filePath, fileName);\n      return;\n    }\n\n    logger.debug(`Archivo ignorado (extensi√≥n no soportada): ${fileName}`);\n  }\n\n  /**\n   * Procesa un archivo .txt que contiene una URL de YouTube\n   */\n  private async processTxtFile(filePath: string, fileName: string): Promise<void> {\n    logger.info(`Analizando archivo de texto: ${fileName}`);\n\n    // Peque√±a demora para asegurar que el archivo se termin√≥ de escribir\n    await new Promise(resolve => setTimeout(resolve, 500));\n\n    // Extraer URL del video\n    const videoUrl = this.extractVideoUrl(filePath);\n\n    if (!videoUrl) {\n      logger.warn(`No se encontr√≥ una URL de YouTube v√°lida en: ${fileName}`);\n      return;\n    }\n\n    logger.info(`URL de YouTube detectada: ${videoUrl}`);\n\n    // Crear job de transcripci√≥n\n    const job: TranscriptionJob = {\n      videoUrl,\n      recipientEmail: this.recipientEmail,\n      fileName,\n      timestamp: new Date().toISOString(),\n    };\n\n    // Encolar el job\n    const enqueued = await this.youtubeTranscriptionQueue.publishTranscriptionJob(job);\n\n    if (enqueued) {\n      logger.info(`Job encolado exitosamente para: ${fileName}`);\n      this.moveToProcessed(filePath);\n    }\n  }\n\n  /**\n   * Sube un video local a AIGestion y luego encola su transcripci√≥n\n   */\n  private async processVideoFile(filePath: string, fileName: string): Promise<void> {\n    logger.info(`üöÄ Iniciando carga premium de video: ${fileName}`);\n\n    try {\n      // 1. Subir a YouTube (Canal AIGestion)\n      const videoId = await this.youtubeChannelService.uploadVideo({\n        channelType: 'business',\n        filePath: filePath,\n        metadata: {\n          title: path.parse(fileName).name, // Nombre del archivo sin extensi√≥n\n          description: 'Video procesado autom√°ticamente por AIGestion (NEXUS V1)',\n          tags: ['AIGestion', 'Automation', 'Tutorial'],\n          categoryId: '27', // Education\n          privacyStatus: 'unlisted', // Por defecto oculto por privacidad\n        },\n      });\n\n      // 2. A√±adir a la lista de Tutoriales\n      const playlistId = await this.youtubeChannelService.findPlaylistByName(\n        'business',\n        'Tutoriales',\n      );\n      if (playlistId) {\n        await this.youtubeChannelService.addVideoToPlaylist('business', videoId, playlistId);\n        logger.info(`Video a√±adido a la playlist Tutoriales: ${playlistId}`);\n      }\n\n      const videoUrl = `https://www.youtube.com/watch?v=${videoId}`;\n      logger.info(`Video subido exitosamente: ${videoUrl}`);\n\n      // 3. Encolar transcripci√≥n (usaremos la URL generada)\n      const job: TranscriptionJob = {\n        videoUrl,\n        recipientEmail: this.recipientEmail,\n        fileName,\n        timestamp: new Date().toISOString(),\n      };\n\n      const enqueued = await youtubeTranscriptionQueue.publishTranscriptionJob(job);\n\n      if (enqueued) {\n        logger.info(`Job de transcripci√≥n encolado para video subido: ${fileName}`);\n        this.moveToProcessed(filePath);\n\n        // 4. Notificaci√≥n Premium por Telegram\n        try {\n          const adminChatId = process.env.TELEGRAM_ADMIN_CHAT_ID || process.env.TELEGRAM_CHAT_ID;\n\n          if (adminChatId) {\n            const message =\n              `üé¨ *NEXUS V1: Video Automatizado*\\n\\n` +\n              `‚úÖ *Archivo:* \\`${fileName}\\` subido exitosamente.\\n` +\n              `üíé *Canal:* AIGestion (Empresa)\\n` +\n              `üìå *Playlist:* Tutoriales\\n` +\n              `üîó *URL:* ${videoUrl}\\n\\n` +\n              `üìù _La transcripci√≥n se est√° procesando y se incluir√° en el pr√≥ximo Briefing._`;\n\n            await this.telegramService.sendMessage(adminChatId, message);\n            logger.info('Notificaci√≥n de Telegram enviada exitosamente.');\n          }\n        } catch (msgError) {\n          logger.error(msgError, 'Error enviando notificaci√≥n de Telegram');\n        }\n      }\n    } catch (error: any) {\n      logger.error(error, `Error durante la automatizaci√≥n premium del video ${fileName}`);\n    }\n  }\n\n  /**\n   * Inicia el servicio de vigilancia\n   */\n  start(): void {\n    this.ensureDirectories();\n\n    logger.info(`Iniciando vigilancia de carpeta: ${this.watchPath}`);\n    logger.info(`Email de destino: ${this.recipientEmail}`);\n\n    this.watcher = chokidar.watch(this.watchPath, {\n      ignored: path =>\n        [\n          /(^|[\\/\\\\])\\../, // Archivos ocultos\n          /processed/, // Carpeta processed\n          /README\\.md/, // README\n        ].some(pattern => pattern.test(path)),\n      persistent: true,\n      ignoreInitial: true, // No procesar archivos existentes al iniciar\n      awaitWriteFinish: {\n        stabilityThreshold: 1000,\n        pollInterval: 100,\n      },\n    });\n\n    this.watcher\n      .on('add', filePath => {\n        this.processFile(filePath).catch((error: any) => {\n          logger.error(error, `Error procesando archivo ${filePath}`);\n        });\n      })\n      .on('error', (error: any) => {\n        logger.error(error, 'Error en el watcher');\n      })\n      .on('ready', () => {\n        logger.info('‚úÖ Watcher de YouTube listo. Esperando archivos...');\n      });\n  }\n\n  /**\n   * Detiene el servicio de vigilancia\n   */\n  async stop(): Promise<void> {\n    if (this.watcher) {\n      await this.watcher.close();\n      this.watcher = null;\n      logger.info('Watcher de YouTube detenido');\n    }\n  }\n\n  /**\n   * Obtiene el estado del watcher\n   */\n  getStatus(): {\n    isRunning: boolean;\n    watchPath: string;\n    recipientEmail: string;\n  } {\n    return {\n      isRunning: this.watcher !== null,\n      watchPath: this.watchPath,\n      recipientEmail: this.recipientEmail,\n    };\n  }\n}\n"],"version":3}
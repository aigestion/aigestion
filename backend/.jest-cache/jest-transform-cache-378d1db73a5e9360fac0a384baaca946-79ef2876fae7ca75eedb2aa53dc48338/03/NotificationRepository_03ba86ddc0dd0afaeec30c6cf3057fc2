80fb250f076e60be674f3f874abb3f0c
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotificationRepository = void 0;
const inversify_1 = require("inversify");
const BaseRepository_1 = require("./BaseRepository");
const Notification_1 = require("../../models/Notification");
let NotificationRepository = class NotificationRepository extends BaseRepository_1.BaseRepository {
    async create(idOrItem, maybeItem) {
        const data = typeof idOrItem === 'string' ? maybeItem ?? {} : idOrItem;
        const notification = new Notification_1.Notification(data);
        return await notification.save();
    }
    async findById(id) {
        return await Notification_1.Notification.findById(id).exec();
    }
    async findByUser(userId, limit = 50, skip = 0) {
        return await Notification_1.Notification.find({ userId })
            .sort({ createdAt: -1 })
            .skip(skip)
            .limit(limit)
            .exec();
    }
    async markAsRead(id) {
        return await Notification_1.Notification.findByIdAndUpdate(id, { read: true }, { new: true }).exec();
    }
    async markAllAsRead(userId) {
        await Notification_1.Notification.updateMany({ userId, read: false }, { read: true }).exec();
    }
    async update(id, data) {
        return await Notification_1.Notification.findByIdAndUpdate(id, data, { new: true }).exec();
    }
    async delete(id) {
        const result = await Notification_1.Notification.findByIdAndDelete(id).exec();
        return !!result;
    }
};
exports.NotificationRepository = NotificationRepository;
exports.NotificationRepository = NotificationRepository = __decorate([
    (0, inversify_1.injectable)()
], NotificationRepository);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxpbmZyYXN0cnVjdHVyZVxccmVwb3NpdG9yeVxcTm90aWZpY2F0aW9uUmVwb3NpdG9yeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSx5Q0FBdUM7QUFDdkMscURBQWtEO0FBQ2xELDREQUF3RTtBQVNqRSxJQUFNLHNCQUFzQixHQUE1QixNQUFNLHNCQUNYLFNBQVEsK0JBQTZCO0lBRzVCLEtBQUssQ0FBQyxNQUFNLENBQUMsUUFBYSxFQUFFLFNBQWU7UUFDbEQsTUFBTSxJQUFJLEdBQUcsT0FBTyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7UUFDdkUsTUFBTSxZQUFZLEdBQUcsSUFBSSwyQkFBWSxDQUFDLElBQVcsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sTUFBTSxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVRLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBVTtRQUNoQyxPQUFPLE1BQU0sMkJBQVksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDaEQsQ0FBQztJQUVELEtBQUssQ0FBQyxVQUFVLENBQUMsTUFBYyxFQUFFLFFBQWdCLEVBQUUsRUFBRSxPQUFlLENBQUM7UUFDbkUsT0FBTyxNQUFNLDJCQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUM7YUFDdkMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7YUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQzthQUNWLEtBQUssQ0FBQyxLQUFLLENBQUM7YUFDWixJQUFJLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFRCxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQVU7UUFDekIsT0FBTyxNQUFNLDJCQUFZLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDeEYsQ0FBQztJQUVELEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBYztRQUNoQyxNQUFNLDJCQUFZLENBQUMsVUFBVSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2hGLENBQUM7SUFFUSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQVUsRUFBRSxJQUE0QjtRQUM1RCxPQUFPLE1BQU0sMkJBQVksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDOUUsQ0FBQztJQUVRLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBVTtRQUM5QixNQUFNLE1BQU0sR0FBRyxNQUFNLDJCQUFZLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDL0QsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ2xCLENBQUM7Q0FDRixDQUFBO0FBdENZLHdEQUFzQjtpQ0FBdEIsc0JBQXNCO0lBRGxDLElBQUEsc0JBQVUsR0FBRTtHQUNBLHNCQUFzQixDQXNDbEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxpbmZyYXN0cnVjdHVyZVxccmVwb3NpdG9yeVxcTm90aWZpY2F0aW9uUmVwb3NpdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlIH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IEJhc2VSZXBvc2l0b3J5IH0gZnJvbSAnLi9CYXNlUmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb24sIElOb3RpZmljYXRpb24gfSBmcm9tICcuLi8uLi9tb2RlbHMvTm90aWZpY2F0aW9uJztcblxuZXhwb3J0IGludGVyZmFjZSBJTm90aWZpY2F0aW9uUmVwb3NpdG9yeSBleHRlbmRzIEJhc2VSZXBvc2l0b3J5PElOb3RpZmljYXRpb24+IHtcbiAgZmluZEJ5VXNlcih1c2VySWQ6IHN0cmluZywgbGltaXQ/OiBudW1iZXIsIHNraXA/OiBudW1iZXIpOiBQcm9taXNlPElOb3RpZmljYXRpb25bXT47XG4gIG1hcmtBc1JlYWQoaWQ6IHN0cmluZyk6IFByb21pc2U8SU5vdGlmaWNhdGlvbiB8IG51bGw+O1xuICBtYXJrQWxsQXNSZWFkKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvblJlcG9zaXRvcnlcbiAgZXh0ZW5kcyBCYXNlUmVwb3NpdG9yeTxJTm90aWZpY2F0aW9uPlxuICBpbXBsZW1lbnRzIElOb3RpZmljYXRpb25SZXBvc2l0b3J5XG57XG4gIG92ZXJyaWRlIGFzeW5jIGNyZWF0ZShpZE9ySXRlbTogYW55LCBtYXliZUl0ZW0/OiBhbnkpOiBQcm9taXNlPElOb3RpZmljYXRpb24+IHtcbiAgICBjb25zdCBkYXRhID0gdHlwZW9mIGlkT3JJdGVtID09PSAnc3RyaW5nJyA/IG1heWJlSXRlbSA/PyB7fSA6IGlkT3JJdGVtO1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IG5ldyBOb3RpZmljYXRpb24oZGF0YSBhcyBhbnkpO1xuICAgIHJldHVybiBhd2FpdCBub3RpZmljYXRpb24uc2F2ZSgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgYXN5bmMgZmluZEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8SU5vdGlmaWNhdGlvbiB8IG51bGw+IHtcbiAgICByZXR1cm4gYXdhaXQgTm90aWZpY2F0aW9uLmZpbmRCeUlkKGlkKS5leGVjKCk7XG4gIH1cblxuICBhc3luYyBmaW5kQnlVc2VyKHVzZXJJZDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gNTAsIHNraXA6IG51bWJlciA9IDApOiBQcm9taXNlPElOb3RpZmljYXRpb25bXT4ge1xuICAgIHJldHVybiBhd2FpdCBOb3RpZmljYXRpb24uZmluZCh7IHVzZXJJZCB9KVxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXG4gICAgICAuc2tpcChza2lwKVxuICAgICAgLmxpbWl0KGxpbWl0KVxuICAgICAgLmV4ZWMoKTtcbiAgfVxuXG4gIGFzeW5jIG1hcmtBc1JlYWQoaWQ6IHN0cmluZyk6IFByb21pc2U8SU5vdGlmaWNhdGlvbiB8IG51bGw+IHtcbiAgICByZXR1cm4gYXdhaXQgTm90aWZpY2F0aW9uLmZpbmRCeUlkQW5kVXBkYXRlKGlkLCB7IHJlYWQ6IHRydWUgfSwgeyBuZXc6IHRydWUgfSkuZXhlYygpO1xuICB9XG5cbiAgYXN5bmMgbWFya0FsbEFzUmVhZCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IE5vdGlmaWNhdGlvbi51cGRhdGVNYW55KHsgdXNlcklkLCByZWFkOiBmYWxzZSB9LCB7IHJlYWQ6IHRydWUgfSkuZXhlYygpO1xuICB9XG5cbiAgb3ZlcnJpZGUgYXN5bmMgdXBkYXRlKGlkOiBzdHJpbmcsIGRhdGE6IFBhcnRpYWw8SU5vdGlmaWNhdGlvbj4pOiBQcm9taXNlPElOb3RpZmljYXRpb24gfCBudWxsPiB7XG4gICAgcmV0dXJuIGF3YWl0IE5vdGlmaWNhdGlvbi5maW5kQnlJZEFuZFVwZGF0ZShpZCwgZGF0YSwgeyBuZXc6IHRydWUgfSkuZXhlYygpO1xuICB9XG5cbiAgb3ZlcnJpZGUgYXN5bmMgZGVsZXRlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBOb3RpZmljYXRpb24uZmluZEJ5SWRBbmREZWxldGUoaWQpLmV4ZWMoKTtcbiAgICByZXR1cm4gISFyZXN1bHQ7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==
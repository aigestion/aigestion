{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\social.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\social.controller.ts"],"sourcesContent":["import axios from 'axios';\nimport type { Request, Response } from 'express';\nimport { Container } from 'typedi';\n\nimport { buildError } from '../common/response-builder';\nimport { config } from '../config/index';\nimport { InstagramService } from '../services/instagram.service';\nimport { LinkedInService } from '../services/linkedin.service';\nimport { TikTokService } from '../services/tiktok.service';\nimport { XService } from '../services/x.service';\n\nconst FB_API_URL = config.whatsapp.apiUrl;\n\nexport class SocialController {\n  // Publicar en Facebook Page\n  static async publishPost(req: Request, res: Response): Promise<void> {\n    try {\n      const { message, link } = req.body;\n      const pageId = process.env.FACEBOOK_PAGE_ID;\n      const accessToken = process.env.FACEBOOK_ACCESS_TOKEN;\n\n      if (!pageId || !accessToken) {\n        res.status(500).json({ error: 'Facebook credentials not configured' });\n        return;\n      }\n\n      console.log(`üöÄ Publishing to Facebook Page ${pageId}...`);\n\n      const response = await axios.post(`${FB_API_URL}/${pageId}/feed`, {\n        message,\n        link,\n        access_token: accessToken,\n      });\n\n      console.log('‚úÖ Published successfully:', response.data);\n      res.json({ success: true, postId: response.data.id });\n    } catch (error: any) {\n      console.error('‚ùå Error publishing to Facebook:', error.response?.data || error.message);\n      res\n        .status(500)\n        .json({ error: 'Failed to publish to Facebook', details: error.response?.data });\n    }\n  }\n\n  // Obtener M√©tricas de la P√°gina\n  static async getPageStats(_req: Request, res: Response): Promise<void> {\n    try {\n      const pageId = process.env.FACEBOOK_PAGE_ID;\n      const accessToken = process.env.FACEBOOK_ACCESS_TOKEN;\n\n      if (!pageId || !accessToken) {\n        // Mock data si no hay credenciales (para demo)\n        res.json({\n          followers: 1250,\n          impressions: 4500,\n          engagement: 8.5,\n          mock: true,\n        });\n      }\n\n      const response = await axios.get(`${FB_API_URL}/${pageId}`, {\n        params: {\n          fields: 'fan_count,rating_count,new_like_count,talking_about_count',\n          access_token: accessToken,\n        },\n      });\n\n      res.json(response.data);\n    } catch (error: any) {\n      console.error('‚ùå Error fetching FB stats:', error.response?.data || error.message);\n      (res as any)\n        .status(500)\n        .json(buildError('Failed to get stats', 'SOCIAL_ERROR', 500, (_req as any).requestId));\n    }\n  }\n\n  // Enviar Mensaje Directo Instagram\n  static async sendInstagramDM(req: Request, res: Response): Promise<void> {\n    try {\n      const { recipientId, text } = req.body;\n      const instagramService = Container.get(InstagramService) as any;\n      const result = await instagramService.sendDM(recipientId, text);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to send Instagram DM' });\n    }\n  }\n\n  // Publicar Tweet en X\n  static async postTweet(req: Request, res: Response): Promise<void> {\n    try {\n      const { text } = req.body as { text?: unknown };\n      // Ensure we have a string; if not, coerce to string or reject\n      if (typeof text !== 'string' || text.trim() === '') {\n        res.status(400).json({ error: 'Invalid tweet text' });\n        return;\n      }\n      const xService = Container.get(XService);\n      const result = await xService.postTweet(text);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to post Tweet to X' });\n    }\n  }\n\n  // Publicar Video en TikTok\n  static async publishTikTokVideo(req: Request, res: Response): Promise<void> {\n    try {\n      const { videoUrl, title } = (req as any).body || {};\n      const tiktokService = Container.get(TikTokService);\n      const result = await tiktokService.publishVideo(videoUrl, title);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to publish to TikTok' });\n    }\n  }\n\n  // Publicar Post en LinkedIn\n  static async publishLinkedInPost(req: Request, res: Response): Promise<void> {\n    try {\n      const { text } = (req as any).body || {};\n      const linkedinService = Container.get(LinkedInService) as any;\n      const result = await linkedinService.sharePost(text);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to publish to LinkedIn' });\n    }\n  }\n}\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\threat-intelligence.routes.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\threat-intelligence.routes.ts"],"sourcesContent":["import { Router } from 'express';\nimport { threatIntelligenceMiddleware } from '../middleware/threat-intelligence.middleware';\nimport { logger } from '../utils/logger';\n\nconst router = Router();\n\n/**\n * Threat Intelligence Routes\n */\n\n// Get threat intelligence statistics\nrouter.get('/stats', threatIntelligenceMiddleware.getStats as any);\n\n// Get recent threat alerts\nrouter.get('/alerts', threatIntelligenceMiddleware.getRecentAlerts as any);\n\n// Add custom threat indicator\nrouter.post('/indicators', threatIntelligenceMiddleware.addCustomIndicator as any);\n\n// Get threat feeds\nrouter.get('/feeds', threatIntelligenceMiddleware.getFeeds as any);\n\n// Toggle threat feed\nrouter.post('/feeds/toggle', threatIntelligenceMiddleware.toggleFeed as any);\n\n// Check IP address\nrouter.post('/check/ip', async (req: any, res: any) => {\n  try {\n    const { ip } = req.body;\n\n    if (!ip) {\n      return res.status(400).json({\n        success: false,\n        error: 'IP address is required',\n      });\n    }\n\n    // Create mock request for threat checking\n    const mockReq = {\n      ip,\n      connection: { remoteAddress: ip },\n      socket: { remoteAddress: ip },\n    } as any;\n\n    // Apply IP threat check\n    await new Promise<void>(resolve => {\n      threatIntelligenceMiddleware.checkIPThreat(mockReq, res, () => resolve());\n    });\n\n    const threatCheck = (mockReq as any).threatCheck;\n\n    res.json({\n      success: true,\n      data: {\n        ip,\n        threat: threatCheck?.ipThreat || null,\n        riskScore: threatCheck?.riskScore || 0,\n        action: threatCheck?.action || 'allow',\n      },\n    });\n  } catch (error) {\n    logger.error('Error checking IP threat:', error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to check IP threat',\n    });\n  }\n});\n\n// Check domain\nrouter.post('/check/domain', async (req: any, res: any) => {\n  try {\n    const { domain } = req.body;\n\n    if (!domain) {\n      return res.status(400).json({\n        success: false,\n        error: 'Domain is required',\n      });\n    }\n\n    // Create mock request for threat checking\n    const mockReq = {\n      body: { domain },\n      get: (header: string) => (header === 'Host' ? domain : null),\n      hostname: domain,\n    } as any;\n\n    // Apply domain threat check\n    await new Promise<void>(resolve => {\n      threatIntelligenceMiddleware.checkDomainThreat(mockReq, res, () => resolve());\n    });\n\n    const threatCheck = (mockReq as any).threatCheck;\n\n    res.json({\n      success: true,\n      data: {\n        domain,\n        threat: threatCheck?.domainThreat || null,\n        riskScore: threatCheck?.riskScore || 0,\n        action: threatCheck?.action || 'allow',\n      },\n    });\n  } catch (error) {\n    logger.error('Error checking domain threat:', error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to check domain threat',\n    });\n  }\n});\n\n// Check URL\nrouter.post('/check/url', async (req: any, res: any) => {\n  try {\n    const { url } = req.body;\n\n    if (!url) {\n      return res.status(400).json({\n        success: false,\n        error: 'URL is required',\n      });\n    }\n\n    // Create mock request for threat checking\n    const mockReq = {\n      body: { url },\n      get: (header: string) => (header === 'Referer' ? url : null),\n    } as any;\n\n    // Apply URL threat check\n    await new Promise<void>(resolve => {\n      threatIntelligenceMiddleware.checkURLThreat(mockReq, res, () => resolve());\n    });\n\n    const threatCheck = (mockReq as any).threatCheck;\n\n    res.json({\n      success: true,\n      data: {\n        url,\n        threat: threatCheck?.urlThreat || null,\n        riskScore: threatCheck?.riskScore || 0,\n        action: threatCheck?.action || 'allow',\n      },\n    });\n  } catch (error) {\n    logger.error('Error checking URL threat:', error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to check URL threat',\n    });\n  }\n});\n\n// Check file hash\nrouter.post('/check/hash', async (req: any, res: any) => {\n  try {\n    const { hash } = req.body;\n\n    if (!hash) {\n      return res.status(400).json({\n        success: false,\n        error: 'Hash is required',\n      });\n    }\n\n    // Create mock request for threat checking\n    const mockReq = {\n      body: { hash },\n    } as any;\n\n    // Apply hash threat check\n    await new Promise<void>(resolve => {\n      threatIntelligenceMiddleware.checkHashThreat(mockReq, res, () => resolve());\n    });\n\n    const threatCheck = (mockReq as any).threatCheck;\n\n    res.json({\n      success: true,\n      data: {\n        hash,\n        threat: threatCheck?.urlThreat || null, // Reuse urlThreat for hash\n        riskScore: threatCheck?.riskScore || 0,\n        action: threatCheck?.action || 'allow',\n      },\n    });\n  } catch (error) {\n    logger.error('Error checking hash threat:', error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to check hash threat',\n    });\n  }\n});\n\n// Comprehensive threat check\nrouter.post('/check/comprehensive', async (req: any, res: any) => {\n  try {\n    const { ip, domain, url, hash } = req.body;\n\n    if (!ip && !domain && !url && !hash) {\n      return res.status(400).json({\n        success: false,\n        error: 'At least one of ip, domain, url, or hash is required',\n      });\n    }\n\n    // Create mock request for threat checking\n    const mockReq = {\n      ip,\n      body: { domain, url, hash },\n      get: (header: string) => {\n        switch (header) {\n          case 'Host':\n            return domain || null;\n          case 'Referer':\n            return url || null;\n          default:\n            return null;\n        }\n      },\n      hostname: domain,\n      connection: { remoteAddress: ip },\n      socket: { remoteAddress: ip },\n    } as any;\n\n    // Apply comprehensive threat check\n    await new Promise<void>(resolve => {\n      threatIntelligenceMiddleware.comprehensiveThreatCheck(mockReq, res, () => resolve());\n    });\n\n    const threatCheck = (mockReq as any).threatCheck;\n\n    res.json({\n      success: true,\n      data: {\n        checked: { ip, domain, url, hash },\n        threats: {\n          ip: threatCheck?.ipThreat || null,\n          domain: threatCheck?.domainThreat || null,\n          url: threatCheck?.urlThreat || null,\n          hash: threatCheck?.urlThreat || null, // Reuse urlThreat for hash\n        },\n        riskScore: threatCheck?.riskScore || 0,\n        action: threatCheck?.action || 'allow',\n      },\n    });\n  } catch (error) {\n    logger.error('Error in comprehensive threat check:', error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to perform comprehensive threat check',\n    });\n  }\n});\n\n// Get threat intelligence health\nrouter.get('/health', (req: any, res: any) => {\n  try {\n    const health = {\n      status: 'healthy',\n      service: 'threat-intelligence',\n      timestamp: new Date().toISOString(),\n    };\n\n    res.json({\n      success: true,\n      data: health,\n    });\n  } catch (error) {\n    logger.error('Error getting threat intelligence health:', error);\n    res.status(500).json({\n      success: false,\n      error: 'Failed to get threat intelligence health',\n    });\n  }\n});\n\nexport default router;\n"],"version":3}
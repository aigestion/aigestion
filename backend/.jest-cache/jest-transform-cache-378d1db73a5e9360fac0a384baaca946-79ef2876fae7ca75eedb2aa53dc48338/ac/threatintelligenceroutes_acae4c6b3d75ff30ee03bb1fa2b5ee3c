86183e6b27f6ed5e64fa30210c9221fb
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const threat_intelligence_middleware_1 = require("../middleware/threat-intelligence.middleware");
const logger_1 = require("../utils/logger");
const router = (0, express_1.Router)();
/**
 * Threat Intelligence Routes
 */
// Get threat intelligence statistics
router.get('/stats', threat_intelligence_middleware_1.threatIntelligenceMiddleware.getStats);
// Get recent threat alerts
router.get('/alerts', threat_intelligence_middleware_1.threatIntelligenceMiddleware.getRecentAlerts);
// Add custom threat indicator
router.post('/indicators', threat_intelligence_middleware_1.threatIntelligenceMiddleware.addCustomIndicator);
// Get threat feeds
router.get('/feeds', threat_intelligence_middleware_1.threatIntelligenceMiddleware.getFeeds);
// Toggle threat feed
router.post('/feeds/toggle', threat_intelligence_middleware_1.threatIntelligenceMiddleware.toggleFeed);
// Check IP address
router.post('/check/ip', async (req, res) => {
    try {
        const { ip } = req.body;
        if (!ip) {
            return res.status(400).json({
                success: false,
                error: 'IP address is required',
            });
        }
        // Create mock request for threat checking
        const mockReq = {
            ip,
            connection: { remoteAddress: ip },
            socket: { remoteAddress: ip },
        };
        // Apply IP threat check
        await new Promise(resolve => {
            threat_intelligence_middleware_1.threatIntelligenceMiddleware.checkIPThreat(mockReq, res, () => resolve());
        });
        const threatCheck = mockReq.threatCheck;
        res.json({
            success: true,
            data: {
                ip,
                threat: threatCheck?.ipThreat || null,
                riskScore: threatCheck?.riskScore || 0,
                action: threatCheck?.action || 'allow',
            },
        });
    }
    catch (error) {
        logger_1.logger.error('Error checking IP threat:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to check IP threat',
        });
    }
});
// Check domain
router.post('/check/domain', async (req, res) => {
    try {
        const { domain } = req.body;
        if (!domain) {
            return res.status(400).json({
                success: false,
                error: 'Domain is required',
            });
        }
        // Create mock request for threat checking
        const mockReq = {
            body: { domain },
            get: (header) => (header === 'Host' ? domain : null),
            hostname: domain,
        };
        // Apply domain threat check
        await new Promise(resolve => {
            threat_intelligence_middleware_1.threatIntelligenceMiddleware.checkDomainThreat(mockReq, res, () => resolve());
        });
        const threatCheck = mockReq.threatCheck;
        res.json({
            success: true,
            data: {
                domain,
                threat: threatCheck?.domainThreat || null,
                riskScore: threatCheck?.riskScore || 0,
                action: threatCheck?.action || 'allow',
            },
        });
    }
    catch (error) {
        logger_1.logger.error('Error checking domain threat:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to check domain threat',
        });
    }
});
// Check URL
router.post('/check/url', async (req, res) => {
    try {
        const { url } = req.body;
        if (!url) {
            return res.status(400).json({
                success: false,
                error: 'URL is required',
            });
        }
        // Create mock request for threat checking
        const mockReq = {
            body: { url },
            get: (header) => (header === 'Referer' ? url : null),
        };
        // Apply URL threat check
        await new Promise(resolve => {
            threat_intelligence_middleware_1.threatIntelligenceMiddleware.checkURLThreat(mockReq, res, () => resolve());
        });
        const threatCheck = mockReq.threatCheck;
        res.json({
            success: true,
            data: {
                url,
                threat: threatCheck?.urlThreat || null,
                riskScore: threatCheck?.riskScore || 0,
                action: threatCheck?.action || 'allow',
            },
        });
    }
    catch (error) {
        logger_1.logger.error('Error checking URL threat:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to check URL threat',
        });
    }
});
// Check file hash
router.post('/check/hash', async (req, res) => {
    try {
        const { hash } = req.body;
        if (!hash) {
            return res.status(400).json({
                success: false,
                error: 'Hash is required',
            });
        }
        // Create mock request for threat checking
        const mockReq = {
            body: { hash },
        };
        // Apply hash threat check
        await new Promise(resolve => {
            threat_intelligence_middleware_1.threatIntelligenceMiddleware.checkHashThreat(mockReq, res, () => resolve());
        });
        const threatCheck = mockReq.threatCheck;
        res.json({
            success: true,
            data: {
                hash,
                threat: threatCheck?.urlThreat || null, // Reuse urlThreat for hash
                riskScore: threatCheck?.riskScore || 0,
                action: threatCheck?.action || 'allow',
            },
        });
    }
    catch (error) {
        logger_1.logger.error('Error checking hash threat:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to check hash threat',
        });
    }
});
// Comprehensive threat check
router.post('/check/comprehensive', async (req, res) => {
    try {
        const { ip, domain, url, hash } = req.body;
        if (!ip && !domain && !url && !hash) {
            return res.status(400).json({
                success: false,
                error: 'At least one of ip, domain, url, or hash is required',
            });
        }
        // Create mock request for threat checking
        const mockReq = {
            ip,
            body: { domain, url, hash },
            get: (header) => {
                switch (header) {
                    case 'Host':
                        return domain || null;
                    case 'Referer':
                        return url || null;
                    default:
                        return null;
                }
            },
            hostname: domain,
            connection: { remoteAddress: ip },
            socket: { remoteAddress: ip },
        };
        // Apply comprehensive threat check
        await new Promise(resolve => {
            threat_intelligence_middleware_1.threatIntelligenceMiddleware.comprehensiveThreatCheck(mockReq, res, () => resolve());
        });
        const threatCheck = mockReq.threatCheck;
        res.json({
            success: true,
            data: {
                checked: { ip, domain, url, hash },
                threats: {
                    ip: threatCheck?.ipThreat || null,
                    domain: threatCheck?.domainThreat || null,
                    url: threatCheck?.urlThreat || null,
                    hash: threatCheck?.urlThreat || null, // Reuse urlThreat for hash
                },
                riskScore: threatCheck?.riskScore || 0,
                action: threatCheck?.action || 'allow',
            },
        });
    }
    catch (error) {
        logger_1.logger.error('Error in comprehensive threat check:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to perform comprehensive threat check',
        });
    }
});
// Get threat intelligence health
router.get('/health', (req, res) => {
    try {
        const health = {
            status: 'healthy',
            service: 'threat-intelligence',
            timestamp: new Date().toISOString(),
        };
        res.json({
            success: true,
            data: health,
        });
    }
    catch (error) {
        logger_1.logger.error('Error getting threat intelligence health:', error);
        res.status(500).json({
            success: false,
            error: 'Failed to get threat intelligence health',
        });
    }
});
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXHRocmVhdC1pbnRlbGxpZ2VuY2Uucm91dGVzLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEscUNBQWlDO0FBQ2pDLGlHQUE0RjtBQUM1Riw0Q0FBeUM7QUFFekMsTUFBTSxNQUFNLEdBQUcsSUFBQSxnQkFBTSxHQUFFLENBQUM7QUFFeEI7O0dBRUc7QUFFSCxxQ0FBcUM7QUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsNkRBQTRCLENBQUMsUUFBZSxDQUFDLENBQUM7QUFFbkUsMkJBQTJCO0FBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLDZEQUE0QixDQUFDLGVBQXNCLENBQUMsQ0FBQztBQUUzRSw4QkFBOEI7QUFDOUIsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsNkRBQTRCLENBQUMsa0JBQXlCLENBQUMsQ0FBQztBQUVuRixtQkFBbUI7QUFDbkIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsNkRBQTRCLENBQUMsUUFBZSxDQUFDLENBQUM7QUFFbkUscUJBQXFCO0FBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLDZEQUE0QixDQUFDLFVBQWlCLENBQUMsQ0FBQztBQUU3RSxtQkFBbUI7QUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsRUFBRTtJQUNwRCxJQUFJLENBQUM7UUFDSCxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztRQUV4QixJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDUixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUMxQixPQUFPLEVBQUUsS0FBSztnQkFDZCxLQUFLLEVBQUUsd0JBQXdCO2FBQ2hDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCwwQ0FB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XFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXHRocmVhdC1pbnRlbGxpZ2VuY2Uucm91dGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgdGhyZWF0SW50ZWxsaWdlbmNlTWlkZGxld2FyZSB9IGZyb20gJy4uL21pZGRsZXdhcmUvdGhyZWF0LWludGVsbGlnZW5jZS5taWRkbGV3YXJlJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5cbmNvbnN0IHJvdXRlciA9IFJvdXRlcigpO1xuXG4vKipcbiAqIFRocmVhdCBJbnRlbGxpZ2VuY2UgUm91dGVzXG4gKi9cblxuLy8gR2V0IHRocmVhdCBpbnRlbGxpZ2VuY2Ugc3RhdGlzdGljc1xucm91dGVyLmdldCgnL3N0YXRzJywgdGhyZWF0SW50ZWxsaWdlbmNlTWlkZGxld2FyZS5nZXRTdGF0cyBhcyBhbnkpO1xuXG4vLyBHZXQgcmVjZW50IHRocmVhdCBhbGVydHNcbnJvdXRlci5nZXQoJy9hbGVydHMnLCB0aHJlYXRJbnRlbGxpZ2VuY2VNaWRkbGV3YXJlLmdldFJlY2VudEFsZXJ0cyBhcyBhbnkpO1xuXG4vLyBBZGQgY3VzdG9tIHRocmVhdCBpbmRpY2F0b3JcbnJvdXRlci5wb3N0KCcvaW5kaWNhdG9ycycsIHRocmVhdEludGVsbGlnZW5jZU1pZGRsZXdhcmUuYWRkQ3VzdG9tSW5kaWNhdG9yIGFzIGFueSk7XG5cbi8vIEdldCB0aHJlYXQgZmVlZHNcbnJvdXRlci5nZXQoJy9mZWVkcycsIHRocmVhdEludGVsbGlnZW5jZU1pZGRsZXdhcmUuZ2V0RmVlZHMgYXMgYW55KTtcblxuLy8gVG9nZ2xlIHRocmVhdCBmZWVkXG5yb3V0ZXIucG9zdCgnL2ZlZWRzL3RvZ2dsZScsIHRocmVhdEludGVsbGlnZW5jZU1pZGRsZXdhcmUudG9nZ2xlRmVlZCBhcyBhbnkpO1xuXG4vLyBDaGVjayBJUCBhZGRyZXNzXG5yb3V0ZXIucG9zdCgnL2NoZWNrL2lwJywgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgaXAgfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFpcCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnSVAgYWRkcmVzcyBpcyByZXF1aXJlZCcsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgbW9jayByZXF1ZXN0IGZvciB0aHJlYXQgY2hlY2tpbmdcbiAgICBjb25zdCBtb2NrUmVxID0ge1xuICAgICAgaXAsXG4gICAgICBjb25uZWN0aW9uOiB7IHJlbW90ZUFkZHJlc3M6IGlwIH0sXG4gICAgICBzb2NrZXQ6IHsgcmVtb3RlQWRkcmVzczogaXAgfSxcbiAgICB9IGFzIGFueTtcblxuICAgIC8vIEFwcGx5IElQIHRocmVhdCBjaGVja1xuICAgIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KHJlc29sdmUgPT4ge1xuICAgICAgdGhyZWF0SW50ZWxsaWdlbmNlTWlkZGxld2FyZS5jaGVja0lQVGhyZWF0KG1vY2tSZXEsIHJlcywgKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHRocmVhdENoZWNrID0gKG1vY2tSZXEgYXMgYW55KS50aHJlYXRDaGVjaztcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGlwLFxuICAgICAgICB0aHJlYXQ6IHRocmVhdENoZWNrPy5pcFRocmVhdCB8fCBudWxsLFxuICAgICAgICByaXNrU2NvcmU6IHRocmVhdENoZWNrPy5yaXNrU2NvcmUgfHwgMCxcbiAgICAgICAgYWN0aW9uOiB0aHJlYXRDaGVjaz8uYWN0aW9uIHx8ICdhbGxvdycsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgY2hlY2tpbmcgSVAgdGhyZWF0OicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGNoZWNrIElQIHRocmVhdCcsXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBDaGVjayBkb21haW5cbnJvdXRlci5wb3N0KCcvY2hlY2svZG9tYWluJywgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgZG9tYWluIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghZG9tYWluKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdEb21haW4gaXMgcmVxdWlyZWQnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIG1vY2sgcmVxdWVzdCBmb3IgdGhyZWF0IGNoZWNraW5nXG4gICAgY29uc3QgbW9ja1JlcSA9IHtcbiAgICAgIGJvZHk6IHsgZG9tYWluIH0sXG4gICAgICBnZXQ6IChoZWFkZXI6IHN0cmluZykgPT4gKGhlYWRlciA9PT0gJ0hvc3QnID8gZG9tYWluIDogbnVsbCksXG4gICAgICBob3N0bmFtZTogZG9tYWluLFxuICAgIH0gYXMgYW55O1xuXG4gICAgLy8gQXBwbHkgZG9tYWluIHRocmVhdCBjaGVja1xuICAgIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KHJlc29sdmUgPT4ge1xuICAgICAgdGhyZWF0SW50ZWxsaWdlbmNlTWlkZGxld2FyZS5jaGVja0RvbWFpblRocmVhdChtb2NrUmVxLCByZXMsICgpID0+IHJlc29sdmUoKSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCB0aHJlYXRDaGVjayA9IChtb2NrUmVxIGFzIGFueSkudGhyZWF0Q2hlY2s7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBkb21haW4sXG4gICAgICAgIHRocmVhdDogdGhyZWF0Q2hlY2s/LmRvbWFpblRocmVhdCB8fCBudWxsLFxuICAgICAgICByaXNrU2NvcmU6IHRocmVhdENoZWNrPy5yaXNrU2NvcmUgfHwgMCxcbiAgICAgICAgYWN0aW9uOiB0aHJlYXRDaGVjaz8uYWN0aW9uIHx8ICdhbGxvdycsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgY2hlY2tpbmcgZG9tYWluIHRocmVhdDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjaGVjayBkb21haW4gdGhyZWF0JyxcbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIENoZWNrIFVSTFxucm91dGVyLnBvc3QoJy9jaGVjay91cmwnLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyB1cmwgfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCF1cmwpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ1VSTCBpcyByZXF1aXJlZCcsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgbW9jayByZXF1ZXN0IGZvciB0aHJlYXQgY2hlY2tpbmdcbiAgICBjb25zdCBtb2NrUmVxID0ge1xuICAgICAgYm9keTogeyB1cmwgfSxcbiAgICAgIGdldDogKGhlYWRlcjogc3RyaW5nKSA9PiAoaGVhZGVyID09PSAnUmVmZXJlcicgPyB1cmwgOiBudWxsKSxcbiAgICB9IGFzIGFueTtcblxuICAgIC8vIEFwcGx5IFVSTCB0aHJlYXQgY2hlY2tcbiAgICBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcbiAgICAgIHRocmVhdEludGVsbGlnZW5jZU1pZGRsZXdhcmUuY2hlY2tVUkxUaHJlYXQobW9ja1JlcSwgcmVzLCAoKSA9PiByZXNvbHZlKCkpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgdGhyZWF0Q2hlY2sgPSAobW9ja1JlcSBhcyBhbnkpLnRocmVhdENoZWNrO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXJsLFxuICAgICAgICB0aHJlYXQ6IHRocmVhdENoZWNrPy51cmxUaHJlYXQgfHwgbnVsbCxcbiAgICAgICAgcmlza1Njb3JlOiB0aHJlYXRDaGVjaz8ucmlza1Njb3JlIHx8IDAsXG4gICAgICAgIGFjdGlvbjogdGhyZWF0Q2hlY2s/LmFjdGlvbiB8fCAnYWxsb3cnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIFVSTCB0aHJlYXQ6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gY2hlY2sgVVJMIHRocmVhdCcsXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBDaGVjayBmaWxlIGhhc2hcbnJvdXRlci5wb3N0KCcvY2hlY2svaGFzaCcsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGhhc2ggfSA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFoYXNoKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdIYXNoIGlzIHJlcXVpcmVkJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBtb2NrIHJlcXVlc3QgZm9yIHRocmVhdCBjaGVja2luZ1xuICAgIGNvbnN0IG1vY2tSZXEgPSB7XG4gICAgICBib2R5OiB7IGhhc2ggfSxcbiAgICB9IGFzIGFueTtcblxuICAgIC8vIEFwcGx5IGhhc2ggdGhyZWF0IGNoZWNrXG4gICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4ocmVzb2x2ZSA9PiB7XG4gICAgICB0aHJlYXRJbnRlbGxpZ2VuY2VNaWRkbGV3YXJlLmNoZWNrSGFzaFRocmVhdChtb2NrUmVxLCByZXMsICgpID0+IHJlc29sdmUoKSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCB0aHJlYXRDaGVjayA9IChtb2NrUmVxIGFzIGFueSkudGhyZWF0Q2hlY2s7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBoYXNoLFxuICAgICAgICB0aHJlYXQ6IHRocmVhdENoZWNrPy51cmxUaHJlYXQgfHwgbnVsbCwgLy8gUmV1c2UgdXJsVGhyZWF0IGZvciBoYXNoXG4gICAgICAgIHJpc2tTY29yZTogdGhyZWF0Q2hlY2s/LnJpc2tTY29yZSB8fCAwLFxuICAgICAgICBhY3Rpb246IHRocmVhdENoZWNrPy5hY3Rpb24gfHwgJ2FsbG93JyxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjaGVja2luZyBoYXNoIHRocmVhdDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBjaGVjayBoYXNoIHRocmVhdCcsXG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBDb21wcmVoZW5zaXZlIHRocmVhdCBjaGVja1xucm91dGVyLnBvc3QoJy9jaGVjay9jb21wcmVoZW5zaXZlJywgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgaXAsIGRvbWFpbiwgdXJsLCBoYXNoIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghaXAgJiYgIWRvbWFpbiAmJiAhdXJsICYmICFoYXNoKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdBdCBsZWFzdCBvbmUgb2YgaXAsIGRvbWFpbiwgdXJsLCBvciBoYXNoIGlzIHJlcXVpcmVkJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBtb2NrIHJlcXVlc3QgZm9yIHRocmVhdCBjaGVja2luZ1xuICAgIGNvbnN0IG1vY2tSZXEgPSB7XG4gICAgICBpcCxcbiAgICAgIGJvZHk6IHsgZG9tYWluLCB1cmwsIGhhc2ggfSxcbiAgICAgIGdldDogKGhlYWRlcjogc3RyaW5nKSA9PiB7XG4gICAgICAgIHN3aXRjaCAoaGVhZGVyKSB7XG4gICAgICAgICAgY2FzZSAnSG9zdCc6XG4gICAgICAgICAgICByZXR1cm4gZG9tYWluIHx8IG51bGw7XG4gICAgICAgICAgY2FzZSAnUmVmZXJlcic6XG4gICAgICAgICAgICByZXR1cm4gdXJsIHx8IG51bGw7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaG9zdG5hbWU6IGRvbWFpbixcbiAgICAgIGNvbm5lY3Rpb246IHsgcmVtb3RlQWRkcmVzczogaXAgfSxcbiAgICAgIHNvY2tldDogeyByZW1vdGVBZGRyZXNzOiBpcCB9LFxuICAgIH0gYXMgYW55O1xuXG4gICAgLy8gQXBwbHkgY29tcHJlaGVuc2l2ZSB0aHJlYXQgY2hlY2tcbiAgICBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPihyZXNvbHZlID0+IHtcbiAgICAgIHRocmVhdEludGVsbGlnZW5jZU1pZGRsZXdhcmUuY29tcHJlaGVuc2l2ZVRocmVhdENoZWNrKG1vY2tSZXEsIHJlcywgKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHRocmVhdENoZWNrID0gKG1vY2tSZXEgYXMgYW55KS50aHJlYXRDaGVjaztcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGNoZWNrZWQ6IHsgaXAsIGRvbWFpbiwgdXJsLCBoYXNoIH0sXG4gICAgICAgIHRocmVhdHM6IHtcbiAgICAgICAgICBpcDogdGhyZWF0Q2hlY2s/LmlwVGhyZWF0IHx8IG51bGwsXG4gICAgICAgICAgZG9tYWluOiB0aHJlYXRDaGVjaz8uZG9tYWluVGhyZWF0IHx8IG51bGwsXG4gICAgICAgICAgdXJsOiB0aHJlYXRDaGVjaz8udXJsVGhyZWF0IHx8IG51bGwsXG4gICAgICAgICAgaGFzaDogdGhyZWF0Q2hlY2s/LnVybFRocmVhdCB8fCBudWxsLCAvLyBSZXVzZSB1cmxUaHJlYXQgZm9yIGhhc2hcbiAgICAgICAgfSxcbiAgICAgICAgcmlza1Njb3JlOiB0aHJlYXRDaGVjaz8ucmlza1Njb3JlIHx8IDAsXG4gICAgICAgIGFjdGlvbjogdGhyZWF0Q2hlY2s/LmFjdGlvbiB8fCAnYWxsb3cnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGluIGNvbXByZWhlbnNpdmUgdGhyZWF0IGNoZWNrOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHBlcmZvcm0gY29tcHJlaGVuc2l2ZSB0aHJlYXQgY2hlY2snLFxuICAgIH0pO1xuICB9XG59KTtcblxuLy8gR2V0IHRocmVhdCBpbnRlbGxpZ2VuY2UgaGVhbHRoXG5yb3V0ZXIuZ2V0KCcvaGVhbHRoJywgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGhlYWx0aCA9IHtcbiAgICAgIHN0YXR1czogJ2hlYWx0aHknLFxuICAgICAgc2VydmljZTogJ3RocmVhdC1pbnRlbGxpZ2VuY2UnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBoZWFsdGgsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHRocmVhdCBpbnRlbGxpZ2VuY2UgaGVhbHRoOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnRmFpbGVkIHRvIGdldCB0aHJlYXQgaW50ZWxsaWdlbmNlIGhlYWx0aCcsXG4gICAgfSk7XG4gIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7XG4iXSwidmVyc2lvbiI6M30=
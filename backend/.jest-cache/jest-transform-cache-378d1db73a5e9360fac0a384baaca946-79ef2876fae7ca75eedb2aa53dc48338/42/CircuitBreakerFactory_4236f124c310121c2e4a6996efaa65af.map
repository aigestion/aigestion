{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\resilience\\CircuitBreakerFactory.ts","mappings":";;;AAAA,0CAA2C;AAC3C,+CAA4C;AAW5C,MAAa,qBAAqB;IACxB,MAAM,CAAU,cAAc,GAAG;QACvC,OAAO,EAAE,KAAK,EAAE,aAAa;QAC7B,wBAAwB,EAAE,EAAE;QAC5B,YAAY,EAAE,KAAK,EAAE,aAAa;KACnC,CAAC;IAEF;;;;OAIG;IACI,MAAM,CAAC,MAAM,CAClB,MAAoC,EACpC,SAA+B,EAAE;QAEjC,MAAM,OAAO,GAAG;YACd,GAAG,IAAI,CAAC,cAAc;YACtB,GAAG,MAAM;SACV,CAAC;QAEF,MAAM,OAAO,GAAG,IAAI,cAAc,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;QAEpD,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,GAAG,EAAE;YACtB,eAAM,CAAC,IAAI,CAAC,0BAA0B,OAAO,CAAC,IAAI,IAAI,WAAW,EAAE,CAAC,CAAC;QACvE,CAAC,CAAC,CAAC;QAEH,OAAO,CAAC,EAAE,CAAC,UAAU,EAAE,GAAG,EAAE;YAC1B,eAAM,CAAC,IAAI,CAAC,+BAA+B,OAAO,CAAC,IAAI,IAAI,WAAW,EAAE,CAAC,CAAC;QAC5E,CAAC,CAAC,CAAC;QAEH,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE;YACvB,eAAM,CAAC,IAAI,CAAC,2BAA2B,OAAO,CAAC,IAAI,IAAI,WAAW,EAAE,CAAC,CAAC;QACxE,CAAC,CAAC,CAAC;QAEH,OAAO,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,OAAY,EAAE,EAAE;YACtC,eAAM,CAAC,IAAI,CAAC,8BAA8B,OAAO,CAAC,IAAI,IAAI,WAAW,EAAE,CAAC,CAAC;QAC3E,CAAC,CAAC,CAAC;QAEH,wEAAwE;QACxE,2DAA2D;QAE3D,OAAO,OAAO,CAAC;IACjB,CAAC;;AA3CH,sDA4CC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\resilience\\CircuitBreakerFactory.ts"],"sourcesContent":["import CircuitBreaker = require('opossum');\nimport { logger } from '../../utils/logger';\n\nexport interface CircuitBreakerConfig {\n  timeout?: number;\n  errorThresholdPercentage?: number;\n  resetTimeout?: number;\n  name?: string;\n  rollingCountTimeout?: number;\n  volumeThreshold?: number;\n}\n\nexport class CircuitBreakerFactory {\n  private static readonly DEFAULT_CONFIG = {\n    timeout: 20000, // 20 seconds\n    errorThresholdPercentage: 50,\n    resetTimeout: 30000, // 30 seconds\n  };\n\n  /**\n   * Creates a new Circuit Breaker for a given function.\n   * @param action The function to wrap\n   * @param config Configuration overrides\n   */\n  public static create<TI extends unknown[], TR>(\n    action: (...args: TI) => Promise<TR>,\n    config: CircuitBreakerConfig = {},\n  ): any {\n    const options = {\n      ...this.DEFAULT_CONFIG,\n      ...config,\n    };\n\n    const breaker = new CircuitBreaker(action, options);\n\n    breaker.on('open', () => {\n      logger.warn(`[CircuitBreaker] OPEN: ${options.name || 'Anonymous'}`);\n    });\n\n    breaker.on('halfOpen', () => {\n      logger.info(`[CircuitBreaker] HALF-OPEN: ${options.name || 'Anonymous'}`);\n    });\n\n    breaker.on('close', () => {\n      logger.info(`[CircuitBreaker] CLOSE: ${options.name || 'Anonymous'}`);\n    });\n\n    breaker.on('fallback', (_result: any) => {\n      logger.warn(`[CircuitBreaker] FALLBACK: ${options.name || 'Anonymous'}`);\n    });\n\n    // Don't log every failure to avoid noise, let the caller handle errors.\n    // However, if the breaker is open, future calls fail fast.\n\n    return breaker;\n  }\n}\n"],"version":3}
69a523efff38561fae4f5a3b006a9780
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const node_fetch_1 = __importDefault(require("node-fetch"));
const env_schema_1 = require("../config/env.schema");
const mcpRouter = (0, express_1.Router)();
/**
 * @openapi
 * /mcp/health:
 *   get:
 *     summary: Check MCP server health
 *     tags: [MCP]
 *     responses:
 *       200:
 *         description: MCP server is reachable
 *       502:
 *         description: Unable to reach MCP server
 */
mcpRouter.get('/health', async (_req, res) => {
    const baseUrl = env_schema_1.env.MCP_SERVER_URL;
    if (!baseUrl) {
        return res.status(500).json({ error: 'MCP_SERVER_URL not configured' });
    }
    try {
        const response = await (0, node_fetch_1.default)(`${baseUrl}/health`);
        if (!response.ok) {
            return res
                .status(502)
                .json({ error: 'MCP server responded with error', status: response.status });
        }
        const data = await response.json();
        return res.status(200).json({ status: 'ok', mcp: data });
    }
    catch (err) {
        return res.status(502).json({
            error: 'Failed to reach MCP server',
            details: err instanceof Error ? err.message : String(err),
        });
    }
});
exports.default = mcpRouter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXG1jcC5yb3V0ZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxxQ0FBaUM7QUFFakMsNERBQStCO0FBRS9CLHFEQUEyQztBQUUzQyxNQUFNLFNBQVMsR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUUzQjs7Ozs7Ozs7Ozs7R0FXRztBQUNILFNBQVMsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFhLEVBQUUsR0FBYSxFQUFFLEVBQUU7SUFDOUQsTUFBTSxPQUFPLEdBQUcsZ0JBQUcsQ0FBQyxjQUFjLENBQUM7SUFDbkMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2IsT0FBUSxHQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSwrQkFBK0IsRUFBRSxDQUFDLENBQUM7SUFDbkYsQ0FBQztJQUNELElBQUksQ0FBQztRQUNILE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxvQkFBSyxFQUFDLEdBQUcsT0FBTyxTQUFTLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2pCLE9BQVEsR0FBVztpQkFDaEIsTUFBTSxDQUFDLEdBQUcsQ0FBQztpQkFDWCxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ2pGLENBQUM7UUFDRCxNQUFNLElBQUksR0FBRyxNQUFNLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNuQyxPQUFRLEdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLE9BQVEsR0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDbkMsS0FBSyxFQUFFLDRCQUE0QjtZQUNuQyxPQUFPLEVBQUUsR0FBRyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQztTQUMxRCxDQUFDLENBQUM7SUFDTCxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCxrQkFBZSxTQUFTLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXG1jcC5yb3V0ZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgdHlwZSB7IFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgZmV0Y2ggZnJvbSAnbm9kZS1mZXRjaCc7XG5cbmltcG9ydCB7IGVudiB9IGZyb20gJy4uL2NvbmZpZy9lbnYuc2NoZW1hJztcblxuY29uc3QgbWNwUm91dGVyID0gUm91dGVyKCk7XG5cbi8qKlxuICogQG9wZW5hcGlcbiAqIC9tY3AvaGVhbHRoOlxuICogICBnZXQ6XG4gKiAgICAgc3VtbWFyeTogQ2hlY2sgTUNQIHNlcnZlciBoZWFsdGhcbiAqICAgICB0YWdzOiBbTUNQXVxuICogICAgIHJlc3BvbnNlczpcbiAqICAgICAgIDIwMDpcbiAqICAgICAgICAgZGVzY3JpcHRpb246IE1DUCBzZXJ2ZXIgaXMgcmVhY2hhYmxlXG4gKiAgICAgICA1MDI6XG4gKiAgICAgICAgIGRlc2NyaXB0aW9uOiBVbmFibGUgdG8gcmVhY2ggTUNQIHNlcnZlclxuICovXG5tY3BSb3V0ZXIuZ2V0KCcvaGVhbHRoJywgYXN5bmMgKF9yZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgY29uc3QgYmFzZVVybCA9IGVudi5NQ1BfU0VSVkVSX1VSTDtcbiAgaWYgKCFiYXNlVXJsKSB7XG4gICAgcmV0dXJuIChyZXMgYXMgYW55KS5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdNQ1BfU0VSVkVSX1VSTCBub3QgY29uZmlndXJlZCcgfSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2Jhc2VVcmx9L2hlYWx0aGApO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHJldHVybiAocmVzIGFzIGFueSlcbiAgICAgICAgLnN0YXR1cyg1MDIpXG4gICAgICAgIC5qc29uKHsgZXJyb3I6ICdNQ1Agc2VydmVyIHJlc3BvbmRlZCB3aXRoIGVycm9yJywgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMgfSk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgcmV0dXJuIChyZXMgYXMgYW55KS5zdGF0dXMoMjAwKS5qc29uKHsgc3RhdHVzOiAnb2snLCBtY3A6IGRhdGEgfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiAocmVzIGFzIGFueSkuc3RhdHVzKDUwMikuanNvbih7XG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZWFjaCBNQ1Agc2VydmVyJyxcbiAgICAgIGRldGFpbHM6IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiBTdHJpbmcoZXJyKSxcbiAgICB9KTtcbiAgfVxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IG1jcFJvdXRlcjtcbiJdLCJ2ZXJzaW9uIjozfQ==
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\task1-auth-ai-graphql.test.ts","mappings":"AAAA;;;;;;;;;GASG;AAEH,MAAM,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,MAAM,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC;AAEnF,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,6BAA6B,EAAE,GAAG,EAAE;IACpE,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;IACvB,EAAE,CAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;QAChE,MAAM,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;QACrC,MAAM,EAAE,GAAG,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;QAClC,MAAM,EAAE,iBAAiB,EAAE,GAAG,OAAO,CAAC,oBAAoB,CAAC,CAAC;QAC5D,MAAM,iBAAiB,EAAE,CAAC;QAE1B,wBAAwB;QACxB,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC;YAC5C,KAAK,EAAE,kBAAkB;YACzB,IAAI,EAAE,cAAc;YACpB,QAAQ,EAAE,gBAAgB;SAC3B,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG;;;;;;;;;;;KAWhB,CAAC;QAEF,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;aAChC,IAAI,CAAC,UAAU,CAAC;aAChB,GAAG,CAAC,cAAc,EAAE,kBAAkB,CAAC;aACvC,IAAI,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;QAE7B,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAClC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,CAAC;QAC7C,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,WAAW,EAAE,CAAC;QAC/C,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC9D,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IACvE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;QACzC,MAAM,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;QACrC,MAAM,EAAE,GAAG,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;QAElC,MAAM,KAAK,GAAG;;;;KAIb,CAAC;QAEF,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;aAChC,IAAI,CAAC,UAAU,CAAC;aAChB,GAAG,CAAC,cAAc,EAAE,kBAAkB,CAAC;aACvC,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;QAEnB,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAClC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,CAAC;QAC7C,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,4BAA4B,CAAC,CAAC;IACrE,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\task1-auth-ai-graphql.test.ts"],"sourcesContent":["/**\n * Task 1.3: Auth & AI GraphQL Integration Tests\n *\n * These tests require a fully booted Express app with InversifyJS-resolved controllers.\n * The app boot process triggers module-level container.get() calls for ALL controllers\n * (DanielaController, GodModeController, etc.), making it impossible to partially mock\n * the IoC container for targeted tests.\n *\n * To run these tests: RUN_INTEGRATION_TESTS=true npx jest --runInBand task1-auth-ai-graphql\n */\n\nconst SKIP = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;\n\n(SKIP ? describe.skip : describe)('Task 1.3: Auth & AI GraphQL', () => {\n  jest.setTimeout(60000);\n  it('should return token and user on successful login', async () => {\n    const request = require('supertest');\n    const { app } = require('../app');\n    const { connectToDatabase } = require('../config/database');\n    await connectToDatabase();\n\n    // Create user for login\n    await request(app).post('/api/v1/users').send({\n      email: 'test@example.com',\n      name: 'GraphQL User',\n      password: 'AIGestion2026!',\n    });\n\n    const mutation = `\n      mutation {\n        login(email: \"test@example.com\", password: \"AIGestion2026!\") {\n          token\n          user {\n            id\n            email\n            name\n          }\n        }\n      }\n    `;\n\n    const response = await request(app)\n      .post('/graphql')\n      .set('Content-Type', 'application/json')\n      .send({ query: mutation });\n\n    expect(response.status).toBe(200);\n    expect(response.body.errors).toBeUndefined();\n    expect(response.body.data.login).toBeDefined();\n    expect(response.body.data.login.token).toBe('mock_jwt_token');\n    expect(response.body.data.login.user.email).toBe('test@example.com');\n  });\n\n  it('should return AI response', async () => {\n    const request = require('supertest');\n    const { app } = require('../app');\n\n    const query = `\n      query {\n        chat(message: \"Hello Nexus\")\n      }\n    `;\n\n    const response = await request(app)\n      .post('/graphql')\n      .set('Content-Type', 'application/json')\n      .send({ query });\n\n    expect(response.status).toBe(200);\n    expect(response.body.errors).toBeUndefined();\n    expect(response.body.data.chat).toBe('This is a mock AI response');\n  });\n});\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\sheets.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\sheets.service.ts"],"sourcesContent":["import { google } from 'googleapis';\nimport { injectable, inject } from 'inversify';\nimport { DanielaAIService } from './daniela-ai.service';\n\n/**\n * Google Sheets Service\n * Integraci칩n con Google Sheets para an치lisis y reportes autom치ticos\n */\n@injectable()\nexport class SheetsService {\n  private sheets: any;\n  private auth: any;\n\n  constructor(@inject(DanielaAIService) private daniela: DanielaAIService) {}\n\n  async initialize() {\n    this.auth = new google.auth.GoogleAuth({\n      keyFile: process.env.GOOGLE_APPLICATION_CREDENTIALS,\n      scopes: [\n        'https://www.googleapis.com/auth/spreadsheets',\n        'https://www.googleapis.com/auth/drive.readonly',\n      ],\n    });\n    this.sheets = google.sheets({ version: 'v4', auth: this.auth });\n  }\n\n  async readData(spreadsheetId: string, range: string = 'Sheet1!A:Z') {\n    try {\n      const response = await this.sheets.spreadsheets.values.get({\n        spreadsheetId,\n        range,\n      });\n      return response.data.values || [];\n    } catch (error) {\n      console.error('Error reading sheet data:', error);\n      throw error;\n    }\n  }\n\n  async writeData(spreadsheetId: string, range: string, values: any[]) {\n    try {\n      const response = await this.sheets.spreadsheets.values.update({\n        spreadsheetId,\n        range,\n        valueInputOption: 'USER_ENTERED',\n        requestBody: { values },\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error writing sheet data:', error);\n      throw error;\n    }\n  }\n\n  async appendData(spreadsheetId: string, range: string, values: any[]) {\n    try {\n      const response = await this.sheets.spreadsheets.values.append({\n        spreadsheetId,\n        range,\n        valueInputOption: 'USER_ENTERED',\n        requestBody: { values },\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error appending sheet data:', error);\n      throw error;\n    }\n  }\n\n  async analyzeSheet(spreadsheetId: string, range: string = 'Sheet1!A:Z') {\n    try {\n      const data = await this.readData(spreadsheetId, range);\n\n      // Convertir a formato estructura\n      const headers = data[0];\n      const rows = data.slice(1);\n      const records = rows.map((row: any[]) =>\n        Object.fromEntries(headers.map((h, i) => [h, row[i]])),\n      );\n\n      // Usar Daniela AI para an치lisis\n      const analysis = {\n        totalRows: rows.length,\n        totalColumns: headers.length,\n        insights: await this.daniela.processMessage(\n          0,\n          JSON.stringify(records),\n          'sheet-analysis',\n          'system',\n          'user',\n        ),\n        summary: {\n          dataPoints: rows.length,\n          timestamp: new Date(),\n        },\n      };\n\n      return analysis;\n    } catch (error) {\n      console.error('Error analyzing sheet:', error);\n      throw error;\n    }\n  }\n\n  async createReport(spreadsheetId: string) {\n    try {\n      const analysis = await this.analyzeSheet(spreadsheetId);\n\n      const report = [\n        ['Generated Report'],\n        [''],\n        ['Timestamp', new Date().toISOString()],\n        ['Total Rows', analysis.totalRows],\n        ['Total Columns', analysis.totalColumns],\n        [''],\n        ['Analysis', analysis.insights],\n        [''],\n      ];\n\n      await this.appendData(spreadsheetId, 'Sheet1!A100:B110', report);\n\n      return {\n        status: 'success',\n        report: analysis,\n        timestamp: new Date(),\n      };\n    } catch (error) {\n      console.error('Error creating report:', error);\n      throw error;\n    }\n  }\n\n  async addChart(spreadsheetId: string, chartData: any) {\n    try {\n      const request = {\n        spreadsheetId,\n        resource: {\n          requests: [\n            {\n              addChart: {\n                chart: {\n                  spec: {\n                    title: chartData.title,\n                    basicChart: {\n                      chartType: chartData.type,\n                      series: chartData.series,\n                      axis: chartData.axis,\n                    },\n                  },\n                },\n              },\n            },\n          ],\n        },\n      };\n\n      return await this.sheets.spreadsheets.batchUpdate(request);\n    } catch (error) {\n      console.error('Error adding chart:', error);\n      throw error;\n    }\n  }\n\n  async autoFormatData(spreadsheetId: string, range: string) {\n    try {\n      const request = {\n        spreadsheetId,\n        resource: {\n          requests: [\n            {\n              autoResizeDimensions: {\n                dimensions: {\n                  sheetId: 0,\n                  dimension: 'COLUMNS',\n                },\n              },\n            },\n          ],\n        },\n      };\n\n      return await this.sheets.spreadsheets.batchUpdate(request);\n    } catch (error) {\n      console.error('Error auto-formatting:', error);\n      throw error;\n    }\n  }\n}\n"],"version":3}
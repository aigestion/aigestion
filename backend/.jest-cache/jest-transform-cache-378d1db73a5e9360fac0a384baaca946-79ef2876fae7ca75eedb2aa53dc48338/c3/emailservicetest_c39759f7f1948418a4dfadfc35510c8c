625a16318eadf22ba2fb15c1b8f86eb4
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Move mock implementation to allow accessing variables (or use factory correctly)
globals_1.jest.mock('nodemailer', () => {
    return {
        createTransport: globals_1.jest.fn(() => ({
            sendMail: mockSendMail,
            verify: mockVerify,
        })),
    };
});
require("reflect-metadata");
const nodemailer_1 = __importDefault(require("nodemailer"));
const inversify_config_1 = require("../../config/inversify.config");
const mockSendMail = globals_1.jest.fn();
const mockVerify = globals_1.jest.fn();
describe('EmailService', () => {
    let service;
    beforeEach(() => {
        globals_1.jest.clearAllMocks();
        service = inversify_config_1.container.get(inversify_config_1.TYPES.EmailService);
    });
    it('should create transporter on initialization', () => {
        expect(nodemailer_1.default.createTransport).toHaveBeenCalled();
    });
    describe('verifyConnection', () => {
        it('should return true on success', async () => {
            mockVerify.mockResolvedValue(true);
            const result = await service.verifyConnection();
            expect(result).toBe(true);
        });
        it('should return false on failure', async () => {
            mockVerify.mockRejectedValue(new Error('Connection failed'));
            const result = await service.verifyConnection();
            expect(result).toBe(false);
        });
    });
    describe('sendEmail', () => {
        it('should send email successfully', async () => {
            mockSendMail.mockResolvedValue({ messageId: 'test-id' });
            await service.sendEmail({
                to: 'test@example.com',
                subject: 'Test Subject',
                html: 'Test Body',
            });
            expect(mockSendMail).toHaveBeenCalledWith(expect.objectContaining({
                to: 'test@example.com',
                subject: 'Test Subject',
                html: 'Test Body',
            }));
        });
        it('should return false on failure', async () => {
            mockSendMail.mockRejectedValue(new Error('Send failed'));
            const result = await service.sendEmail({ to: 'test', subject: 'test', html: 'test' });
            expect(result).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXHNlcnZpY2VzXFxlbWFpbC5zZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFFQSwyQ0FBcUM7QUFRckMsbUZBQW1GO0FBQ25GLGNBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMzQixPQUFPO1FBQ0wsZUFBZSxFQUFFLGNBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUM5QixRQUFRLEVBQUUsWUFBWTtZQUN0QixNQUFNLEVBQUUsVUFBVTtTQUNuQixDQUFDLENBQUM7S0FDSixDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFsQkgsNEJBQTBCO0FBRzFCLDREQUFvQztBQUNwQyxvRUFBaUU7QUFHakUsTUFBTSxZQUFZLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQy9CLE1BQU0sVUFBVSxHQUFHLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQVk3QixRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFJLE9BQXFCLENBQUM7SUFFMUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGNBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixPQUFPLEdBQUcsNEJBQVMsQ0FBQyxHQUFHLENBQWUsd0JBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7UUFDckQsTUFBTSxDQUFDLG9CQUFVLENBQUMsZUFBZSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUN4RCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLCtCQUErQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuQyxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDOUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDLElBQUksS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztZQUM3RCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5QyxZQUFZLENBQUMsaUJBQWlCLENBQUMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztZQUN6RCxNQUFNLE9BQU8sQ0FBQyxTQUFTLENBQUM7Z0JBQ3RCLEVBQUUsRUFBRSxrQkFBa0I7Z0JBQ3RCLE9BQU8sRUFBRSxjQUFjO2dCQUN2QixJQUFJLEVBQUUsV0FBVzthQUNsQixDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsb0JBQW9CLENBQ3ZDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsRUFBRSxFQUFFLGtCQUFrQjtnQkFDdEIsT0FBTyxFQUFFLGNBQWM7Z0JBQ3ZCLElBQUksRUFBRSxXQUFXO2FBQ2xCLENBQUMsQ0FDSCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDOUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLElBQUksS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7WUFDekQsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQ3RGLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWxlamFuZHJvXFxBSUdlc3Rpb25cXGJhY2tlbmRcXHNyY1xcX190ZXN0c19fXFxzZXJ2aWNlc1xcZW1haWwuc2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAncmVmbGVjdC1tZXRhZGF0YSc7XG5cbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCBub2RlbWFpbGVyIGZyb20gJ25vZGVtYWlsZXInO1xuaW1wb3J0IHsgY29udGFpbmVyLCBUWVBFUyB9IGZyb20gJy4uLy4uL2NvbmZpZy9pbnZlcnNpZnkuY29uZmlnJztcbmltcG9ydCB7IEVtYWlsU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2VtYWlsLnNlcnZpY2UnO1xuXG5jb25zdCBtb2NrU2VuZE1haWwgPSBqZXN0LmZuKCk7XG5jb25zdCBtb2NrVmVyaWZ5ID0gamVzdC5mbigpO1xuXG4vLyBNb3ZlIG1vY2sgaW1wbGVtZW50YXRpb24gdG8gYWxsb3cgYWNjZXNzaW5nIHZhcmlhYmxlcyAob3IgdXNlIGZhY3RvcnkgY29ycmVjdGx5KVxuamVzdC5tb2NrKCdub2RlbWFpbGVyJywgKCkgPT4ge1xuICByZXR1cm4ge1xuICAgIGNyZWF0ZVRyYW5zcG9ydDogamVzdC5mbigoKSA9PiAoe1xuICAgICAgc2VuZE1haWw6IG1vY2tTZW5kTWFpbCxcbiAgICAgIHZlcmlmeTogbW9ja1ZlcmlmeSxcbiAgICB9KSksXG4gIH07XG59KTtcblxuZGVzY3JpYmUoJ0VtYWlsU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IEVtYWlsU2VydmljZTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBzZXJ2aWNlID0gY29udGFpbmVyLmdldDxFbWFpbFNlcnZpY2U+KFRZUEVTLkVtYWlsU2VydmljZSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY3JlYXRlIHRyYW5zcG9ydGVyIG9uIGluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xuICAgIGV4cGVjdChub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndmVyaWZ5Q29ubmVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIG9uIHN1Y2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVmVyaWZ5Lm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZnlDb25uZWN0aW9uKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugb24gZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tWZXJpZnkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDb25uZWN0aW9uIGZhaWxlZCcpKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmVyaWZ5Q29ubmVjdGlvbigpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZW5kRW1haWwnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZW5kIGVtYWlsIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTZW5kTWFpbC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IG1lc3NhZ2VJZDogJ3Rlc3QtaWQnIH0pO1xuICAgICAgYXdhaXQgc2VydmljZS5zZW5kRW1haWwoe1xuICAgICAgICB0bzogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBzdWJqZWN0OiAnVGVzdCBTdWJqZWN0JyxcbiAgICAgICAgaHRtbDogJ1Rlc3QgQm9keScsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrU2VuZE1haWwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdG86ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBzdWJqZWN0OiAnVGVzdCBTdWJqZWN0JyxcbiAgICAgICAgICBodG1sOiAnVGVzdCBCb2R5JyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2Ugb24gZmFpbHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tTZW5kTWFpbC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1NlbmQgZmFpbGVkJykpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5zZW5kRW1haWwoeyB0bzogJ3Rlc3QnLCBzdWJqZWN0OiAndGVzdCcsIGh0bWw6ICd0ZXN0JyB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9
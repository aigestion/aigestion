90cbfdbf513823c1250497d9730b8350
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deleteUser = exports.updateUser = exports.getUserById = exports.getAllUsers = exports.createUser = void 0;
const response_builder_1 = require("../common/response-builder");
const inversify_config_1 = require("../config/inversify.config");
const errors_1 = require("../utils/errors");
const createUser = async (req, res, next) => {
    try {
        const userService = inversify_config_1.container.get(inversify_config_1.TYPES.UserService);
        const user = await userService.create(req.body);
        res.status(201).json((0, response_builder_1.buildResponse)(user, 201, req.requestId));
    }
    catch (err) {
        next(err);
    }
};
exports.createUser = createUser;
const getAllUsers = async (req, res, next) => {
    try {
        const userService = inversify_config_1.container.get(inversify_config_1.TYPES.UserService);
        const { page = 1, limit = 10 } = req.pagination || {};
        const { data, total } = await userService.findAll(Number(page), Number(limit));
        const response = {
            data,
            pagination: {
                page: Number(page),
                limit: Number(limit),
                total,
            },
        };
        res.json((0, response_builder_1.buildResponse)(response, 200, req.requestId));
    }
    catch (err) {
        next(err);
    }
};
exports.getAllUsers = getAllUsers;
const getUserById = async (req, res, next) => {
    try {
        const userService = inversify_config_1.container.get(inversify_config_1.TYPES.UserService);
        const { id } = req.params;
        const user = await userService.findById(id);
        if (!user) {
            return next(new errors_1.AppError('User not found', 404, 'NOT_FOUND'));
        }
        res.json((0, response_builder_1.buildResponse)(user, 200, req.requestId));
    }
    catch (err) {
        next(err);
    }
};
exports.getUserById = getUserById;
const updateUser = async (req, res, next) => {
    try {
        const userService = inversify_config_1.container.get(inversify_config_1.TYPES.UserService);
        const { id } = req.params;
        const user = await userService.update(id, req.body);
        if (!user) {
            return next(new errors_1.AppError('User not found', 404, 'NOT_FOUND'));
        }
        res.json((0, response_builder_1.buildResponse)(user, 200, req.requestId));
    }
    catch (err) {
        next(err);
    }
};
exports.updateUser = updateUser;
const deleteUser = async (req, res, next) => {
    try {
        const userService = inversify_config_1.container.get(inversify_config_1.TYPES.UserService);
        const { id } = req.params;
        const success = await userService.delete(id);
        if (!success) {
            return next(new errors_1.AppError('User not found', 404, 'NOT_FOUND'));
        }
        res.json((0, response_builder_1.buildResponse)({ message: 'User deleted' }, 200, req.requestId));
    }
    catch (err) {
        next(err);
    }
};
exports.deleteUser = deleteUser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxjb250cm9sbGVyc1xcdXNlci5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLGlFQUEyRDtBQUMzRCxpRUFBOEQ7QUFFOUQsNENBQTJDO0FBRXBDLE1BQU0sVUFBVSxHQUFHLEtBQUssRUFBRSxHQUFZLEVBQUUsR0FBYSxFQUFFLElBQWtCLEVBQUUsRUFBRTtJQUNsRixJQUFJLENBQUM7UUFDSCxNQUFNLFdBQVcsR0FBRyw0QkFBUyxDQUFDLEdBQUcsQ0FBYyx3QkFBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sSUFBSSxHQUFHLE1BQU0sV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBQSxnQ0FBYSxFQUFDLElBQUksRUFBRSxHQUFHLEVBQUcsR0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDekUsQ0FBQztJQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDWixDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBUlcsUUFBQSxVQUFVLGNBUXJCO0FBRUssTUFBTSxXQUFXLEdBQUcsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsSUFBa0IsRUFBRSxFQUFFO0lBQ25GLElBQUksQ0FBQztRQUNILE1BQU0sV0FBVyxHQUFHLDRCQUFTLENBQUMsR0FBRyxDQUFjLHdCQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDbEUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLEVBQUUsRUFBRSxHQUFJLEdBQVcsQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDO1FBQy9ELE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsTUFBTSxXQUFXLENBQUMsT0FBTyxDQUFDLE1B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QU0sT0FBTyxHQUFHLE1BQU0sV0FBVyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3QyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDYixPQUFPLElBQUksQ0FBQyxJQUFJLGlCQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDaEUsQ0FBQztRQUNELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBQSxnQ0FBYSxFQUFDLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxFQUFFLEdBQUcsRUFBRyxHQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUNwRixDQUFDO0lBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNaLENBQUM7QUFDSCxDQUFDLENBQUM7QUFaVyxRQUFBLFVBQVUsY0FZckIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxjb250cm9sbGVyc1xcdXNlci5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEZ1bmN0aW9uLCBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgYnVpbGRSZXNwb25zZSB9IGZyb20gJy4uL2NvbW1vbi9yZXNwb25zZS1idWlsZGVyJztcbmltcG9ydCB7IFRZUEVTLCBjb250YWluZXIgfSBmcm9tICcuLi9jb25maWcvaW52ZXJzaWZ5LmNvbmZpZyc7XG5pbXBvcnQgeyBVc2VyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3VzZXIuc2VydmljZSc7XG5pbXBvcnQgeyBBcHBFcnJvciB9IGZyb20gJy4uL3V0aWxzL2Vycm9ycyc7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVVc2VyID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlclNlcnZpY2UgPSBjb250YWluZXIuZ2V0PFVzZXJTZXJ2aWNlPihUWVBFUy5Vc2VyU2VydmljZSk7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJTZXJ2aWNlLmNyZWF0ZShyZXEuYm9keSk7XG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oYnVpbGRSZXNwb25zZSh1c2VyLCAyMDEsIChyZXEgYXMgYW55KS5yZXF1ZXN0SWQpKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbmV4dChlcnIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0QWxsVXNlcnMgPSBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VyU2VydmljZSA9IGNvbnRhaW5lci5nZXQ8VXNlclNlcnZpY2U+KFRZUEVTLlVzZXJTZXJ2aWNlKTtcbiAgICBjb25zdCB7IHBhZ2UgPSAxLCBsaW1pdCA9IDEwIH0gPSAocmVxIGFzIGFueSkucGFnaW5hdGlvbiB8fCB7fTtcbiAgICBjb25zdCB7IGRhdGEsIHRvdGFsIH0gPSBhd2FpdCB1c2VyU2VydmljZS5maW5kQWxsKE51bWJlcihwYWdlKSwgTnVtYmVyKGxpbWl0KSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IHtcbiAgICAgIGRhdGEsXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIHBhZ2U6IE51bWJlcihwYWdlKSxcbiAgICAgICAgbGltaXQ6IE51bWJlcihsaW1pdCksXG4gICAgICAgIHRvdGFsLFxuICAgICAgfSxcbiAgICB9O1xuICAgIHJlcy5qc29uKGJ1aWxkUmVzcG9uc2UocmVzcG9uc2UsIDIwMCwgKHJlcSBhcyBhbnkpLnJlcXVlc3RJZCkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRVc2VyQnlJZCA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJTZXJ2aWNlID0gY29udGFpbmVyLmdldDxVc2VyU2VydmljZT4oVFlQRVMuVXNlclNlcnZpY2UpO1xuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXMgYXMgYW55O1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2VyU2VydmljZS5maW5kQnlJZChpZCk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICByZXR1cm4gbmV4dChuZXcgQXBwRXJyb3IoJ1VzZXIgbm90IGZvdW5kJywgNDA0LCAnTk9UX0ZPVU5EJykpO1xuICAgIH1cbiAgICByZXMuanNvbihidWlsZFJlc3BvbnNlKHVzZXIsIDIwMCwgKHJlcSBhcyBhbnkpLnJlcXVlc3RJZCkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVVc2VyID0gYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlclNlcnZpY2UgPSBjb250YWluZXIuZ2V0PFVzZXJTZXJ2aWNlPihUWVBFUy5Vc2VyU2VydmljZSk7XG4gICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcyBhcyBhbnk7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHVzZXJTZXJ2aWNlLnVwZGF0ZShpZCwgcmVxLmJvZHkpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIG5leHQobmV3IEFwcEVycm9yKCdVc2VyIG5vdCBmb3VuZCcsIDQwNCwgJ05PVF9GT1VORCcpKTtcbiAgICB9XG4gICAgcmVzLmpzb24oYnVpbGRSZXNwb25zZSh1c2VyLCAyMDAsIChyZXEgYXMgYW55KS5yZXF1ZXN0SWQpKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbmV4dChlcnIpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGVsZXRlVXNlciA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJTZXJ2aWNlID0gY29udGFpbmVyLmdldDxVc2VyU2VydmljZT4oVFlQRVMuVXNlclNlcnZpY2UpO1xuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXMgYXMgYW55O1xuICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCB1c2VyU2VydmljZS5kZWxldGUoaWQpO1xuICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIG5leHQobmV3IEFwcEVycm9yKCdVc2VyIG5vdCBmb3VuZCcsIDQwNCwgJ05PVF9GT1VORCcpKTtcbiAgICB9XG4gICAgcmVzLmpzb24oYnVpbGRSZXNwb25zZSh7IG1lc3NhZ2U6ICdVc2VyIGRlbGV0ZWQnIH0sIDIwMCwgKHJlcSBhcyBhbnkpLnJlcXVlc3RJZCkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG4iXSwidmVyc2lvbiI6M30=
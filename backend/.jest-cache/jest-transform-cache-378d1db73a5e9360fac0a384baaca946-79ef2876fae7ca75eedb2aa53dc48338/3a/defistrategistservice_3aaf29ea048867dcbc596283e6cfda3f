6bee8aef05a7842bd761e7bc392dcc43
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DeFiStrategistService = void 0;
const axios_1 = __importDefault(require("axios"));
const inversify_1 = require("inversify");
const env_schema_1 = require("../config/env.schema");
const logger_1 = require("../utils/logger");
let DeFiStrategistService = class DeFiStrategistService {
    alphaVantageKey;
    constructor() {
        this.alphaVantageKey = env_schema_1.env.ALPHAVANTAGE_KEY || '';
    }
    /**
     * Analyzes current wallet "health" and suggests yield improvements.
     * This is a prototype that simulates DeFi rebalancing logic.
     */
    async getYieldAdvice() {
        try {
            logger_1.logger.info('[DeFiStrategist] Analyzing yield opportunities...');
            // 1. Get Market Sentiment (Simulated using AlphaVantage if key exists)
            const sentiment = await this.getMarketSentiment();
            // 2. Simulated Wallet Status (In production, this would call ethers.js or a web3 provider)
            const mockWallets = [
                { asset: 'ETH', balance: 1.5, apy: 3.2, recommendation: 'hold' },
                { asset: 'USDT', balance: 5000, apy: 8.5, recommendation: 'compound' },
                { asset: 'LINK', balance: 100, apy: 1.2, recommendation: 'rebalance' },
            ];
            return {
                timestamp: new Date().toISOString(),
                marketSentiment: sentiment,
                wallets: mockWallets,
                strategy: sentiment === 'BULLISH' ? 'Aggressive Staking' : 'Delta-Neutral Stable Farming',
            };
        }
        catch (error) {
            logger_1.logger.error('[DeFiStrategist] Advice generation failed:', error);
            throw error;
        }
    }
    async getMarketSentiment() {
        if (!this.alphaVantageKey)
            return 'NEUTRAL';
        try {
            // Real AlphaVantage endpoint for Sentiment
            const res = await axios_1.default.get(`https://www.alphavantage.co/query?function=NEWS_SENTIMENT&apikey=${this.alphaVantageKey}`);
            const overallSentiment = res.data.feed?.[0]?.overall_sentiment_label || 'NEUTRAL';
            return overallSentiment.toUpperCase();
        }
        catch {
            return 'NEUTRAL';
        }
    }
};
exports.DeFiStrategistService = DeFiStrategistService;
exports.DeFiStrategistService = DeFiStrategistService = __decorate([
    (0, inversify_1.injectable)(),
    __metadata("design:paramtypes", [])
], DeFiStrategistService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcZGVmaS1zdHJhdGVnaXN0LnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsa0RBQTBCO0FBQzFCLHlDQUF1QztBQUN2QyxxREFBMkM7QUFDM0MsNENBQXlDO0FBVWxDLElBQU0scUJBQXFCLEdBQTNCLE1BQU0scUJBQXFCO0lBQ2YsZUFBZSxDQUFTO0lBRXpDO1FBQ0UsSUFBSSxDQUFDLGVBQWUsR0FBRyxnQkFBRyxDQUFDLGdCQUFnQixJQUFJLEVBQUUsQ0FBQztJQUNwRCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLGNBQWM7UUFDbEIsSUFBSSxDQUFDO1lBQ0gsZUFBTSxDQUFDLElBQUksQ0FBQyxtREFBbUQsQ0FBQyxDQUFDO1lBRWpFLHVFQUF1RTtZQUN2RSxNQUFNLFNBQVMsR0FBRyxNQUFNLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1lBRWxELDJGQUEyRjtZQUMzRixNQUFNLFdBQVcsR0FBa0I7Z0JBQ2pDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRTtnQkFDaEUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxjQUFjLEVBQUUsVUFBVSxFQUFFO2dCQUN0RSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLGNBQWMsRUFBRSxXQUFXLEVBQUU7YUFDdkUsQ0FBQztZQUVGLE9BQU87Z0JBQ0wsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2dCQUNuQyxlQUFlLEVBQUUsU0FBUztnQkFDMUIsT0FBTyxFQUFFLFdBQVc7Z0JBQ3BCLFFBQVEsRUFBRSxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUMsOEJBQThCO2FBQzFGLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGVBQU0sQ0FBQyxLQUFLLENBQUMsNENBQTRDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDbEUsTUFBTSxLQUFLLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQztJQUVPLEtBQUssQ0FBQyxrQkFBa0I7UUFDOUIsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlO1lBQUUsT0FBTyxTQUFTLENBQUM7UUFFNUMsSUFBSSxDQUFDO1lBQ0gsMkNBQTJDO1lBQzNDLE1BQU0sR0FBRyxHQUFHLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FDekIsb0VBQW9FLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FDM0YsQ0FBQztZQUNGLE1BQU0sZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSx1QkFBdUIsSUFBSSxTQUFTLENBQUM7WUFDbEYsT0FBTyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN4QyxDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1AsT0FBTyxTQUFTLENBQUM7UUFDbkIsQ0FBQztJQUNILENBQUM7Q0FDRixDQUFBO0FBbkRZLHNEQUFxQjtnQ0FBckIscUJBQXFCO0lBRGpDLElBQUEsc0JBQVUsR0FBRTs7R0FDQSxxQkFBcUIsQ0FtRGpDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWxlamFuZHJvXFxBSUdlc3Rpb25cXGJhY2tlbmRcXHNyY1xcc2VydmljZXNcXGRlZmktc3RyYXRlZ2lzdC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyBpbmplY3RhYmxlIH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IGVudiB9IGZyb20gJy4uL2NvbmZpZy9lbnYuc2NoZW1hJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgV2FsbGV0WWllbGQge1xuICBhc3NldDogc3RyaW5nO1xuICBiYWxhbmNlOiBudW1iZXI7XG4gIGFweTogbnVtYmVyO1xuICByZWNvbW1lbmRhdGlvbjogJ2hvbGQnIHwgJ3JlYmFsYW5jZScgfCAnY29tcG91bmQnO1xufVxuXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGVGaVN0cmF0ZWdpc3RTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBhbHBoYVZhbnRhZ2VLZXk6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFscGhhVmFudGFnZUtleSA9IGVudi5BTFBIQVZBTlRBR0VfS0VZIHx8ICcnO1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emVzIGN1cnJlbnQgd2FsbGV0IFwiaGVhbHRoXCIgYW5kIHN1Z2dlc3RzIHlpZWxkIGltcHJvdmVtZW50cy5cbiAgICogVGhpcyBpcyBhIHByb3RvdHlwZSB0aGF0IHNpbXVsYXRlcyBEZUZpIHJlYmFsYW5jaW5nIGxvZ2ljLlxuICAgKi9cbiAgYXN5bmMgZ2V0WWllbGRBZHZpY2UoKTogUHJvbWlzZTxhbnk+IHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oJ1tEZUZpU3RyYXRlZ2lzdF0gQW5hbHl6aW5nIHlpZWxkIG9wcG9ydHVuaXRpZXMuLi4nKTtcblxuICAgICAgLy8gMS4gR2V0IE1hcmtldCBTZW50aW1lbnQgKFNpbXVsYXRlZCB1c2luZyBBbHBoYVZhbnRhZ2UgaWYga2V5IGV4aXN0cylcbiAgICAgIGNvbnN0IHNlbnRpbWVudCA9IGF3YWl0IHRoaXMuZ2V0TWFya2V0U2VudGltZW50KCk7XG5cbiAgICAgIC8vIDIuIFNpbXVsYXRlZCBXYWxsZXQgU3RhdHVzIChJbiBwcm9kdWN0aW9uLCB0aGlzIHdvdWxkIGNhbGwgZXRoZXJzLmpzIG9yIGEgd2ViMyBwcm92aWRlcilcbiAgICAgIGNvbnN0IG1vY2tXYWxsZXRzOiBXYWxsZXRZaWVsZFtdID0gW1xuICAgICAgICB7IGFzc2V0OiAnRVRIJywgYmFsYW5jZTogMS41LCBhcHk6IDMuMiwgcmVjb21tZW5kYXRpb246ICdob2xkJyB9LFxuICAgICAgICB7IGFzc2V0OiAnVVNEVCcsIGJhbGFuY2U6IDUwMDAsIGFweTogOC41LCByZWNvbW1lbmRhdGlvbjogJ2NvbXBvdW5kJyB9LFxuICAgICAgICB7IGFzc2V0OiAnTElOSycsIGJhbGFuY2U6IDEwMCwgYXB5OiAxLjIsIHJlY29tbWVuZGF0aW9uOiAncmViYWxhbmNlJyB9LFxuICAgICAgXTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIG1hcmtldFNlbnRpbWVudDogc2VudGltZW50LFxuICAgICAgICB3YWxsZXRzOiBtb2NrV2FsbGV0cyxcbiAgICAgICAgc3RyYXRlZ3k6IHNlbnRpbWVudCA9PT0gJ0JVTExJU0gnID8gJ0FnZ3Jlc3NpdmUgU3Rha2luZycgOiAnRGVsdGEtTmV1dHJhbCBTdGFibGUgRmFybWluZycsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1tEZUZpU3RyYXRlZ2lzdF0gQWR2aWNlIGdlbmVyYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0TWFya2V0U2VudGltZW50KCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgaWYgKCF0aGlzLmFscGhhVmFudGFnZUtleSkgcmV0dXJuICdORVVUUkFMJztcblxuICAgIHRyeSB7XG4gICAgICAvLyBSZWFsIEFscGhhVmFudGFnZSBlbmRwb2ludCBmb3IgU2VudGltZW50XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBheGlvcy5nZXQoXG4gICAgICAgIGBodHRwczovL3d3dy5hbHBoYXZhbnRhZ2UuY28vcXVlcnk/ZnVuY3Rpb249TkVXU19TRU5USU1FTlQmYXBpa2V5PSR7dGhpcy5hbHBoYVZhbnRhZ2VLZXl9YCxcbiAgICAgICk7XG4gICAgICBjb25zdCBvdmVyYWxsU2VudGltZW50ID0gcmVzLmRhdGEuZmVlZD8uWzBdPy5vdmVyYWxsX3NlbnRpbWVudF9sYWJlbCB8fCAnTkVVVFJBTCc7XG4gICAgICByZXR1cm4gb3ZlcmFsbFNlbnRpbWVudC50b1VwcGVyQ2FzZSgpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuICdORVVUUkFMJztcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==
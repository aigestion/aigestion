b01c750ca5f68c0994f1efe08957b546
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.InfraOptimizerService = void 0;
const inversify_1 = require("inversify");
const env_schema_1 = require("../config/env.schema");
const logger_1 = require("../utils/logger");
const monitoring_1 = require("@google-cloud/monitoring");
let InfraOptimizerService = class InfraOptimizerService {
    monitoringClient;
    constructor() {
        this.monitoringClient = new monitoring_1.MetricServiceClient();
    }
    /**
     * Analyzes GCP usage and suggests cost/performance optimizations.
     */
    async getInfraRecommendations() {
        const projectId = env_schema_1.env.GOOGLE_CLOUD_PROJECT_ID;
        try {
            logger_1.logger.info(`[InfraOptimizer] Analyzing infrastructure for project: ${projectId}`);
            // In a real scenario, we'd query Cloud Monitoring metrics for CPU/Memory
            // For this prototype, we'll return a simulated high-impact recommendation based on typical Cloud Run patterns.
            const recommendations = [
                {
                    service: 'dashboard-backend',
                    issue: 'Over-provisioned Memory',
                    action: 'Reduce from 1GiB to 512MiB',
                    estimatedMonthlySavings: '$12.50',
                },
                {
                    service: 'rag-service',
                    issue: 'Cold Starts detected',
                    action: 'Enable min-instances: 1',
                    estimatedImprovement: '30% Latency reduction',
                },
            ];
            return {
                projectId,
                recommendations,
                totalPotentialSavings: '$12.50',
            };
        }
        catch (error) {
            logger_1.logger.error('[InfraOptimizer] Optimization analysis failed:', error);
            throw error;
        }
    }
    /**
     * Optimizes infrastructure resources based on target.
     */
    async optimize(target) {
        logger_1.logger.info(`[InfraOptimizer] optimizing target: ${target}`);
        // Simulated optimization logic
        return {
            target,
            status: 'optimized',
            actions_taken: ['scaled_down_memory', 'enabled_min_instances'],
            savings: '$15.00/mo',
        };
    }
};
exports.InfraOptimizerService = InfraOptimizerService;
exports.InfraOptimizerService = InfraOptimizerService = __decorate([
    (0, inversify_1.injectable)(),
    __metadata("design:paramtypes", [])
], InfraOptimizerService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcaW5mcmEtb3B0aW1pemVyLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEseUNBQXVDO0FBQ3ZDLHFEQUEyQztBQUMzQyw0Q0FBeUM7QUFDekMseURBQStEO0FBR3hELElBQU0scUJBQXFCLEdBQTNCLE1BQU0scUJBQXFCO0lBQ3hCLGdCQUFnQixDQUFzQjtJQUU5QztRQUNFLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLGdDQUFtQixFQUFFLENBQUM7SUFDcEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLHVCQUF1QjtRQUMzQixNQUFNLFNBQVMsR0FBRyxnQkFBRyxDQUFDLHVCQUF1QixDQUFDO1FBRTlDLElBQUksQ0FBQztZQUNILGVBQU0sQ0FBQyxJQUFJLENBQUMsMERBQTBELFNBQVMsRUFBRSxDQUFDLENBQUM7WUFFbkYseUVBQXlFO1lBQ3pFLCtHQUErRztZQUUvRyxNQUFNLGVBQWUsR0FBRztnQkFDdEI7b0JBQ0UsT0FBTyxFQUFFLG1CQUFtQjtvQkFDNUIsS0FBSyxFQUFFLHlCQUF5QjtvQkFDaEMsTUFBTSxFQUFFLDRCQUE0QjtvQkFDcEMsdUJBQXVCLEVBQUUsUUFBUTtpQkFDbEM7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLGFBQWE7b0JBQ3RCLEtBQUssRUFBRSxzQkFBc0I7b0JBQzdCLE1BQU0sRUFBRSx5QkFBeUI7b0JBQ2pDLG9CQUFvQixFQUFFLHVCQUF1QjtpQkFDOUM7YUFDRixDQUFDO1lBRUYsT0FBTztnQkFDTCxTQUFTO2dCQUNULGVBQWU7Z0JBQ2YscUJBQXFCLEVBQUUsUUFBUTthQUNoQyxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixlQUFNLENBQUMsS0FBSyxDQUFDLGdEQUFnRCxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBYztRQUMzQixlQUFNLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQzdELCtCQUErQjtRQUMvQixPQUFPO1lBQ0wsTUFBTTtZQUNOLE1BQU0sRUFBRSxXQUFXO1lBQ25CLGFBQWEsRUFBRSxDQUFDLG9CQUFvQixFQUFFLHVCQUF1QixDQUFDO1lBQzlELE9BQU8sRUFBRSxXQUFXO1NBQ3JCLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQTtBQTFEWSxzREFBcUI7Z0NBQXJCLHFCQUFxQjtJQURqQyxJQUFBLHNCQUFVLEdBQUU7O0dBQ0EscUJBQXFCLENBMERqQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFsZWphbmRyb1xcQUlHZXN0aW9uXFxiYWNrZW5kXFxzcmNcXHNlcnZpY2VzXFxpbmZyYS1vcHRpbWl6ZXIuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlIH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IGVudiB9IGZyb20gJy4uL2NvbmZpZy9lbnYuc2NoZW1hJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBNZXRyaWNTZXJ2aWNlQ2xpZW50IH0gZnJvbSAnQGdvb2dsZS1jbG91ZC9tb25pdG9yaW5nJztcblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEluZnJhT3B0aW1pemVyU2VydmljZSB7XG4gIHByaXZhdGUgbW9uaXRvcmluZ0NsaWVudDogTWV0cmljU2VydmljZUNsaWVudDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLm1vbml0b3JpbmdDbGllbnQgPSBuZXcgTWV0cmljU2VydmljZUNsaWVudCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emVzIEdDUCB1c2FnZSBhbmQgc3VnZ2VzdHMgY29zdC9wZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0SW5mcmFSZWNvbW1lbmRhdGlvbnMoKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCBwcm9qZWN0SWQgPSBlbnYuR09PR0xFX0NMT1VEX1BST0pFQ1RfSUQ7XG5cbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmluZm8oYFtJbmZyYU9wdGltaXplcl0gQW5hbHl6aW5nIGluZnJhc3RydWN0dXJlIGZvciBwcm9qZWN0OiAke3Byb2plY3RJZH1gKTtcblxuICAgICAgLy8gSW4gYSByZWFsIHNjZW5hcmlvLCB3ZSdkIHF1ZXJ5IENsb3VkIE1vbml0b3JpbmcgbWV0cmljcyBmb3IgQ1BVL01lbW9yeVxuICAgICAgLy8gRm9yIHRoaXMgcHJvdG90eXBlLCB3ZSdsbCByZXR1cm4gYSBzaW11bGF0ZWQgaGlnaC1pbXBhY3QgcmVjb21tZW5kYXRpb24gYmFzZWQgb24gdHlwaWNhbCBDbG91ZCBSdW4gcGF0dGVybnMuXG5cbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHNlcnZpY2U6ICdkYXNoYm9hcmQtYmFja2VuZCcsXG4gICAgICAgICAgaXNzdWU6ICdPdmVyLXByb3Zpc2lvbmVkIE1lbW9yeScsXG4gICAgICAgICAgYWN0aW9uOiAnUmVkdWNlIGZyb20gMUdpQiB0byA1MTJNaUInLFxuICAgICAgICAgIGVzdGltYXRlZE1vbnRobHlTYXZpbmdzOiAnJDEyLjUwJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHNlcnZpY2U6ICdyYWctc2VydmljZScsXG4gICAgICAgICAgaXNzdWU6ICdDb2xkIFN0YXJ0cyBkZXRlY3RlZCcsXG4gICAgICAgICAgYWN0aW9uOiAnRW5hYmxlIG1pbi1pbnN0YW5jZXM6IDEnLFxuICAgICAgICAgIGVzdGltYXRlZEltcHJvdmVtZW50OiAnMzAlIExhdGVuY3kgcmVkdWN0aW9uJyxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb2plY3RJZCxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLFxuICAgICAgICB0b3RhbFBvdGVudGlhbFNhdmluZ3M6ICckMTIuNTAnLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdbSW5mcmFPcHRpbWl6ZXJdIE9wdGltaXphdGlvbiBhbmFseXNpcyBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9wdGltaXplcyBpbmZyYXN0cnVjdHVyZSByZXNvdXJjZXMgYmFzZWQgb24gdGFyZ2V0LlxuICAgKi9cbiAgYXN5bmMgb3B0aW1pemUodGFyZ2V0OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgIGxvZ2dlci5pbmZvKGBbSW5mcmFPcHRpbWl6ZXJdIG9wdGltaXppbmcgdGFyZ2V0OiAke3RhcmdldH1gKTtcbiAgICAvLyBTaW11bGF0ZWQgb3B0aW1pemF0aW9uIGxvZ2ljXG4gICAgcmV0dXJuIHtcbiAgICAgIHRhcmdldCxcbiAgICAgIHN0YXR1czogJ29wdGltaXplZCcsXG4gICAgICBhY3Rpb25zX3Rha2VuOiBbJ3NjYWxlZF9kb3duX21lbW9yeScsICdlbmFibGVkX21pbl9pbnN0YW5jZXMnXSxcbiAgICAgIHNhdmluZ3M6ICckMTUuMDAvbW8nLFxuICAgIH07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\facebook.service.ts","mappings":";;;;;;;;;;;;AAAA,kDAA0B;AAC1B,yCAAuC;AACvC,qDAA2C;AAC3C,4CAAyC;AAGlC,IAAM,eAAe,GAArB,MAAM,eAAe;IACT,OAAO,GAAG,kCAAkC,CAAC;IAE9D;;OAEG;IACH,KAAK,CAAC,UAAU,CAAC,MAAc,EAAE,OAAe,EAAE,WAAoB;QACpE,MAAM,KAAK,GAAG,WAAW,IAAI,gBAAG,CAAC,0BAA0B,CAAC;QAE5D,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,MAAM,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC;QAC/D,CAAC;QAED,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,IAAI,CAC/B,GAAG,IAAI,CAAC,OAAO,IAAI,MAAM,OAAO,EAChC;gBACE,OAAO,EAAE,OAAO;aACjB,EACD;gBACE,MAAM,EAAE,EAAE,YAAY,EAAE,KAAK,EAAE;aAChC,CACF,CAAC;YAEF,eAAM,CAAC,IAAI,CAAC,2BAA2B,MAAM,KAAK,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;YACtE,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,eAAM,CAAC,KAAK,CACV,EAAE,KAAK,EAAE,KAAK,CAAC,QAAQ,EAAE,IAAI,IAAI,KAAK,CAAC,OAAO,EAAE,EAChD,gCAAgC,CACjC,CAAC;YACF,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,eAAe,CACnB,MAAc,EACd,UAAkB,qCAAqC;QAEvD,MAAM,KAAK,GAAG,gBAAG,CAAC,0BAA0B,CAAC;QAE7C,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO,IAAI,CAAC;QACd,CAAC;QAED,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,OAAO,IAAI,MAAM,WAAW,EAAE;gBACrE,MAAM,EAAE;oBACN,MAAM,EAAE,OAAO;oBACf,YAAY,EAAE,KAAK;iBACpB;aACF,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,eAAM,CAAC,KAAK,CACV,EAAE,KAAK,EAAE,KAAK,CAAC,QAAQ,EAAE,IAAI,IAAI,KAAK,CAAC,OAAO,EAAE,EAChD,uCAAuC,CACxC,CAAC;YACF,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,eAAe,CAAC,MAAc;QAClC,MAAM,KAAK,GAAG,gBAAG,CAAC,0BAA0B,CAAC;QAE7C,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO,IAAI,CAAC;QACd,CAAC;QAED,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,OAAO,IAAI,MAAM,WAAW,EAAE;gBACrE,MAAM,EAAE;oBACN,YAAY,EAAE,KAAK;iBACpB;aACF,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC,IAAI,CAAC;QACvB,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,eAAM,CAAC,KAAK,CACV,EAAE,KAAK,EAAE,KAAK,CAAC,QAAQ,EAAE,IAAI,IAAI,KAAK,CAAC,OAAO,EAAE,EAChD,uCAAuC,CACxC,CAAC;YACF,OAAO,IAAI,CAAC;QACd,CAAC;IACH,CAAC;CACF,CAAA;AA1FY,0CAAe;0BAAf,eAAe;IAD3B,IAAA,sBAAU,GAAE;GACA,eAAe,CA0F3B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\facebook.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { injectable } from 'inversify';\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class FacebookService {\n  private readonly baseUrl = 'https://graph.facebook.com/v19.0';\n\n  /**\n   * Post a message to a Facebook Page feed\n   */\n  async postToPage(pageId: string, message: string, accessToken?: string): Promise<any> {\n    const token = accessToken || env.FACEBOOK_PAGE_ACCESS_TOKEN;\n\n    if (!token) {\n      throw new Error('Facebook Page Access Token not configured');\n    }\n\n    try {\n      const response = await axios.post(\n        `${this.baseUrl}/${pageId}/feed`,\n        {\n          message: message,\n        },\n        {\n          params: { access_token: token },\n        },\n      );\n\n      logger.info(`Posted to Facebook Page ${pageId}: ${response.data.id}`);\n      return response.data;\n    } catch (error: any) {\n      logger.error(\n        { error: error.response?.data || error.message },\n        'Error posting to Facebook Page',\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Get Page insights (e.g., page_impressions, page_engagement)\n   */\n  async getPageInsights(\n    pageId: string,\n    metrics: string = 'page_impressions,page_engaged_users',\n  ): Promise<any> {\n    const token = env.FACEBOOK_PAGE_ACCESS_TOKEN;\n\n    if (!token) {\n      return null;\n    }\n\n    try {\n      const response = await axios.get(`${this.baseUrl}/${pageId}/insights`, {\n        params: {\n          metric: metrics,\n          access_token: token,\n        },\n      });\n      return response.data;\n    } catch (error: any) {\n      logger.error(\n        { error: error.response?.data || error.message },\n        'Error fetching Facebook Page insights',\n      );\n      return null;\n    }\n  }\n\n  /**\n   * Get comments for a specific post\n   */\n  async getPostComments(postId: string): Promise<any> {\n    const token = env.FACEBOOK_PAGE_ACCESS_TOKEN;\n\n    if (!token) {\n      return null;\n    }\n\n    try {\n      const response = await axios.get(`${this.baseUrl}/${postId}/comments`, {\n        params: {\n          access_token: token,\n        },\n      });\n      return response.data;\n    } catch (error: any) {\n      logger.error(\n        { error: error.response?.data || error.message },\n        'Error fetching Facebook post comments',\n      );\n      return null;\n    }\n  }\n}\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\rag.routes.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\rag.routes.ts"],"sourcesContent":["import { Router } from 'express';\nimport multer from 'multer';\nimport { container, TYPES } from '../config/inversify.config';\nimport { RagService } from '../services/rag.service';\nimport { logger } from '../utils/logger';\n\nconst router = Router();\nconst upload = multer();\n\n/**\n * @openapi\n * /rag/query:\n *   post:\n *     summary: Query the hybrid knowledge base (Cloud + Local + Code)\n *     tags: [RAG]\n */\nrouter.post('/query', (req: any, res: any, next: any) => {\n  (async () => {\n    const { query } = (req as any).body;\n    if (!query) {\n      return res.status(400).json({ error: 'Missing query in request body' });\n    }\n\n    try {\n      const ragService = container.get<RagService>(TYPES.RagService);\n      const result = await ragService.queryKnowledgeBase(query);\n      res.json({ success: true, data: result });\n    } catch (error: any) {\n      const message = error instanceof Error ? error.message : String(error);\n      logger.error(`[RagRoute] Query failed: ${message}`);\n      res.status(500).json({ error: 'Search operation failed' });\n    }\n  })().catch(next);\n});\n\n/**\n * @openapi\n * /rag/ingest:\n *   post:\n *     summary: Ingest a document into hybrid memory\n *     tags: [RAG]\n */\n// TODO: Fix Express type conflicts - temporarily disabled\n// router.post('/ingest', upload.single('file'), (req, res, next) => {\n//   (async () => {\n//     const file = (req as any).file;\n//     if (!file) {\n//       return res.status(400).json({ error: 'No file provided' });\n//     }\n\n//     try {\n//       const content = file.buffer.toString('utf-8');\n//       const tags = (req as any).body.tags ? String((req as any).body.tags).split(',') : [];\n\n//       const ragService = container.get<RagService>(TYPES.RagService);\n//       await ragService.ingestDocument(file.originalname, content, tags);\n\n//       res.json({ success: true, message: 'Document ingested successfully' });\n//     } catch (error: any) {\n//       logger.error(`[RagRoute] Ingestion failed: ${error.message}`);\n//       res.status(500).json({ error: 'Ingestion operation failed' });\n//     }\n//   })().catch(next);\n// });\n\n// Legacy support: GET /rag?query=...\nrouter.get('/', (req: any, res: any, next: any) => {\n  (async () => {\n    const query = (req as any).query.query as string;\n    if (!query) {\n      return res.status(400).json({ error: 'Missing query parameter' });\n    }\n    try {\n      const ragService = container.get<RagService>(TYPES.RagService);\n      const result = await ragService.queryKnowledgeBase(query);\n      res.json({ results: [{ content: result }] }); // Match previous format roughly\n    } catch (error: any) {\n      res.status(502).json({ error: 'Failed to retrieve context' });\n    }\n  })().catch(next);\n});\n\nexport default router;\n"],"version":3}
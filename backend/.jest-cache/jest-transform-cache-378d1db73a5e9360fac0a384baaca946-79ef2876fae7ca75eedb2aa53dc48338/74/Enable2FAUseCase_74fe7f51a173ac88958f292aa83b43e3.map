{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\application\\usecases\\Enable2FAUseCase.ts","mappings":";;;;;;;;;;;;;;;;AAAA,yCAA+C;AAC/C,uCAAoC;AACpC,4CAAyC;AACzC,0EAAqE;AACrE,+CAA8C;AAGvC,IAAM,gBAAgB,GAAtB,MAAM,gBAAgB;IACyB;IAApD,YAAoD,gBAAkC;QAAlC,qBAAgB,GAAhB,gBAAgB,CAAkB;IAAG,CAAC;IAE1F,KAAK,CAAC,OAAO,CAAC,MAAc;QAC1B,MAAM,IAAI,GAAG,MAAO,WAAY,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC;QACzD,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,MAAM,IAAI,iBAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE,gBAAgB,CAAC,CAAC;QAC9D,CAAC;QACD,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YAChB,MAAM,IAAI,iBAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE,oBAAoB,CAAC,CAAC;QACxE,CAAC;QAED,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,CACvE,IAAI,CAAC,EAAY,EACjB,IAAI,CAAC,KAAK,CACX,CAAC;QACF,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC;QAC9B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,CAAC,kCAAkC;QAC7D,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC;QAClB,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;IAC5B,CAAC;CACF,CAAA;AArBY,4CAAgB;2BAAhB,gBAAgB;IAD5B,IAAA,sBAAU,GAAE;IAEE,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,gBAAgB,CAAC,CAAA;yDAA2B,qCAAgB,oBAAhB,qCAAgB;GAD3E,gBAAgB,CAqB5B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\application\\usecases\\Enable2FAUseCase.ts"],"sourcesContent":["import { injectable, inject } from 'inversify';\nimport { TYPES } from '../../types';\nimport { User } from '../../models/User';\nimport { TwoFactorService } from '../../services/two-factor.service';\nimport { AppError } from '../../utils/errors';\n\n@injectable()\nexport class Enable2FAUseCase {\n  constructor(@inject(TYPES.TwoFactorService) private twoFactorService: TwoFactorService) {}\n\n  async execute(userId: string): Promise<{ secret: string; qrCode: string }> {\n    const user = await (User as any).findById(userId).exec();\n    if (!user) {\n      throw new AppError('User not found', 404, 'USER_NOT_FOUND');\n    }\n    if (!user.email) {\n      throw new AppError('User email not found', 400, 'USER_EMAIL_MISSING');\n    }\n\n    const { secret, qrCode } = await this.twoFactorService.generateTOTPSecret(\n      user.id as string,\n      user.email,\n    );\n    user.twoFactorSecret = secret;\n    user.isMfaEnabled = false; // will be true after verification\n    await user.save();\n    return { secret, qrCode };\n  }\n}\n"],"version":3}
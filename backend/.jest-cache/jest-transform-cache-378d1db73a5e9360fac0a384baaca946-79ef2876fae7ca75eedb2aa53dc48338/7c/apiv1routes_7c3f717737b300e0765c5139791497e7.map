{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\api-v1.routes.ts","mappings":";;;;;AAAA,qCAAiC;AACjC,iEAAuE;AACvE,iEAAuD;AACvD,iGAAmE;AAGnE,oCAAiC;AACjC,4DAAmC;AACnC,8DAAqC;AACrC,0EAAiD;AACjD,gEAAuC;AACvC,sEAA6C;AAC7C,oEAA2C;AAC3C,oFAA0D;AAC1D,oEAA2C;AAC3C,sEAA6C;AAC7C,kEAAyC;AACzC,kEAAyC;AACzC,oEAA2C;AAC3C,qDAAiD;AACjD,sEAA6C;AAC7C,yEAA8D;AAC9D,iFAA6E;AAC7E,+EAAyE;AACzE,iFAAkE;AAClE,mEAA4D;AAC5D,oFAA0D;AAC1D,gEAAuC;AACvC,sFAA4D;AAC5D,kEAAyC;AACzC,4FAAkE;AAClE,oEAA2C;AAC3C,oEAA2C;AAC3C,8FAA6D;AAC7D,kFAAoD;AACpD,8DAAqC;AACrC,wEAA+C;AAC/C,8FAAoE;AAKpE,MAAM,WAAW,GAAG,IAAA,gBAAM,GAAE,CAAC;AAE7B,aAAa;AACb,WAAW,CAAC,GAAG,CAAC,8CAAqB,CAAC,CAAC;AACvC,WAAW,CAAC,GAAG,CAAC,+BAAU,CAAC,CAAC;AAE5B,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;AAE3C,eAAe;AACf,WAAW,CAAC,GAAG,CAAC,OAAO,EAAE,qBAAU,CAAC,CAAC;AACrC,WAAW,CAAC,GAAG,CAAC,SAAS,EAAE,uBAAY,CAAC,CAAC;AACzC,WAAW,CAAC,GAAG,CAAC,WAAW,EAAE,wBAAa,CAAC,CAAC;AAC5C,WAAW,CAAC,GAAG,CAAC,QAAQ,EAAE,sBAAW,CAAC,CAAC;AACvC,WAAW,CAAC,GAAG,CAAC,WAAW,EAAE,yBAAc,CAAC,CAAC;AAC7C,WAAW,CAAC,GAAG,CAAC,YAAY,EAAE,oCAAwB,CAAC,CAAC;AACxD,WAAW,CAAC,GAAG,CAAC,QAAQ,EAAE,sBAAW,CAAC,CAAC;AACvC,WAAW,CAAC,GAAG,CAAC,SAAS,EAAE,uBAAY,CAAC,CAAC;AACzC,WAAW,CAAC,GAAG,CAAC,SAAS,EAAE,uBAAY,CAAC,CAAC;AACzC,WAAW,CAAC,GAAG,CAAC,UAAU,EAAE,8BAAa,CAAC,CAAC;AAE3C,mBAAmB;AACnB,WAAW,CAAC,IAAI,CAAC,4BAA4B,EAAE,KAAK,EAAE,GAAQ,EAAE,GAAQ,EAAE,EAAE;IAC1E,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;IAChC,IAAI,CAAC;QACH,MAAM,WAAW,GAAG,4BAAS,CAAC,GAAG,CAA2B,aAAK,CAAC,wBAAwB,CAAC,CAAC;QAC5F,MAAM,MAAM,GAAG,MAAM,WAAW,CAAC,SAAS,EAAE,CAAC;QAC7C,GAAG,CAAC,IAAI,CAAC,IAAA,gCAAa,EAAC,MAAM,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;IAClD,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,6BAAU,EAAC,qBAAqB,EAAE,oBAAoB,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;IAChG,CAAC;AACH,CAAC,CAAC,CAAC;AAEH,WAAW,CAAC,GAAG,CAAC,yBAAyB,EAAE,KAAK,EAAE,GAAQ,EAAE,GAAQ,EAAE,EAAE;IACtE,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;IAChC,IAAI,CAAC;QACH,MAAM,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;QAC9B,MAAM,cAAc,GAAG,4BAAS,CAAC,GAAG,CAAiB,aAAK,CAAC,cAAc,CAAC,CAAC;QAC3E,MAAM,OAAO,GAAG,MAAM,cAAc,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QACxD,GAAG,CAAC,IAAI,CAAC,IAAA,gCAAa,EAAC,OAAO,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;IACnD,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,6BAAU,EAAC,uBAAuB,EAAE,gBAAgB,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;IAC9F,CAAC;AACH,CAAC,CAAC,CAAC;AAEH,oEAAoE;AACpE,oDAAoD;AAEpD,WAAW,CAAC,GAAG,CAAC,gBAAgB,EAAE,IAAA,mCAAU,EAAC,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE,CACnE,4BAAS,CAAC,GAAG,CAAkB,aAAK,CAAC,eAAe,CAAC,CAAC,eAAe,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,CACtF,CAAC;AACF,WAAW,CAAC,GAAG,CAAC,mBAAmB,EAAE,6BAAW,EAAE,IAAA,mCAAU,EAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE,CACpF,4BAAS,CAAC,GAAG,CAAoB,aAAK,CAAC,iBAAiB,CAAC,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,CAC7F,CAAC;AACF,WAAW,CAAC,IAAI,CAAC,mBAAmB,EAAE,6BAAW,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE,CACpE,4BAAS,CAAC,GAAG,CAAoB,aAAK,CAAC,iBAAiB,CAAC,CAAC,qBAAqB,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,CAChG,CAAC;AACF,WAAW,CAAC,IAAI,CAAC,iBAAiB,EAAE,6BAAW,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE,CAClE,4BAAS,CAAC,GAAG,CAAoB,aAAK,CAAC,iBAAiB,CAAC,CAAC,mBAAmB,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC,CAC9F,CAAC;AAEF,oBAAoB;AACpB,WAAW,CAAC,GAAG,CAAC,YAAY,EAAE,IAAA,mCAAU,EAAC,EAAE,CAAC,EAAE,0BAAe,CAAC,CAAC;AAC/D,WAAW,CAAC,GAAG,CAAC,iBAAiB,EAAE,+BAAmB,CAAC,CAAC;AACxD,WAAW,CAAC,GAAG,CAAC,UAAU,EAAE,wBAAa,CAAC,CAAC;AAC3C,WAAW,CAAC,GAAG,CAAC,KAAK,EAAE,0CAAkB,EAAE,mBAAQ,CAAC,CAAC;AACrD,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,oBAAS,CAAC,CAAC;AACnC,WAAW,CAAC,GAAG,CAAC,iBAAiB,EAAE,+BAAe,CAAC,CAAC;AAEpD,oBAAoB;AACpB,WAAW,CAAC,GAAG,CAAC,SAAS,EAAE,uBAAY,CAAC,CAAC;AACzC,WAAW,CAAC,GAAG,CAAC,SAAS,EAAE,uBAAY,CAAC,CAAC;AACzC,WAAW,CAAC,GAAG,CAAC,OAAO,EAAE,qBAAU,CAAC,CAAC;AACrC,WAAW,CAAC,GAAG,CAAC,qBAAqB,EAAE,mCAAuB,CAAC,CAAC;AAChE,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,oBAAS,CAAC,CAAC;AACnC,WAAW,CAAC,GAAG,CAAC,kBAAkB,EAAE,gCAAoB,CAAC,CAAC;AAC1D,WAAW,CAAC,GAAG,CAAC,sBAAsB,EAAE,oCAAiB,CAAC,CAAC;AAC3D,WAAW,CAAC,GAAG,CAAC,WAAW,EAAE,8BAAc,CAAC,CAAC;AAC7C,WAAW,CAAC,GAAG,CAAC,iBAAiB,EAAE,+BAAmB,CAAC,CAAC;AACxD,WAAW,CAAC,GAAG,CAAC,QAAQ,EAAE,sBAAW,CAAC,CAAC;AACvC,WAAW,CAAC,GAAG,CAAC,WAAW,EAAE,wBAAa,CAAC,CAAC;AAE5C,kBAAe,WAAW,CAAC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\api-v1.routes.ts"],"sourcesContent":["import { Router } from 'express';\nimport { buildError, buildResponse } from '../common/response-builder';\nimport { container } from '../config/inversify.config';\nimport exitEmailRouter from '../controllers/exit-email.controller';\nimport { CredentialManagerService } from '../services/credential-manager.service';\nimport { HistoryService } from '../services/history.service';\nimport { TYPES } from '../types';\nimport aiRouter from './ai.routes';\nimport ragRoutes from './rag.routes';\nimport analyticsRouter from './analytics.routes';\nimport authRouter from './auth.routes';\nimport danielaRouter from './daniela.routes';\nimport dockerRouter from './docker.routes';\nimport enhancedVoiceRouter from './enhanced-voice.routes';\nimport healthRouter from './health.routes';\nimport personaRouter from './persona.routes';\nimport swarmRouter from './swarm.routes';\nimport usersRouter from './users.routes';\nimport stripeRouter from './stripe.routes';\nimport { youtubeRouter } from './youtube.routes';\nimport godmodeRoutes from './godmode.routes';\nimport { apiKeyAuth } from '../middleware/api-key.middleware';\nimport { idempotencyMiddleware } from '../middleware/idempotency.middleware';\nimport { dynamicRateLimiter } from '../middleware/rate-limit.middleware';\nimport { redisCache } from '../middleware/redis-cache.middleware';\nimport { requireAuth } from '../middleware/auth.middleware';\nimport devicePostureRouter from './device-posture.routes';\nimport logsRouter from './logs.routes';\nimport malwareScannerRouter from './malware-scanner.routes';\nimport nexusRouter from './nexus.routes';\nimport securityDashboardRouter from './security-dashboard.routes';\nimport socialRouter from './social.routes';\nimport systemRouter from './system.routes';\nimport threatIntelRouter from './threat-intelligence.routes';\nimport behaviorRouter from './user-behavior.routes';\nimport wafRouter from './waf.routes';\nimport webauthnRouter from './webauthn.routes';\nimport sovereignHandshakeRouter from './sovereign-handshake.routes';\nimport { setupSwagger } from '../docs/swagger';\nimport { BillingController } from '../controllers/billing.controller';\nimport { UsageController } from '../controllers/usage.controller';\n\nconst apiV1Router = Router();\n\n// Middleware\napiV1Router.use(idempotencyMiddleware);\napiV1Router.use(apiKeyAuth);\n\nconsole.log('DEBUG: API V1 router loaded');\n\n// Mount Routes\napiV1Router.use('/auth', authRouter);\napiV1Router.use('/docker', dockerRouter);\napiV1Router.use('/personas', personaRouter);\napiV1Router.use('/swarm', swarmRouter);\napiV1Router.use('/webauthn', webauthnRouter);\napiV1Router.use('/sovereign', sovereignHandshakeRouter);\napiV1Router.use('/users', usersRouter);\napiV1Router.use('/health', healthRouter);\napiV1Router.use('/stripe', stripeRouter);\napiV1Router.use('/youtube', youtubeRouter);\n\n// System Endpoints\napiV1Router.post('/system/credentials/verify', async (req: any, res: any) => {\n  const requestId = req.requestId;\n  try {\n    const credManager = container.get<CredentialManagerService>(TYPES.CredentialManagerService);\n    const report = await credManager.verifyAll();\n    res.json(buildResponse(report, 200, requestId));\n  } catch (err) {\n    res.status(500).json(buildError('Verification failed', 'VERIFICATION_ERROR', 500, requestId));\n  }\n});\n\napiV1Router.get('/system/history/:metric', async (req: any, res: any) => {\n  const requestId = req.requestId;\n  try {\n    const { metric } = req.params;\n    const historyService = container.get<HistoryService>(TYPES.HistoryService);\n    const history = await historyService.getHistory(metric);\n    res.json(buildResponse(history, 200, requestId));\n  } catch (err) {\n    res.status(500).json(buildError('Internal server error', 'INTERNAL_ERROR', 500, requestId));\n  }\n});\n\n// Controllers - resolved lazily to avoid circular dependency issues\n// Controller resolution moved inside route handlers\n\napiV1Router.get('/usage/current', redisCache(60), (req, res, next) =>\n  container.get<UsageController>(TYPES.UsageController).getCurrentUsage(req, res, next),\n);\napiV1Router.get('/billing/snapshot', requireAuth, redisCache(300), (req, res, next) =>\n  container.get<BillingController>(TYPES.BillingController).getBillingSnapshot(req, res, next),\n);\napiV1Router.post('/billing/checkout', requireAuth, (req, res, next) =>\n  container.get<BillingController>(TYPES.BillingController).createCheckoutSession(req, res, next),\n);\napiV1Router.post('/billing/portal', requireAuth, (req, res, next) =>\n  container.get<BillingController>(TYPES.BillingController).createPortalSession(req, res, next),\n);\n\n// Monitoring and AI\napiV1Router.use('/analytics', redisCache(30), analyticsRouter);\napiV1Router.use('/enhanced-voice', enhancedVoiceRouter);\napiV1Router.use('/daniela', danielaRouter);\napiV1Router.use('/ai', dynamicRateLimiter, aiRouter);\napiV1Router.use('/rag', ragRoutes);\napiV1Router.use('/exit-templates', exitEmailRouter);\n\n// System Management\napiV1Router.use('/system', systemRouter);\napiV1Router.use('/social', socialRouter);\napiV1Router.use('/logs', logsRouter);\napiV1Router.use('/security-dashboard', securityDashboardRouter);\napiV1Router.use('/waf', wafRouter);\napiV1Router.use('/malware-scanner', malwareScannerRouter);\napiV1Router.use('/threat-intelligence', threatIntelRouter);\napiV1Router.use('/behavior', behaviorRouter);\napiV1Router.use('/device-posture', devicePostureRouter);\napiV1Router.use('/nexus', nexusRouter);\napiV1Router.use('/god-mode', godmodeRoutes);\n\nexport default apiV1Router;\n"],"version":3}
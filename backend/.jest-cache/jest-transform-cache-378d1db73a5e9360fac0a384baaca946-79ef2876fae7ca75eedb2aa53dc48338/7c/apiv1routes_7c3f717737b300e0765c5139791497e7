d66078c456dd23599022a17640ac82ac
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const response_builder_1 = require("../common/response-builder");
const inversify_config_1 = require("../config/inversify.config");
const exit_email_controller_1 = __importDefault(require("../controllers/exit-email.controller"));
const types_1 = require("../types");
const ai_routes_1 = __importDefault(require("./ai.routes"));
const rag_routes_1 = __importDefault(require("./rag.routes"));
const analytics_routes_1 = __importDefault(require("./analytics.routes"));
const auth_routes_1 = __importDefault(require("./auth.routes"));
const daniela_routes_1 = __importDefault(require("./daniela.routes"));
const docker_routes_1 = __importDefault(require("./docker.routes"));
const enhanced_voice_routes_1 = __importDefault(require("./enhanced-voice.routes"));
const health_routes_1 = __importDefault(require("./health.routes"));
const persona_routes_1 = __importDefault(require("./persona.routes"));
const swarm_routes_1 = __importDefault(require("./swarm.routes"));
const users_routes_1 = __importDefault(require("./users.routes"));
const stripe_routes_1 = __importDefault(require("./stripe.routes"));
const youtube_routes_1 = require("./youtube.routes");
const godmode_routes_1 = __importDefault(require("./godmode.routes"));
const api_key_middleware_1 = require("../middleware/api-key.middleware");
const idempotency_middleware_1 = require("../middleware/idempotency.middleware");
const rate_limit_middleware_1 = require("../middleware/rate-limit.middleware");
const redis_cache_middleware_1 = require("../middleware/redis-cache.middleware");
const auth_middleware_1 = require("../middleware/auth.middleware");
const device_posture_routes_1 = __importDefault(require("./device-posture.routes"));
const logs_routes_1 = __importDefault(require("./logs.routes"));
const malware_scanner_routes_1 = __importDefault(require("./malware-scanner.routes"));
const nexus_routes_1 = __importDefault(require("./nexus.routes"));
const security_dashboard_routes_1 = __importDefault(require("./security-dashboard.routes"));
const social_routes_1 = __importDefault(require("./social.routes"));
const system_routes_1 = __importDefault(require("./system.routes"));
const threat_intelligence_routes_1 = __importDefault(require("./threat-intelligence.routes"));
const user_behavior_routes_1 = __importDefault(require("./user-behavior.routes"));
const waf_routes_1 = __importDefault(require("./waf.routes"));
const webauthn_routes_1 = __importDefault(require("./webauthn.routes"));
const sovereign_handshake_routes_1 = __importDefault(require("./sovereign-handshake.routes"));
const apiV1Router = (0, express_1.Router)();
// Middleware
apiV1Router.use(idempotency_middleware_1.idempotencyMiddleware);
apiV1Router.use(api_key_middleware_1.apiKeyAuth);
console.log('DEBUG: API V1 router loaded');
// Mount Routes
apiV1Router.use('/auth', auth_routes_1.default);
apiV1Router.use('/docker', docker_routes_1.default);
apiV1Router.use('/personas', persona_routes_1.default);
apiV1Router.use('/swarm', swarm_routes_1.default);
apiV1Router.use('/webauthn', webauthn_routes_1.default);
apiV1Router.use('/sovereign', sovereign_handshake_routes_1.default);
apiV1Router.use('/users', users_routes_1.default);
apiV1Router.use('/health', health_routes_1.default);
apiV1Router.use('/stripe', stripe_routes_1.default);
apiV1Router.use('/youtube', youtube_routes_1.youtubeRouter);
// System Endpoints
apiV1Router.post('/system/credentials/verify', async (req, res) => {
    const requestId = req.requestId;
    try {
        const credManager = inversify_config_1.container.get(types_1.TYPES.CredentialManagerService);
        const report = await credManager.verifyAll();
        res.json((0, response_builder_1.buildResponse)(report, 200, requestId));
    }
    catch (err) {
        res.status(500).json((0, response_builder_1.buildError)('Verification failed', 'VERIFICATION_ERROR', 500, requestId));
    }
});
apiV1Router.get('/system/history/:metric', async (req, res) => {
    const requestId = req.requestId;
    try {
        const { metric } = req.params;
        const historyService = inversify_config_1.container.get(types_1.TYPES.HistoryService);
        const history = await historyService.getHistory(metric);
        res.json((0, response_builder_1.buildResponse)(history, 200, requestId));
    }
    catch (err) {
        res.status(500).json((0, response_builder_1.buildError)('Internal server error', 'INTERNAL_ERROR', 500, requestId));
    }
});
// Controllers - resolved lazily to avoid circular dependency issues
// Controller resolution moved inside route handlers
apiV1Router.get('/usage/current', (0, redis_cache_middleware_1.redisCache)(60), (req, res, next) => inversify_config_1.container.get(types_1.TYPES.UsageController).getCurrentUsage(req, res, next));
apiV1Router.get('/billing/snapshot', auth_middleware_1.requireAuth, (0, redis_cache_middleware_1.redisCache)(300), (req, res, next) => inversify_config_1.container.get(types_1.TYPES.BillingController).getBillingSnapshot(req, res, next));
apiV1Router.post('/billing/checkout', auth_middleware_1.requireAuth, (req, res, next) => inversify_config_1.container.get(types_1.TYPES.BillingController).createCheckoutSession(req, res, next));
apiV1Router.post('/billing/portal', auth_middleware_1.requireAuth, (req, res, next) => inversify_config_1.container.get(types_1.TYPES.BillingController).createPortalSession(req, res, next));
// Monitoring and AI
apiV1Router.use('/analytics', (0, redis_cache_middleware_1.redisCache)(30), analytics_routes_1.default);
apiV1Router.use('/enhanced-voice', enhanced_voice_routes_1.default);
apiV1Router.use('/daniela', daniela_routes_1.default);
apiV1Router.use('/ai', rate_limit_middleware_1.dynamicRateLimiter, ai_routes_1.default);
apiV1Router.use('/rag', rag_routes_1.default);
apiV1Router.use('/exit-templates', exit_email_controller_1.default);
// System Management
apiV1Router.use('/system', system_routes_1.default);
apiV1Router.use('/social', social_routes_1.default);
apiV1Router.use('/logs', logs_routes_1.default);
apiV1Router.use('/security-dashboard', security_dashboard_routes_1.default);
apiV1Router.use('/waf', waf_routes_1.default);
apiV1Router.use('/malware-scanner', malware_scanner_routes_1.default);
apiV1Router.use('/threat-intelligence', threat_intelligence_routes_1.default);
apiV1Router.use('/behavior', user_behavior_routes_1.default);
apiV1Router.use('/device-posture', device_posture_routes_1.default);
apiV1Router.use('/nexus', nexus_routes_1.default);
apiV1Router.use('/god-mode', godmode_routes_1.default);
exports.default = apiV1Router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXGFwaS12MS5yb3V0ZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxxQ0FBaUM7QUFDakMsaUVBQXVFO0FBQ3ZFLGlFQUF1RDtBQUN2RCxpR0FBbUU7QUFHbkUsb0NBQWlDO0FBQ2pDLDREQUFtQztBQUNuQyw4REFBcUM7QUFDckMsMEVBQWlEO0FBQ2pELGdFQUF1QztBQUN2QyxzRUFBNkM7QUFDN0Msb0VBQTJDO0FBQzNDLG9GQUEwRDtBQUMxRCxvRUFBMkM7QUFDM0Msc0VBQTZDO0FBQzdDLGtFQUF5QztBQUN6QyxrRUFBeUM7QUFDekMsb0VBQTJDO0FBQzNDLHFEQUFpRDtBQUNqRCxzRUFBNkM7QUFDN0MseUVBQThEO0FBQzlELGlGQUE2RTtBQUM3RSwrRUFBeUU7QUFDekUsaUZBQWtFO0FBQ2xFLG1FQUE0RDtBQUM1RCxvRkFBMEQ7QUFDMUQsZ0VBQXVDO0FBQ3ZDLHNGQUE0RDtBQUM1RCxrRUFBeUM7QUFDekMsNEZBQWtFO0FBQ2xFLG9FQUEyQztBQUMzQyxvRUFBMkM7QUFDM0MsOEZBQTZEO0FBQzdELGtGQUFvRDtBQUNwRCw4REFBcUM7QUFDckMsd0VBQStDO0FBQy9DLDhGQUFvRTtBQUtwRSxNQUFNLFdBQVcsR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUU3QixhQUFhO0FBQ2IsV0FBVyxDQUFDLEdBQUcsQ0FBQyw4Q0FBcUIsQ0FBQyxDQUFDO0FBQ3ZDLFdBQVcsQ0FBQyxHQUFHLENBQUMsK0JBQVUsQ0FBQyxDQUFDO0FBRTVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQztBQUUzQyxlQUFlO0FBQ2YsV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUscUJBQVUsQ0FBQyxDQUFDO0FBQ3JDLFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLHVCQUFZLENBQUMsQ0FBQztBQUN6QyxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSx3QkFB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QkFBZSxDQUFDLENBQUM7QUFFcEQsb0JBQW9CO0FBQ3BCLFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLHVCQUFZLENBQUMsQ0FBQztBQUN6QyxXQUFXLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSx1QkFBWSxDQUFDLENBQUM7QUFDekMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUscUJBQVUsQ0FBQyxDQUFDO0FBQ3JDLFdBQVcsQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsbUNBQXVCLENBQUMsQ0FBQztBQUNoRSxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxvQkFBUyxDQUFDLENBQUM7QUFDbkMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxnQ0FBb0IsQ0FBQyxDQUFDO0FBQzFELFdBQVcsQ0FBQyxHQUFHLENBQUMsc0JBQXNCLEVBQUUsb0NBQWlCLENBQUMsQ0FBQztBQUMzRCxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSw4QkFBYyxDQUFDLENBQUM7QUFDN0MsV0FBVyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSwrQkFBbUIsQ0FBQyxDQUFDO0FBQ3hELFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLHNCQUFXLENBQUMsQ0FBQztBQUN2QyxXQUFXLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSx3QkFBYSxDQUFDLENBQUM7QUFFNUMsa0JBQWUsV0FBVyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWxlamFuZHJvXFxBSUdlc3Rpb25cXGJhY2tlbmRcXHNyY1xccm91dGVzXFxhcGktdjEucm91dGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgYnVpbGRFcnJvciwgYnVpbGRSZXNwb25zZSB9IGZyb20gJy4uL2NvbW1vbi9yZXNwb25zZS1idWlsZGVyJztcbmltcG9ydCB7IGNvbnRhaW5lciB9IGZyb20gJy4uL2NvbmZpZy9pbnZlcnNpZnkuY29uZmlnJztcbmltcG9ydCBleGl0RW1haWxSb3V0ZXIgZnJvbSAnLi4vY29udHJvbGxlcnMvZXhpdC1lbWFpbC5jb250cm9sbGVyJztcbmltcG9ydCB7IENyZWRlbnRpYWxNYW5hZ2VyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NyZWRlbnRpYWwtbWFuYWdlci5zZXJ2aWNlJztcbmltcG9ydCB7IEhpc3RvcnlTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaGlzdG9yeS5zZXJ2aWNlJztcbmltcG9ydCB7IFRZUEVTIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IGFpUm91dGVyIGZyb20gJy4vYWkucm91dGVzJztcbmltcG9ydCByYWdSb3V0ZXMgZnJvbSAnLi9yYWcucm91dGVzJztcbmltcG9ydCBhbmFseXRpY3NSb3V0ZXIgZnJvbSAnLi9hbmFseXRpY3Mucm91dGVzJztcbmltcG9ydCBhdXRoUm91dGVyIGZyb20gJy4vYXV0aC5yb3V0ZXMnO1xuaW1wb3J0IGRhbmllbGFSb3V0ZXIgZnJvbSAnLi9kYW5pZWxhLnJvdXRlcyc7XG5pbXBvcnQgZG9ja2VyUm91dGVyIGZyb20gJy4vZG9ja2VyLnJvdXRlcyc7XG5pbXBvcnQgZW5oYW5jZWRWb2ljZVJvdXRlciBmcm9tICcuL2VuaGFuY2VkLXZvaWNlLnJvdXRlcyc7XG5pbXBvcnQgaGVhbHRoUm91dGVyIGZyb20gJy4vaGVhbHRoLnJvdXRlcyc7XG5pbXBvcnQgcGVyc29uYVJvdXRlciBmcm9tICcuL3BlcnNvbmEucm91dGVzJztcbmltcG9ydCBzd2FybVJvdXRlciBmcm9tICcuL3N3YXJtLnJvdXRlcyc7XG5pbXBvcnQgdXNlcnNSb3V0ZXIgZnJvbSAnLi91c2Vycy5yb3V0ZXMnO1xuaW1wb3J0IHN0cmlwZVJvdXRlciBmcm9tICcuL3N0cmlwZS5yb3V0ZXMnO1xuaW1wb3J0IHsgeW91dHViZVJvdXRlciB9IGZyb20gJy4veW91dHViZS5yb3V0ZXMnO1xuaW1wb3J0IGdvZG1vZGVSb3V0ZXMgZnJvbSAnLi9nb2Rtb2RlLnJvdXRlcyc7XG5pbXBvcnQgeyBhcGlLZXlBdXRoIH0gZnJvbSAnLi4vbWlkZGxld2FyZS9hcGkta2V5Lm1pZGRsZXdhcmUnO1xuaW1wb3J0IHsgaWRlbXBvdGVuY3lNaWRkbGV3YXJlIH0gZnJvbSAnLi4vbWlkZGxld2FyZS9pZGVtcG90ZW5jeS5taWRkbGV3YXJlJztcbmltcG9ydCB7IGR5bmFtaWNSYXRlTGltaXRlciB9IGZyb20gJy4uL21pZGRsZXdhcmUvcmF0ZS1saW1pdC5taWRkbGV3YXJlJztcbmltcG9ydCB7IHJlZGlzQ2FjaGUgfSBmcm9tICcuLi9taWRkbGV3YXJlL3JlZGlzLWNhY2hlLm1pZGRsZXdhcmUnO1xuaW1wb3J0IHsgcmVxdWlyZUF1dGggfSBmcm9tICcuLi9taWRkbGV3YXJlL2F1dGgubWlkZGxld2FyZSc7XG5pbXBvcnQgZGV2aWNlUG9zdHVyZVJvdXRlciBmcm9tICcuL2RldmljZS1wb3N0dXJlLnJvdXRlcyc7XG5pbXBvcnQgbG9nc1JvdXRlciBmcm9tICcuL2xvZ3Mucm91dGVzJztcbmltcG9ydCBtYWx3YXJlU2Nhbm5lclJvdXRlciBmcm9tICcuL21hbHdhcmUtc2Nhbm5lci5yb3V0ZXMnO1xuaW1wb3J0IG5leHVzUm91dGVyIGZyb20gJy4vbmV4dXMucm91dGVzJztcbmltcG9ydCBzZWN1cml0eURhc2hib2FyZFJvdXRlciBmcm9tICcuL3NlY3VyaXR5LWRhc2hib2FyZC5yb3V0ZXMnO1xuaW1wb3J0IHNvY2lhbFJvdXRlciBmcm9tICcuL3NvY2lhbC5yb3V0ZXMnO1xuaW1wb3J0IHN5c3RlbVJvdXRlciBmcm9tICcuL3N5c3RlbS5yb3V0ZXMnO1xuaW1wb3J0IHRocmVhdEludGVsUm91dGVyIGZyb20gJy4vdGhyZWF0LWludGVsbGlnZW5jZS5yb3V0ZXMnO1xuaW1wb3J0IGJlaGF2aW9yUm91dGVyIGZyb20gJy4vdXNlci1iZWhhdmlvci5yb3V0ZXMnO1xuaW1wb3J0IHdhZlJvdXRlciBmcm9tICcuL3dhZi5yb3V0ZXMnO1xuaW1wb3J0IHdlYmF1dGhuUm91dGVyIGZyb20gJy4vd2ViYXV0aG4ucm91dGVzJztcbmltcG9ydCBzb3ZlcmVpZ25IYW5kc2hha2VSb3V0ZXIgZnJvbSAnLi9zb3ZlcmVpZ24taGFuZHNoYWtlLnJvdXRlcyc7XG5pbXBvcnQgeyBzZXR1cFN3YWdnZXIgfSBmcm9tICcuLi9kb2NzL3N3YWdnZXInO1xuaW1wb3J0IHsgQmlsbGluZ0NvbnRyb2xsZXIgfSBmcm9tICcuLi9jb250cm9sbGVycy9iaWxsaW5nLmNvbnRyb2xsZXInO1xuaW1wb3J0IHsgVXNhZ2VDb250cm9sbGVyIH0gZnJvbSAnLi4vY29udHJvbGxlcnMvdXNhZ2UuY29udHJvbGxlcic7XG5cbmNvbnN0IGFwaVYxUm91dGVyID0gUm91dGVyKCk7XG5cbi8vIE1pZGRsZXdhcmVcbmFwaVYxUm91dGVyLnVzZShpZGVtcG90ZW5jeU1pZGRsZXdhcmUpO1xuYXBpVjFSb3V0ZXIudXNlKGFwaUtleUF1dGgpO1xuXG5jb25zb2xlLmxvZygnREVCVUc6IEFQSSBWMSByb3V0ZXIgbG9hZGVkJyk7XG5cbi8vIE1vdW50IFJvdXRlc1xuYXBpVjFSb3V0ZXIudXNlKCcvYXV0aCcsIGF1dGhSb3V0ZXIpO1xuYXBpVjFSb3V0ZXIudXNlKCcvZG9ja2VyJywgZG9ja2VyUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL3BlcnNvbmFzJywgcGVyc29uYVJvdXRlcik7XG5hcGlWMVJvdXRlci51c2UoJy9zd2FybScsIHN3YXJtUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL3dlYmF1dGhuJywgd2ViYXV0aG5Sb3V0ZXIpO1xuYXBpVjFSb3V0ZXIudXNlKCcvc292ZXJlaWduJywgc292ZXJlaWduSGFuZHNoYWtlUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL3VzZXJzJywgdXNlcnNSb3V0ZXIpO1xuYXBpVjFSb3V0ZXIudXNlKCcvaGVhbHRoJywgaGVhbHRoUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL3N0cmlwZScsIHN0cmlwZVJvdXRlcik7XG5hcGlWMVJvdXRlci51c2UoJy95b3V0dWJlJywgeW91dHViZVJvdXRlcik7XG5cbi8vIFN5c3RlbSBFbmRwb2ludHNcbmFwaVYxUm91dGVyLnBvc3QoJy9zeXN0ZW0vY3JlZGVudGlhbHMvdmVyaWZ5JywgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICBjb25zdCByZXF1ZXN0SWQgPSByZXEucmVxdWVzdElkO1xuICB0cnkge1xuICAgIGNvbnN0IGNyZWRNYW5hZ2VyID0gY29udGFpbmVyLmdldDxDcmVkZW50aWFsTWFuYWdlclNlcnZpY2U+KFRZUEVTLkNyZWRlbnRpYWxNYW5hZ2VyU2VydmljZSk7XG4gICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgY3JlZE1hbmFnZXIudmVyaWZ5QWxsKCk7XG4gICAgcmVzLmpzb24oYnVpbGRSZXNwb25zZShyZXBvcnQsIDIwMCwgcmVxdWVzdElkKSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKGJ1aWxkRXJyb3IoJ1ZlcmlmaWNhdGlvbiBmYWlsZWQnLCAnVkVSSUZJQ0FUSU9OX0VSUk9SJywgNTAwLCByZXF1ZXN0SWQpKTtcbiAgfVxufSk7XG5cbmFwaVYxUm91dGVyLmdldCgnL3N5c3RlbS9oaXN0b3J5LzptZXRyaWMnLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gIGNvbnN0IHJlcXVlc3RJZCA9IHJlcS5yZXF1ZXN0SWQ7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBtZXRyaWMgfSA9IHJlcS5wYXJhbXM7XG4gICAgY29uc3QgaGlzdG9yeVNlcnZpY2UgPSBjb250YWluZXIuZ2V0PEhpc3RvcnlTZXJ2aWNlPihUWVBFUy5IaXN0b3J5U2VydmljZSk7XG4gICAgY29uc3QgaGlzdG9yeSA9IGF3YWl0IGhpc3RvcnlTZXJ2aWNlLmdldEhpc3RvcnkobWV0cmljKTtcbiAgICByZXMuanNvbihidWlsZFJlc3BvbnNlKGhpc3RvcnksIDIwMCwgcmVxdWVzdElkKSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKGJ1aWxkRXJyb3IoJ0ludGVybmFsIHNlcnZlciBlcnJvcicsICdJTlRFUk5BTF9FUlJPUicsIDUwMCwgcmVxdWVzdElkKSk7XG4gIH1cbn0pO1xuXG4vLyBDb250cm9sbGVycyAtIHJlc29sdmVkIGxhemlseSB0byBhdm9pZCBjaXJjdWxhciBkZXBlbmRlbmN5IGlzc3Vlc1xuLy8gQ29udHJvbGxlciByZXNvbHV0aW9uIG1vdmVkIGluc2lkZSByb3V0ZSBoYW5kbGVyc1xuXG5hcGlWMVJvdXRlci5nZXQoJy91c2FnZS9jdXJyZW50JywgcmVkaXNDYWNoZSg2MCksIChyZXEsIHJlcywgbmV4dCkgPT5cbiAgY29udGFpbmVyLmdldDxVc2FnZUNvbnRyb2xsZXI+KFRZUEVTLlVzYWdlQ29udHJvbGxlcikuZ2V0Q3VycmVudFVzYWdlKHJlcSwgcmVzLCBuZXh0KSxcbik7XG5hcGlWMVJvdXRlci5nZXQoJy9iaWxsaW5nL3NuYXBzaG90JywgcmVxdWlyZUF1dGgsIHJlZGlzQ2FjaGUoMzAwKSwgKHJlcSwgcmVzLCBuZXh0KSA9PlxuICBjb250YWluZXIuZ2V0PEJpbGxpbmdDb250cm9sbGVyPihUWVBFUy5CaWxsaW5nQ29udHJvbGxlcikuZ2V0QmlsbGluZ1NuYXBzaG90KHJlcSwgcmVzLCBuZXh0KSxcbik7XG5hcGlWMVJvdXRlci5wb3N0KCcvYmlsbGluZy9jaGVja291dCcsIHJlcXVpcmVBdXRoLCAocmVxLCByZXMsIG5leHQpID0+XG4gIGNvbnRhaW5lci5nZXQ8QmlsbGluZ0NvbnRyb2xsZXI+KFRZUEVTLkJpbGxpbmdDb250cm9sbGVyKS5jcmVhdGVDaGVja291dFNlc3Npb24ocmVxLCByZXMsIG5leHQpLFxuKTtcbmFwaVYxUm91dGVyLnBvc3QoJy9iaWxsaW5nL3BvcnRhbCcsIHJlcXVpcmVBdXRoLCAocmVxLCByZXMsIG5leHQpID0+XG4gIGNvbnRhaW5lci5nZXQ8QmlsbGluZ0NvbnRyb2xsZXI+KFRZUEVTLkJpbGxpbmdDb250cm9sbGVyKS5jcmVhdGVQb3J0YWxTZXNzaW9uKHJlcSwgcmVzLCBuZXh0KSxcbik7XG5cbi8vIE1vbml0b3JpbmcgYW5kIEFJXG5hcGlWMVJvdXRlci51c2UoJy9hbmFseXRpY3MnLCByZWRpc0NhY2hlKDMwKSwgYW5hbHl0aWNzUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL2VuaGFuY2VkLXZvaWNlJywgZW5oYW5jZWRWb2ljZVJvdXRlcik7XG5hcGlWMVJvdXRlci51c2UoJy9kYW5pZWxhJywgZGFuaWVsYVJvdXRlcik7XG5hcGlWMVJvdXRlci51c2UoJy9haScsIGR5bmFtaWNSYXRlTGltaXRlciwgYWlSb3V0ZXIpO1xuYXBpVjFSb3V0ZXIudXNlKCcvcmFnJywgcmFnUm91dGVzKTtcbmFwaVYxUm91dGVyLnVzZSgnL2V4aXQtdGVtcGxhdGVzJywgZXhpdEVtYWlsUm91dGVyKTtcblxuLy8gU3lzdGVtIE1hbmFnZW1lbnRcbmFwaVYxUm91dGVyLnVzZSgnL3N5c3RlbScsIHN5c3RlbVJvdXRlcik7XG5hcGlWMVJvdXRlci51c2UoJy9zb2NpYWwnLCBzb2NpYWxSb3V0ZXIpO1xuYXBpVjFSb3V0ZXIudXNlKCcvbG9ncycsIGxvZ3NSb3V0ZXIpO1xuYXBpVjFSb3V0ZXIudXNlKCcvc2VjdXJpdHktZGFzaGJvYXJkJywgc2VjdXJpdHlEYXNoYm9hcmRSb3V0ZXIpO1xuYXBpVjFSb3V0ZXIudXNlKCcvd2FmJywgd2FmUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL21hbHdhcmUtc2Nhbm5lcicsIG1hbHdhcmVTY2FubmVyUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL3RocmVhdC1pbnRlbGxpZ2VuY2UnLCB0aHJlYXRJbnRlbFJvdXRlcik7XG5hcGlWMVJvdXRlci51c2UoJy9iZWhhdmlvcicsIGJlaGF2aW9yUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL2RldmljZS1wb3N0dXJlJywgZGV2aWNlUG9zdHVyZVJvdXRlcik7XG5hcGlWMVJvdXRlci51c2UoJy9uZXh1cycsIG5leHVzUm91dGVyKTtcbmFwaVYxUm91dGVyLnVzZSgnL2dvZC1tb2RlJywgZ29kbW9kZVJvdXRlcyk7XG5cbmV4cG9ydCBkZWZhdWx0IGFwaVYxUm91dGVyO1xuIl0sInZlcnNpb24iOjN9
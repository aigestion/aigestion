{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\knowledge-graph.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\knowledge-graph.service.ts"],"sourcesContent":["import { injectable } from 'inversify';\nimport { getRedisClient } from '../cache/redis';\nimport { logger } from '../utils/logger';\n\nexport interface GraphNode {\n  id: string;\n  type: 'user' | 'mission' | 'document' | 'concept';\n  label: string;\n}\n\nexport interface GraphEdge {\n  source: string;\n  target: string;\n  relation: 'owns' | 'created' | 'references' | 'similar_to';\n  weight: number;\n}\n\n@injectable()\nexport class KnowledgeGraphService {\n  private readonly GRAPH_KEY_PREFIX = 'kg:';\n\n  constructor() {}\n\n  /**\n   * Adds a node to the knowledge graph.\n   */\n  async addNode(node: GraphNode): Promise<void> {\n    const client = getRedisClient();\n    if (!client?.isOpen) return;\n\n    const key = `${this.GRAPH_KEY_PREFIX}node:${node.id}`;\n    await client.hSet(key, {\n      type: node.type,\n      label: node.label,\n    });\n  }\n\n  /**\n   * Creates a relationship (edge) between two nodes.\n   */\n  async addEdge(edge: GraphEdge): Promise<void> {\n    const client = getRedisClient();\n    if (!client?.isOpen) return;\n\n    // Adjacency list pattern in Redis Sets\n    const outKey = `${this.GRAPH_KEY_PREFIX}edges:out:${edge.source}`;\n    const inKey = `${this.GRAPH_KEY_PREFIX}edges:in:${edge.target}`;\n\n    const edgeData = JSON.stringify({\n      target: edge.target,\n      relation: edge.relation,\n      weight: edge.weight,\n    });\n\n    await Promise.all([\n      client.sAdd(outKey, edgeData),\n      client.sAdd(inKey, edge.source), // Simple back-ref\n    ]);\n\n    logger.info(`[KnowledgeGraph] Linked ${edge.source} -> ${edge.relation} -> ${edge.target}`);\n  }\n\n  /**\n   * Retrieves related nodes (e.g., finding documents related to a mission).\n   */\n  async getRelated(nodeId: string, relationType?: string): Promise<any[]> {\n    const client = getRedisClient();\n    if (!client?.isOpen) return [];\n\n    const outKey = `${this.GRAPH_KEY_PREFIX}edges:out:${nodeId}`;\n    const edges = await client.sMembers(outKey);\n\n    const related = edges\n      .map(e => JSON.parse(e))\n      .filter(e => !relationType || e.relation === relationType);\n\n    return related;\n  }\n\n  /**\n   * Finds the \"Knowledge Path\" between two concepts (Basic BFS).\n   * Useful for RAG to explain HOW two things are connected.\n   */\n  async findPath(startId: string, endId: string): Promise<string[]> {\n    // Implementation placeholder for BFS/DFS traversal\n    // In a real graph database (Neo4j) this is native.\n    // For Redis, we simulated it for immediate adjacencies.\n    const direct = await this.getRelated(startId);\n    const match = direct.find(d => d.target === endId);\n\n    return match ? [startId, match.relation, endId] : [];\n  }\n}\n"],"version":3}
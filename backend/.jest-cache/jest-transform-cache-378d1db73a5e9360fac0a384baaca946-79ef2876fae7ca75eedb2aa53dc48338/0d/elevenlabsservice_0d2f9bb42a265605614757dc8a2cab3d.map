{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\elevenlabs.service.ts","mappings":";;;;;;;;;;;;;;;AAAA,kDAA0B;AAC1B,yCAAuC;AACvC,qDAA2C;AAC3C,4CAAyC;AACzC,2DAA6B;AAC7B,gDAAwB;AAQjB,IAAM,iBAAiB,GAAvB,MAAM,iBAAiB;IACX,MAAM,CAAS;IACf,OAAO,GAAG,8BAA8B,CAAC;IAE1D;QACE,IAAI,CAAC,MAAM,GAAG,gBAAG,CAAC,kBAAkB,IAAI,EAAE,CAAC;IAC7C,CAAC;IAED;;;;;OAKG;IACH,KAAK,CAAC,YAAY,CAAC,IAAY,EAAE,OAAe,EAAE,UAAkB;QAClE,IAAI,CAAC;YACH,eAAM,CAAC,IAAI,CAAC,gDAAgD,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;YAEzF,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,IAAI,CAC/B,GAAG,IAAI,CAAC,OAAO,mBAAmB,OAAO,EAAE,EAC3C;gBACE,IAAI;gBACJ,QAAQ,EAAE,wBAAwB;gBAClC,cAAc,EAAE;oBACd,SAAS,EAAE,GAAG;oBACd,gBAAgB,EAAE,IAAI;iBACvB;aACF,EACD;gBACE,OAAO,EAAE;oBACP,YAAY,EAAE,IAAI,CAAC,MAAM;oBACzB,cAAc,EAAE,kBAAkB;iBACnC;gBACD,YAAY,EAAE,aAAa;aAC5B,CACF,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YAE1C,0BAA0B;YAC1B,MAAM,GAAG,GAAG,cAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;YACrC,MAAM,kBAAE,CAAC,KAAK,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;YAEzC,MAAM,kBAAE,CAAC,SAAS,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;YAEvC,eAAM,CAAC,IAAI,CAAC,uCAAuC,UAAU,EAAE,CAAC,CAAC;YACjE,OAAO,UAAU,CAAC;QACpB,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,eAAM,CAAC,KAAK,CACV,uCAAuC,EACvC,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,KAAK,CAAC,OAAO,CAClD,CAAC;YACF,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;QAC7D,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,SAAS;QACb,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,OAAO,SAAS,EAAE;gBACzD,OAAO,EAAE,EAAE,YAAY,EAAE,IAAI,CAAC,MAAM,EAAE;aACvC,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;QAC9B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,6CAA6C,EAAE,KAAK,CAAC,CAAC;YACnE,OAAO,EAAE,CAAC;QACZ,CAAC;IACH,CAAC;CACF,CAAA;AAtEY,8CAAiB;4BAAjB,iBAAiB;IAD7B,IAAA,sBAAU,GAAE;;GACA,iBAAiB,CAsE7B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\elevenlabs.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { injectable } from 'inversify';\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\nimport fs from 'fs/promises';\nimport path from 'path';\n\nexport interface VoiceSettings {\n  stability: number;\n  similarity_boost: number;\n}\n\n@injectable()\nexport class ElevenLabsService {\n  private readonly apiKey: string;\n  private readonly baseUrl = 'https://api.elevenlabs.io/v1';\n\n  constructor() {\n    this.apiKey = env.ELEVENLABS_API_KEY || '';\n  }\n\n  /**\n   * Generates audio from text and saves it to a file\n   * @param text The text to synthesize\n   * @param voiceId The ElevenLabs Voice ID\n   * @param outputPath Full path where the .mp3 will be saved\n   */\n  async textToSpeech(text: string, voiceId: string, outputPath: string): Promise<string> {\n    try {\n      logger.info(`[ElevenLabsService] Synthesizing voice for: \"${text.substring(0, 30)}...\"`);\n\n      const response = await axios.post(\n        `${this.baseUrl}/text-to-speech/${voiceId}`,\n        {\n          text,\n          model_id: 'eleven_multilingual_v2',\n          voice_settings: {\n            stability: 0.5,\n            similarity_boost: 0.75,\n          },\n        },\n        {\n          headers: {\n            'xi-api-key': this.apiKey,\n            'Content-Type': 'application/json',\n          },\n          responseType: 'arraybuffer',\n        },\n      );\n\n      const buffer = Buffer.from(response.data);\n\n      // Ensure directory exists\n      const dir = path.dirname(outputPath);\n      await fs.mkdir(dir, { recursive: true });\n\n      await fs.writeFile(outputPath, buffer);\n\n      logger.info(`[ElevenLabsService] Audio saved to: ${outputPath}`);\n      return outputPath;\n    } catch (error: any) {\n      logger.error(\n        '[ElevenLabsService] Synthesis failed:',\n        error.response?.data?.toString() || error.message,\n      );\n      throw new Error('Failed to generate high-fidelity voice.');\n    }\n  }\n\n  /**\n   * Retrieves available voices\n   */\n  async getVoices(): Promise<any[]> {\n    try {\n      const response = await axios.get(`${this.baseUrl}/voices`, {\n        headers: { 'xi-api-key': this.apiKey },\n      });\n      return response.data.voices;\n    } catch (error) {\n      logger.error('[ElevenLabsService] Failed to fetch voices:', error);\n      return [];\n    }\n  }\n}\n"],"version":3}
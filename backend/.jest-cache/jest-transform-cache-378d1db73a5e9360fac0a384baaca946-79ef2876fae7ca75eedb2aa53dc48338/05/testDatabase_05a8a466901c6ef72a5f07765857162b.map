{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\testDatabase.ts","mappings":";;;;;;AAAA,iEAA0D;AAC1D,wDAAgC;AAEhC,IAAI,WAA+D,CAAC;AACpE,IAAI,WAAW,GAAG,KAAK,CAAC;AAEjB,MAAM,kBAAkB,GAAG,KAAK,IAAmB,EAAE;IAC1D,IAAI,WAAW;QAAE,OAAO;IAExB,IAAI,CAAC;QACH,8CAA8C;QAC9C,WAAW,GAAG,MAAM,yCAAiB,CAAC,MAAM,EAAE,CAAC;QAC/C,MAAM,GAAG,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC;QAEjC,OAAO,CAAC,GAAG,CAAC,gDAAgD,GAAG,EAAE,CAAC,CAAC;QAEnE,MAAM,kBAAQ,CAAC,OAAO,CAAC,GAAG,EAAE;YAC1B,wBAAwB,EAAE,KAAK;YAC/B,gBAAgB,EAAE,KAAK;SACxB,CAAC,CAAC;QAEH,WAAW,GAAG,IAAI,CAAC;QACnB,OAAO,CAAC,GAAG,CAAC,sDAAsD,CAAC,CAAC;IACtE,CAAC;IAAC,OAAO,KAAU,EAAE,CAAC;QACpB,OAAO,CAAC,KAAK,CAAC,6CAA6C,EAAE,KAAK,CAAC,CAAC;QAEpE,+DAA+D;QAC/D,MAAM,WAAW,GAAG,+CAA+C,CAAC;QACpE,OAAO,CAAC,IAAI,CAAC,qCAAqC,WAAW,EAAE,CAAC,CAAC;QAEjE,IAAI,CAAC;YACH,MAAM,kBAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YACpC,WAAW,GAAG,IAAI,CAAC;QACrB,CAAC;QAAC,OAAO,aAAa,EAAE,CAAC;YACvB,OAAO,CAAC,KAAK,CAAC,4CAA4C,CAAC,CAAC;YAC5D,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;AACH,CAAC,CAAC;AAhCW,QAAA,kBAAkB,sBAgC7B;AAEK,MAAM,iBAAiB,GAAG,KAAK,IAAmB,EAAE;IACzD,IAAI,kBAAQ,CAAC,UAAU,CAAC,UAAU,KAAK,CAAC,EAAE,CAAC;QACzC,MAAM,kBAAQ,CAAC,UAAU,EAAE,CAAC;IAC9B,CAAC;IACD,IAAI,WAAW,EAAE,CAAC;QAChB,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;IAC3B,CAAC;IACD,WAAW,GAAG,KAAK,CAAC;IACpB,OAAO,CAAC,GAAG,CAAC,gDAAgD,CAAC,CAAC;AAChE,CAAC,CAAC;AATW,QAAA,iBAAiB,qBAS5B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\testDatabase.ts"],"sourcesContent":["import { MongoMemoryServer } from 'mongodb-memory-server';\nimport mongoose from 'mongoose';\n\nlet mongoServer: InstanceType<typeof MongoMemoryServer> | undefined;\nlet isConnected = false;\n\nexport const startInMemoryMongo = async (): Promise<void> => {\n  if (isConnected) return;\n\n  try {\n    // Create an actual in-memory MongoDB instance\n    mongoServer = await MongoMemoryServer.create();\n    const uri = mongoServer.getUri();\n\n    console.log(`üîß [TEST] Connecting to MongoMemoryServer at ${uri}`);\n\n    await mongoose.connect(uri, {\n      serverSelectionTimeoutMS: 15000,\n      connectTimeoutMS: 30000,\n    });\n\n    isConnected = true;\n    console.log('‚úÖ [TEST] Connected to MongoMemoryServer successfully');\n  } catch (error: any) {\n    console.error('‚ùå [TEST] Failed to start MongoMemoryServer:', error);\n\n    // Fallback if MongoMemoryServer fails (e.g., binaries missing)\n    const fallbackUri = 'mongodb://127.0.0.1:27017/aigestion-test-jest';\n    console.warn(`‚ö†Ô∏è [TEST] Using local fallback at ${fallbackUri}`);\n\n    try {\n      await mongoose.connect(fallbackUri);\n      isConnected = true;\n    } catch (fallbackError) {\n      console.error('‚ùå [TEST] Global MongoDB connection failure');\n      throw error;\n    }\n  }\n};\n\nexport const stopInMemoryMongo = async (): Promise<void> => {\n  if (mongoose.connection.readyState !== 0) {\n    await mongoose.disconnect();\n  }\n  if (mongoServer) {\n    await mongoServer.stop();\n  }\n  isConnected = false;\n  console.log('üîß [TEST] MongoDB connection and server closed');\n};\n"],"version":3}
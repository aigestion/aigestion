{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\logs.controller.ts","mappings":";;;;;AAQA,wBAmBC;AAKD,sCAuBC;AAKD,8BAUC;AApED,iEAAuE;AACvE,wDAAgC;AAEhC;;GAEG;AACI,KAAK,UAAU,MAAM,CAC1B,KAA0C,EAC1C,OAAe,EACf,QAAc,EACd,MAAM,GAAG,QAAQ;IAEjB,IAAI,CAAC;QACH,MAAM,GAAG,GAAG,MAAM,aAAG,CAAC,MAAM,CAAC;YAC3B,KAAK;YACL,OAAO;YACP,QAAQ;YACR,MAAM;YACN,SAAS,EAAE,IAAI,IAAI,EAAE;SACtB,CAAC,CAAC;QACH,OAAO,GAAG,CAAC;IACb,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAC;QACnD,OAAO,IAAI,CAAC;IACd,CAAC;AACH,CAAC;AAED;;GAEG;AACI,KAAK,UAAU,aAAa,CAAC,GAAY,EAAE,GAAa;IAC7D,IAAI,CAAC;QACH,MAAM,KAAK,GAAG,QAAQ,CAAE,GAAW,CAAC,KAAK,CAAC,KAAe,CAAC,IAAI,GAAG,CAAC;QAClE,MAAM,KAAK,GAAK,GAAW,CAAC,KAAK,CAAC,KAAgB,IAAI,MAAM,CAAC;QAC7D,MAAM,MAAM,GAAG,GAAG,CAAC,KAAK,CAAC,MAAgB,CAAC,CAAC,+BAA+B;QAE1E,MAAM,KAAK,GAAQ,EAAE,CAAC;QACtB,IAAI,KAAK,EAAE,CAAC;YACV,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;QACtB,CAAC;QACD,IAAI,MAAM,EAAE,CAAC;YACX,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;QACxB,CAAC;QAED,MAAM,IAAI,GAAG,MAAM,aAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAEvE,GAAW,CAAC,IAAI,CAAC,IAAA,gCAAa,EAAC,IAAI,EAAE,GAAG,EAAG,GAAW,CAAC,SAAS,CAAC,CAAC,CAAC;IACtE,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,qBAAqB,EAAE,KAAK,CAAC,CAAC;QAC3C,GAAW;aACT,MAAM,CAAC,GAAG,CAAC;aACX,IAAI,CAAC,IAAA,6BAAU,EAAC,sBAAsB,EAAE,YAAY,EAAE,GAAG,EAAG,GAAW,CAAC,SAAS,CAAC,CAAC,CAAC;IACzF,CAAC;AACH,CAAC;AAED;;GAEG;AACI,KAAK,UAAU,SAAS,CAAC,GAAY,EAAE,GAAa;IACzD,IAAI,CAAC;QACH,MAAM,aAAG,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;QACzB,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,cAAc,EAAE,CAAC,CAAC;IACvD,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,sBAAsB,EAAE,KAAK,CAAC,CAAC;QAC5C,GAAW;aACT,MAAM,CAAC,GAAG,CAAC;aACX,IAAI,CAAC,IAAA,6BAAU,EAAC,sBAAsB,EAAE,YAAY,EAAE,GAAG,EAAG,GAAW,CAAC,SAAS,CAAC,CAAC,CAAC;IACzF,CAAC;AACH,CAAC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\logs.controller.ts"],"sourcesContent":["import type { Request, Response } from 'express';\n\nimport { buildError, buildResponse } from '../common/response-builder';\nimport Log from '../models/Log';\n\n/**\n * Add a log entry (Internal use)\n */\nexport async function addLog(\n  level: 'info' | 'warn' | 'error' | 'debug',\n  message: string,\n  metadata?: any,\n  source = 'system',\n) {\n  try {\n    const log = await Log.create({\n      level,\n      message,\n      metadata,\n      source,\n      timestamp: new Date(),\n    });\n    return log;\n  } catch (error) {\n    console.error('Failed to write log to DB:', error);\n    return null;\n  }\n}\n\n/**\n * Get recent logs\n */\nexport async function getRecentLogs(req: Request, res: Response) {\n  try {\n    const limit = parseInt((req as any).query.limit as string) || 100;\n    const level = ((req as any).query.level as string) || 'info';\n    const source = req.query.source as string; // Keep this line from original\n\n    const query: any = {};\n    if (level) {\n      query.level = level;\n    }\n    if (source) {\n      query.source = source;\n    }\n\n    const logs = await Log.find(query).sort({ timestamp: -1 }).limit(limit);\n\n    (res as any).json(buildResponse(logs, 200, (req as any).requestId));\n  } catch (error) {\n    console.error('Error getting logs:', error);\n    (res as any)\n      .status(500)\n      .json(buildError('Failed to fetch logs', 'LOGS_ERROR', 500, (req as any).requestId));\n  }\n}\n\n/**\n * Clear logs (Admin only - ideally just drop collection or remove older)\n */\nexport async function clearLogs(req: Request, res: Response) {\n  try {\n    await Log.deleteMany({});\n    res.json({ success: true, message: 'Logs cleared' });\n  } catch (error) {\n    console.error('Error clearing logs:', error);\n    (res as any)\n      .status(500)\n      .json(buildError('Failed to clear logs', 'LOGS_ERROR', 500, (req as any).requestId));\n  }\n}\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\god-notification.service.ts","mappings":";;;;;;;;;;;;;;;;AAAA,yCAA+C;AAC/C,oCAAiC;AACjC,yDAAqD;AACrD,yDAAqD;AACrD,mDAA+C;AAC/C,4CAAyC;AACzC,qDAA2C;AAC3C,uEAAqE;AAG9D,IAAM,sBAAsB,GAA5B,MAAM,sBAAsB;IAEQ;IACA;IACH;IAHtC,YACyC,QAAyB,EACzB,QAAyB,EAC5B,KAAmB;QAFhB,aAAQ,GAAR,QAAQ,CAAiB;QACzB,aAAQ,GAAR,QAAQ,CAAiB;QAC5B,UAAK,GAAL,KAAK,CAAc;IACtD,CAAC;IAEJ;;OAEG;IACH,KAAK,CAAC,iBAAiB,CACrB,KAAa,EACb,OAAe,EACf,UAAqC,QAAQ;QAE7C,MAAM,gBAAgB,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;QAErE,eAAM,CAAC,IAAI,CAAC,gDAAgD,KAAK,KAAK,OAAO,GAAG,CAAC,CAAC;QAElF,MAAM,KAAK,GAAmB,EAAE,CAAC;QAEjC,0BAA0B;QAC1B,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,gBAAgB,CAAC,CAAC,CAAC;QAExD,yCAAyC;QACzC,IAAI,OAAO,KAAK,MAAM,IAAI,gBAAG,CAAC,qBAAqB,EAAE,CAAC;YACpD,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,gBAAG,CAAC,qBAAqB,EAAE,gBAAgB,CAAC,CAAC,CAAC;QACrF,CAAC;QAED,2BAA2B;QAC3B,IAAI,OAAO,KAAK,KAAK,EAAE,CAAC;YACtB,MAAM,OAAO,GAAG,gBAAG,CAAC,UAAU,IAAI,mBAAmB,CAAC;YACtD,MAAM,YAAY,GAAG,IAAI,kCAAgB,CAAC,KAAK,WAAW,KAAK,EAAE,CAAC;YAClE,MAAM,SAAS,GAAG,yDAAyD,gBAAgB,QAAQ,CAAC;YAEpG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,OAAO,EAAE,YAAY,EAAE,SAAS,CAAC,CAAC,CAAC;QACrE,CAAC;QAED,MAAM,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;IAClC,CAAC;IAED;;OAEG;IACK,aAAa,CAAC,KAAa,EAAE,OAAe,EAAE,OAAe;QACnE,MAAM,IAAI,GAAG,OAAO,KAAK,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,KAAK,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC;QAC3E,OAAO;EACT,IAAI,KAAK,KAAK,CAAC,WAAW,EAAE;;EAE5B,OAAO;;;EAGP,kCAAgB,CAAC,IAAI,MAAM,kCAAgB,CAAC,KAAK;EACjD,kCAAgB,CAAC,KAAK;KACnB,CAAC,IAAI,EAAE,CAAC;IACX,CAAC;CACF,CAAA;AAxDY,wDAAsB;iCAAtB,sBAAsB;IADlC,IAAA,sBAAU,GAAE;IAGR,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,eAAe,CAAC,CAAA;IAC7B,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,eAAe,CAAC,CAAA;IAC7B,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,YAAY,CAAC,CAAA;yDAFsB,kCAAe,oBAAf,kCAAe,oDACf,kCAAe,oBAAf,kCAAe,oDACrB,4BAAY,oBAAZ,4BAAY;GAJ9C,sBAAsB,CAwDlC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\god-notification.service.ts"],"sourcesContent":["import { injectable, inject } from 'inversify';\nimport { TYPES } from '../types';\nimport { TelegramService } from './telegram.service';\nimport { WhatsAppService } from './whatsapp.service';\nimport { EmailService } from './email.service';\nimport { logger } from '../utils/logger';\nimport { env } from '../config/env.schema';\nimport { DANIELA_IDENTITY } from '../config/prompts/daniela.persona';\n\n@injectable()\nexport class GodNotificationService {\n  constructor(\n    @inject(TYPES.TelegramService) private telegram: TelegramService,\n    @inject(TYPES.WhatsAppService) private whatsapp: WhatsAppService,\n    @inject(TYPES.EmailService) private email: EmailService,\n  ) {}\n\n  /**\n   * Sends a high-priority alert through all enabled sovereign channels.\n   */\n  async broadcastGodAlert(\n    title: string,\n    message: string,\n    urgency: 'low' | 'medium' | 'high' = 'medium',\n  ) {\n    const formattedMessage = this.formatMessage(title, message, urgency);\n\n    logger.info(`[GodNotificationService] Broadcasting alert: ${title} (${urgency})`);\n\n    const tasks: Promise<any>[] = [];\n\n    // 1. Telegram (Immediate)\n    tasks.push(this.telegram.sendMessage(formattedMessage));\n\n    // 2. WhatsApp (Direct, for high urgency)\n    if (urgency === 'high' && env.WHATSAPP_PHONE_NUMBER) {\n      tasks.push(this.whatsapp.sendMessage(env.WHATSAPP_PHONE_NUMBER, formattedMessage));\n    }\n\n    // 3. Email (Formal record)\n    if (urgency !== 'low') {\n      const emailTo = env.EMAIL_FROM || 'admin@nexusv1.net';\n      const emailSubject = `[${DANIELA_IDENTITY.brand} ALERT] ${title}`;\n      const emailHtml = `<pre style=\"font-family: monospace; font-size: 14px;\">${formattedMessage}</pre>`;\n\n      tasks.push(this.email.sendEmail(emailTo, emailSubject, emailHtml));\n    }\n\n    await Promise.allSettled(tasks);\n  }\n\n  /**\n   * Applies Daniela's persona to the notification content.\n   */\n  private formatMessage(title: string, message: string, urgency: string): string {\n    const icon = urgency === 'high' ? 'üö®' : urgency === 'medium' ? '‚ö°' : '‚ÑπÔ∏è';\n    return `\n${icon} *${title.toUpperCase()}*\n-------------------\n${message}\n\n--\n${DANIELA_IDENTITY.name} | ${DANIELA_IDENTITY.title}\n${DANIELA_IDENTITY.brand} Sovereign Operations\n    `.trim();\n  }\n}\n"],"version":3}
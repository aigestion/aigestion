{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\integration\\api.integration.test.ts","mappings":"AAAA;;;;;;;;GAQG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEH,MAAM,gBAAgB,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,MAAM,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC;AAE/F,CAAC,gBAAgB,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,uBAAuB,EAAE,GAAG,EAAE;IAC1E,IAAI,MAAW,CAAC;IAChB,IAAI,SAAc,CAAC;IACnB,IAAI,YAAiB,CAAC;IAEtB,SAAS,CAAC,KAAK,IAAI,EAAE;QACnB,2DAA2D;QAC3D,MAAM,EAAE,GAAG,EAAE,GAAG,wDAAa,WAAW,GAAC,CAAC;QAC1C,MAAM,EAAE,iBAAiB,EAAE,GAAG,wDAAa,uBAAuB,GAAC,CAAC;QACpE,MAAM,iBAAiB,EAAE,CAAC;QAE1B,SAAS,GAAG,EAAE,CAAC;QACf,YAAY,GAAG,EAAE,CAAC;QAClB,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;IACzB,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,KAAK,IAAI,EAAE;QAClB,IAAI,MAAM;YAAE,MAAM,CAAC,KAAK,EAAE,CAAC;IAC7B,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,0BAA0B,EAAE,GAAG,EAAE;QACxC,IAAI,CAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE;YAC7D,MAAM,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;YAErC,oBAAoB;YACpB,MAAM,OAAO,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC;gBAC/C,KAAK,EAAE,kBAAkB;gBACzB,IAAI,EAAE,uBAAuB;gBAC7B,QAAQ,EAAE,gBAAgB;aAC3B,CAAC,CAAC;YAEH,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,MAAM,CAAC;iBACnC,IAAI,CAAC,oBAAoB,CAAC;iBAC1B,IAAI,CAAC,EAAE,KAAK,EAAE,kBAAkB,EAAE,QAAQ,EAAE,gBAAgB,EAAE,CAAC,CAAC;YAEnE,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACpC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,cAAc,EAAE,GAAG,EAAE;QAC5B,IAAI,CAAC,kCAAkC,EAAE,KAAK,IAAI,EAAE;YAClD,MAAM,OAAO,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;YACrC,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;YACtD,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,CAAC;QACxC,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\integration\\api.integration.test.ts"],"sourcesContent":["/**\r\n * API Integration Tests\r\n *\r\n * These tests require a fully running server with real MongoDB and Redis connections.\r\n * They are skipped in unit test mode (NODE_ENV=test) and should only be run\r\n * as part of a dedicated integration test pipeline with `npm run test:integration`.\r\n *\r\n * To run: RUN_INTEGRATION_TESTS=true npx jest --runInBand api.integration.test.ts\r\n */\r\n\r\nconst SKIP_INTEGRATION = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;\r\n\r\n(SKIP_INTEGRATION ? describe.skip : describe)('API Integration Tests', () => {\r\n  let server: any;\r\n  let dbService: any;\r\n  let redisService: any;\r\n\r\n  beforeAll(async () => {\r\n    // Dynamic imports to avoid compilation errors when skipped\r\n    const { app } = await import('../../app');\r\n    const { connectToDatabase } = await import('../../config/database');\r\n    await connectToDatabase();\r\n\r\n    dbService = {};\r\n    redisService = {};\r\n    server = app.listen(0);\r\n  });\r\n\r\n  afterAll(async () => {\r\n    if (server) server.close();\r\n  });\r\n\r\n  describe('Authentication Endpoints', () => {\r\n    test('POST /api/v1/auth/login - Valid credentials', async () => {\r\n      const request = require('supertest');\r\n\r\n      // Create user first\r\n      await request(server).post('/api/v1/users').send({\r\n        email: 'test@example.com',\r\n        name: 'Integration Test User',\r\n        password: 'AIGestion2026!',\r\n      });\r\n\r\n      const response = await request(server)\r\n        .post('/api/v1/auth/login')\r\n        .send({ email: 'test@example.com', password: 'AIGestion2026!' });\r\n\r\n      expect(response.status).toBe(200);\r\n    });\r\n  });\r\n\r\n  describe('Health Check', () => {\r\n    test('GET /health should return status', async () => {\r\n      const request = require('supertest');\r\n      const response = await request(server).get('/health');\r\n      expect(response.status).toBeDefined();\r\n    });\r\n  });\r\n});\r\n"],"version":3}
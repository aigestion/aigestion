a947ff5956c0f2e67abee493109fc90d
/**
 * API Integration Tests
 *
 * These tests require a fully running server with real MongoDB and Redis connections.
 * They are skipped in unit test mode (NODE_ENV=test) and should only be run
 * as part of a dedicated integration test pipeline with `npm run test:integration`.
 *
 * To run: RUN_INTEGRATION_TESTS=true npx jest --runInBand api.integration.test.ts
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
const SKIP_INTEGRATION = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;
(SKIP_INTEGRATION ? describe.skip : describe)('API Integration Tests', () => {
    let server;
    let dbService;
    let redisService;
    beforeAll(async () => {
        // Dynamic imports to avoid compilation errors when skipped
        const { app } = await Promise.resolve().then(() => __importStar(require('../../app')));
        const { connectToDatabase } = await Promise.resolve().then(() => __importStar(require('../../config/database')));
        await connectToDatabase();
        dbService = {};
        redisService = {};
        server = app.listen(0);
    });
    afterAll(async () => {
        if (server)
            server.close();
    });
    describe('Authentication Endpoints', () => {
        test('POST /api/v1/auth/login - Valid credentials', async () => {
            const request = require('supertest');
            // Create user first
            await request(server).post('/api/v1/users').send({
                email: 'test@example.com',
                name: 'Integration Test User',
                password: 'AIGestion2026!',
            });
            const response = await request(server)
                .post('/api/v1/auth/login')
                .send({ email: 'test@example.com', password: 'AIGestion2026!' });
            expect(response.status).toBe(200);
        });
    });
    describe('Health Check', () => {
        test('GET /health should return status', async () => {
            const request = require('supertest');
            const response = await request(server).get('/health');
            expect(response.status).toBeDefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXGludGVncmF0aW9uXFxhcGkuaW50ZWdyYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7R0FRRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQztBQUUvRixDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDMUUsSUFBSSxNQUFXLENBQUM7SUFDaEIsSUFBSSxTQUFjLENBQUM7SUFDbkIsSUFBSSxZQUFpQixDQUFDO0lBRXRCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQiwyREFBMkQ7UUFDM0QsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLHdEQUFhLFdBQVcsR0FBQyxDQUFDO1FBQzFDLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxHQUFHLHdEQUFhLHVCQUF1QixHQUFDLENBQUM7UUFDcEUsTUFBTSxpQkFBaUIsRUFBRSxDQUFDO1FBRTFCLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDZixZQUFZLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2xCLElBQUksTUFBTTtZQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUM3QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsSUFBSSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUVyQyxvQkFBb0I7WUFDcEIsTUFBTSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDL0MsS0FBSyxFQUFFLGtCQUFrQjtnQkFDekIsSUFBSSxFQUFFLHVCQUF1QjtnQkFDN0IsUUFBUSxFQUFFLGdCQUFnQjthQUMzQixDQUFDLENBQUM7WUFFSCxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQU8sQ0FBQyxNQUFNLENBQUM7aUJBQ25DLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztpQkFDMUIsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7WUFFbkUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1FBQzVCLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDckMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWxlamFuZHJvXFxBSUdlc3Rpb25cXGJhY2tlbmRcXHNyY1xcX190ZXN0c19fXFxpbnRlZ3JhdGlvblxcYXBpLmludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEFQSSBJbnRlZ3JhdGlvbiBUZXN0c1xyXG4gKlxyXG4gKiBUaGVzZSB0ZXN0cyByZXF1aXJlIGEgZnVsbHkgcnVubmluZyBzZXJ2ZXIgd2l0aCByZWFsIE1vbmdvREIgYW5kIFJlZGlzIGNvbm5lY3Rpb25zLlxyXG4gKiBUaGV5IGFyZSBza2lwcGVkIGluIHVuaXQgdGVzdCBtb2RlIChOT0RFX0VOVj10ZXN0KSBhbmQgc2hvdWxkIG9ubHkgYmUgcnVuXHJcbiAqIGFzIHBhcnQgb2YgYSBkZWRpY2F0ZWQgaW50ZWdyYXRpb24gdGVzdCBwaXBlbGluZSB3aXRoIGBucG0gcnVuIHRlc3Q6aW50ZWdyYXRpb25gLlxyXG4gKlxyXG4gKiBUbyBydW46IFJVTl9JTlRFR1JBVElPTl9URVNUUz10cnVlIG5weCBqZXN0IC0tcnVuSW5CYW5kIGFwaS5pbnRlZ3JhdGlvbi50ZXN0LnRzXHJcbiAqL1xyXG5cclxuY29uc3QgU0tJUF9JTlRFR1JBVElPTiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgJiYgIXByb2Nlc3MuZW52LlJVTl9JTlRFR1JBVElPTl9URVNUUztcclxuXHJcbihTS0lQX0lOVEVHUkFUSU9OID8gZGVzY3JpYmUuc2tpcCA6IGRlc2NyaWJlKSgnQVBJIEludGVncmF0aW9uIFRlc3RzJywgKCkgPT4ge1xyXG4gIGxldCBzZXJ2ZXI6IGFueTtcclxuICBsZXQgZGJTZXJ2aWNlOiBhbnk7XHJcbiAgbGV0IHJlZGlzU2VydmljZTogYW55O1xyXG5cclxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gRHluYW1pYyBpbXBvcnRzIHRvIGF2b2lkIGNvbXBpbGF0aW9uIGVycm9ycyB3aGVuIHNraXBwZWRcclxuICAgIGNvbnN0IHsgYXBwIH0gPSBhd2FpdCBpbXBvcnQoJy4uLy4uL2FwcCcpO1xyXG4gICAgY29uc3QgeyBjb25uZWN0VG9EYXRhYmFzZSB9ID0gYXdhaXQgaW1wb3J0KCcuLi8uLi9jb25maWcvZGF0YWJhc2UnKTtcclxuICAgIGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcblxyXG4gICAgZGJTZXJ2aWNlID0ge307XHJcbiAgICByZWRpc1NlcnZpY2UgPSB7fTtcclxuICAgIHNlcnZlciA9IGFwcC5saXN0ZW4oMCk7XHJcbiAgfSk7XHJcblxyXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcclxuICAgIGlmIChzZXJ2ZXIpIHNlcnZlci5jbG9zZSgpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnQXV0aGVudGljYXRpb24gRW5kcG9pbnRzJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnUE9TVCAvYXBpL3YxL2F1dGgvbG9naW4gLSBWYWxpZCBjcmVkZW50aWFscycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xyXG5cclxuICAgICAgLy8gQ3JlYXRlIHVzZXIgZmlyc3RcclxuICAgICAgYXdhaXQgcmVxdWVzdChzZXJ2ZXIpLnBvc3QoJy9hcGkvdjEvdXNlcnMnKS5zZW5kKHtcclxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgIG5hbWU6ICdJbnRlZ3JhdGlvbiBUZXN0IFVzZXInLFxyXG4gICAgICAgIHBhc3N3b3JkOiAnQUlHZXN0aW9uMjAyNiEnLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChzZXJ2ZXIpXHJcbiAgICAgICAgLnBvc3QoJy9hcGkvdjEvYXV0aC9sb2dpbicpXHJcbiAgICAgICAgLnNlbmQoeyBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLCBwYXNzd29yZDogJ0FJR2VzdGlvbjIwMjYhJyB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnSGVhbHRoIENoZWNrJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnR0VUIC9oZWFsdGggc2hvdWxkIHJldHVybiBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHNlcnZlcikuZ2V0KCcvaGVhbHRoJyk7XHJcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==
2cef8ff739a4f73ad8b6837ff0364623
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnomalyDetectionService = void 0;
const inversify_1 = require("inversify");
const types_1 = require("../types");
const logger_1 = require("../utils/logger");
const ai_service_1 = require("./ai.service");
let AnomalyDetectionService = class AnomalyDetectionService {
    aiService;
    constructor(aiService) {
        this.aiService = aiService;
    }
    /**
     * Analyzes recent system metrics/logs for anomalies.
     */
    async analyzePatterns(data) {
        logger_1.logger.info(`[AnomalyDetection] Analyzing system patterns...`);
        // Real-world: Use a specialized model or statistical analysis.
        // God-mode: Leverage AIService for high-level semantic anomaly detection.
        const prompt = `Analyze the following system behavior logs for security anomalies: ${JSON.stringify(data)}. Return a JSON with "anomalyDetected" (boolean), "threatLevel" (string), and "explanation" (string).`;
        try {
            const response = await this.aiService.generateContent(prompt, 'system', 'security_analyst');
            const result = JSON.parse(response);
            if (result.anomalyDetected) {
                logger_1.logger.warn(`[AnomalyDetection] ALERT: ${result.explanation} (Level: ${result.threatLevel})`);
            }
            return result;
        }
        catch (error) {
            logger_1.logger.error(`[AnomalyDetection] Error analyzing patterns: ${error}`);
            // Fallback to basic rule-based detection
            return { anomalyDetected: false, threatLevel: 'low' };
        }
    }
    /**
     * Specifically checks for "impossible travel" or unusual login timing.
     */
    async checkUserActivity(userId, activityLog) {
        // Logic to correlate timestamps and geo-locations
        logger_1.logger.info(`[AnomalyDetection] Checking activity for user ${userId}`);
    }
};
exports.AnomalyDetectionService = AnomalyDetectionService;
exports.AnomalyDetectionService = AnomalyDetectionService = __decorate([
    (0, inversify_1.injectable)(),
    __param(0, (0, inversify_1.inject)(types_1.TYPES.AIService)),
    __metadata("design:paramtypes", [typeof (_a = typeof ai_service_1.AIService !== "undefined" && ai_service_1.AIService) === "function" ? _a : Object])
], AnomalyDetectionService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcYW5vbWFseS1kZXRlY3Rpb24uc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEseUNBQStDO0FBQy9DLG9DQUFpQztBQUNqQyw0Q0FBeUM7QUFDekMsNkNBQXlDO0FBR2xDLElBQU0sdUJBQXVCLEdBQTdCLE1BQU0sdUJBQXVCO0lBQ1c7SUFBN0MsWUFBNkMsU0FBb0I7UUFBcEIsY0FBUyxHQUFULFNBQVMsQ0FBVztJQUFHLENBQUM7SUFFckU7O09BRUc7SUFDSCxLQUFLLENBQUMsZUFBZSxDQUNuQixJQUFTO1FBTVQsZUFBTSxDQUFDLElBQUksQ0FBQyxpREFBaUQsQ0FBQyxDQUFDO1FBRS9ELCtEQUErRDtRQUMvRCwwRUFBMEU7UUFDMUUsTUFBTSxNQUFNLEdBQUcsc0VBQXNFLElBQUksQ0FBQyxTQUFTLENBQ2pHLElBQUksQ0FDTCx1R0FBdUcsQ0FBQztRQUV6RyxJQUFJLENBQUM7WUFDSCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztZQUM1RixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRXBDLElBQUksTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUMzQixlQUFNLENBQUMsSUFBSSxDQUNULDZCQUE2QixNQUFNLENBQUMsV0FBVyxZQUFZLE1BQU0sQ0FBQyxXQUFXLEdBQUcsQ0FDakYsQ0FBQztZQUNKLENBQUM7WUFFRCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGVBQU0sQ0FBQyxLQUFLLENBQUMsZ0RBQWdELEtBQUssRUFBRSxDQUFDLENBQUM7WUFDdEUseUNBQXlDO1lBQ3pDLE9BQU8sRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsQ0FBQztRQUN4RCxDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGlCQUFpQixDQUFDLE1BQWMsRUFBRSxXQUFrQjtRQUN4RCxrREFBa0Q7UUFDbEQsZUFBTSxDQUFDLElBQUksQ0FBQyxpREFBaUQsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUN6RSxDQUFDO0NBQ0YsQ0FBQTtBQTlDWSwwREFBdUI7a0NBQXZCLHVCQUF1QjtJQURuQyxJQUFBLHNCQUFVLEdBQUU7SUFFRSxXQUFBLElBQUEsa0JBQU0sRUFBQyxhQUFLLENBQUMsU0FBUyxDQUFDLENBQUE7eURBQW9CLHNCQUFTLG9CQUFULHNCQUFTO0dBRHRELHVCQUF1QixDQThDbkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcYW5vbWFseS1kZXRlY3Rpb24uc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3QsIGluamVjdGFibGUgfSBmcm9tICdpbnZlcnNpZnknO1xuaW1wb3J0IHsgVFlQRVMgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgQUlTZXJ2aWNlIH0gZnJvbSAnLi9haS5zZXJ2aWNlJztcblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEFub21hbHlEZXRlY3Rpb25TZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoQGluamVjdChUWVBFUy5BSVNlcnZpY2UpIHByaXZhdGUgYWlTZXJ2aWNlOiBBSVNlcnZpY2UpIHt9XG5cbiAgLyoqXG4gICAqIEFuYWx5emVzIHJlY2VudCBzeXN0ZW0gbWV0cmljcy9sb2dzIGZvciBhbm9tYWxpZXMuXG4gICAqL1xuICBhc3luYyBhbmFseXplUGF0dGVybnMoXG4gICAgZGF0YTogYW55LFxuICApOiBQcm9taXNlPHtcbiAgICBhbm9tYWx5RGV0ZWN0ZWQ6IGJvb2xlYW47XG4gICAgdGhyZWF0TGV2ZWw6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCc7XG4gICAgbWVzc2FnZT86IHN0cmluZztcbiAgfT4ge1xuICAgIGxvZ2dlci5pbmZvKGBbQW5vbWFseURldGVjdGlvbl0gQW5hbHl6aW5nIHN5c3RlbSBwYXR0ZXJucy4uLmApO1xuXG4gICAgLy8gUmVhbC13b3JsZDogVXNlIGEgc3BlY2lhbGl6ZWQgbW9kZWwgb3Igc3RhdGlzdGljYWwgYW5hbHlzaXMuXG4gICAgLy8gR29kLW1vZGU6IExldmVyYWdlIEFJU2VydmljZSBmb3IgaGlnaC1sZXZlbCBzZW1hbnRpYyBhbm9tYWx5IGRldGVjdGlvbi5cbiAgICBjb25zdCBwcm9tcHQgPSBgQW5hbHl6ZSB0aGUgZm9sbG93aW5nIHN5c3RlbSBiZWhhdmlvciBsb2dzIGZvciBzZWN1cml0eSBhbm9tYWxpZXM6ICR7SlNPTi5zdHJpbmdpZnkoXG4gICAgICBkYXRhLFxuICAgICl9LiBSZXR1cm4gYSBKU09OIHdpdGggXCJhbm9tYWx5RGV0ZWN0ZWRcIiAoYm9vbGVhbiksIFwidGhyZWF0TGV2ZWxcIiAoc3RyaW5nKSwgYW5kIFwiZXhwbGFuYXRpb25cIiAoc3RyaW5nKS5gO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5haVNlcnZpY2UuZ2VuZXJhdGVDb250ZW50KHByb21wdCwgJ3N5c3RlbScsICdzZWN1cml0eV9hbmFseXN0Jyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcblxuICAgICAgaWYgKHJlc3VsdC5hbm9tYWx5RGV0ZWN0ZWQpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICAgYFtBbm9tYWx5RGV0ZWN0aW9uXSBBTEVSVDogJHtyZXN1bHQuZXhwbGFuYXRpb259IChMZXZlbDogJHtyZXN1bHQudGhyZWF0TGV2ZWx9KWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgW0Fub21hbHlEZXRlY3Rpb25dIEVycm9yIGFuYWx5emluZyBwYXR0ZXJuczogJHtlcnJvcn1gKTtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGJhc2ljIHJ1bGUtYmFzZWQgZGV0ZWN0aW9uXG4gICAgICByZXR1cm4geyBhbm9tYWx5RGV0ZWN0ZWQ6IGZhbHNlLCB0aHJlYXRMZXZlbDogJ2xvdycgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3BlY2lmaWNhbGx5IGNoZWNrcyBmb3IgXCJpbXBvc3NpYmxlIHRyYXZlbFwiIG9yIHVudXN1YWwgbG9naW4gdGltaW5nLlxuICAgKi9cbiAgYXN5bmMgY2hlY2tVc2VyQWN0aXZpdHkodXNlcklkOiBzdHJpbmcsIGFjdGl2aXR5TG9nOiBhbnlbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIExvZ2ljIHRvIGNvcnJlbGF0ZSB0aW1lc3RhbXBzIGFuZCBnZW8tbG9jYXRpb25zXG4gICAgbG9nZ2VyLmluZm8oYFtBbm9tYWx5RGV0ZWN0aW9uXSBDaGVja2luZyBhY3Rpdml0eSBmb3IgdXNlciAke3VzZXJJZH1gKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9
2d17aff333b69bcd23a6419da9dbe015
"use strict";
// src/infrastructure/repository/UserRepository.ts
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.UserRepository = void 0;
const User_1 = require("../../models/User");
const BaseRepository_1 = require("./BaseRepository");
const inversify_1 = require("inversify");
let UserRepository = class UserRepository extends BaseRepository_1.BaseRepository {
    async findByEmail(email) {
        return await User_1.User.findOne({ email }).exec();
    }
    async create(idOrItem, maybeItem) {
        const data = typeof idOrItem === 'string' ? maybeItem ?? {} : idOrItem;
        const user = new User_1.User(data);
        return await user.save();
    }
    async findById(id) {
        return await User_1.User.findById(id).exec();
    }
    async findAll(limit = 10, skip = 0) {
        return await User_1.User.find().skip(skip).limit(limit).exec();
    }
    async countAll() {
        return await User_1.User.countDocuments().exec();
    }
    async update(id, data) {
        return await User_1.User.findByIdAndUpdate(id, data, { new: true }).exec();
    }
    async delete(id) {
        const result = await User_1.User.findByIdAndDelete(id).exec();
        return !!result;
    }
    async findOne(query) {
        return await User_1.User.findOne(query).exec();
    }
    async removeRefreshToken(token) {
        await User_1.User.updateOne({ 'refreshTokens.token': token }, { $pull: { refreshTokens: { token: token } } }).exec();
    }
};
exports.UserRepository = UserRepository;
exports.UserRepository = UserRepository = __decorate([
    (0, inversify_1.injectable)()
], UserRepository);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxpbmZyYXN0cnVjdHVyZVxccmVwb3NpdG9yeVxcVXNlclJlcG9zaXRvcnkudHMiLCJtYXBwaW5ncyI6IjtBQUFBLGtEQUFrRDs7Ozs7Ozs7O0FBRWxELDRDQUFnRDtBQUNoRCxxREFBa0Q7QUFDbEQseUNBQXVDO0FBWWhDLElBQU0sY0FBYyxHQUFwQixNQUFNLGNBQWUsU0FBUSwrQkFBcUI7SUFDdkQsS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFhO1FBQzdCLE9BQU8sTUFBTSxXQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM5QyxDQUFDO0lBRVEsS0FBSyxDQUFDLE1BQU0sQ0FDbkIsUUFBaUMsRUFDakMsU0FBMEI7UUFFMUIsTUFBTSxJQUFJLEdBQUcsT0FBTyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7UUFDdkUsTUFBTSxJQUFJLEdBQUcsSUFBSSxXQUFJLENBQUMsSUFBVyxDQUFDLENBQUM7UUFDbkMsT0FBTyxNQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRVEsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFVO1FBQ2hDLE9BQU8sTUFBTSxXQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3hDLENBQUM7SUFFUSxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQWdCLEVBQUUsRUFBRSxPQUFlLENBQUM7UUFDekQsT0FBTyxNQUFNLFdBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzFELENBQUM7SUFFRCxLQUFLLENBQUMsUUFBUTtRQUNaLE9BQU8sTUFBTSxXQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDNUMsQ0FBQztJQUVRLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBVSxFQUFFLElBQW9CO1FBQ3BELE9BQU8sTUFBTSxXQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3RFLENBQUM7SUFFUSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQVU7UUFDOUIsTUFBTSxNQUFNLEdBQUcsTUFBTSxXQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdkQsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQVU7UUFDdEIsT0FBTyxNQUFNLFdBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUMsQ0FBQztJQUVELEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxLQUFhO1FBQ3BDLE1BQU0sV0FBSSxDQUFDLFNBQVMsQ0FDbEIsRUFBRSxxQkFBcUIsRUFBRSxLQUFLLEVBQUUsRUFDaEMsRUFBRSxLQUFLLEVBQUUsRUFBRSxhQUFhLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUMvQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ1gsQ0FBQztDQUNGLENBQUE7QUE3Q1ksd0NBQWM7eUJBQWQsY0FBYztJQUQxQixJQUFBLHNCQUFVLEdBQUU7R0FDQSxjQUFjLENBNkMxQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFsZWphbmRyb1xcQUlHZXN0aW9uXFxiYWNrZW5kXFxzcmNcXGluZnJhc3RydWN0dXJlXFxyZXBvc2l0b3J5XFxVc2VyUmVwb3NpdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvaW5mcmFzdHJ1Y3R1cmUvcmVwb3NpdG9yeS9Vc2VyUmVwb3NpdG9yeS50c1xuXG5pbXBvcnQgeyBVc2VyLCBJVXNlciB9IGZyb20gJy4uLy4uL21vZGVscy9Vc2VyJztcbmltcG9ydCB7IEJhc2VSZXBvc2l0b3J5IH0gZnJvbSAnLi9CYXNlUmVwb3NpdG9yeSc7XG5pbXBvcnQgeyBpbmplY3RhYmxlIH0gZnJvbSAnaW52ZXJzaWZ5JztcblxuZXhwb3J0IGludGVyZmFjZSBJVXNlclJlcG9zaXRvcnkgZXh0ZW5kcyBCYXNlUmVwb3NpdG9yeTxJVXNlcj4ge1xuICBmaW5kQnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxJVXNlciB8IG51bGw+O1xuICBjcmVhdGUoaWRPckl0ZW06IHN0cmluZyB8IFBhcnRpYWw8SVVzZXI+LCBtYXliZUl0ZW0/OiBQYXJ0aWFsPElVc2VyPik6IFByb21pc2U8SVVzZXI+O1xuICBmaW5kQWxsKGxpbWl0PzogbnVtYmVyLCBza2lwPzogbnVtYmVyKTogUHJvbWlzZTxJVXNlcltdPjtcbiAgY291bnRBbGwoKTogUHJvbWlzZTxudW1iZXI+O1xuICBmaW5kT25lKHF1ZXJ5OiBhbnkpOiBQcm9taXNlPElVc2VyIHwgbnVsbD47XG4gIHJlbW92ZVJlZnJlc2hUb2tlbih0b2tlbjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuQGluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFVzZXJSZXBvc2l0b3J5IGV4dGVuZHMgQmFzZVJlcG9zaXRvcnk8SVVzZXI+IGltcGxlbWVudHMgSVVzZXJSZXBvc2l0b3J5IHtcbiAgYXN5bmMgZmluZEJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8SVVzZXIgfCBudWxsPiB7XG4gICAgcmV0dXJuIGF3YWl0IFVzZXIuZmluZE9uZSh7IGVtYWlsIH0pLmV4ZWMoKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGFzeW5jIGNyZWF0ZShcbiAgICBpZE9ySXRlbTogc3RyaW5nIHwgUGFydGlhbDxJVXNlcj4sXG4gICAgbWF5YmVJdGVtPzogUGFydGlhbDxJVXNlcj4sXG4gICk6IFByb21pc2U8SVVzZXI+IHtcbiAgICBjb25zdCBkYXRhID0gdHlwZW9mIGlkT3JJdGVtID09PSAnc3RyaW5nJyA/IG1heWJlSXRlbSA/PyB7fSA6IGlkT3JJdGVtO1xuICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlcihkYXRhIGFzIGFueSk7XG4gICAgcmV0dXJuIGF3YWl0IHVzZXIuc2F2ZSgpO1xuICB9XG5cbiAgb3ZlcnJpZGUgYXN5bmMgZmluZEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8SVVzZXIgfCBudWxsPiB7XG4gICAgcmV0dXJuIGF3YWl0IFVzZXIuZmluZEJ5SWQoaWQpLmV4ZWMoKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGFzeW5jIGZpbmRBbGwobGltaXQ6IG51bWJlciA9IDEwLCBza2lwOiBudW1iZXIgPSAwKTogUHJvbWlzZTxJVXNlcltdPiB7XG4gICAgcmV0dXJuIGF3YWl0IFVzZXIuZmluZCgpLnNraXAoc2tpcCkubGltaXQobGltaXQpLmV4ZWMoKTtcbiAgfVxuXG4gIGFzeW5jIGNvdW50QWxsKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgcmV0dXJuIGF3YWl0IFVzZXIuY291bnREb2N1bWVudHMoKS5leGVjKCk7XG4gIH1cblxuICBvdmVycmlkZSBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgZGF0YTogUGFydGlhbDxJVXNlcj4pOiBQcm9taXNlPElVc2VyIHwgbnVsbD4ge1xuICAgIHJldHVybiBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKGlkLCBkYXRhLCB7IG5ldzogdHJ1ZSB9KS5leGVjKCk7XG4gIH1cblxuICBvdmVycmlkZSBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFVzZXIuZmluZEJ5SWRBbmREZWxldGUoaWQpLmV4ZWMoKTtcbiAgICByZXR1cm4gISFyZXN1bHQ7XG4gIH1cblxuICBhc3luYyBmaW5kT25lKHF1ZXJ5OiBhbnkpOiBQcm9taXNlPElVc2VyIHwgbnVsbD4ge1xuICAgIHJldHVybiBhd2FpdCBVc2VyLmZpbmRPbmUocXVlcnkpLmV4ZWMoKTtcbiAgfVxuXG4gIGFzeW5jIHJlbW92ZVJlZnJlc2hUb2tlbih0b2tlbjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgVXNlci51cGRhdGVPbmUoXG4gICAgICB7ICdyZWZyZXNoVG9rZW5zLnRva2VuJzogdG9rZW4gfSxcbiAgICAgIHsgJHB1bGw6IHsgcmVmcmVzaFRva2VuczogeyB0b2tlbjogdG9rZW4gfSB9IH0sXG4gICAgKS5leGVjKCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==
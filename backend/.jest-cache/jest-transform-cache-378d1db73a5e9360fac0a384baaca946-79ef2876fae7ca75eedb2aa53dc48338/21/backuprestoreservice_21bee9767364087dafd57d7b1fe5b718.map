{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\backup-restore.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\backup-restore.service.ts"],"sourcesContent":["import { exec } from 'child_process';\nimport crypto from 'crypto';\nimport fs from 'fs/promises';\nimport { injectable } from 'inversify';\nimport path from 'path';\nimport { promisify } from 'util';\nimport { logger } from '../utils/logger';\n\nconst execAsync = promisify(exec);\n\ninterface BackupConfig {\n  name: string;\n  type: 'database' | 'files' | 'logs' | 'config' | 'full';\n  schedule: string; // Cron expression\n  enabled: boolean;\n  retention: number; // Days\n  compression: boolean;\n  encryption: boolean;\n  destinations: BackupDestination[];\n}\n\ninterface BackupDestination {\n  type: 'local' | 's3' | 'gcs' | 'azure';\n  path: string;\n  credentials?: {\n    accessKeyId?: string;\n    secretAccessKey?: string;\n    bucket?: string;\n    region?: string;\n    connectionString?: string;\n  };\n}\n\ninterface BackupJob {\n  id: string;\n  config: BackupConfig;\n  status: 'pending' | 'running' | 'completed' | 'failed';\n  startTime: Date;\n  endTime?: Date;\n  size: number;\n  files: string[];\n  checksum: string;\n  error?: string;\n  metadata: {\n    [key: string]: any;\n  };\n}\n\ninterface RestoreJob {\n  id: string;\n  backupId: string;\n  status: 'pending' | 'running' | 'completed' | 'failed';\n  startTime: Date;\n  endTime?: Date;\n  files: string[];\n  error?: string;\n  metadata: {\n    [key: string]: any;\n  };\n}\n\n@injectable()\nexport class BackupRestoreService {\n  private readonly backupDir = 'backups';\n  private readonly encryptionKey: string;\n  private readonly backupConfigs: BackupConfig[] = [];\n  private readonly backupJobs: BackupJob[] = [];\n  private readonly restoreJobs: RestoreJob[] = [];\n  private readonly maxJobs = 1000;\n\n  constructor() {\n    this.encryptionKey =\n      process.env.BACKUP_ENCRYPTION_KEY || crypto.randomBytes(32).toString('hex');\n    this.initializeBackupDirectory();\n    this.initializeDefaultConfigs();\n    this.startScheduledBackups();\n  }\n\n  private async initializeBackupDirectory(): Promise<void> {\n    try {\n      await fs.mkdir(this.backupDir, { recursive: true });\n      await fs.mkdir(path.join(this.backupDir, 'database'), { recursive: true });\n      await fs.mkdir(path.join(this.backupDir, 'files'), { recursive: true });\n      await fs.mkdir(path.join(this.backupDir, 'logs'), { recursive: true });\n      await fs.mkdir(path.join(this.backupDir, 'config'), { recursive: true });\n\n      logger.info('Backup directory initialized');\n    } catch (error) {\n      logger.error('Failed to initialize backup directory:', error);\n    }\n  }\n\n  private initializeDefaultConfigs(): void {\n    this.backupConfigs.push(\n      {\n        name: 'daily-database',\n        type: 'database',\n        schedule: '0 2 * * *', // 2 AM daily\n        enabled: true,\n        retention: 30,\n        compression: true,\n        encryption: true,\n        destinations: [\n          {\n            type: 'local',\n            path: path.join(this.backupDir, 'database'),\n          },\n        ],\n      },\n      {\n        name: 'weekly-full',\n        type: 'full',\n        schedule: '0 3 * * 0', // 3 AM on Sundays\n        enabled: true,\n        retention: 90,\n        compression: true,\n        encryption: true,\n        destinations: [\n          {\n            type: 'local',\n            path: this.backupDir,\n          },\n        ],\n      },\n      {\n        name: 'hourly-logs',\n        type: 'logs',\n        schedule: '0 * * * *', // Every hour\n        enabled: true,\n        retention: 7,\n        compression: true,\n        encryption: false,\n        destinations: [\n          {\n            type: 'local',\n            path: path.join(this.backupDir, 'logs'),\n          },\n        ],\n      },\n      {\n        name: 'daily-files',\n        type: 'files',\n        schedule: '0 1 * * *', // 1 AM daily\n        enabled: true,\n        retention: 30,\n        compression: true,\n        encryption: true,\n        destinations: [\n          {\n            type: 'local',\n            path: path.join(this.backupDir, 'files'),\n          },\n        ],\n      },\n    );\n\n    logger.info('Default backup configurations initialized', {\n      totalConfigs: this.backupConfigs.length,\n    });\n  }\n\n  /**\n   * Create backup job\n   */\n  public async createBackup(\n    configName: string,\n    customOptions?: Partial<BackupConfig>,\n  ): Promise<BackupJob> {\n    try {\n      const config = this.backupConfigs.find(c => c.name === configName);\n      if (!config) {\n        throw new Error(`Backup configuration '${configName}' not found`);\n      }\n\n      const mergedConfig = { ...config, ...customOptions };\n      const job: BackupJob = {\n        id: this.generateJobId(),\n        config: mergedConfig,\n        status: 'pending',\n        startTime: new Date(),\n        size: 0,\n        files: [],\n        checksum: '',\n        metadata: {\n          createdBy: 'system',\n          environment: process.env.NODE_ENV || 'development',\n        },\n      };\n\n      this.backupJobs.push(job);\n      await this.executeBackup(job);\n\n      return job;\n    } catch (error) {\n      logger.error('Failed to create backup job:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Execute backup\n   */\n  private async executeBackup(job: BackupJob): Promise<void> {\n    try {\n      job.status = 'running';\n      logger.info('Starting backup job', { jobId: job.id, config: job.config.name });\n\n      const startTime = Date.now();\n      let totalSize = 0;\n      const files: string[] = [];\n\n      switch (job.config.type) {\n        case 'database':\n          await this.backupDatabase(job, files, totalSize);\n          break;\n        case 'files':\n          await this.backupFiles(job, files, totalSize);\n          break;\n        case 'logs':\n          await this.backupLogs(job, files, totalSize);\n          break;\n        case 'config':\n          await this.backupConfig(job, files, totalSize);\n          break;\n        case 'full':\n          await this.backupFull(job, files, totalSize);\n          break;\n      }\n\n      // Process backup (compress and encrypt)\n      const processedFiles = await this.processBackup(job, files);\n\n      // Store backup\n      await this.storeBackup(job, processedFiles);\n\n      // Update job status\n      job.status = 'completed';\n      job.endTime = new Date();\n      job.size = totalSize;\n      job.files = processedFiles;\n      job.checksum = await this.calculateChecksum(processedFiles);\n\n      const duration = Date.now() - startTime;\n      logger.info('Backup completed successfully', {\n        jobId: job.id,\n        config: job.config.name,\n        duration,\n        size: job.size,\n        files: job.files.length,\n      });\n\n      // Cleanup old backups\n      await this.cleanupOldBackups(job.config);\n    } catch (error) {\n      job.status = 'failed';\n      job.endTime = new Date();\n      job.error = error instanceof Error ? error.message : 'Unknown error';\n\n      logger.error('Backup failed', {\n        jobId: job.id,\n        config: job.config.name,\n        error: job.error,\n      });\n    }\n  }\n\n  /**\n   * Backup database\n   */\n  private async backupDatabase(job: BackupJob, files: string[], totalSize: number): Promise<void> {\n    try {\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n      const backupFile = path.join(this.backupDir, 'database', `database-${timestamp}.sql`);\n\n      // MongoDB backup\n      if (process.env.MONGODB_URI) {\n        const command = `mongodump --uri=\"${process.env.MONGODB_URI}\" --out=\"${backupFile}\"`;\n        await execAsync(command);\n        files.push(backupFile);\n\n        const stats = await fs.stat(backupFile);\n        totalSize += stats.size;\n      }\n\n      // PostgreSQL backup\n      if (process.env.DATABASE_URL) {\n        const pgBackupFile = path.join(this.backupDir, 'database', `postgres-${timestamp}.sql`);\n        const command = `pg_dump \"${process.env.DATABASE_URL}\" > \"${pgBackupFile}\"`;\n        await execAsync(command);\n        files.push(pgBackupFile);\n\n        const stats = await fs.stat(pgBackupFile);\n        totalSize += stats.size;\n      }\n\n      logger.info('Database backup completed', { files: files.length, size: totalSize });\n    } catch (error) {\n      logger.error('Database backup failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Backup files\n   */\n  private async backupFiles(job: BackupJob, files: string[], totalSize: number): Promise<void> {\n    try {\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n      const backupFile = path.join(this.backupDir, 'files', `files-${timestamp}.tar.gz`);\n\n      // Create tar archive of important directories\n      const directories = ['uploads', 'quarantine', 'data'];\n\n      let tarCommand = `tar -czf \"${backupFile}\"`;\n      for (const dir of directories) {\n        try {\n          await fs.access(dir);\n          tarCommand += ` ${dir}`;\n        } catch {\n          // Directory doesn't exist, skip\n        }\n      }\n\n      await execAsync(tarCommand);\n      files.push(backupFile);\n\n      const stats = await fs.stat(backupFile);\n      totalSize += stats.size;\n\n      logger.info('Files backup completed', { files: files.length, size: totalSize });\n    } catch (error) {\n      logger.error('Files backup failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Backup logs\n   */\n  private async backupLogs(job: BackupJob, files: string[], totalSize: number): Promise<void> {\n    try {\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n      const backupFile = path.join(this.backupDir, 'logs', `logs-${timestamp}.tar.gz`);\n\n      // Create tar archive of logs\n      const logDirs = ['logs', 'monitoring'];\n\n      let tarCommand = `tar -czf \"${backupFile}\"`;\n      for (const dir of logDirs) {\n        try {\n          await fs.access(dir);\n          tarCommand += ` ${dir}`;\n        } catch {\n          // Directory doesn't exist, skip\n        }\n      }\n\n      await execAsync(tarCommand);\n      files.push(backupFile);\n\n      const stats = await fs.stat(backupFile);\n      totalSize += stats.size;\n\n      logger.info('Logs backup completed', { files: files.length, size: totalSize });\n    } catch (error) {\n      logger.error('Logs backup failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Backup configuration\n   */\n  private async backupConfig(job: BackupJob, files: string[], totalSize: number): Promise<void> {\n    try {\n      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n      const backupFile = path.join(this.backupDir, 'config', `config-${timestamp}.tar.gz`);\n\n      // Create tar archive of configuration files\n      const configFiles = ['.env', 'package.json', 'tsconfig.json', 'docker-compose.yml'];\n\n      let tarCommand = `tar -czf \"${backupFile}\"`;\n      for (const file of configFiles) {\n        try {\n          await fs.access(file);\n          tarCommand += ` ${file}`;\n        } catch {\n          // File doesn't exist, skip\n        }\n      }\n\n      await execAsync(tarCommand);\n      files.push(backupFile);\n\n      const stats = await fs.stat(backupFile);\n      totalSize += stats.size;\n\n      logger.info('Configuration backup completed', { files: files.length, size: totalSize });\n    } catch (error) {\n      logger.error('Configuration backup failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Full backup\n   */\n  private async backupFull(job: BackupJob, files: string[], totalSize: number): Promise<void> {\n    try {\n      // Run all backup types\n      await this.backupDatabase(job, files, totalSize);\n      await this.backupFiles(job, files, totalSize);\n      await this.backupLogs(job, files, totalSize);\n      await this.backupConfig(job, files, totalSize);\n\n      logger.info('Full backup completed', { files: files.length, size: totalSize });\n    } catch (error) {\n      logger.error('Full backup failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Process backup (compress and encrypt)\n   */\n  private async processBackup(job: BackupJob, files: string[]): Promise<string[]> {\n    const processedFiles: string[] = [];\n\n    for (const file of files) {\n      let processedFile = file;\n\n      // Compression\n      if (job.config.compression && !file.endsWith('.gz')) {\n        processedFile = await this.compressFile(file);\n        await fs.unlink(file); // Remove original\n      }\n\n      // Encryption\n      if (job.config.encryption) {\n        processedFile = await this.encryptFile(processedFile);\n        await fs.unlink(processedFile.replace('.enc', '')); // Remove unencrypted\n      }\n\n      processedFiles.push(processedFile);\n    }\n\n    return processedFiles;\n  }\n\n  /**\n   * Compress file\n   */\n  private async compressFile(filePath: string): Promise<string> {\n    const compressedPath = `${filePath}.gz`;\n    await execAsync(`gzip \"${filePath}\"`);\n    return compressedPath;\n  }\n\n  /**\n   * Encrypt file\n   */\n  private async encryptFile(filePath: string): Promise<string> {\n    const encryptedPath = `${filePath}.enc`;\n    const data = await fs.readFile(filePath);\n\n    // Simple XOR encryption (in production, use proper encryption)\n    const encrypted = Buffer.from(data.map(byte => byte ^ this.encryptionKey.charCodeAt(0)));\n    await fs.writeFile(encryptedPath, encrypted);\n\n    return encryptedPath;\n  }\n\n  /**\n   * Store backup\n   */\n  private async storeBackup(job: BackupJob, files: string[]): Promise<void> {\n    try {\n      for (const destination of job.config.destinations) {\n        switch (destination.type) {\n          case 'local':\n            await this.storeBackupLocal(job, files, destination.path);\n            break;\n          case 's3':\n            await this.storeBackupS3(job, files, destination);\n            break;\n          case 'gcs':\n            await this.storeBackupGCS(job, files, destination);\n            break;\n          case 'azure':\n            await this.storeBackupAzure(job, files, destination);\n            break;\n        }\n      }\n    } catch (error) {\n      logger.error('Failed to store backup:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Store backup locally\n   */\n  private async storeBackupLocal(\n    job: BackupJob,\n    files: string[],\n    destinationPath: string,\n  ): Promise<void> {\n    try {\n      await fs.mkdir(destinationPath, { recursive: true });\n\n      for (const file of files) {\n        const fileName = path.basename(file);\n        const destPath = path.join(destinationPath, `${job.id}_${fileName}`);\n        await fs.copyFile(file, destPath);\n      }\n\n      // Store backup metadata\n      const metadataPath = path.join(destinationPath, `${job.id}_metadata.json`);\n      await fs.writeFile(\n        metadataPath,\n        JSON.stringify(\n          {\n            job,\n            files,\n            storedAt: new Date(),\n          },\n          null,\n          2,\n        ),\n      );\n\n      logger.info('Backup stored locally', { destination: destinationPath, files: files.length });\n    } catch (error) {\n      logger.error('Failed to store backup locally:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Store backup to S3 (placeholder)\n   */\n  private async storeBackupS3(\n    job: BackupJob,\n    files: string[],\n    destination: BackupDestination,\n  ): Promise<void> {\n    // Implementation would use AWS SDK\n    logger.info('S3 backup storage not implemented', { destination });\n  }\n\n  /**\n   * Store backup to GCS (placeholder)\n   */\n  private async storeBackupGCS(\n    job: BackupJob,\n    files: string[],\n    destination: BackupDestination,\n  ): Promise<void> {\n    // Implementation would use Google Cloud SDK\n    logger.info('GCS backup storage not implemented', { destination });\n  }\n\n  /**\n   * Store backup to Azure (placeholder)\n   */\n  private async storeBackupAzure(\n    job: BackupJob,\n    files: string[],\n    destination: BackupDestination,\n  ): Promise<void> {\n    // Implementation would use Azure SDK\n    logger.info('Azure backup storage not implemented', { destination });\n  }\n\n  /**\n   * Calculate checksum\n   */\n  private async calculateChecksum(files: string[]): Promise<string> {\n    const hash = crypto.createHash('sha256');\n\n    for (const file of files) {\n      try {\n        const data = await fs.readFile(file);\n        hash.update(data);\n      } catch (error) {\n        logger.error('Failed to read file for checksum:', { file, error });\n      }\n    }\n\n    return hash.digest('hex');\n  }\n\n  /**\n   * Cleanup old backups\n   */\n  private async cleanupOldBackups(config: BackupConfig): Promise<void> {\n    try {\n      const cutoffDate = new Date(Date.now() - config.retention * 24 * 60 * 60 * 1000);\n\n      for (const destination of config.destinations) {\n        if (destination.type === 'local') {\n          const files = await fs.readdir(destination.path);\n\n          for (const file of files) {\n            if (file.endsWith('_metadata.json')) {\n              const metadataPath = path.join(destination.path, file);\n              try {\n                const metadata = JSON.parse(await fs.readFile(metadataPath, 'utf-8'));\n\n                if (new Date(metadata.storedAt) < cutoffDate) {\n                  // Remove backup files\n                  for (const backupFile of metadata.files) {\n                    const filePath = path.join(destination.path, backupFile);\n                    try {\n                      await fs.unlink(filePath);\n                    } catch (error) {\n                      logger.error('Failed to delete backup file:', { filePath, error });\n                    }\n                  }\n\n                  // Remove metadata file\n                  await fs.unlink(metadataPath);\n\n                  logger.info('Cleaned up old backup', { backupId: metadata.job.id });\n                }\n              } catch (error) {\n                logger.error('Failed to read backup metadata:', { metadataPath, error });\n              }\n            }\n          }\n        }\n      }\n    } catch (error) {\n      logger.error('Failed to cleanup old backups:', error);\n    }\n  }\n\n  /**\n   * Restore from backup\n   */\n  public async restoreFromBackup(backupId: string): Promise<RestoreJob> {\n    try {\n      const backupJob = this.backupJobs.find(job => job.id === backupId);\n      if (!backupJob) {\n        throw new Error(`Backup '${backupId}' not found`);\n      }\n\n      const restoreJob: RestoreJob = {\n        id: this.generateJobId(),\n        backupId,\n        status: 'pending',\n        startTime: new Date(),\n        files: [],\n        metadata: {\n          restoredBy: 'system',\n          environment: process.env.NODE_ENV || 'development',\n        },\n      };\n\n      this.restoreJobs.push(restoreJob);\n      await this.executeRestore(restoreJob, backupJob);\n\n      return restoreJob;\n    } catch (error) {\n      logger.error('Failed to create restore job:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Execute restore\n   */\n  private async executeRestore(restoreJob: RestoreJob, backupJob: BackupJob): Promise<void> {\n    try {\n      restoreJob.status = 'running';\n      logger.info('Starting restore job', { restoreJobId: restoreJob.id, backupId: backupJob.id });\n\n      // Find backup files\n      const backupFiles = await this.findBackupFiles(backupJob);\n\n      if (backupFiles.length === 0) {\n        throw new Error('No backup files found');\n      }\n\n      // Decrypt and decompress files\n      const processedFiles = await this.processRestoreFiles(backupFiles, backupJob);\n\n      // Restore data\n      await this.restoreData(processedFiles, backupJob);\n\n      // Update job status\n      restoreJob.status = 'completed';\n      restoreJob.endTime = new Date();\n      restoreJob.files = processedFiles;\n\n      logger.info('Restore completed successfully', {\n        restoreJobId: restoreJob.id,\n        backupId: backupJob.id,\n        files: restoreJob.files.length,\n      });\n    } catch (error) {\n      restoreJob.status = 'failed';\n      restoreJob.endTime = new Date();\n      restoreJob.error = error instanceof Error ? error.message : 'Unknown error';\n\n      logger.error('Restore failed', {\n        restoreJobId: restoreJob.id,\n        backupId: backupJob.id,\n        error: restoreJob.error,\n      });\n    }\n  }\n\n  /**\n   * Find backup files\n   */\n  private async findBackupFiles(backupJob: BackupJob): Promise<string[]> {\n    const files: string[] = [];\n\n    for (const destination of backupJob.config.destinations) {\n      if (destination.type === 'local') {\n        const dirFiles = await fs.readdir(destination.path);\n\n        for (const file of dirFiles) {\n          if (file.startsWith(backupJob.id)) {\n            files.push(path.join(destination.path, file));\n          }\n        }\n      }\n      // Add other destination types as needed\n    }\n\n    return files;\n  }\n\n  /**\n   * Process restore files (decrypt and decompress)\n   */\n  private async processRestoreFiles(files: string[], backupJob: BackupJob): Promise<string[]> {\n    const processedFiles: string[] = [];\n\n    for (const file of files) {\n      let processedFile = file;\n\n      // Decrypt\n      if (backupJob.config.encryption && file.endsWith('.enc')) {\n        processedFile = await this.decryptFile(file);\n        await fs.unlink(file); // Remove encrypted\n      }\n\n      // Decompress\n      if (backupJob.config.compression && processedFile.endsWith('.gz')) {\n        processedFile = await this.decompressFile(processedFile);\n        await fs.unlink(processedFile); // Remove compressed\n      }\n\n      processedFiles.push(processedFile);\n    }\n\n    return processedFiles;\n  }\n\n  /**\n   * Decrypt file\n   */\n  private async decryptFile(filePath: string): Promise<string> {\n    const decryptedPath = filePath.replace('.enc', '');\n    const encrypted = await fs.readFile(filePath);\n\n    // Simple XOR decryption (in production, use proper decryption)\n    const decrypted = Buffer.from(encrypted.map(byte => byte ^ this.encryptionKey.charCodeAt(0)));\n    await fs.writeFile(decryptedPath, decrypted);\n\n    return decryptedPath;\n  }\n\n  /**\n   * Decompress file\n   */\n  private async decompressFile(filePath: string): Promise<string> {\n    const decompressedPath = filePath.replace('.gz', '');\n    await execAsync(`gunzip \"${filePath}\"`);\n    return decompressedPath;\n  }\n\n  /**\n   * Restore data\n   */\n  private async restoreData(files: string[], backupJob: BackupJob): Promise<void> {\n    try {\n      switch (backupJob.config.type) {\n        case 'database':\n          await this.restoreDatabase(files);\n          break;\n        case 'files':\n          await this.restoreFiles(files);\n          break;\n        case 'logs':\n          await this.restoreLogs(files);\n          break;\n        case 'config':\n          await this.restoreConfig(files);\n          break;\n        case 'full':\n          await this.restoreFull(files);\n          break;\n      }\n\n      logger.info('Data restored successfully', {\n        files: files.length,\n        type: backupJob.config.type,\n      });\n    } catch (error) {\n      logger.error('Data restore failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Restore database\n   */\n  private async restoreDatabase(files: string[]): Promise<void> {\n    for (const file of files) {\n      if (file.includes('database-') && file.endsWith('.sql')) {\n        if (file.includes('mongodb')) {\n          const command = `mongorestore --uri=\"${process.env.MONGODB_URI}\" --drop \"${file}\"`;\n          await execAsync(command);\n        } else if (file.includes('postgres')) {\n          const command = `psql \"${process.env.DATABASE_URL}\" < \"${file}\"`;\n          await execAsync(command);\n        }\n        break;\n      }\n    }\n  }\n\n  /**\n   * Restore files\n   */\n  private async restoreFiles(files: string[]): Promise<void> {\n    for (const file of files) {\n      if (file.includes('files-') && file.endsWith('.tar.gz')) {\n        const command = `tar -xzf \"${file}\" -C .`;\n        await execAsync(command);\n      }\n    }\n  }\n\n  /**\n   * Restore logs\n   */\n  private async restoreLogs(files: string[]): Promise<void> {\n    for (const file of files) {\n      if (file.includes('logs-') && file.endsWith('.tar.gz')) {\n        const command = `tar -xzf \"${file}\" -C .`;\n        await execAsync(command);\n      }\n    }\n  }\n\n  /**\n   * Restore configuration\n   */\n  private async restoreConfig(files: string[]): Promise<void> {\n    for (const file of files) {\n      if (file.includes('config-') && file.endsWith('.tar.gz')) {\n        const command = `tar -xzf \"${file}\" -C .`;\n        await execAsync(command);\n      }\n    }\n  }\n\n  /**\n   * Full restore\n   */\n  private async restoreFull(files: string[]): Promise<void> {\n    await this.restoreDatabase(files);\n    await this.restoreFiles(files);\n    await this.restoreLogs(files);\n    await this.restoreConfig(files);\n  }\n\n  /**\n   * Get backup jobs\n   */\n  public getBackupJobs(): BackupJob[] {\n    return this.backupJobs.sort((a, b) => b.startTime.getTime() - a.startTime.getTime());\n  }\n\n  /**\n   * Get restore jobs\n   */\n  public getRestoreJobs(): RestoreJob[] {\n    return this.restoreJobs.sort((a, b) => b.startTime.getTime() - a.startTime.getTime());\n  }\n\n  /**\n   * Get backup configurations\n   */\n  public getBackupConfigs(): BackupConfig[] {\n    return this.backupConfigs;\n  }\n\n  /**\n   * Add backup configuration\n   */\n  public addBackupConfig(config: BackupConfig): void {\n    this.backupConfigs.push(config);\n    logger.info('Backup configuration added', { name: config.name });\n  }\n\n  /**\n   * Start scheduled backups\n   */\n  private startScheduledBackups(): void {\n    // This would integrate with a cron scheduler\n    // For now, just log that it would start\n    logger.info('Scheduled backups configured', {\n      configs: this.backupConfigs.filter(c => c.enabled).length,\n    });\n  }\n\n  /**\n   * Generate job ID\n   */\n  private generateJobId(): string {\n    return `job_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Get backup statistics\n   */\n  public async getStats(): Promise<{\n    totalBackups: number;\n    successfulBackups: number;\n    failedBackups: number;\n    totalSize: number;\n    averageSize: number;\n    backupsByType: { [key: string]: number };\n    recentBackups: Array<{\n      id: string;\n      type: string;\n      status: string;\n      size: number;\n      timestamp: Date;\n    }>;\n  }> {\n    try {\n      const totalBackups = this.backupJobs.length;\n      const successfulBackups = this.backupJobs.filter(job => job.status === 'completed').length;\n      const failedBackups = this.backupJobs.filter(job => job.status === 'failed').length;\n      const totalSize = this.backupJobs.reduce((sum, job) => sum + job.size, 0);\n      const averageSize = totalBackups > 0 ? totalSize / totalBackups : 0;\n\n      const backupsByType: { [key: string]: number } = {};\n      this.backupJobs.forEach(job => {\n        backupsByType[job.config.type] = (backupsByType[job.config.type] || 0) + 1;\n      });\n\n      const recentBackups = this.backupJobs\n        .sort((a, b) => b.startTime.getTime() - a.startTime.getTime())\n        .slice(0, 10)\n        .map(job => ({\n          id: job.id,\n          type: job.config.type,\n          status: job.status,\n          size: job.size,\n          timestamp: job.startTime,\n        }));\n\n      return {\n        totalBackups,\n        successfulBackups,\n        failedBackups,\n        totalSize,\n        averageSize,\n        backupsByType,\n        recentBackups,\n      };\n    } catch (error) {\n      logger.error('Failed to get backup stats:', error);\n      return {\n        totalBackups: 0,\n        successfulBackups: 0,\n        failedBackups: 0,\n        totalSize: 0,\n        averageSize: 0,\n        backupsByType: {},\n        recentBackups: [],\n      };\n    }\n  }\n}\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\alerting.service.ts","mappings":";;;;;;;;;;;;;;;;AAAA,yCAA+C;AAE/C,oCAAiC;AACjC,4CAAyC;AACzC,qEAAgE;AAChE,yDAAqD;AAG9C,IAAM,eAAe,GAArB,MAAM,eAAe;IAQoB;IACL;IARjC,UAAU,GAAG;QACnB,GAAG,EAAE,EAAE;QACP,MAAM,EAAE,EAAE;QACV,IAAI,EAAE,EAAE;KACT,CAAC;IAEF,YAC8C,cAAoC,EACzC,eAAgC;QAD3B,mBAAc,GAAd,cAAc,CAAsB;QACzC,oBAAe,GAAf,eAAe,CAAiB;IACtE,CAAC;IAEJ;;OAEG;IACH,KAAK,CAAC,iBAAiB;QACrB,IAAI,CAAC;YACH,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,gBAAgB,EAAE,CAAC;YAE7D,IAAI,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;gBACtC,MAAM,IAAI,CAAC,YAAY,CAAC,sBAAsB,OAAO,CAAC,GAAG,GAAG,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;YACtF,CAAC;YAED,IAAI,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;gBAC5C,MAAM,IAAI,CAAC,YAAY,CAAC,yBAAyB,OAAO,CAAC,MAAM,GAAG,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;YAC5F,CAAC;YAED,IAAI,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;gBACxC,MAAM,IAAI,CAAC,YAAY,CAAC,uBAAuB,OAAO,CAAC,IAAI,GAAG,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;YACxF,CAAC;YAED,eAAM,CAAC,IAAI,CAAC,+BAA+B,CAAC,CAAC;QAC/C,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,KAAK,CAAC,CAAC;QACvD,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,iBAAiB;QACrB,IAAI,CAAC;YACH,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,uBAAuB,EAAE,CAAC;YAClE,eAAM,CAAC,IAAI,CAAC,iBAAiB,KAAK,qBAAqB,CAAC,CAAC;YAEzD,IAAI,KAAK,KAAK,CAAC,EAAE,CAAC;gBAChB,MAAM,IAAI,CAAC,YAAY,CAAC,yCAAyC,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;YAC3F,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,+BAA+B,EAAE,KAAK,CAAC,CAAC;QACvD,CAAC;IACH,CAAC;IAEO,KAAK,CAAC,YAAY,CAAC,OAAe,EAAE,eAAgC;QAC1E,eAAM,CAAC,IAAI,CAAC,UAAU,OAAO,EAAE,CAAC,CAAC;QACjC,MAAM,eAAe,CAAC,WAAW,CAAC,oBAAoB,OAAO,EAAE,CAAC,CAAC;IACnE,CAAC;CACF,CAAA;AAzDY,0CAAe;0BAAf,eAAe;IAD3B,IAAA,sBAAU,GAAE;IASR,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,oBAAoB,CAAC,CAAA;IAClC,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,eAAe,CAAC,CAAA;yDAD8B,6CAAoB,oBAApB,6CAAoB,oDACxB,kCAAe,oBAAf,kCAAe;GAT9D,eAAe,CAyD3B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\alerting.service.ts"],"sourcesContent":["import { inject, injectable } from 'inversify';\n\nimport { TYPES } from '../types';\nimport { logger } from '../utils/logger';\nimport { SystemMetricsService } from './system-metrics.service';\nimport { TelegramService } from './telegram.service';\n\n@injectable()\nexport class AlertingService {\n  private thresholds = {\n    cpu: 90,\n    memory: 90,\n    disk: 90,\n  };\n\n  constructor(\n    @inject(TYPES.SystemMetricsService) private metricsService: SystemMetricsService,\n    @inject(TYPES.TelegramService) private telegramService: TelegramService,\n  ) {}\n\n  /**\n   * Check system health and trigger alerts if thresholds are exceeded\n   */\n  async checkSystemHealth(): Promise<void> {\n    try {\n      const metrics = await this.metricsService.getSystemMetrics();\n\n      if (metrics.cpu > this.thresholds.cpu) {\n        await this.triggerAlert(`‚ö†Ô∏è High CPU Usage: ${metrics.cpu}%`, this.telegramService);\n      }\n\n      if (metrics.memory > this.thresholds.memory) {\n        await this.triggerAlert(`‚ö†Ô∏è High Memory Usage: ${metrics.memory}%`, this.telegramService);\n      }\n\n      if (metrics.disk > this.thresholds.disk) {\n        await this.triggerAlert(`‚ö†Ô∏è High Disk Usage: ${metrics.disk}%`, this.telegramService);\n      }\n\n      logger.info('System health check completed');\n    } catch (error) {\n      logger.error('Failed to check system health', error);\n    }\n  }\n\n  /**\n   * Check Docker container health\n   */\n  async checkDockerHealth(): Promise<void> {\n    try {\n      const count = await this.metricsService.getDockerContainerCount();\n      logger.info(`Docker check: ${count} running containers`);\n\n      if (count === 0) {\n        await this.triggerAlert('‚ö†Ô∏è No Docker containers passing checks!', this.telegramService);\n      }\n    } catch (error) {\n      logger.error('Failed to check Docker health', error);\n    }\n  }\n\n  private async triggerAlert(message: string, telegramService: TelegramService) {\n    logger.warn(`ALERT: ${message}`);\n    await telegramService.sendMessage(`üö® SYSTEM ALERT: ${message}`);\n  }\n}\n"],"version":3}
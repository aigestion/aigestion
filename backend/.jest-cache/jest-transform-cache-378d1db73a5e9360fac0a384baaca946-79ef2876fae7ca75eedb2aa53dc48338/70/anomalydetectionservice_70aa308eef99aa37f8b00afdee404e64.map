{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\anomaly-detection.service.ts","mappings":";;;;;;;;;;;;;;;;AAAA,yCAA+C;AAC/C,oCAAiC;AACjC,4CAAyC;AACzC,6CAAyC;AAGlC,IAAM,uBAAuB,GAA7B,MAAM,uBAAuB;IACW;IAA7C,YAA6C,SAAoB;QAApB,cAAS,GAAT,SAAS,CAAW;IAAG,CAAC;IAErE;;OAEG;IACH,KAAK,CAAC,eAAe,CACnB,IAAS;QAMT,eAAM,CAAC,IAAI,CAAC,iDAAiD,CAAC,CAAC;QAE/D,+DAA+D;QAC/D,0EAA0E;QAC1E,MAAM,MAAM,GAAG,sEAAsE,IAAI,CAAC,SAAS,CACjG,IAAI,CACL,uGAAuG,CAAC;QAEzG,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,EAAE,kBAAkB,CAAC,CAAC;YAC5F,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YAEpC,IAAI,MAAM,CAAC,eAAe,EAAE,CAAC;gBAC3B,eAAM,CAAC,IAAI,CACT,6BAA6B,MAAM,CAAC,WAAW,YAAY,MAAM,CAAC,WAAW,GAAG,CACjF,CAAC;YACJ,CAAC;YAED,OAAO,MAAM,CAAC;QAChB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,gDAAgD,KAAK,EAAE,CAAC,CAAC;YACtE,yCAAyC;YACzC,OAAO,EAAE,eAAe,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC;QACxD,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,iBAAiB,CAAC,MAAc,EAAE,WAAkB;QACxD,kDAAkD;QAClD,eAAM,CAAC,IAAI,CAAC,iDAAiD,MAAM,EAAE,CAAC,CAAC;IACzE,CAAC;CACF,CAAA;AA9CY,0DAAuB;kCAAvB,uBAAuB;IADnC,IAAA,sBAAU,GAAE;IAEE,WAAA,IAAA,kBAAM,EAAC,aAAK,CAAC,SAAS,CAAC,CAAA;yDAAoB,sBAAS,oBAAT,sBAAS;GADtD,uBAAuB,CA8CnC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\anomaly-detection.service.ts"],"sourcesContent":["import { inject, injectable } from 'inversify';\nimport { TYPES } from '../types';\nimport { logger } from '../utils/logger';\nimport { AIService } from './ai.service';\n\n@injectable()\nexport class AnomalyDetectionService {\n  constructor(@inject(TYPES.AIService) private aiService: AIService) {}\n\n  /**\n   * Analyzes recent system metrics/logs for anomalies.\n   */\n  async analyzePatterns(\n    data: any,\n  ): Promise<{\n    anomalyDetected: boolean;\n    threatLevel: 'low' | 'medium' | 'high';\n    message?: string;\n  }> {\n    logger.info(`[AnomalyDetection] Analyzing system patterns...`);\n\n    // Real-world: Use a specialized model or statistical analysis.\n    // God-mode: Leverage AIService for high-level semantic anomaly detection.\n    const prompt = `Analyze the following system behavior logs for security anomalies: ${JSON.stringify(\n      data,\n    )}. Return a JSON with \"anomalyDetected\" (boolean), \"threatLevel\" (string), and \"explanation\" (string).`;\n\n    try {\n      const response = await this.aiService.generateContent(prompt, 'system', 'security_analyst');\n      const result = JSON.parse(response);\n\n      if (result.anomalyDetected) {\n        logger.warn(\n          `[AnomalyDetection] ALERT: ${result.explanation} (Level: ${result.threatLevel})`,\n        );\n      }\n\n      return result;\n    } catch (error) {\n      logger.error(`[AnomalyDetection] Error analyzing patterns: ${error}`);\n      // Fallback to basic rule-based detection\n      return { anomalyDetected: false, threatLevel: 'low' };\n    }\n  }\n\n  /**\n   * Specifically checks for \"impossible travel\" or unusual login timing.\n   */\n  async checkUserActivity(userId: string, activityLog: any[]): Promise<void> {\n    // Logic to correlate timestamps and geo-locations\n    logger.info(`[AnomalyDetection] Checking activity for user ${userId}`);\n  }\n}\n"],"version":3}
04e7b455851d838f3fc540848bbd6395
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SwarmController = void 0;
const inversify_1 = require("inversify");
const types_1 = require("../types");
const swarm_service_1 = require("../services/swarm.service");
const response_builder_1 = require("../common/response-builder");
let SwarmController = class SwarmController {
    swarmService;
    constructor(swarmService) {
        this.swarmService = swarmService;
    }
    async createMission(req, res, next) {
        const requestId = req.requestId || 'unknown';
        try {
            const { objective } = req.body;
            const userId = req.user?.id || 'system';
            if (!objective) {
                return res
                    .status(400)
                    .json((0, response_builder_1.buildError)('objective is required', 'BAD_REQUEST', 400, requestId));
            }
            const result = await this.swarmService.createMission(objective, userId);
            return res.json((0, response_builder_1.buildResponse)(result, 200, requestId));
        }
        catch (error) {
            next(error);
        }
    }
    async executeTool(req, res, next) {
        const requestId = req.requestId || 'unknown';
        try {
            const { tool_name, args } = req.body;
            if (!tool_name) {
                return res
                    .status(400)
                    .json((0, response_builder_1.buildError)('tool_name is required', 'BAD_REQUEST', 400, requestId));
            }
            const result = await this.swarmService.executeTool(tool_name, args || {});
            return res.json((0, response_builder_1.buildResponse)(result, 200, requestId));
        }
        catch (error) {
            next(error);
        }
    }
    async getGodState(req, res, next) {
        const requestId = req.requestId || 'unknown';
        try {
            const godState = await this.swarmService.getGodState();
            return res.json((0, response_builder_1.buildResponse)(godState, 200, requestId));
        }
        catch (error) {
            next(error);
        }
    }
    async getMission(req, res, next) {
        const requestId = req.requestId || 'unknown';
        try {
            const { id } = req.params;
            const mission = await this.swarmService.getMission(id);
            return res.json((0, response_builder_1.buildResponse)(mission, 200, requestId));
        }
        catch (error) {
            next(error);
        }
    }
};
exports.SwarmController = SwarmController;
exports.SwarmController = SwarmController = __decorate([
    (0, inversify_1.injectable)(),
    __param(0, (0, inversify_1.inject)(types_1.TYPES.SwarmService)),
    __metadata("design:paramtypes", [typeof (_a = typeof swarm_service_1.SwarmService !== "undefined" && swarm_service_1.SwarmService) === "function" ? _a : Object])
], SwarmController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxjb250cm9sbGVyc1xcc3dhcm0uY29udHJvbGxlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EseUNBQStDO0FBQy9DLG9DQUFpQztBQUNqQyw2REFBeUQ7QUFFekQsaUVBQXVFO0FBR2hFLElBQU0sZUFBZSxHQUFyQixNQUFNLGVBQWU7SUFDc0I7SUFBaEQsWUFBZ0QsWUFBMEI7UUFBMUIsaUJBQVksR0FBWixZQUFZLENBQWM7SUFBRyxDQUFDO0lBRXZFLEtBQUssQ0FBQyxhQUFhLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFTO1FBQy9ELE1BQU0sU0FBUyxHQUFJLEdBQVcsQ0FBQyxTQUFTLElBQUksU0FBUyxDQUFDO1FBQ3RELElBQUksQ0FBQztZQUNILE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQy9CLE1BQU0sTUFBTSxHQUFJLEdBQVcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLFFBQVEsQ0FBQztZQUVqRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ2YsT0FBTyxHQUFHO3FCQUNQLE1BQU0sQ0FBQyxHQUFHLENBQUM7cUJBQ1gsSUFBSSxDQUFDLElBQUEsNkJBQVUsRUFBQyx1QkFBdUIsRUFBRSxhQUFhLEVBQUUsR0FBRyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDOUUsQ0FBQztZQUVELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3hFLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFBLGdDQUFhLEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ3pELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFTSxLQUFLLENBQUMsV0FBVyxDQUFDLEdBQVksRUFBRSxHQUFhLEVBQUUsSUFBUztRQUM3RCxNQUFNLFNBQVMsR0FBSSxHQUFXLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQztRQUN0RCxJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFFckMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUNmLE9BQU8sR0FBRztxQkFDUCxNQUFNLENBQUMsR0FBRyxDQUFDO3FCQUNYLElBQUksQ0FBQyxJQUFBLDZCQUFVLEVBQUMsdUJBQXVCLEVBQUUsYUFBYSxFQUFFLEdBQUcsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQzlFLENBQUM7WUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLENBQUM7WUFDMUUsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUEsZ0NBQWEsRUFBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDekQsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQztJQUVNLEtBQUssQ0FBQyxXQUFXLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFTO1FBQzdELE1BQU0sU0FBUyxHQUFJLEdBQVcsQ0FBQyxTQUFTLElBQUksU0FBUyxDQUFDO1FBQ3RELElBQUksQ0FBQztZQUNILE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN2RCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBQSxnQ0FBYSxFQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUMzRCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDO0lBRU0sS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFZLEVBQUUsR0FBYSxFQUFFLElBQVM7UUFDNUQsTUFBTSxTQUFTLEdBQUksR0FBVyxDQUFDLFNBQVMsSUFBSSxTQUFTLENBQUM7UUFDdEQsSUFBSSxDQUFDO1lBQ0gsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFhLENBQUM7WUFDakMsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN2RCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBQSxnQ0FBYSxFQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUMxRCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQTVEWSwwQ0FBZTswQkFBZixlQUFlO0lBRDNCLElBQUEsc0JBQVUsR0FBRTtJQUVFLFdBQUEsSUFBQSxrQkFBTSxFQUFDLGFBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQTt5REFBdUIsNEJBQVksb0JBQVosNEJBQVk7R0FEL0QsZUFBZSxDQTREM0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxjb250cm9sbGVyc1xcc3dhcm0uY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIsIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBpbmplY3QsIGluamVjdGFibGUgfSBmcm9tICdpbnZlcnNpZnknO1xuaW1wb3J0IHsgVFlQRVMgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBTd2FybVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9zd2FybS5zZXJ2aWNlJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBidWlsZFJlc3BvbnNlLCBidWlsZEVycm9yIH0gZnJvbSAnLi4vY29tbW9uL3Jlc3BvbnNlLWJ1aWxkZXInO1xuXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU3dhcm1Db250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoQGluamVjdChUWVBFUy5Td2FybVNlcnZpY2UpIHByaXZhdGUgc3dhcm1TZXJ2aWNlOiBTd2FybVNlcnZpY2UpIHt9XG5cbiAgcHVibGljIGFzeW5jIGNyZWF0ZU1pc3Npb24ocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcbiAgICBjb25zdCByZXF1ZXN0SWQgPSAocmVxIGFzIGFueSkucmVxdWVzdElkIHx8ICd1bmtub3duJztcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBvYmplY3RpdmUgfSA9IHJlcS5ib2R5O1xuICAgICAgY29uc3QgdXNlcklkID0gKHJlcSBhcyBhbnkpLnVzZXI/LmlkIHx8ICdzeXN0ZW0nO1xuXG4gICAgICBpZiAoIW9iamVjdGl2ZSkge1xuICAgICAgICByZXR1cm4gcmVzXG4gICAgICAgICAgLnN0YXR1cyg0MDApXG4gICAgICAgICAgLmpzb24oYnVpbGRFcnJvcignb2JqZWN0aXZlIGlzIHJlcXVpcmVkJywgJ0JBRF9SRVFVRVNUJywgNDAwLCByZXF1ZXN0SWQpKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zd2FybVNlcnZpY2UuY3JlYXRlTWlzc2lvbihvYmplY3RpdmUsIHVzZXJJZCk7XG4gICAgICByZXR1cm4gcmVzLmpzb24oYnVpbGRSZXNwb25zZShyZXN1bHQsIDIwMCwgcmVxdWVzdElkKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBleGVjdXRlVG9vbChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IGFueSkge1xuICAgIGNvbnN0IHJlcXVlc3RJZCA9IChyZXEgYXMgYW55KS5yZXF1ZXN0SWQgfHwgJ3Vua25vd24nO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHRvb2xfbmFtZSwgYXJncyB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghdG9vbF9uYW1lKSB7XG4gICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAuc3RhdHVzKDQwMClcbiAgICAgICAgICAuanNvbihidWlsZEVycm9yKCd0b29sX25hbWUgaXMgcmVxdWlyZWQnLCAnQkFEX1JFUVVFU1QnLCA0MDAsIHJlcXVlc3RJZCkpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnN3YXJtU2VydmljZS5leGVjdXRlVG9vbCh0b29sX25hbWUsIGFyZ3MgfHwge30pO1xuICAgICAgcmV0dXJuIHJlcy5qc29uKGJ1aWxkUmVzcG9uc2UocmVzdWx0LCAyMDAsIHJlcXVlc3RJZCkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0R29kU3RhdGUocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcbiAgICBjb25zdCByZXF1ZXN0SWQgPSAocmVxIGFzIGFueSkucmVxdWVzdElkIHx8ICd1bmtub3duJztcbiAgICB0cnkge1xuICAgICAgY29uc3QgZ29kU3RhdGUgPSBhd2FpdCB0aGlzLnN3YXJtU2VydmljZS5nZXRHb2RTdGF0ZSgpO1xuICAgICAgcmV0dXJuIHJlcy5qc29uKGJ1aWxkUmVzcG9uc2UoZ29kU3RhdGUsIDIwMCwgcmVxdWVzdElkKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRNaXNzaW9uKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogYW55KSB7XG4gICAgY29uc3QgcmVxdWVzdElkID0gKHJlcSBhcyBhbnkpLnJlcXVlc3RJZCB8fCAndW5rbm93bic7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXMgYXMgYW55O1xuICAgICAgY29uc3QgbWlzc2lvbiA9IGF3YWl0IHRoaXMuc3dhcm1TZXJ2aWNlLmdldE1pc3Npb24oaWQpO1xuICAgICAgcmV0dXJuIHJlcy5qc29uKGJ1aWxkUmVzcG9uc2UobWlzc2lvbiwgMjAwLCByZXF1ZXN0SWQpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\services\\social-media.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\services\\social-media.test.ts"],"sourcesContent":["import 'reflect-metadata';\n\nimport { jest } from '@jest/globals';\nimport axios from 'axios';\nimport { container, TYPES } from '../../config/inversify.config';\n\nimport { env } from '../../config/env.schema';\nimport { InstagramService } from '../../services/instagram.service';\nimport { LinkedInService } from '../../services/linkedin.service';\nimport { TikTokService } from '../../services/tiktok.service';\nimport { XService } from '../../services/x.service';\n\n// Mock axios\njest.mock('axios');\nconst mockedAxios = axios as jest.Mocked<typeof axios>;\n\ndescribe('Social Media Services', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('InstagramService', () => {\n    let service: InstagramService;\n\n    beforeEach(() => {\n      service = container.get<InstagramService>(TYPES.InstagramService);\n      // Mock env vars\n      (env as any).INSTAGRAM_ACCESS_TOKEN = 'test-token';\n      (env as any).INSTAGRAM_BUSINESS_ACCOUNT_ID = 'test-id';\n    });\n\n    it('should send DM', async () => {\n      mockedAxios.post.mockResolvedValueOnce({ data: { success: true } });\n      const result = await service.sendDM('recipient', 'message');\n      expect(result).toEqual({ success: true });\n      expect(mockedAxios.post).toHaveBeenCalledWith(\n        expect.stringContaining('/messages'),\n        expect.objectContaining({\n          recipient: { id: 'recipient' },\n          message: { text: 'message' },\n        }),\n        expect.anything(),\n      );\n    });\n\n    it('should publish photo', async () => {\n      // Mock container creation\n      mockedAxios.post.mockResolvedValueOnce({ data: { id: 'container-id' } });\n      // Mock publish\n      mockedAxios.post.mockResolvedValueOnce({ data: { id: 'media-id' } });\n\n      const result = await service.publishPhoto('http://image.jpg', 'caption');\n      expect(result).toBe('media-id');\n      expect(mockedAxios.post).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  describe('LinkedInService', () => {\n    let service: LinkedInService;\n\n    beforeEach(() => {\n      service = container.get<LinkedInService>(TYPES.LinkedInService);\n      (env as any).LINKEDIN_ACCESS_TOKEN = 'test-token';\n      (env as any).LINKEDIN_ORGANIZATION_URN = '12345';\n    });\n\n    it('should share post', async () => {\n      mockedAxios.post.mockResolvedValueOnce({ data: { id: 'urn:li:share:123' } });\n      const result = await service.sharePost('Hello LinkedIn');\n      expect(result.id).toBe('urn:li:share:123');\n      expect(mockedAxios.post).toHaveBeenCalledWith(\n        expect.stringContaining('/ugcPosts'),\n        expect.objectContaining({\n          author: 'urn:li:organization:12345',\n          specificContent: expect.objectContaining({\n            'com.linkedin.ugc.ShareContent': expect.objectContaining({\n              shareCommentary: { text: 'Hello LinkedIn' },\n            }),\n          }),\n        }),\n        expect.anything(),\n      );\n    });\n  });\n\n  describe('TikTokService', () => {\n    let service: TikTokService;\n\n    beforeEach(() => {\n      service = container.get<TikTokService>(TYPES.TikTokService);\n      (env as any).TIKTOK_ACCESS_TOKEN = 'test-token';\n    });\n\n    it('should initialize video upload', async () => {\n      mockedAxios.post.mockResolvedValueOnce({ data: { data: { upload_url: 'http://upload' } } });\n      const result = await service.publishVideo('http://video.mp4', 'Title');\n      expect(result).toBeDefined();\n      expect(mockedAxios.post).toHaveBeenCalledWith(\n        expect.stringContaining('/post/publish/video/init/'),\n        expect.objectContaining({\n          post_info: expect.objectContaining({ title: 'Title' }),\n        }),\n        expect.anything(),\n      );\n    });\n  });\n\n  describe('XService', () => {\n    let service: XService;\n\n    beforeEach(() => {\n      service = container.get<XService>(TYPES.XService);\n      (env as any).X_ACCESS_TOKEN = 'test-token';\n    });\n\n    it('should post tweet', async () => {\n      mockedAxios.post.mockResolvedValueOnce({ data: { data: { id: 'tweet-id' } } });\n      const result = await service.postTweet('Hello X');\n      expect(result.data.id).toBe('tweet-id');\n      expect(mockedAxios.post).toHaveBeenCalledWith(\n        expect.stringContaining('/tweets'),\n        expect.objectContaining({\n          text: 'Hello X',\n        }),\n        expect.anything(),\n      );\n    });\n  });\n});\n"],"version":3}
c5ead40df8d9712a8636e6e8ec3b9b51
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = void 0;
// src/utils/logger.ts
const pino_1 = __importDefault(require("pino"));
const context_1 = require("./context");
// Configuration
const isDev = process.env.NODE_ENV === 'development';
const pinoLogger = (0, pino_1.default)({
    level: process.env.LOG_LEVEL || 'info',
    // In production, log JSON to stdout (best for Cloud Run/K8s).
    // In dev, use pino-pretty for readability.
    transport: isDev
        ? {
            target: 'pino-pretty',
            options: {
                colorize: true,
                translateTime: 'SYS:standard',
                ignore: 'pid,hostname',
            },
        }
        : undefined,
    mixin() {
        const store = context_1.requestContext.getStore?.();
        return store ? { requestId: store.get('requestId') } : {};
    },
});
// Helper to support both (msg, meta) and (meta, msg) signatures
// Compatible with Winston legacy usage
function wrap(method) {
    return (arg1, arg2, ...rest) => {
        // Determine which argument is the message and which is the object
        if (typeof arg1 === 'string') {
            if (arg2 && typeof arg2 === 'object') {
                // (msg, meta) -> Pino (meta, msg)
                pinoLogger[method](arg2, arg1, ...rest);
            }
            else {
                // (msg)
                pinoLogger[method](arg1, arg2, ...rest);
            }
        }
        else if (typeof arg1 === 'object' && typeof arg2 === 'string') {
            // (meta, msg) -> Pino (meta, msg)
            pinoLogger[method](arg1, arg2, ...rest);
        }
        else {
            // Fallback
            pinoLogger[method](arg1, arg2, ...rest);
        }
    };
}
exports.logger = {
    info: wrap('info'),
    error: wrap('error'),
    warn: wrap('warn'),
    debug: wrap('debug'),
    verbose: wrap('trace'), // Map verbose to trace
    silly: wrap('trace'), // Map silly to trace
};
exports.default = exports.logger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFx1dGlsc1xcbG9nZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHNCQUFzQjtBQUN0QixnREFBd0I7QUFDeEIsdUNBQTJDO0FBRTNDLGdCQUFnQjtBQUNoQixNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxhQUFhLENBQUM7QUFFckQsTUFBTSxVQUFVLEdBQUcsSUFBQSxjQUFJLEVBQUM7SUFDdEIsS0FBSyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLE1BQU07SUFDdEMsOERBQThEO0lBQzlELDJDQUEyQztJQUMzQyxTQUFTLEVBQUUsS0FBSztRQUNkLENBQUMsQ0FBQztZQUNFLE1BQU0sRUFBRSxhQUFhO1lBQ3JCLE9BQU8sRUFBRTtnQkFDUCxRQUFRLEVBQUUsSUFBSTtnQkFDZCxhQUFhLEVBQUUsY0FBYztnQkFDN0IsTUFBTSxFQUFFLGNBQWM7YUFDdkI7U0FDRjtRQUNILENBQUMsQ0FBQyxTQUFTO0lBQ2IsS0FBSztRQUNILE1BQU0sS0FBSyxHQUFHLHdCQUFjLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQztRQUMxQyxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDNUQsQ0FBQztDQUNGLENBQUMsQ0FBQztBQUVILGdFQUFnRTtBQUNoRSx1Q0FBdUM7QUFDdkMsU0FBUyxJQUFJLENBQUMsTUFBK0Q7SUFDM0UsT0FBTyxDQUFDLElBQVMsRUFBRSxJQUFVLEVBQUUsR0FBRyxJQUFXLEVBQUUsRUFBRTtRQUMvQyxrRUFBa0U7UUFDbEUsSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLEVBQUUsQ0FBQztZQUM3QixJQUFJLElBQUksSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLEVBQUUsQ0FBQztnQkFDckMsa0NBQWtDO2dCQUNsQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQzFDLENBQUM7aUJBQU0sQ0FBQztnQkFDTixRQUFRO2dCQUNSLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDMUMsQ0FBQztRQUNILENBQUM7YUFBTSxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLEVBQUUsQ0FBQztZQUNoRSxrQ0FBa0M7WUFDbEMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUMxQyxDQUFDO2FBQU0sQ0FBQztZQUNOLFdBQVc7WUFDWCxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQzFDLENBQUM7SUFDSCxDQUFDLENBQUM7QUFDSixDQUFDO0FBRVksUUFBQSxNQUFNLEdBQUc7SUFDcEIsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDbEIsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDcEIsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDbEIsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDcEIsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSx1QkFBdUI7SUFDL0MsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxxQkFBcUI7Q0FDNUMsQ0FBQztBQUVGLGtCQUFlLGNBQU0sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFsZWphbmRyb1xcQUlHZXN0aW9uXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxsb2dnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3V0aWxzL2xvZ2dlci50c1xuaW1wb3J0IHBpbm8gZnJvbSAncGlubyc7XG5pbXBvcnQgeyByZXF1ZXN0Q29udGV4dCB9IGZyb20gJy4vY29udGV4dCc7XG5cbi8vIENvbmZpZ3VyYXRpb25cbmNvbnN0IGlzRGV2ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XG5cbmNvbnN0IHBpbm9Mb2dnZXIgPSBwaW5vKHtcbiAgbGV2ZWw6IHByb2Nlc3MuZW52LkxPR19MRVZFTCB8fCAnaW5mbycsXG4gIC8vIEluIHByb2R1Y3Rpb24sIGxvZyBKU09OIHRvIHN0ZG91dCAoYmVzdCBmb3IgQ2xvdWQgUnVuL0s4cykuXG4gIC8vIEluIGRldiwgdXNlIHBpbm8tcHJldHR5IGZvciByZWFkYWJpbGl0eS5cbiAgdHJhbnNwb3J0OiBpc0RldlxuICAgID8ge1xuICAgICAgICB0YXJnZXQ6ICdwaW5vLXByZXR0eScsXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBjb2xvcml6ZTogdHJ1ZSxcbiAgICAgICAgICB0cmFuc2xhdGVUaW1lOiAnU1lTOnN0YW5kYXJkJyxcbiAgICAgICAgICBpZ25vcmU6ICdwaWQsaG9zdG5hbWUnLFxuICAgICAgICB9LFxuICAgICAgfVxuICAgIDogdW5kZWZpbmVkLFxuICBtaXhpbigpIHtcbiAgICBjb25zdCBzdG9yZSA9IHJlcXVlc3RDb250ZXh0LmdldFN0b3JlPy4oKTtcbiAgICByZXR1cm4gc3RvcmUgPyB7IHJlcXVlc3RJZDogc3RvcmUuZ2V0KCdyZXF1ZXN0SWQnKSB9IDoge307XG4gIH0sXG59KTtcblxuLy8gSGVscGVyIHRvIHN1cHBvcnQgYm90aCAobXNnLCBtZXRhKSBhbmQgKG1ldGEsIG1zZykgc2lnbmF0dXJlc1xuLy8gQ29tcGF0aWJsZSB3aXRoIFdpbnN0b24gbGVnYWN5IHVzYWdlXG5mdW5jdGlvbiB3cmFwKG1ldGhvZDogJ2luZm8nIHwgJ2Vycm9yJyB8ICd3YXJuJyB8ICdkZWJ1ZycgfCAndHJhY2UnIHwgJ2ZhdGFsJykge1xuICByZXR1cm4gKGFyZzE6IGFueSwgYXJnMj86IGFueSwgLi4ucmVzdDogYW55W10pID0+IHtcbiAgICAvLyBEZXRlcm1pbmUgd2hpY2ggYXJndW1lbnQgaXMgdGhlIG1lc3NhZ2UgYW5kIHdoaWNoIGlzIHRoZSBvYmplY3RcbiAgICBpZiAodHlwZW9mIGFyZzEgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAoYXJnMiAmJiB0eXBlb2YgYXJnMiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gKG1zZywgbWV0YSkgLT4gUGlubyAobWV0YSwgbXNnKVxuICAgICAgICBwaW5vTG9nZ2VyW21ldGhvZF0oYXJnMiwgYXJnMSwgLi4ucmVzdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyAobXNnKVxuICAgICAgICBwaW5vTG9nZ2VyW21ldGhvZF0oYXJnMSwgYXJnMiwgLi4ucmVzdCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgYXJnMSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGFyZzIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAvLyAobWV0YSwgbXNnKSAtPiBQaW5vIChtZXRhLCBtc2cpXG4gICAgICBwaW5vTG9nZ2VyW21ldGhvZF0oYXJnMSwgYXJnMiwgLi4ucmVzdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZhbGxiYWNrXG4gICAgICBwaW5vTG9nZ2VyW21ldGhvZF0oYXJnMSwgYXJnMiwgLi4ucmVzdCk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgY29uc3QgbG9nZ2VyID0ge1xuICBpbmZvOiB3cmFwKCdpbmZvJyksXG4gIGVycm9yOiB3cmFwKCdlcnJvcicpLFxuICB3YXJuOiB3cmFwKCd3YXJuJyksXG4gIGRlYnVnOiB3cmFwKCdkZWJ1ZycpLFxuICB2ZXJib3NlOiB3cmFwKCd0cmFjZScpLCAvLyBNYXAgdmVyYm9zZSB0byB0cmFjZVxuICBzaWxseTogd3JhcCgndHJhY2UnKSwgLy8gTWFwIHNpbGx5IHRvIHRyYWNlXG59O1xuXG5leHBvcnQgZGVmYXVsdCBsb2dnZXI7XG4iXSwidmVyc2lvbiI6M30=
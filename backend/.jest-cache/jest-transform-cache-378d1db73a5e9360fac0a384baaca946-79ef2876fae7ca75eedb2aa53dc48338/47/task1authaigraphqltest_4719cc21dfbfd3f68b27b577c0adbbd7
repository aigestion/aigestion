6ed654b37a4af95578302ee38995fc92
/**
 * Task 1.3: Auth & AI GraphQL Integration Tests
 *
 * These tests require a fully booted Express app with InversifyJS-resolved controllers.
 * The app boot process triggers module-level container.get() calls for ALL controllers
 * (DanielaController, GodModeController, etc.), making it impossible to partially mock
 * the IoC container for targeted tests.
 *
 * To run these tests: RUN_INTEGRATION_TESTS=true npx jest --runInBand task1-auth-ai-graphql
 */
const SKIP = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;
(SKIP ? describe.skip : describe)('Task 1.3: Auth & AI GraphQL', () => {
    jest.setTimeout(30000);
    it('should return token and user on successful login', async () => {
        const request = require('supertest');
        const { app } = require('../app');
        const mutation = `
      mutation {
        login(email: "test@example.com", password: "AIGestion2026!") {
          token
          user {
            id
            email
            name
          }
        }
      }
    `;
        const response = await request(app)
            .post('/graphql')
            .set('Content-Type', 'application/json')
            .send({ query: mutation });
        expect(response.status).toBe(200);
        expect(response.body.errors).toBeUndefined();
        expect(response.body.data.login).toBeDefined();
        expect(response.body.data.login.token).toBe('mock_jwt_token');
        expect(response.body.data.login.user.email).toBe('test@example.com');
    });
    it('should return AI response', async () => {
        const request = require('supertest');
        const { app } = require('../app');
        const query = `
      query {
        chat(message: "Hello Nexus")
      }
    `;
        const response = await request(app)
            .post('/graphql')
            .set('Content-Type', 'application/json')
            .send({ query });
        expect(response.status).toBe(200);
        expect(response.body.errors).toBeUndefined();
        expect(response.body.data.chat).toBe('This is a mock AI response');
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxfX3Rlc3RzX19cXHRhc2sxLWF1dGgtYWktZ3JhcGhxbC50ZXN0LnRzIiwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7R0FTRztBQUVILE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUM7QUFFbkYsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtJQUNwRSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZCLEVBQUUsQ0FBQyxrREFBa0QsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNoRSxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUVsQyxNQUFNLFFBQVEsR0FBRzs7Ozs7Ozs7Ozs7S0FXaEIsQ0FBQztRQUVGLE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQzthQUNoQyxJQUFJLENBQUMsVUFBVSxDQUFDO2FBQ2hCLEdBQUcsQ0FBQyxjQUFjLEVBQUUsa0JBQWtCLENBQUM7YUFDdkMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFFN0IsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDN0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9DLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDOUQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDdkUsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMkJBQTJCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDekMsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFbEMsTUFBTSxLQUFLLEdBQUc7Ozs7S0FJYixDQUFDO1FBRUYsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDO2FBQ2hDLElBQUksQ0FBQyxVQUFVLENBQUM7YUFDaEIsR0FBRyxDQUFDLGNBQWMsRUFBRSxrQkFBa0IsQ0FBQzthQUN2QyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBRW5CLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzdDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsQ0FBQztJQUNyRSxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcQWxlamFuZHJvXFxBSUdlc3Rpb25cXGJhY2tlbmRcXHNyY1xcX190ZXN0c19fXFx0YXNrMS1hdXRoLWFpLWdyYXBocWwudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRhc2sgMS4zOiBBdXRoICYgQUkgR3JhcGhRTCBJbnRlZ3JhdGlvbiBUZXN0c1xuICpcbiAqIFRoZXNlIHRlc3RzIHJlcXVpcmUgYSBmdWxseSBib290ZWQgRXhwcmVzcyBhcHAgd2l0aCBJbnZlcnNpZnlKUy1yZXNvbHZlZCBjb250cm9sbGVycy5cbiAqIFRoZSBhcHAgYm9vdCBwcm9jZXNzIHRyaWdnZXJzIG1vZHVsZS1sZXZlbCBjb250YWluZXIuZ2V0KCkgY2FsbHMgZm9yIEFMTCBjb250cm9sbGVyc1xuICogKERhbmllbGFDb250cm9sbGVyLCBHb2RNb2RlQ29udHJvbGxlciwgZXRjLiksIG1ha2luZyBpdCBpbXBvc3NpYmxlIHRvIHBhcnRpYWxseSBtb2NrXG4gKiB0aGUgSW9DIGNvbnRhaW5lciBmb3IgdGFyZ2V0ZWQgdGVzdHMuXG4gKlxuICogVG8gcnVuIHRoZXNlIHRlc3RzOiBSVU5fSU5URUdSQVRJT05fVEVTVFM9dHJ1ZSBucHggamVzdCAtLXJ1bkluQmFuZCB0YXNrMS1hdXRoLWFpLWdyYXBocWxcbiAqL1xuXG5jb25zdCBTS0lQID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyAmJiAhcHJvY2Vzcy5lbnYuUlVOX0lOVEVHUkFUSU9OX1RFU1RTO1xuXG4oU0tJUCA/IGRlc2NyaWJlLnNraXAgOiBkZXNjcmliZSkoJ1Rhc2sgMS4zOiBBdXRoICYgQUkgR3JhcGhRTCcsICgpID0+IHtcbiAgamVzdC5zZXRUaW1lb3V0KDMwMDAwKTtcbiAgaXQoJ3Nob3VsZCByZXR1cm4gdG9rZW4gYW5kIHVzZXIgb24gc3VjY2Vzc2Z1bCBsb2dpbicsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XG4gICAgY29uc3QgeyBhcHAgfSA9IHJlcXVpcmUoJy4uL2FwcCcpO1xuXG4gICAgY29uc3QgbXV0YXRpb24gPSBgXG4gICAgICBtdXRhdGlvbiB7XG4gICAgICAgIGxvZ2luKGVtYWlsOiBcInRlc3RAZXhhbXBsZS5jb21cIiwgcGFzc3dvcmQ6IFwiQUlHZXN0aW9uMjAyNiFcIikge1xuICAgICAgICAgIHRva2VuXG4gICAgICAgICAgdXNlciB7XG4gICAgICAgICAgICBpZFxuICAgICAgICAgICAgZW1haWxcbiAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgIC5wb3N0KCcvZ3JhcGhxbCcpXG4gICAgICAuc2V0KCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAgICAuc2VuZCh7IHF1ZXJ5OiBtdXRhdGlvbiB9KTtcblxuICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcnMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhLmxvZ2luKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEubG9naW4udG9rZW4pLnRvQmUoJ21vY2tfand0X3Rva2VuJyk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS5sb2dpbi51c2VyLmVtYWlsKS50b0JlKCd0ZXN0QGV4YW1wbGUuY29tJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmV0dXJuIEFJIHJlc3BvbnNlJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcbiAgICBjb25zdCB7IGFwcCB9ID0gcmVxdWlyZSgnLi4vYXBwJyk7XG5cbiAgICBjb25zdCBxdWVyeSA9IGBcbiAgICAgIHF1ZXJ5IHtcbiAgICAgICAgY2hhdChtZXNzYWdlOiBcIkhlbGxvIE5leHVzXCIpXG4gICAgICB9XG4gICAgYDtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAucG9zdCgnL2dyYXBocWwnKVxuICAgICAgLnNldCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKVxuICAgICAgLnNlbmQoeyBxdWVyeSB9KTtcblxuICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcnMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhLmNoYXQpLnRvQmUoJ1RoaXMgaXMgYSBtb2NrIEFJIHJlc3BvbnNlJyk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=
2e171f3a278b6ad0278c744e83fc1cf3
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.pineconeService = exports.PineconeService = void 0;
const pinecone_1 = require("@pinecone-database/pinecone");
const inversify_1 = require("inversify");
const env_schema_1 = require("../config/env.schema");
const logger_1 = require("../utils/logger");
const vertex_ai_service_1 = require("./google/vertex-ai.service");
let PineconeService = class PineconeService {
    client = null;
    indexName = 'aigestion-docs';
    constructor() {
        this.initialize();
    }
    initialize() {
        if (env_schema_1.env.PINECONE_API_KEY) {
            try {
                this.client = new pinecone_1.Pinecone({
                    apiKey: env_schema_1.env.PINECONE_API_KEY,
                });
                logger_1.logger.info('[PineconeService] Client initialized');
            }
            catch (error) {
                logger_1.logger.error('[PineconeService] Failed to initialize client', error);
            }
        }
        else {
            logger_1.logger.warn('[PineconeService] PINECONE_API_KEY not set. Service disabled.');
        }
    }
    /**
     * Upserts document embeddings into Pinecone
     */
    async upsertDocument(id, text, metadata) {
        await this.upsertDocBatch([{ id, text, metadata }]);
    }
    /**
     * Upserts a batch of documents into Pinecone
     */
    async upsertDocBatch(documents, namespace = 'default') {
        if (!this.client) {
            logger_1.logger.warn('[PineconeService] Client not initialized. Skipping batch upsert.');
            return;
        }
        try {
            const index = this.client.index(this.indexName);
            const ns = index.namespace(namespace);
            // Generate Embeddings in parallel
            const records = await Promise.all(documents.map(async (doc) => {
                const embedding = await vertex_ai_service_1.vertexAIService.generateEmbeddings(doc.text);
                if (embedding.length === 0) {
                    throw new Error(`Failed to generate embeddings for document ${doc.id}`);
                }
                return {
                    id: doc.id,
                    values: embedding,
                    metadata: {
                        ...doc.metadata,
                        text: doc.text.substring(0, 3000), // Increased context length
                        timestamp: new Date().toISOString(),
                    },
                };
            }));
            if (records.length > 0) {
                // Pinecone recommends batches of ~100
                const batchSize = 100;
                for (let i = 0; i < records.length; i += batchSize) {
                    const batch = records.slice(i, i + batchSize);
                    await ns.upsert(batch);
                }
                logger_1.logger.info(`[PineconeService] Successfully upserted ${records.length} documents into namespace: ${namespace}`);
            }
        }
        catch (error) {
            logger_1.logger.error('[PineconeService] Error in batch upsert to Pinecone:', error);
            throw error;
        }
    }
    /**
     * Searches for similar documents
     */
    async search(queryText, topK = 5, namespace = 'default', filter) {
        if (!this.client) {
            logger_1.logger.warn('[PineconeService] Client not initialized. Returning empty results.');
            return [];
        }
        try {
            const embedding = await vertex_ai_service_1.vertexAIService.generateEmbeddings(queryText);
            const index = this.client.index(this.indexName);
            const ns = index.namespace(namespace);
            const queryResponse = await ns.query({
                vector: embedding,
                topK,
                filter,
                includeMetadata: true,
            });
            return queryResponse.matches || [];
        }
        catch (error) {
            logger_1.logger.error('[PineconeService] Error searching Pinecone:', error);
            throw error;
        }
    }
};
exports.PineconeService = PineconeService;
exports.PineconeService = PineconeService = __decorate([
    (0, inversify_1.injectable)(),
    __metadata("design:paramtypes", [])
], PineconeService);
exports.pineconeService = new PineconeService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xccGluZWNvbmUuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwwREFBdUU7QUFDdkUseUNBQXVDO0FBQ3ZDLHFEQUEyQztBQUMzQyw0Q0FBeUM7QUFDekMsa0VBQTZEO0FBR3RELElBQU0sZUFBZSxHQUFyQixNQUFNLGVBQWU7SUFDbEIsTUFBTSxHQUFlLElBQUksQ0FBQztJQUMxQixTQUFTLEdBQUcsZ0JBQWdCLENBQUM7SUFFckM7UUFDRSxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVPLFVBQVU7UUFDaEIsSUFBSSxnQkFBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDekIsSUFBSSxDQUFDO2dCQUNILElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxtQkFBUSxDQUFDO29CQUN6QixNQUFNLEVBQUUsZ0JBQUcsQ0FBQyxnQkFBZ0I7aUJBQzdCLENBQUMsQ0FBQztnQkFDSCxlQUFNLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxDQUFDLENBQUM7WUFDdEQsQ0FBQztZQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7Z0JBQ2YsZUFBTSxDQUFDLEtBQUssQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN2RSxDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDTixlQUFNLENBQUMsSUFBSSxDQUFDLCtEQUErRCxDQUFDLENBQUM7UUFDL0UsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxjQUFjLENBQUMsRUFBVSxFQUFFLElBQVksRUFBRSxRQUFhO1FBQzFELE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGNBQWMsQ0FDbEIsU0FBd0QsRUFDeEQs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QUcsTUFBTSxFQUFFLENBQUMsS0FBSyxDQUFDO2dCQUNuQyxNQUFNLEVBQUUsU0FBUztnQkFDakIsSUFBSTtnQkFDSixNQUFNO2dCQUNOLGVBQWUsRUFBRSxJQUFJO2FBQ3RCLENBQUMsQ0FBQztZQUVILE9BQU8sYUFBYSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFDckMsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixlQUFNLENBQUMsS0FBSyxDQUFDLDZDQUE2QyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ25FLE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7Q0FDRixDQUFBO0FBbEhZLDBDQUFlOzBCQUFmLGVBQWU7SUFEM0IsSUFBQSxzQkFBVSxHQUFFOztHQUNBLGVBQWUsQ0FrSDNCO0FBQ1ksUUFBQSxlQUFlLEdBQUcsSUFBSSxlQUFlLEVBQUUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFsZWphbmRyb1xcQUlHZXN0aW9uXFxiYWNrZW5kXFxzcmNcXHNlcnZpY2VzXFxwaW5lY29uZS5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBpbmVjb25lLCBQaW5lY29uZVJlY29yZCB9IGZyb20gJ0BwaW5lY29uZS1kYXRhYmFzZS9waW5lY29uZSc7XG5pbXBvcnQgeyBpbmplY3RhYmxlIH0gZnJvbSAnaW52ZXJzaWZ5JztcbmltcG9ydCB7IGVudiB9IGZyb20gJy4uL2NvbmZpZy9lbnYuc2NoZW1hJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyB2ZXJ0ZXhBSVNlcnZpY2UgfSBmcm9tICcuL2dvb2dsZS92ZXJ0ZXgtYWkuc2VydmljZSc7XG5cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQaW5lY29uZVNlcnZpY2Uge1xuICBwcml2YXRlIGNsaWVudDogYW55IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgaW5kZXhOYW1lID0gJ2FpZ2VzdGlvbi1kb2NzJztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmluaXRpYWxpemUoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZSgpIHtcbiAgICBpZiAoZW52LlBJTkVDT05FX0FQSV9LRVkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuY2xpZW50ID0gbmV3IFBpbmVjb25lKHtcbiAgICAgICAgICBhcGlLZXk6IGVudi5QSU5FQ09ORV9BUElfS0VZLFxuICAgICAgICB9KTtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ1tQaW5lY29uZVNlcnZpY2VdIENsaWVudCBpbml0aWFsaXplZCcpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdbUGluZWNvbmVTZXJ2aWNlXSBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBjbGllbnQnLCBlcnJvcik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci53YXJuKCdbUGluZWNvbmVTZXJ2aWNlXSBQSU5FQ09ORV9BUElfS0VZIG5vdCBzZXQuIFNlcnZpY2UgZGlzYWJsZWQuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwc2VydHMgZG9jdW1lbnQgZW1iZWRkaW5ncyBpbnRvIFBpbmVjb25lXG4gICAqL1xuICBhc3luYyB1cHNlcnREb2N1bWVudChpZDogc3RyaW5nLCB0ZXh0OiBzdHJpbmcsIG1ldGFkYXRhOiBhbnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLnVwc2VydERvY0JhdGNoKFt7IGlkLCB0ZXh0LCBtZXRhZGF0YSB9XSk7XG4gIH1cblxuICAvKipcbiAgICogVXBzZXJ0cyBhIGJhdGNoIG9mIGRvY3VtZW50cyBpbnRvIFBpbmVjb25lXG4gICAqL1xuICBhc3luYyB1cHNlcnREb2NCYXRjaChcbiAgICBkb2N1bWVudHM6IHsgaWQ6IHN0cmluZzsgdGV4dDogc3RyaW5nOyBtZXRhZGF0YTogYW55IH1bXSxcbiAgICBuYW1lc3BhY2U6IHN0cmluZyA9ICdkZWZhdWx0JyxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNsaWVudCkge1xuICAgICAgbG9nZ2VyLndhcm4oJ1tQaW5lY29uZVNlcnZpY2VdIENsaWVudCBub3QgaW5pdGlhbGl6ZWQuIFNraXBwaW5nIGJhdGNoIHVwc2VydC4nKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmNsaWVudC5pbmRleCh0aGlzLmluZGV4TmFtZSk7XG4gICAgICBjb25zdCBucyA9IGluZGV4Lm5hbWVzcGFjZShuYW1lc3BhY2UpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSBFbWJlZGRpbmdzIGluIHBhcmFsbGVsXG4gICAgICBjb25zdCByZWNvcmRzOiBhbnlbXSA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICBkb2N1bWVudHMubWFwKGFzeW5jIGRvYyA9PiB7XG4gICAgICAgICAgY29uc3QgZW1iZWRkaW5nID0gYXdhaXQgdmVydGV4QUlTZXJ2aWNlLmdlbmVyYXRlRW1iZWRkaW5ncyhkb2MudGV4dCk7XG4gICAgICAgICAgaWYgKGVtYmVkZGluZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdlbmVyYXRlIGVtYmVkZGluZ3MgZm9yIGRvY3VtZW50ICR7ZG9jLmlkfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQ6IGRvYy5pZCxcbiAgICAgICAgICAgIHZhbHVlczogZW1iZWRkaW5nLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgLi4uZG9jLm1ldGFkYXRhLFxuICAgICAgICAgICAgICB0ZXh0OiBkb2MudGV4dC5zdWJzdHJpbmcoMCwgMzAwMCksIC8vIEluY3JlYXNlZCBjb250ZXh0IGxlbmd0aFxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSBhcyBhbnk7XG4gICAgICAgIH0pLFxuICAgICAgKTtcblxuICAgICAgaWYgKHJlY29yZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBQaW5lY29uZSByZWNvbW1lbmRzIGJhdGNoZXMgb2YgfjEwMFxuICAgICAgICBjb25zdCBiYXRjaFNpemUgPSAxMDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVjb3Jkcy5sZW5ndGg7IGkgKz0gYmF0Y2hTaXplKSB7XG4gICAgICAgICAgY29uc3QgYmF0Y2ggPSByZWNvcmRzLnNsaWNlKGksIGkgKyBiYXRjaFNpemUpO1xuICAgICAgICAgIGF3YWl0IG5zLnVwc2VydChiYXRjaCk7XG4gICAgICAgIH1cbiAgICAgICAgbG9nZ2VyLmluZm8oXG4gICAgICAgICAgYFtQaW5lY29uZVNlcnZpY2VdIFN1Y2Nlc3NmdWxseSB1cHNlcnRlZCAke3JlY29yZHMubGVuZ3RofSBkb2N1bWVudHMgaW50byBuYW1lc3BhY2U6ICR7bmFtZXNwYWNlfWAsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignW1BpbmVjb25lU2VydmljZV0gRXJyb3IgaW4gYmF0Y2ggdXBzZXJ0IHRvIFBpbmVjb25lOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZWFyY2hlcyBmb3Igc2ltaWxhciBkb2N1bWVudHNcbiAgICovXG4gIGFzeW5jIHNlYXJjaChcbiAgICBxdWVyeVRleHQ6IHN0cmluZyxcbiAgICB0b3BLOiBudW1iZXIgPSA1LFxuICAgIG5hbWVzcGFjZTogc3RyaW5nID0gJ2RlZmF1bHQnLFxuICAgIGZpbHRlcj86IG9iamVjdCxcbiAgKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIGlmICghdGhpcy5jbGllbnQpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdbUGluZWNvbmVTZXJ2aWNlXSBDbGllbnQgbm90IGluaXRpYWxpemVkLiBSZXR1cm5pbmcgZW1wdHkgcmVzdWx0cy4nKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgZW1iZWRkaW5nID0gYXdhaXQgdmVydGV4QUlTZXJ2aWNlLmdlbmVyYXRlRW1iZWRkaW5ncyhxdWVyeVRleHQpO1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmNsaWVudC5pbmRleCh0aGlzLmluZGV4TmFtZSk7XG4gICAgICBjb25zdCBucyA9IGluZGV4Lm5hbWVzcGFjZShuYW1lc3BhY2UpO1xuXG4gICAgICBjb25zdCBxdWVyeVJlc3BvbnNlID0gYXdhaXQgbnMucXVlcnkoe1xuICAgICAgICB2ZWN0b3I6IGVtYmVkZGluZyxcbiAgICAgICAgdG9wSyxcbiAgICAgICAgZmlsdGVyLFxuICAgICAgICBpbmNsdWRlTWV0YWRhdGE6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHF1ZXJ5UmVzcG9uc2UubWF0Y2hlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdbUGluZWNvbmVTZXJ2aWNlXSBFcnJvciBzZWFyY2hpbmcgUGluZWNvbmU6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG5leHBvcnQgY29uc3QgcGluZWNvbmVTZXJ2aWNlID0gbmV3IFBpbmVjb25lU2VydmljZSgpO1xuIl0sInZlcnNpb24iOjN9
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\api-v1.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\__tests__\\api-v1.test.ts"],"sourcesContent":["/**\r\n * Sprint 1: Task 1.1 - REST API Refactoring Tests\r\n * \r\n * Standardized for God Mode Phase 5\r\n */\r\n\r\nimport request from 'supertest';\r\nimport { app } from '../app';\r\nimport { User } from '../models/User';\r\n\r\nconst SKIP_DB_TESTS = process.env.NODE_ENV === 'test' && !process.env.RUN_INTEGRATION_TESTS;\r\n\r\n(SKIP_DB_TESTS ? describe.skip : describe)('API v1 - REST Refactoring', () => {\r\n  let testUserId: string;\r\n\r\n  beforeAll(async () => {\r\n    // Cleanup test users to prevent 409 Conflict\r\n    await User.deleteMany({\r\n      email: { $in: ['api-v1-test@example.com'] },\r\n    });\r\n\r\n    // Create a test user for ID-based tests\r\n    const response = await request(app).post('/api/v1/users').send({\r\n      email: 'api-v1-test@example.com',\r\n      name: 'API Test User',\r\n      password: 'AIGestion2026!',\r\n    });\r\n\r\n    if (response.status === 201) {\r\n      testUserId = response.body.id || response.body.data?.id;\r\n    }\r\n  });\r\n\r\n  describe('GET /health', () => {\r\n    it('should return standardized health response', async () => {\r\n      const response = await request(app).get('/api/v1/health').expect(200);\r\n\r\n      expect(response.body).toHaveProperty('status', 200);\r\n      expect(response.body).toHaveProperty('data');\r\n      expect(response.body.data).toHaveProperty('status', 'healthy');\r\n      \r\n      const requestId = response.body.requestId;\r\n      expect(requestId).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('POST /users (create)', () => {\r\n    it('should create user with valid input', async () => {\r\n      const uniqueEmail = `unique-${Date.now()}@example.com`;\r\n      const response = await request(app)\r\n        .post('/api/v1/users')\r\n        .send({\r\n          email: uniqueEmail,\r\n          name: 'Unique Test User',\r\n          password: 'AIGestion123!',\r\n        })\r\n        .expect(201);\r\n\r\n      expect(response.body.status).toBe(201);\r\n      const data = response.body.data || response.body;\r\n      expect(data.email).toBe(uniqueEmail);\r\n    });\r\n\r\n    it('should validate required fields', async () => {\r\n      await request(app)\r\n        .post('/api/v1/users')\r\n        .send({\r\n          name: 'Test User',\r\n        })\r\n        .expect(400);\r\n    });\r\n  });\r\n\r\n  describe('User Retrieval', () => {\r\n    it('should get user by ID', async () => {\r\n      if (!testUserId) {\r\n        console.warn('Skipping ID test: testUserId not created');\r\n        return;\r\n      }\r\n      const response = await request(app).get(`/api/v1/users/${testUserId}`).expect(200);\r\n      expect(response.body.status).toBe(200);\r\n    });\r\n  });\r\n});\r\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\middleware\\cache.middleware.ts","mappings":";;;AAEA,wDAA8C;AAC9C,4CAAyC;AAEzC;;;GAGG;AACI,MAAM,eAAe,GAAG,CAAC,GAAG,GAAG,GAAG,EAAE,EAAE;IAC3C,OAAO,KAAK,EAAE,GAAQ,EAAE,GAAQ,EAAE,IAAkB,EAAiB,EAAE;QACrE,0BAA0B;QAC1B,IAAI,GAAG,CAAC,MAAM,KAAK,KAAK,EAAE,CAAC;YACzB,IAAI,EAAE,CAAC;YACP,OAAO;QACT,CAAC;QAED,MAAM,GAAG,GAAG,OAAO,GAAG,CAAC,OAAO,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,8CAA8C;QAE3F,IAAI,CAAC;YACH,wBAAwB;YACxB,MAAM,MAAM,GAAG,MAAM,oBAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACpC,IAAI,MAAM,EAAE,CAAC;gBACX,eAAM,CAAC,KAAK,CAAC,iBAAiB,GAAG,EAAE,CAAC,CAAC;gBACrC,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;gBAChC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACjB,OAAO;YACT,CAAC;YAED,iCAAiC;YACjC,MAAM,YAAY,GAAG,GAAG,CAAC,IAAI,CAAC;YAE9B,GAAG,CAAC,IAAI,GAAG,UAAU,IAAS;gBAC5B,0BAA0B;gBAC1B,GAAG,CAAC,IAAI,GAAG,YAAY,CAAC;gBAExB,kDAAkD;gBAClD,IAAI,GAAG,CAAC,UAAU,KAAK,GAAG,EAAE,CAAC;oBAC3B,oBAAK,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;wBACxC,eAAM,CAAC,KAAK,CAAC,GAAG,EAAE,yBAAyB,CAAC,CAAC;oBAC/C,CAAC,CAAC,CAAC;gBACL,CAAC;gBAED,OAAO,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YACvC,CAAC,CAAC;YAEF,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;YACjC,IAAI,EAAE,CAAC;QACT,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,KAAK,EAAE,yBAAyB,CAAC,CAAC;YAC/C,IAAI,EAAE,CAAC;QACT,CAAC;IACH,CAAC,CAAC;AACJ,CAAC,CAAC;AA5CW,QAAA,eAAe,mBA4C1B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\middleware\\cache.middleware.ts"],"sourcesContent":["import type { NextFunction, Response } from 'express';\n\nimport { cache } from '../utils/cacheManager';\nimport { logger } from '../utils/logger';\n\n/**\n * Middleware to cache API responses\n * @param ttl Time to live in seconds (default 300)\n */\nexport const cacheMiddleware = (ttl = 300) => {\n  return async (req: any, res: any, next: NextFunction): Promise<void> => {\n    // Only cache GET requests\n    if (req.method !== 'GET') {\n      next();\n      return;\n    }\n\n    const key = `api:${req.baseUrl}${req.path}`; // Use baseUrl + path so it works with routers\n\n    try {\n      // Try to get from cache\n      const cached = await cache.get(key);\n      if (cached) {\n        logger.debug(`Cache hit for ${key}`);\n        res.setHeader('X-Cache', 'HIT');\n        res.json(cached);\n        return;\n      }\n\n      // Intercept response to cache it\n      const originalJson = res.json;\n\n      res.json = function (body: any): Response {\n        // Restore original method\n        res.json = originalJson;\n\n        // Cache the response asynchronously if successful\n        if (res.statusCode === 200) {\n          cache.set(key, body, { ttl }).catch(err => {\n            logger.error(err, 'Error caching response:');\n          });\n        }\n\n        return originalJson.call(this, body);\n      };\n\n      res.setHeader('X-Cache', 'MISS');\n      next();\n    } catch (error) {\n      logger.error(error, 'Cache middleware error:');\n      next();\n    }\n  };\n};\n"],"version":3}
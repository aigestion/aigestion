5fa9e603544de6be8f73c46232fc342c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const auth_controller_1 = require("../controllers/auth.controller");
const auth_middleware_1 = require("../middleware/auth.middleware");
const rateLimiter_1 = require("../middleware/rateLimiter");
const validation_middleware_1 = require("../middleware/validation.middleware");
const router = (0, express_1.Router)();
// Rutas públicas con rate limiting estricto + validación Zod
router.post('/register', rateLimiter_1.authLimiter, (0, validation_middleware_1.validateBody)(validation_middleware_1.schemas.auth.register), auth_controller_1.register);
router.post('/login', rateLimiter_1.authLimiter, (0, validation_middleware_1.validateBody)(validation_middleware_1.schemas.auth.login), auth_controller_1.login);
router.post('/verify-email', rateLimiter_1.authLimiter, auth_controller_1.verifyEmail); // New
router.post('/2fa/enable', rateLimiter_1.authLimiter, auth_controller_1.enable2FA);
router.post('/2fa/verify', rateLimiter_1.authLimiter, auth_controller_1.verify2FA);
router.post('/login/2fa', rateLimiter_1.authLimiter, (0, validation_middleware_1.validateBody)(validation_middleware_1.schemas.auth.verify2FA), auth_controller_1.verifyLogin2FA);
// Onboarding Routes (Protected)
router.put('/role', auth_middleware_1.protect, auth_controller_1.updateUserRole); // New
router.put('/plan', auth_middleware_1.protect, auth_controller_1.updateSubscription); // New
// Refresh Token (uses Cookie)
router.get('/refresh', rateLimiter_1.authLimiter, auth_controller_1.refresh);
router.post('/logout', auth_controller_1.logout);
// Ruta protegida - Requiere autenticación
router.get('/me', auth_middleware_1.protect, auth_controller_1.getMe);
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXGF1dGgucm91dGVzLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEscUNBQWlDO0FBRWpDLG9FQVl3QztBQUN4QyxtRUFBd0Q7QUFDeEQsMkRBQXdEO0FBQ3hELCtFQUE0RTtBQUU1RSxNQUFNLE1BQU0sR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUN4Qiw2REFBNkQ7QUFDN0QsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUseUJBQVcsRUFBRSxJQUFBLG9DQUFZLEVBQUMsK0JBQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsMEJBQVEsQ0FBQyxDQUFDO0FBQ3JGLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLHlCQUFXLEVBQUUsSUFBQSxvQ0FBWSxFQUFDLCtCQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLHVCQUFLLENBQUMsQ0FBQztBQUM1RSxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSx5QkFBVyxFQUFFLDZCQUFXLENBQUMsQ0FBQyxDQUFDLE1BQU07QUFDOUQsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUseUJBQVcsRUFBRSwyQkFBUyxDQUFDLENBQUM7QUFDbkQsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUseUJBQVcsRUFBRSwyQkFBUyxDQUFDLENBQUM7QUFDbkQsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUseUJBQVcsRUFBRSxJQUFBLG9DQUFZLEVBQUMsK0JBQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsZ0NBQWMsQ0FBQyxDQUFDO0FBRTdGLGdDQUFnQztBQUNoQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSx5QkFBTyxFQUFFLGdDQUFjLENBQUMsQ0FBQyxDQUFDLE1BQU07QUFDcEQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUseUJBQU8sRUFBRSxvQ0FBa0IsQ0FBQyxDQUFDLENBQUMsTUFBTTtBQUV4RCw4QkFBOEI7QUFDOUIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUseUJBQVcsRUFBRSx5QkFBTyxDQUFDLENBQUM7QUFFN0MsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsd0JBQU0sQ0FBQyxDQUFDO0FBRS9CLDBDQUEwQztBQUMxQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSx5QkFBTyxFQUFFLHVCQUFLLENBQUMsQ0FBQztBQUVsQyxrQkFBZSxNQUFNLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxyb3V0ZXNcXGF1dGgucm91dGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xuXG5pbXBvcnQge1xuICBnZXRNZSxcbiAgbG9naW4sXG4gIHJlZ2lzdGVyLFxuICBlbmFibGUyRkEsXG4gIHZlcmlmeTJGQSxcbiAgdmVyaWZ5TG9naW4yRkEsXG4gIHJlZnJlc2gsXG4gIGxvZ291dCxcbiAgdmVyaWZ5RW1haWwsXG4gIHVwZGF0ZVVzZXJSb2xlLFxuICB1cGRhdGVTdWJzY3JpcHRpb24sXG59IGZyb20gJy4uL2NvbnRyb2xsZXJzL2F1dGguY29udHJvbGxlcic7XG5pbXBvcnQgeyBwcm90ZWN0IH0gZnJvbSAnLi4vbWlkZGxld2FyZS9hdXRoLm1pZGRsZXdhcmUnO1xuaW1wb3J0IHsgYXV0aExpbWl0ZXIgfSBmcm9tICcuLi9taWRkbGV3YXJlL3JhdGVMaW1pdGVyJztcbmltcG9ydCB7IHNjaGVtYXMsIHZhbGlkYXRlQm9keSB9IGZyb20gJy4uL21pZGRsZXdhcmUvdmFsaWRhdGlvbi5taWRkbGV3YXJlJztcblxuY29uc3Qgcm91dGVyID0gUm91dGVyKCk7XG4vLyBSdXRhcyBww7pibGljYXMgY29uIHJhdGUgbGltaXRpbmcgZXN0cmljdG8gKyB2YWxpZGFjacOzbiBab2RcbnJvdXRlci5wb3N0KCcvcmVnaXN0ZXInLCBhdXRoTGltaXRlciwgdmFsaWRhdGVCb2R5KHNjaGVtYXMuYXV0aC5yZWdpc3RlciksIHJlZ2lzdGVyKTtcbnJvdXRlci5wb3N0KCcvbG9naW4nLCBhdXRoTGltaXRlciwgdmFsaWRhdGVCb2R5KHNjaGVtYXMuYXV0aC5sb2dpbiksIGxvZ2luKTtcbnJvdXRlci5wb3N0KCcvdmVyaWZ5LWVtYWlsJywgYXV0aExpbWl0ZXIsIHZlcmlmeUVtYWlsKTsgLy8gTmV3XG5yb3V0ZXIucG9zdCgnLzJmYS9lbmFibGUnLCBhdXRoTGltaXRlciwgZW5hYmxlMkZBKTtcbnJvdXRlci5wb3N0KCcvMmZhL3ZlcmlmeScsIGF1dGhMaW1pdGVyLCB2ZXJpZnkyRkEpO1xucm91dGVyLnBvc3QoJy9sb2dpbi8yZmEnLCBhdXRoTGltaXRlciwgdmFsaWRhdGVCb2R5KHNjaGVtYXMuYXV0aC52ZXJpZnkyRkEpLCB2ZXJpZnlMb2dpbjJGQSk7XG5cbi8vIE9uYm9hcmRpbmcgUm91dGVzIChQcm90ZWN0ZWQpXG5yb3V0ZXIucHV0KCcvcm9sZScsIHByb3RlY3QsIHVwZGF0ZVVzZXJSb2xlKTsgLy8gTmV3XG5yb3V0ZXIucHV0KCcvcGxhbicsIHByb3RlY3QsIHVwZGF0ZVN1YnNjcmlwdGlvbik7IC8vIE5ld1xuXG4vLyBSZWZyZXNoIFRva2VuICh1c2VzIENvb2tpZSlcbnJvdXRlci5nZXQoJy9yZWZyZXNoJywgYXV0aExpbWl0ZXIsIHJlZnJlc2gpO1xuXG5yb3V0ZXIucG9zdCgnL2xvZ291dCcsIGxvZ291dCk7XG5cbi8vIFJ1dGEgcHJvdGVnaWRhIC0gUmVxdWllcmUgYXV0ZW50aWNhY2nDs25cbnJvdXRlci5nZXQoJy9tZScsIHByb3RlY3QsIGdldE1lKTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyO1xuIl0sInZlcnNpb24iOjN9
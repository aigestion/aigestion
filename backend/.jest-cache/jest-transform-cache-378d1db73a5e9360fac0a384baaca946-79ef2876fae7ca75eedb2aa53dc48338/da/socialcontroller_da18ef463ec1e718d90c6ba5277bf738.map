{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\social.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\social.controller.ts"],"sourcesContent":["import axios from 'axios';\nimport type { Request, Response } from 'express';\nimport { inject, injectable } from 'inversify';\n\nimport { buildError } from '../common/response-builder';\nimport { config } from '../config/index';\nimport { InstagramService } from '../services/instagram.service';\nimport { LinkedInService } from '../services/linkedin.service';\nimport { TikTokService } from '../services/tiktok.service';\nimport { XService } from '../services/x.service';\nimport { TYPE_ID, TYPES } from '../types';\n\nconst FB_API_URL = config.whatsapp.apiUrl;\n\n@injectable()\nexport class SocialController {\n  constructor(\n    @inject(TYPES.InstagramService) private instagramService: InstagramService,\n    @inject(TYPES.LinkedInService) private linkedinService: LinkedInService,\n    @inject(TYPES.TikTokService) private tiktokService: TikTokService,\n    @inject(TYPES.XService) private xService: XService,\n  ) {}\n\n  // Publicar en Facebook Page\n  async publishPost(req: Request, res: Response, next: NextFunction): Promise<void> {\n    try {\n      const { message, link } = req.body;\n      const pageId = process.env.FACEBOOK_PAGE_ID;\n      const accessToken = process.env.FACEBOOK_ACCESS_TOKEN;\n\n      if (!pageId || !accessToken) {\n        res.status(500).json({ error: 'Facebook credentials not configured' });\n        return;\n      }\n\n      console.log(`üöÄ Publishing to Facebook Page ${pageId}...`);\n\n      const response = await axios.post(`${FB_API_URL}/${pageId}/feed`, {\n        message,\n        link,\n        access_token: accessToken,\n      });\n\n      console.log('‚úÖ Published successfully:', response.data.id);\n      res.json({ success: true, postId: response.data.id });\n    } catch (error: any) {\n      console.error('‚ùå Error publishing to Facebook:', error.response?.data || error.message);\n      res\n        .status(500)\n        .json({ error: 'Failed to publish to Facebook', details: error.response?.data });\n    }\n  }\n\n  // Obtener M√©tricas de la P√°gina\n  async getPageStats(_req: Request, res: Response, next: NextFunction): Promise<void> {\n    try {\n      const pageId = process.env.FACEBOOK_PAGE_ID;\n      const accessToken = process.env.FACEBOOK_ACCESS_TOKEN;\n\n      if (!pageId || !accessToken) {\n        // Mock data si no hay credenciales (para demo)\n        res.json({\n          followers: 1250,\n          impressions: 4500,\n          engagement: 8.5,\n          mock: true,\n        });\n        return;\n      }\n\n      const response = await axios.get(`${FB_API_URL}/${pageId}`, {\n        params: {\n          fields: 'fan_count,rating_count,new_like_count,talking_about_count',\n          access_token: accessToken,\n        },\n      });\n\n      res.json(response.data);\n    } catch (error: any) {\n      console.error('‚ùå Error fetching FB stats:', error.response?.data || error.message);\n      (res as any)\n        .status(500)\n        .json(buildError('Failed to get stats', 'SOCIAL_ERROR', 500, (_req as any).requestId));\n    }\n  }\n\n  // Enviar Mensaje Directo Instagram\n  async sendInstagramDM(req: Request, res: Response, next: NextFunction): Promise<void> {\n    try {\n      const { recipientId, text } = req.body;\n      const result = await this.instagramService.sendDM(recipientId, text);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to send Instagram DM' });\n    }\n  }\n\n  // Publicar Tweet en X\n  async postTweet(req: Request, res: Response, next: NextFunction): Promise<void> {\n    try {\n      const { text } = req.body as { text?: unknown };\n      // Ensure we have a string; if not, coerce to string or reject\n      if (typeof text !== 'string' || text.trim() === '') {\n        res.status(400).json({ error: 'Invalid tweet text' });\n        return;\n      }\n      const result = await this.xService.postTweet(text);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to post Tweet to X' });\n    }\n  }\n\n  // Publicar Video en TikTok\n  async publishTikTokVideo(req: Request, res: Response, next: NextFunction): Promise<void> {\n    try {\n      const { videoUrl, title } = (req as any).body || {};\n      const result = await this.tiktokService.publishVideo(videoUrl, title);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to publish to TikTok' });\n    }\n  }\n\n  // Publicar Post en LinkedIn\n  async publishLinkedInPost(req: Request, res: Response, next: NextFunction): Promise<void> {\n    try {\n      const { text } = (req as any).body || {};\n      const result = await this.linkedinService.sharePost(text);\n      res.json({ success: true, result });\n    } catch (error: any) {\n      res.status(500).json({ error: 'Failed to publish to LinkedIn' });\n    }\n  }\n}\n"],"version":3}
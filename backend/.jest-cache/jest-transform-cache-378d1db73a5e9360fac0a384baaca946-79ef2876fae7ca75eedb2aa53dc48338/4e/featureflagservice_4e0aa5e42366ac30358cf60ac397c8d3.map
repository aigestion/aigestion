{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\feature-flag.service.ts","mappings":";;;;;;;;;AAAA,yCAAuC;AACvC,0CAAgD;AAChD,4CAAyC;AAGlC,IAAM,kBAAkB,GAAxB,MAAM,kBAAkB;IACZ,SAAS,GAAG,qBAAqB,CAAC;IAEnD;;OAEG;IACH,KAAK,CAAC,SAAS,CAAC,QAAgB,EAAE,MAAe;QAC/C,MAAM,MAAM,GAAG,IAAA,sBAAc,GAAE,CAAC;QAChC,IAAI,CAAC,MAAM,EAAE,MAAM;YAAE,OAAO,KAAK,CAAC;QAElC,kCAAkC;QAClC,IAAI,MAAM,EAAE,CAAC;YACX,MAAM,YAAY,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,SAAS,SAAS,MAAM,EAAE,EAAE,QAAQ,CAAC,CAAC;YACrF,IAAI,YAAY,KAAK,IAAI;gBAAE,OAAO,YAAY,KAAK,MAAM,CAAC;QAC5D,CAAC;QAED,wBAAwB;QACxB,MAAM,WAAW,GAAG,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;QAChE,OAAO,WAAW,KAAK,MAAM,CAAC;IAChC,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,aAAa,CAAC,QAAgB,EAAE,OAAgB;QACpD,MAAM,MAAM,GAAG,IAAA,sBAAc,GAAE,CAAC;QAChC,IAAI,CAAC,MAAM,EAAE,MAAM;YAAE,OAAO;QAE5B,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;QAChE,eAAM,CAAC,IAAI,CAAC,6BAA6B,QAAQ,WAAW,OAAO,EAAE,CAAC,CAAC;IACzE,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,eAAe,CAAC,MAAc,EAAE,QAAgB,EAAE,OAAgB;QACtE,MAAM,MAAM,GAAG,IAAA,sBAAc,GAAE,CAAC;QAChC,IAAI,CAAC,MAAM,EAAE,MAAM;YAAE,OAAO;QAE5B,MAAM,MAAM,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,SAAS,SAAS,MAAM,EAAE,EAAE,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;QACpF,eAAM,CAAC,IAAI,CAAC,sBAAsB,MAAM,iBAAiB,QAAQ,WAAW,OAAO,EAAE,CAAC,CAAC;IACzF,CAAC;CACF,CAAA;AA1CY,gDAAkB;6BAAlB,kBAAkB;IAD9B,IAAA,sBAAU,GAAE;GACA,kBAAkB,CA0C9B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\feature-flag.service.ts"],"sourcesContent":["import { injectable } from 'inversify';\nimport { getRedisClient } from '../cache/redis';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class FeatureFlagService {\n  private readonly CACHE_KEY = 'nexus:feature_flags';\n\n  /**\n   * Checks if a feature is enabled for a specific user or globally.\n   */\n  async isEnabled(flagName: string, userId?: string): Promise<boolean> {\n    const client = getRedisClient();\n    if (!client?.isOpen) return false;\n\n    // 1. Check user-specific override\n    if (userId) {\n      const userOverride = await client.hGet(`${this.CACHE_KEY}:user:${userId}`, flagName);\n      if (userOverride !== null) return userOverride === 'true';\n    }\n\n    // 2. Check global state\n    const globalState = await client.hGet(this.CACHE_KEY, flagName);\n    return globalState === 'true';\n  }\n\n  /**\n   * Sets a global feature flag.\n   */\n  async setGlobalFlag(flagName: string, enabled: boolean): Promise<void> {\n    const client = getRedisClient();\n    if (!client?.isOpen) return;\n\n    await client.hSet(this.CACHE_KEY, flagName, enabled.toString());\n    logger.info(`[FeatureFlag] Global flag ${flagName} set to ${enabled}`);\n  }\n\n  /**\n   * Sets a user-specific feature flag override.\n   */\n  async setUserOverride(userId: string, flagName: string, enabled: boolean): Promise<void> {\n    const client = getRedisClient();\n    if (!client?.isOpen) return;\n\n    await client.hSet(`${this.CACHE_KEY}:user:${userId}`, flagName, enabled.toString());\n    logger.info(`[FeatureFlag] User ${userId} override for ${flagName} set to ${enabled}`);\n  }\n}\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\middleware\\redis-cache.middleware.ts","mappings":";;;AACA,4CAAyC;AACzC,0CAAoD;AAEpD;;;GAGG;AACI,MAAM,UAAU,GAAG,CAAC,UAAkB,EAAE,EAAE;IAC/C,OAAO,KAAK,EAAE,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;QAC/D,0BAA0B;QAC1B,IAAI,GAAG,CAAC,MAAM,KAAK,KAAK,EAAE,CAAC;YACzB,OAAO,IAAI,EAAE,CAAC;QAChB,CAAC;QAED,MAAM,GAAG,GAAG,SAAS,GAAG,CAAC,WAAW,IAAI,GAAG,CAAC,GAAG,EAAE,CAAC;QAElD,IAAI,CAAC;YACH,MAAM,UAAU,GAAG,MAAM,IAAA,gBAAQ,EAAC,GAAG,CAAC,CAAC;YACvC,IAAI,UAAU,EAAE,CAAC;gBACf,eAAM,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,EAAE,iBAAiB,CAAC,CAAC;gBACzC,OAAO,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC9B,CAAC;YAED,kEAAkE;YAClE,MAAM,YAAY,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACxC,GAAG,CAAC,IAAI,GAAG,CAAC,IAAS,EAAE,EAAE;gBACvB,IAAA,gBAAQ,EAAC,GAAG,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAC1C,eAAM,CAAC,IAAI,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,2BAA2B,CAAC,CACvD,CAAC;gBACF,OAAO,YAAY,CAAC,IAAI,CAAC,CAAC;YAC5B,CAAC,CAAC;YAEF,IAAI,EAAE,CAAC;QACT,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,GAAG,EAAE,EAAE,8BAA8B,CAAC,CAAC;YAC5D,IAAI,EAAE,CAAC;QACT,CAAC;IACH,CAAC,CAAC;AACJ,CAAC,CAAC;AA/BW,QAAA,UAAU,cA+BrB","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\middleware\\redis-cache.middleware.ts"],"sourcesContent":["import { NextFunction, Request, Response } from 'express';\nimport { logger } from '../utils/logger';\nimport { getCache, setCache } from '../utils/redis';\n\n/**\n * Middleware to cache responses in Redis\n * @param ttlSeconds Seconds to cache the response\n */\nexport const redisCache = (ttlSeconds: number) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    // Only cache GET requests\n    if (req.method !== 'GET') {\n      return next();\n    }\n\n    const key = `cache:${req.originalUrl || req.url}`;\n\n    try {\n      const cachedData = await getCache(key);\n      if (cachedData) {\n        logger.debug({ key }, 'Redis Cache Hit');\n        return res.json(cachedData);\n      }\n\n      // Override res.json to capture the response and store it in cache\n      const originalJson = res.json.bind(res);\n      res.json = (body: any) => {\n        setCache(key, body, ttlSeconds).catch(err =>\n          logger.warn({ err, key }, 'Failed to set Redis cache'),\n        );\n        return originalJson(body);\n      };\n\n      next();\n    } catch (error) {\n      logger.warn({ error, key }, 'Redis cache middleware error');\n      next();\n    }\n  };\n};\n"],"version":3}
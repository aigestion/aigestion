{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\api-v1.routes.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\api-v1.routes.ts"],"sourcesContent":["import { Router } from 'express';\n\nimport { buildError, buildResponse } from '../common/response-builder';\n// import { buildError, buildResponse, requestIdMiddleware } from '../common/response-builder';\n\n// import { getEmailTracking } from '../controllers/email-tracking.controller';\n// import briefingRoutes from './briefing.routes';\nimport { container } from '../config/inversify.config';\nimport exitEmailRouter from '../controllers/exit-email.controller';\nimport { CredentialManagerService } from '../services/credential-manager.service';\nimport { HistoryService } from '../services/history.service';\nimport { TYPES } from '../types';\nimport aiRouter from './ai.routes';\nimport ragRoutes from './rag.routes';\n// import gmailRoutes from './gmail.routes';\n// import bigqueryRoutes from './bigquery.routes';\n// import cloudMonitoringRoutes from './cloudMonitoring.routes';\n// import jwt from 'jsonwebtoken';\n// import { env } from '../config/env.schema';\n// import { dashboardAuth } from '../middleware/dashboardAuth';\nimport {\n  createCheckoutSession,\n  createPortalSession,\n  getBillingSnapshot,\n} from '../controllers/billing.controller';\nimport { getCurrentUsage } from '../controllers/usage.controller';\nimport { requireAuth } from '../middleware/auth.middleware';\nimport analyticsRouter from './analytics.routes';\nimport authRouter from './auth.routes';\nimport danielaRouter from './daniela.routes';\nimport dockerRouter from './docker.routes';\nimport enhancedVoiceRouter from './enhanced-voice.routes';\nimport personaRouter from './persona.routes';\nimport { youtubeRouter } from './youtube.routes';\nimport { GodModeController } from '../controllers/godmode.controller';\nimport { BillingController } from '../controllers/billing.controller';\nimport { UsageController } from '../controllers/usage.controller';\nimport godmodeRoutes from './godmode.routes';\n\n// ... (existing imports)\n\nimport { apiKeyAuth } from '../middleware/api-key.middleware';\nimport { idempotencyMiddleware } from '../middleware/idempotency.middleware';\nimport { dynamicRateLimiter } from '../middleware/rate-limit.middleware';\nimport { redisCache } from '../middleware/redis-cache.middleware';\nimport devicePostureRouter from './device-posture.routes';\nimport logsRouter from './logs.routes';\nimport malwareScannerRouter from './malware-scanner.routes';\nimport nexusRouter from './nexus.routes';\nimport securityDashboardRouter from './security-dashboard.routes';\nimport socialRouter from './social.routes';\nimport systemRouter from './system.routes';\nimport threatIntelRouter from './threat-intelligence.routes';\nimport behaviorRouter from './user-behavior.routes';\nimport wafRouter from './waf.routes';\nimport webauthnRouter from './webauthn.routes';\nimport sovereignHandshakeRouter from './sovereign-handshake.routes';\n\n/**\n * API v1 Router\n * Base estandarizada para todas las rutas versionadas\n */\nconst apiV1Router = Router();\n\n// Aplicar middleware de idempotencia globalmente para proteger todos los POST/PUT/PATCH\napiV1Router.use(idempotencyMiddleware);\napiV1Router.use(apiKeyAuth);\n\nconsole.log('DEBUG: API V1 router loaded');\n\n// Mount Auth Routes\n// Mount Auth Routes\napiV1Router.use('/auth', authRouter);\napiV1Router.use('/docker', dockerRouter);\napiV1Router.use('/personas', personaRouter);\napiV1Router.use('/swarm', swarmRouter);\napiV1Router.use('/webauthn', webauthnRouter);\napiV1Router.use('/sovereign', sovereignHandshakeRouter);\n\n/**\n * @openapi\n * /api/v1/system/credentials/verify:\n *   post:\n *     summary: Verify all configured credentials and API keys\n *     tags: [System]\n *     responses:\n *       200:\n *         description: Verification report\n *       500:\n *         description: Internal server error\n */\napiV1Router.post('/system/credentials/verify', async (req: any, res: any) => {\n  const requestId = req.requestId;\n  try {\n    const credManager = container.get<CredentialManagerService>(TYPES.CredentialManagerService);\n    const report = await credManager.verifyAll();\n    res.json(buildResponse(report, 200, requestId));\n  } catch (err) {\n    const requestId = req.requestId;\n    res.status(500).json(buildError('Verification failed', 'VERIFICATION_ERROR', 500, requestId));\n  }\n});\n\n/**\n * @openapi\n * /api/v1/system/history/{metric}:\n *   get:\n *     summary: Retrieve history for a specific metric\n *     tags: [System]\n *     parameters:\n *       - in: path\n *         name: metric\n *         required: true\n *         schema:\n *           type: string\n *         description: The name of the metric (e.g., cpu, memory)\n *     responses:\n *       200:\n *         description: List of metric snapshots\n *       500:\n *         description: Internal server error\n */\napiV1Router.get('/system/history/:metric', async (req: any, res: any) => {\n  const requestId = req.requestId;\n  try {\n    const { metric } = req.params;\n    const historyService = container.get<HistoryService>(TYPES.HistoryService);\n    const history = await historyService.getHistory(metric);\n    res.json(buildResponse(history, 200, requestId));\n  } catch (err) {\n    const requestId = req.requestId;\n    res.status(500).json(buildError('Internal server error', 'INTERNAL_ERROR', 500, requestId));\n  }\n});\n\n// Standard API Routes\n\n// Users (Prueba poniÃ©ndolo arriba)\napiV1Router.use('/users', usersRouter);\n\nimport healthRouter from './health.routes';\n// ... (existing imports)\n\n// Health checks\napiV1Router.use('/health', healthRouter);\n\n// Other services\n/**\n * @openapi\n * /api/v1/stripe:\n *   get:\n *     summary: Stripe related endpoints (placeholder)\n *     tags: [Stripe]\n *     responses:\n *       200:\n *         description: Successful response\n */\napiV1Router.use('/stripe', stripeRouter);\n/**\n * @openapi\n * /api/v1/youtube:\n *   get:\n *     summary: YouTube related endpoints (placeholder)\n *     tags: [YouTube]\n *     responses:\n *       200:\n *         description: Successful response\n */\napiV1Router.use('/youtube', youtubeRouter);\n// apiV1Router.use('/gmail', gmailRoutes);\n// apiV1Router.use('/bigquery', bigqueryRoutes);\n// apiV1Router.use('/cloud-monitoring', cloudMonitoringRoutes);\n// apiV1Router.use('/youtube', youtubeRoutes);\n// apiV1Router.use('/briefing', briefingRoutes);\n\n// Dashboard Auth routes (refresh token, etc.)\n// apiV1Router.post('/auth/refresh', dashboardAuth, (req, res) => {\n//   const { user } = req as any;\n//   const newToken = jwt.sign({ user: user.user, role: user.role }, env.JWT_SECRET, {\n//     expiresIn: '7d',\n//   });\n//   res.json({ token: newToken });\n// });\n\n// Nueva ruta para el tracking de emails\n// apiV1Router.get('/email/tracking', getEmailTracking);\n\nconst billingController = container.get<BillingController>(TYPES.BillingController);\nconst usageController = container.get<UsageController>(TYPES.UsageController);\n\napiV1Router.get('/usage/current', redisCache(60), (req, res, next) =>\n  usageController.getCurrentUsage(req, res, next),\n);\napiV1Router.get('/billing/snapshot', requireAuth, redisCache(300), (req, res, next) =>\n  billingController.getBillingSnapshot(req, res, next),\n);\napiV1Router.post('/billing/checkout', requireAuth, (req, res, next) =>\n  billingController.createCheckoutSession(req, res, next),\n);\napiV1Router.post('/billing/portal', requireAuth, (req, res, next) =>\n  billingController.createPortalSession(req, res, next),\n);\napiV1Router.use('/analytics', redisCache(30), analyticsRouter);\n\n// Enhanced Voice Service (Daniela)\n/**\n * @openapi\n * /api/v1/enhanced-voice:\n *   get:\n *     summary: Enhanced Voice Service endpoints for Daniela\n *     tags: [EnhancedVoice]\n *     responses:\n *       200:\n *         description: Enhanced Voice Service endpoints\n */\napiV1Router.use('/enhanced-voice', enhancedVoiceRouter);\napiV1Router.use('/daniela', danielaRouter);\n\n// AI and RAG Routes\n\n/**\n * @openapi\n * /api/v1/ai:\n *   get:\n *     summary: AI related endpoints (placeholder)\n *     tags: [AI]\n *     responses:\n *       200:\n *         description: Successful response\n */\napiV1Router.use('/ai', dynamicRateLimiter, aiRouter);\napiV1Router.use('/rag', ragRoutes);\n/**\n * @openapi\n * /api/v1/exit-templates:\n *   get:\n *     summary: Exit email templates endpoints (placeholder)\n *     tags: [ExitEmail]\n *     responses:\n *       200:\n *         description: Successful response\n */\napiV1Router.use('/exit-templates', exitEmailRouter);\n\n// System Routes (Metrics, CPU, etc.)\napiV1Router.use('/system', systemRouter);\n\n// Social Routes (Facebook, Instagram, etc.)\napiV1Router.use('/social', socialRouter);\n\n// Logs Routes\napiV1Router.use('/logs', logsRouter);\napiV1Router.use('/security-dashboard', securityDashboardRouter);\napiV1Router.use('/waf', wafRouter);\napiV1Router.use('/malware-scanner', malwareScannerRouter);\napiV1Router.use('/threat-intelligence', threatIntelRouter);\napiV1Router.use('/behavior', behaviorRouter);\napiV1Router.use('/device-posture', devicePostureRouter);\napiV1Router.use('/nexus', nexusRouter);\napiV1Router.use('/god-mode', godmodeRoutes);\n\nexport default apiV1Router;\n"],"version":3}
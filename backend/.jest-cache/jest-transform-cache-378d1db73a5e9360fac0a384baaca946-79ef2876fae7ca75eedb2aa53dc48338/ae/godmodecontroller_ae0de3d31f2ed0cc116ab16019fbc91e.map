{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\godmode.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\godmode.controller.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\nimport { injectable, inject } from 'inversify';\nimport { TYPES } from '../types';\nimport { SupabaseService } from '../services/supabase.service';\nimport { GodNotificationService } from '../services/god-notification.service';\nimport { logger } from '../utils/logger';\n\n/**\n * ðŸŒŒ [GOD MODE] Controller\n * Sovereign management of AI assets: Projects, Documents, Prompts and Notifications.\n */\n@injectable()\nexport class GodModeController {\n  constructor(\n    @inject(TYPES.GodNotificationService) private notificationService: GodNotificationService,\n  ) {}\n\n  // PROJECTS\n  public async listProjects(req: Request, res: Response, next: NextFunction) {\n    try {\n      const client = SupabaseService.getInstance().getClient();\n      const { data, error } = await client\n        .from('projects')\n        .select('*')\n        .order('updated_at', { ascending: false });\n\n      if (error) throw error;\n      res.json({ success: true, data });\n    } catch (error: any) {\n      next(error);\n    }\n  }\n\n  public async createProject(req: Request, res: Response, next: NextFunction) {\n    try {\n      const { name, description } = req.body;\n      const client = SupabaseService.getInstance().getClient();\n      const { data, error } = await client\n        .from('projects')\n        .insert({ name, description })\n        .select()\n        .single();\n\n      if (error) throw error;\n      res.status(201).json({ success: true, data });\n    } catch (error: any) {\n      next(error);\n    }\n  }\n\n  // DOCUMENTS / RAG\n  public async hybridSearch(req: Request, res: Response, next: NextFunction) {\n    try {\n      const query = typeof req.body.query === 'string' ? req.body.query : '';\n      const { projectId, embedding, threshold, limit } = req.body;\n\n      if (!query || !embedding) {\n        return res.status(400).json({ error: 'Query and embedding are required' });\n      }\n\n      const results = await SupabaseService.getInstance().hybridSearch(\n        projectId,\n        query,\n        embedding,\n        threshold || 0.5,\n        limit || 5,\n      );\n\n      res.json({ success: true, data: results });\n    } catch (error: any) {\n      next(error);\n    }\n  }\n\n  // PROMPTS\n  public async getPrompt(req: Request, res: Response, next: NextFunction) {\n    try {\n      const name = req.params.name as string;\n      const template = await SupabaseService.getInstance().getPromptTemplate(name);\n\n      if (!template) {\n        return res.status(404).json({ error: `Prompt template [${name}] not found` });\n      }\n\n      res.json({ success: true, data: template });\n    } catch (error: any) {\n      next(error);\n    }\n  }\n\n  public async listPrompts(req: Request, res: Response, next: NextFunction) {\n    try {\n      const client = SupabaseService.getInstance().getClient();\n      const { data, error } = await client\n        .from('prompt_templates')\n        .select('name, description, version, is_active')\n        .order('name');\n\n      if (error) throw error;\n      res.json({ success: true, data });\n    } catch (error: any) {\n      next(error);\n    }\n  }\n\n  // AUDIT\n  public async getAuditLogs(req: Request, res: Response, next: NextFunction) {\n    try {\n      const client = SupabaseService.getInstance().getClient();\n      const { data, error } = await client\n        .from('audit_logs')\n        .select('*')\n        .order('created_at', { ascending: false })\n        .limit(50);\n\n\n      if (error) throw error;\n      res.json({ success: true, data });\n    } catch (error: any) {\n      next(error);\n    }\n  }\n\n  // NOTIFICATIONS\n  public async testNotification(req: Request, res: Response, next: NextFunction) {\n    try {\n      const { title, message, urgency } = req.body;\n\n      await this.notificationService.broadcastGodAlert(\n        title || 'Prueba de Sistema Soberano',\n        message || 'Este es un mensaje de prueba verificado por Daniela.',\n        urgency || 'medium',\n      );\n\n      res.json({ success: true, message: 'Broadcast successful' });\n    } catch (error: any) {\n      next(error);\n    }\n  }\n}\n"],"version":3}
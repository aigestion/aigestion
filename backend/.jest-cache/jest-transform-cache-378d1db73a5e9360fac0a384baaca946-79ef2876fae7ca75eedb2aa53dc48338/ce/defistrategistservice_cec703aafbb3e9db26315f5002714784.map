{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\defi-strategist.service.ts","mappings":";;;;;;;;;;;;;;;AAAA,kDAA0B;AAC1B,yCAAuC;AACvC,qDAA2C;AAC3C,4CAAyC;AAUlC,IAAM,qBAAqB,GAA3B,MAAM,qBAAqB;IACf,eAAe,CAAS;IAEzC;QACE,IAAI,CAAC,eAAe,GAAG,gBAAG,CAAC,gBAAgB,IAAI,EAAE,CAAC;IACpD,CAAC;IAED;;;OAGG;IACH,KAAK,CAAC,cAAc;QAClB,IAAI,CAAC;YACH,eAAM,CAAC,IAAI,CAAC,mDAAmD,CAAC,CAAC;YAEjE,uEAAuE;YACvE,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAElD,2FAA2F;YAC3F,MAAM,WAAW,GAAkB;gBACjC,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,cAAc,EAAE,MAAM,EAAE;gBAChE,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,EAAE,cAAc,EAAE,UAAU,EAAE;gBACtE,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,cAAc,EAAE,WAAW,EAAE;aACvE,CAAC;YAEF,OAAO;gBACL,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;gBACnC,eAAe,EAAE,SAAS;gBAC1B,OAAO,EAAE,WAAW;gBACpB,QAAQ,EAAE,SAAS,KAAK,SAAS,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,8BAA8B;aAC1F,CAAC;QACJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,eAAM,CAAC,KAAK,CAAC,4CAA4C,EAAE,KAAK,CAAC,CAAC;YAClE,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAEO,KAAK,CAAC,kBAAkB;QAC9B,IAAI,CAAC,IAAI,CAAC,eAAe;YAAE,OAAO,SAAS,CAAC;QAE5C,IAAI,CAAC;YACH,2CAA2C;YAC3C,MAAM,GAAG,GAAG,MAAM,eAAK,CAAC,GAAG,CACzB,oEAAoE,IAAI,CAAC,eAAe,EAAE,CAC3F,CAAC;YACF,MAAM,gBAAgB,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE,uBAAuB,IAAI,SAAS,CAAC;YAClF,OAAO,gBAAgB,CAAC,WAAW,EAAE,CAAC;QACxC,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,SAAS,CAAC;QACnB,CAAC;IACH,CAAC;CACF,CAAA;AAnDY,sDAAqB;gCAArB,qBAAqB;IADjC,IAAA,sBAAU,GAAE;;GACA,qBAAqB,CAmDjC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\defi-strategist.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { injectable } from 'inversify';\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\n\nexport interface WalletYield {\n  asset: string;\n  balance: number;\n  apy: number;\n  recommendation: 'hold' | 'rebalance' | 'compound';\n}\n\n@injectable()\nexport class DeFiStrategistService {\n  private readonly alphaVantageKey: string;\n\n  constructor() {\n    this.alphaVantageKey = env.ALPHAVANTAGE_KEY || '';\n  }\n\n  /**\n   * Analyzes current wallet \"health\" and suggests yield improvements.\n   * This is a prototype that simulates DeFi rebalancing logic.\n   */\n  async getYieldAdvice(): Promise<any> {\n    try {\n      logger.info('[DeFiStrategist] Analyzing yield opportunities...');\n\n      // 1. Get Market Sentiment (Simulated using AlphaVantage if key exists)\n      const sentiment = await this.getMarketSentiment();\n\n      // 2. Simulated Wallet Status (In production, this would call ethers.js or a web3 provider)\n      const mockWallets: WalletYield[] = [\n        { asset: 'ETH', balance: 1.5, apy: 3.2, recommendation: 'hold' },\n        { asset: 'USDT', balance: 5000, apy: 8.5, recommendation: 'compound' },\n        { asset: 'LINK', balance: 100, apy: 1.2, recommendation: 'rebalance' },\n      ];\n\n      return {\n        timestamp: new Date().toISOString(),\n        marketSentiment: sentiment,\n        wallets: mockWallets,\n        strategy: sentiment === 'BULLISH' ? 'Aggressive Staking' : 'Delta-Neutral Stable Farming',\n      };\n    } catch (error) {\n      logger.error('[DeFiStrategist] Advice generation failed:', error);\n      throw error;\n    }\n  }\n\n  private async getMarketSentiment(): Promise<string> {\n    if (!this.alphaVantageKey) return 'NEUTRAL';\n\n    try {\n      // Real AlphaVantage endpoint for Sentiment\n      const res = await axios.get(\n        `https://www.alphavantage.co/query?function=NEWS_SENTIMENT&apikey=${this.alphaVantageKey}`,\n      );\n      const overallSentiment = res.data.feed?.[0]?.overall_sentiment_label || 'NEUTRAL';\n      return overallSentiment.toUpperCase();\n    } catch {\n      return 'NEUTRAL';\n    }\n  }\n}\n"],"version":3}
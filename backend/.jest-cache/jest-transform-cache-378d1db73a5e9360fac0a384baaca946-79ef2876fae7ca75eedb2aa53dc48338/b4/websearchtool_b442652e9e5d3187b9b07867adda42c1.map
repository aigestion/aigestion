{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\tools\\web-search.tool.ts","mappings":";;;AAAA,uCAAsC;AACtC,6BAAwB;AAExB,2CAAuC;AAEvC;;;;;GAKG;AACH,MAAa,aAAc,SAAQ,oBAA2B;IAC5D,sCAAsC;IACtC,IAAI,GAAG,YAAY,CAAC;IAEpB,uCAAuC;IACvC,WAAW,GAAG,4EAA4E,CAAC;IAE3F,sCAAsC;IACtC,MAAM,GAAG,OAAC,CAAC,MAAM,CAAC;QAChB,KAAK,EAAE,OAAC;aACL,MAAM,EAAE;aACR,GAAG,CAAC,CAAC,EAAE,EAAE,OAAO,EAAE,qCAAqC,EAAE,CAAC;aAC1D,GAAG,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,oDAAoD,EAAE,CAAC;aAC3E,QAAQ,CAAC,kDAAkD,CAAC;KAChE,CAAC,CAAC;IAEH;;;;;;OAMG;IACH,KAAK,CAAC,OAAO,CAAC,KAAwB;QACpC,wCAAwC;QACxC,IAAI,CAAC,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACpD,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;QACnD,CAAC;QAED,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC;QAC1C,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,MAAM,IAAI,KAAK,CAAC,iDAAiD,CAAC,CAAC;QACrE,CAAC;QAED,MAAM,MAAM,GAAG,IAAA,aAAM,EAAC,EAAE,MAAM,EAAE,CAAC,CAAC;QAClC,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE;gBAChD,WAAW,EAAE,OAAO;gBACpB,aAAa,EAAE,IAAI;gBACnB,UAAU,EAAE,CAAC;aACd,CAAC,CAAC;YAEH,OAAO;gBACL,MAAM,EAAE,QAAQ,CAAC,MAAM;gBACvB,OAAO,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;oBAClC,KAAK,EAAE,CAAC,CAAC,KAAK;oBACd,GAAG,EAAE,CAAC,CAAC,GAAG;oBACV,OAAO,EAAE,CAAC,CAAC,OAAO;iBACnB,CAAC,CAAC;aACJ,CAAC;QACJ,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,uDAAuD;YACvD,MAAM,IAAI,KAAK,CAAC,sBAAsB,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;QACzD,CAAC;IACH,CAAC;CACF;AAvDD,sCAuDC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\tools\\web-search.tool.ts"],"sourcesContent":["import { tavily } from '@tavily/core';\nimport { z } from 'zod';\n\nimport { BaseTool } from './base.tool';\n\n/**\n * SearchWebTool\n *\n * Performs a web search using the Tavily API. Includes comprehensive input validation,\n * environment variable checks, and detailed error handling to aid debugging.\n */\nexport class SearchWebTool extends BaseTool<{ query: string }> {\n  /** Human‑readable name of the tool */\n  name = 'search_web';\n\n  /** Description used by the AI agent */\n  description = 'Performs a web search to retrieve up‑to‑date information on a given topic.';\n\n  /** Zod schema for input validation */\n  schema = z.object({\n    query: z\n      .string()\n      .min(1, { message: 'The search query must not be empty.' })\n      .max(200, { message: 'The search query is too long (max 200 characters).' })\n      .describe('The search query or topic to look up on the web.'),\n  });\n\n  /**\n   * Execute the web search.\n   *\n   * @param input - Object containing the `query` string.\n   * @returns An object with the answer and a list of result items.\n   * @throws Will throw an error if the API key is missing or the request fails.\n   */\n  async execute(input: { query: string }): Promise<any> {\n    // Runtime guard for empty query strings\n    if (!input.query || input.query.trim().length === 0) {\n      throw new Error('Search query cannot be empty.');\n    }\n\n    const apiKey = process.env.TAVILY_API_KEY;\n    if (!apiKey) {\n      throw new Error('TAVILY_API_KEY environment variable is not set.');\n    }\n\n    const client = tavily({ apiKey });\n    try {\n      const response = await client.search(input.query, {\n        searchDepth: 'basic',\n        includeAnswer: true,\n        maxResults: 5,\n      });\n\n      return {\n        answer: response.answer,\n        results: response.results.map(r => ({\n          title: r.title,\n          url: r.url,\n          content: r.content,\n        })),\n      };\n    } catch (error: any) {\n      // Re‑throw with a clearer message for troubleshooting.\n      throw new Error(`Web search failed: ${error.message}`);\n    }\n  }\n}\n"],"version":3}
864bb4cce61c088e6de90c3091ee3984
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DanielaController = void 0;
const inversify_1 = require("inversify");
const daniela_ai_service_1 = require("../services/daniela-ai.service");
const response_builder_1 = require("../common/response-builder");
const logger_1 = require("../utils/logger");
const types_1 = require("../types");
/**
 * ðŸ’œ Daniela Controller
 * Provides REST endpoints for Daniela AI interactions.
 */
let DanielaController = class DanielaController {
    danielaService;
    constructor(danielaService) {
        this.danielaService = danielaService;
        // Bind methods for use as route handlers
        this.chat = this.chat.bind(this);
        this.getStatus = this.getStatus.bind(this);
        this.getInsights = this.getInsights.bind(this);
        this.getSystemStatus = this.getSystemStatus.bind(this);
    }
    /**
     * Chat with Daniela
     */
    async chat(req, res, next) {
        try {
            const { message, sessionId } = req.body;
            const userId = req.user?.id || 'anonymous';
            const userName = req.user?.name || 'User';
            const userRole = req.user?.role || 'user';
            // We use the sessionId (from frontend) as the chatId for the service
            const chatId = parseInt(sessionId, 10) || 0;
            const response = await this.danielaService.processMessage(chatId, message, userName, userId, userRole);
            res.json((0, response_builder_1.buildResponse)({ response }, 200, req.requestId));
        }
        catch (error) {
            logger_1.logger.error('Error in DanielaController.chat:', error);
            next(error);
        }
    }
    /**
     * Get Daniela's Status and Info
     */
    async getStatus(req, res, next) {
        try {
            const info = this.danielaService.getDanielaInfo();
            res.json((0, response_builder_1.buildResponse)({
                status: 'operational',
                info,
                version: '1.0.0-PRO',
            }, 200, req.requestId));
        }
        catch (error) {
            next(error);
        }
    }
    /**
     * Get Strategic Insights for Daniela Dashboards
     */
    async getInsights(req, res, next) {
        try {
            const userId = req.user?.id || 'anonymous';
            const insights = await this.danielaService.getInsights(userId);
            res.json((0, response_builder_1.buildResponse)({ insights }, 200, req.requestId));
        }
        catch (error) {
            logger_1.logger.error('Error in DanielaController.getInsights:', error);
            next(error);
        }
    }
    /**
     * Get System Status for Daniela Dashboards
     */
    async getSystemStatus(req, res, next) {
        try {
            // For now, return the simulated/real metrics info
            res.json((0, response_builder_1.buildResponse)({
                status: 'operational',
                version: 'v2.4.0',
                statistics: {
                    totalUsers: 12450,
                    activeConversations: 45,
                    messagesProcessed: 1500000,
                },
            }, 200, req.requestId));
        }
        catch (error) {
            next(error);
        }
    }
};
exports.DanielaController = DanielaController;
exports.DanielaController = DanielaController = __decorate([
    (0, inversify_1.injectable)(),
    __param(0, (0, inversify_1.inject)(types_1.TYPES.DanielaAIService)),
    __metadata("design:paramtypes", [typeof (_a = typeof daniela_ai_service_1.DanielaAIService !== "undefined" && daniela_ai_service_1.DanielaAIService) === "function" ? _a : Object])
], DanielaController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxjb250cm9sbGVyc1xcZGFuaWVsYS5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSx5Q0FBK0M7QUFDL0MsdUVBQWtFO0FBQ2xFLGlFQUEyRDtBQUMzRCw0Q0FBeUM7QUFFekMsb0NBQWlDO0FBRWpDOzs7R0FHRztBQUVJLElBQU0saUJBQWlCLEdBQXZCLE1BQU0saUJBQWlCO0lBQ3dCO0lBQXBELFlBQW9ELGNBQWdDO1FBQWhDLG1CQUFjLEdBQWQsY0FBYyxDQUFrQjtRQUNsRix5Q0FBeUM7UUFDekMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQVksRUFBRSxHQUFhLEVBQUUsSUFBa0I7UUFDL0QsSUFBSSxDQUFDO1lBQ0gsTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQ3hDLE1BQU0sTUFBTSxHQUFJLEdBQVcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLFdBQVcsQ0FBQztZQUNwRCxNQUFNLFFBQVEsR0FBSSxHQUFXLENBQUMsSUFBSSxFQUFFLElBQUksSUFBSSxNQUFNLENBQUM7WUFDbkQsTUFBTSxRQUFRLEdBQUksR0FBVyxDQUFDLElBQUksRUFBRSxJQUFJLElBQUksTUFBTSxDQUFDO1lBRW5ELHFFQUFxRTtZQUNyRSxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUU1QyxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUN2RCxNQUFNLEVBQ04sT0FBTyxFQUNQLFFBQVEsRUFDUixNQUFNLEVBQ04sUUFBUSxDQUNULENBQUM7WUFFRixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUEsZ0NBQWEsRUFBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEdBQUcsRUFBRyxHQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGVBQU0sQ0FBQyxLQUFLLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDeEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNJLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQjtRQUNwRSxJQUFJLENBQUM7WUFDSCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ2xELEdBQUcsQ0FBQyxJQUFJLENBQ04sSUFBQSxnQ0FBYSxFQUNYO2dCQUNFLE1BQU0sRUFBRSxhQUFhO2dCQUNyQixJQUFJO2dCQUNKLE9BQU8sRUFBRSxXQUFXO2FBQ3JCLEVBQ0QsR0FBRyxFQUNGLEdBQVcsQ0FBQyxTQUFTLENBQ3ZCLENBQ0YsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNJLEtBQUssQ0FBQyxXQUFXLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQjtRQUN0RSxJQUFJLENBQUM7WUFDSCxNQUFNLE1BQU0sR0FBSSxHQUFXLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxXQUFXLENBQUM7WUFDcEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMvRCxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUEsZ0NBQWEsRUFBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEdBQUcsRUFBRyxHQUFXLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGVBQU0sQ0FBQyxLQUFLLENBQUMseUNBQXlDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNJLEtBQUssQ0FBQyxlQUFlLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQjtRQUMxRSxJQUFJLENBQUM7WUFDSCxrREFBa0Q7WUFDbEQsR0FBRyxDQUFDLElBQUksQ0FDTixJQUFBLGdDQUFhLEVBQ1g7Z0JBQ0UsTUFBTSxFQUFFLGFBQWE7Z0JBQ3JCLE9BQU8sRUFBRSxRQUFRO2dCQUNqQixVQUFVLEVBQUU7b0JBQ1YsVUFBVSxFQUFFLEtBQUs7b0JBQ2pCLG1CQUFtQixFQUFFLEVBQUU7b0JBQ3ZCLGlCQUFpQixFQUFFLE9BQU87aUJBQzNCO2FBQ0YsRUFDRCxHQUFHLEVBQ0YsR0FBVyxDQUFDLFNBQVMsQ0FDdkIsQ0FDRixDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUE7QUFsR1ksOENBQWlCOzRCQUFqQixpQkFBaUI7SUFEN0IsSUFBQSxzQkFBVSxHQUFFO0lBRUUsV0FBQSxJQUFBLGtCQUFNLEVBQUMsYUFBSyxDQUFDLGdCQUFnQixDQUFDLENBQUE7eURBQXlCLHFDQUFnQixvQkFBaEIscUNBQWdCO0dBRHpFLGlCQUFpQixDQWtHN0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxjb250cm9sbGVyc1xcZGFuaWVsYS5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IGluamVjdGFibGUsIGluamVjdCB9IGZyb20gJ2ludmVyc2lmeSc7XG5pbXBvcnQgeyBEYW5pZWxhQUlTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvZGFuaWVsYS1haS5zZXJ2aWNlJztcbmltcG9ydCB7IGJ1aWxkUmVzcG9uc2UgfSBmcm9tICcuLi9jb21tb24vcmVzcG9uc2UtYnVpbGRlcic7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi91dGlscy9sb2dnZXInO1xuXG5pbXBvcnQgeyBUWVBFUyB9IGZyb20gJy4uL3R5cGVzJztcblxuLyoqXG4gKiDwn5KcIERhbmllbGEgQ29udHJvbGxlclxuICogUHJvdmlkZXMgUkVTVCBlbmRwb2ludHMgZm9yIERhbmllbGEgQUkgaW50ZXJhY3Rpb25zLlxuICovXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGFuaWVsYUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihAaW5qZWN0KFRZUEVTLkRhbmllbGFBSVNlcnZpY2UpIHByaXZhdGUgZGFuaWVsYVNlcnZpY2U6IERhbmllbGFBSVNlcnZpY2UpIHtcbiAgICAvLyBCaW5kIG1ldGhvZHMgZm9yIHVzZSBhcyByb3V0ZSBoYW5kbGVyc1xuICAgIHRoaXMuY2hhdCA9IHRoaXMuY2hhdC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuZ2V0U3RhdHVzID0gdGhpcy5nZXRTdGF0dXMuYmluZCh0aGlzKTtcbiAgICB0aGlzLmdldEluc2lnaHRzID0gdGhpcy5nZXRJbnNpZ2h0cy5iaW5kKHRoaXMpO1xuICAgIHRoaXMuZ2V0U3lzdGVtU3RhdHVzID0gdGhpcy5nZXRTeXN0ZW1TdGF0dXMuYmluZCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGF0IHdpdGggRGFuaWVsYVxuICAgKi9cbiAgcHVibGljIGFzeW5jIGNoYXQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBtZXNzYWdlLCBzZXNzaW9uSWQgfSA9IHJlcS5ib2R5O1xuICAgICAgY29uc3QgdXNlcklkID0gKHJlcSBhcyBhbnkpLnVzZXI/LmlkIHx8ICdhbm9ueW1vdXMnO1xuICAgICAgY29uc3QgdXNlck5hbWUgPSAocmVxIGFzIGFueSkudXNlcj8ubmFtZSB8fCAnVXNlcic7XG4gICAgICBjb25zdCB1c2VyUm9sZSA9IChyZXEgYXMgYW55KS51c2VyPy5yb2xlIHx8ICd1c2VyJztcblxuICAgICAgLy8gV2UgdXNlIHRoZSBzZXNzaW9uSWQgKGZyb20gZnJvbnRlbmQpIGFzIHRoZSBjaGF0SWQgZm9yIHRoZSBzZXJ2aWNlXG4gICAgICBjb25zdCBjaGF0SWQgPSBwYXJzZUludChzZXNzaW9uSWQsIDEwKSB8fCAwO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuZGFuaWVsYVNlcnZpY2UucHJvY2Vzc01lc3NhZ2UoXG4gICAgICAgIGNoYXRJZCxcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgdXNlck5hbWUsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgdXNlclJvbGUsXG4gICAgICApO1xuXG4gICAgICByZXMuanNvbihidWlsZFJlc3BvbnNlKHsgcmVzcG9uc2UgfSwgMjAwLCAocmVxIGFzIGFueSkucmVxdWVzdElkKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgaW4gRGFuaWVsYUNvbnRyb2xsZXIuY2hhdDonLCBlcnJvcik7XG4gICAgICBuZXh0KGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IERhbmllbGEncyBTdGF0dXMgYW5kIEluZm9cbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRTdGF0dXMocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaW5mbyA9IHRoaXMuZGFuaWVsYVNlcnZpY2UuZ2V0RGFuaWVsYUluZm8oKTtcbiAgICAgIHJlcy5qc29uKFxuICAgICAgICBidWlsZFJlc3BvbnNlKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN0YXR1czogJ29wZXJhdGlvbmFsJyxcbiAgICAgICAgICAgIGluZm8sXG4gICAgICAgICAgICB2ZXJzaW9uOiAnMS4wLjAtUFJPJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIDIwMCxcbiAgICAgICAgICAocmVxIGFzIGFueSkucmVxdWVzdElkLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbmV4dChlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBTdHJhdGVnaWMgSW5zaWdodHMgZm9yIERhbmllbGEgRGFzaGJvYXJkc1xuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldEluc2lnaHRzKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IChyZXEgYXMgYW55KS51c2VyPy5pZCB8fCAnYW5vbnltb3VzJztcbiAgICAgIGNvbnN0IGluc2lnaHRzID0gYXdhaXQgdGhpcy5kYW5pZWxhU2VydmljZS5nZXRJbnNpZ2h0cyh1c2VySWQpO1xuICAgICAgcmVzLmpzb24oYnVpbGRSZXNwb25zZSh7IGluc2lnaHRzIH0sIDIwMCwgKHJlcSBhcyBhbnkpLnJlcXVlc3RJZCkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGluIERhbmllbGFDb250cm9sbGVyLmdldEluc2lnaHRzOicsIGVycm9yKTtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgU3lzdGVtIFN0YXR1cyBmb3IgRGFuaWVsYSBEYXNoYm9hcmRzXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0U3lzdGVtU3RhdHVzKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEZvciBub3csIHJldHVybiB0aGUgc2ltdWxhdGVkL3JlYWwgbWV0cmljcyBpbmZvXG4gICAgICByZXMuanNvbihcbiAgICAgICAgYnVpbGRSZXNwb25zZShcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdGF0dXM6ICdvcGVyYXRpb25hbCcsXG4gICAgICAgICAgICB2ZXJzaW9uOiAndjIuNC4wJyxcbiAgICAgICAgICAgIHN0YXRpc3RpY3M6IHtcbiAgICAgICAgICAgICAgdG90YWxVc2VyczogMTI0NTAsXG4gICAgICAgICAgICAgIGFjdGl2ZUNvbnZlcnNhdGlvbnM6IDQ1LFxuICAgICAgICAgICAgICBtZXNzYWdlc1Byb2Nlc3NlZDogMTUwMDAwMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICAyMDAsXG4gICAgICAgICAgKHJlcSBhcyBhbnkpLnJlcXVlc3RJZCxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG5leHQoZXJyb3IpO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9
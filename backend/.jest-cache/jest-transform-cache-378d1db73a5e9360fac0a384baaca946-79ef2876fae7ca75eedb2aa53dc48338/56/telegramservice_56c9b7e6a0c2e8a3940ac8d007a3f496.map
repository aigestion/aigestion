{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\telegram.service.ts","mappings":";;;;;;;;;;;;AAAA,uCAAoC;AACpC,yCAAuC;AACvC,qDAA2C;AAC3C,4CAAyC;AAGlC,IAAM,eAAe,GAArB,MAAM,eAAe;IAClB,GAAG,GAAoB,IAAI,CAAC;IAC5B,aAAa,CAAqB;IAE1C;QACE,IAAI,CAAC,UAAU,EAAE,CAAC;IACpB,CAAC;IAEO,UAAU;QAChB,IAAI,gBAAG,CAAC,kBAAkB,EAAE,CAAC;YAC3B,IAAI,CAAC;gBACH,IAAI,CAAC,GAAG,GAAG,IAAI,mBAAQ,CAAC,gBAAG,CAAC,kBAAkB,CAAC,CAAC;gBAChD,IAAI,CAAC,aAAa,GAAG,gBAAG,CAAC,gBAAgB,CAAC;gBAC1C,eAAM,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;YAC1C,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,eAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE,KAAK,CAAC,CAAC;YAC3D,CAAC;QACH,CAAC;aAAM,CAAC;YACN,eAAM,CAAC,IAAI,CAAC,mEAAmE,CAAC,CAAC;QACnF,CAAC;IACH,CAAC;IAED;;;;OAIG;IACH,KAAK,CAAC,WAAW,CAAC,OAAe,EAAE,MAAwB;QACzD,MAAM,YAAY,GAAG,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC;QAElD,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;YAC/B,eAAM,CAAC,IAAI,CAAC,sEAAsE,CAAC,CAAC;YACpF,OAAO;QACT,CAAC;QAED,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC;YAC3D,eAAM,CAAC,IAAI,CAAC,4BAA4B,YAAY,EAAE,CAAC,CAAC;QAC1D,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,eAAM,CAAC,KAAK,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE,EAAE,gCAAgC,CAAC,CAAC;QAC3E,CAAC;IACH,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,SAAS,CAAC,SAAiB,EAAE,OAAgB,EAAE,MAAwB;QAC3E,MAAM,YAAY,GAAG,MAAM,IAAI,IAAI,CAAC,aAAa,CAAC;QAElD,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;YAC/B,OAAO;QACT,CAAC;QAED,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,EAAE,EAAE,MAAM,EAAE,SAAS,EAAE,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;YACpF,eAAM,CAAC,IAAI,CAAC,0BAA0B,YAAY,EAAE,CAAC,CAAC;QACxD,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,eAAM,CAAC,KAAK,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE,EAAE,8BAA8B,CAAC,CAAC;YACvE,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;CACF,CAAA;AA7DY,0CAAe;0BAAf,eAAe;IAD3B,IAAA,sBAAU,GAAE;;GACA,eAAe,CA6D3B","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\telegram.service.ts"],"sourcesContent":["import { Telegraf } from 'telegraf';\nimport { injectable } from 'inversify';\nimport { env } from '../config/env.schema';\nimport { logger } from '../utils/logger';\n\n@injectable()\nexport class TelegramService {\n  private bot: Telegraf | null = null;\n  private defaultChatId: string | undefined;\n\n  constructor() {\n    this.initialize();\n  }\n\n  private initialize() {\n    if (env.TELEGRAM_BOT_TOKEN) {\n      try {\n        this.bot = new Telegraf(env.TELEGRAM_BOT_TOKEN);\n        this.defaultChatId = env.TELEGRAM_CHAT_ID;\n        logger.info('Telegram Bot initialized');\n      } catch (error) {\n        logger.error('Failed to initialize Telegram Bot', error);\n      }\n    } else {\n      logger.warn('TELEGRAM_BOT_TOKEN not provided. Telegram notifications disabled.');\n    }\n  }\n\n  /**\n   * Send a text message to a chat\n   * @param chatId Optional chat ID. If not provided, uses the default env CHAT_ID.\n   * @param message Message content\n   */\n  async sendMessage(message: string, chatId?: string | number): Promise<void> {\n    const targetChatId = chatId || this.defaultChatId;\n\n    if (!this.bot || !targetChatId) {\n      logger.warn('Cannot send Telegram message: Bot not initialized or Chat ID missing');\n      return;\n    }\n\n    try {\n      await this.bot.telegram.sendMessage(targetChatId, message);\n      logger.info(`Telegram message sent to ${targetChatId}`);\n    } catch (error: any) {\n      logger.error({ error: error.message }, 'Error sending Telegram message');\n    }\n  }\n\n  /**\n   * Send a video file to a chat\n   */\n  async sendVideo(videoPath: string, caption?: string, chatId?: string | number): Promise<void> {\n    const targetChatId = chatId || this.defaultChatId;\n\n    if (!this.bot || !targetChatId) {\n      return;\n    }\n\n    try {\n      await this.bot.telegram.sendVideo(targetChatId, { source: videoPath }, { caption });\n      logger.info(`Telegram video sent to ${targetChatId}`);\n    } catch (error: any) {\n      logger.error({ error: error.message }, 'Error sending Telegram video');\n      throw error;\n    }\n  }\n}\n"],"version":3}
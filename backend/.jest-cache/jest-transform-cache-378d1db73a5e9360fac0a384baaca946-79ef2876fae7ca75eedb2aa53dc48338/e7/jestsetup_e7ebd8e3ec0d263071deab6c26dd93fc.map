{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\jest.setup.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\jest.setup.ts"],"sourcesContent":["// ============================================\n// CRITICAL: Set NODE_ENV before ANY imports\n// ============================================\nprocess.env.NODE_ENV = 'test';\n\n// ============================================\n// SECURITY: Override DB URIs to NEVER use production\n// ============================================\nprocess.env.MONGODB_URI = 'mongodb://127.0.0.1:27017/aigestion-test-jest';\nprocess.env.DATABASE_URL = 'mongodb://127.0.0.1:27017/aigestion-test-jest';\n\n// ============================================\n// Auth env vars (required by jsonwebtoken.sign)\n// ============================================\nprocess.env.JWT_SECRET = 'test-jwt-secret-at-least-32-chars-long-for-security-check';\nprocess.env.JWT_EXPIRES_IN = '7d';\nprocess.env.JWT_COOKIE_EXPIRES_IN = '7';\nprocess.env.REFRESH_TOKEN_SECRET = 'test-refresh-secret-test-refresh-secret';\n\n// ============================================\n// Service mocks\n// ============================================\nprocess.env.SUPABASE_URL = 'https://mock-project.supabase.co';\nprocess.env.SUPABASE_KEY =\n  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vY2siLCJyb2xlIjoiYW5vbiIsImlhdCI6MTYwMDAwMDAwMCwiZXhwIjoxOTAwMDAwMDAwfQ.mock-signature';\nprocess.env.REDIS_URL = 'redis://localhost:6379';\nprocess.env.ENABLE_REDIS = 'false'; // Use mock Redis in tests\nprocess.env.SKIP_ENV_VALIDATION = 'true';\nprocess.env.MONGOMS_DOWNLOAD_DIR = './.mongodb-binaries';\n\n// ============================================\n// Global module mocks (prevent external service init)\n// ============================================\njest.mock('@supabase/supabase-js', () => ({\n  createClient: jest.fn(() => ({\n    from: jest.fn(() => ({\n      select: jest.fn().mockReturnThis(),\n      insert: jest.fn().mockReturnThis(),\n      update: jest.fn().mockReturnThis(),\n      upsert: jest.fn().mockReturnThis(),\n      delete: jest.fn().mockReturnThis(),\n      eq: jest.fn().mockReturnThis(),\n      neq: jest.fn().mockReturnThis(),\n      limit: jest.fn().mockReturnThis(),\n      single: jest.fn().mockResolvedValue({ data: null, error: null }),\n      maybeSingle: jest.fn().mockResolvedValue({ data: null, error: null }),\n    })),\n    rpc: jest.fn().mockResolvedValue({ data: [], error: null }),\n    auth: {\n      getSession: jest.fn().mockResolvedValue({ data: { session: null }, error: null }),\n      getUser: jest.fn().mockResolvedValue({ data: { user: null }, error: null }),\n    },\n    storage: {\n      from: jest.fn(() => ({\n        upload: jest.fn().mockResolvedValue({ data: { path: 'mock' }, error: null }),\n        download: jest.fn().mockResolvedValue({ data: null, error: null }),\n      })),\n    },\n  })),\n}));\n\njest.setTimeout(120000);\n\nimport { startInMemoryMongo, stopInMemoryMongo } from './src/testDatabase';\nimport mongoose from 'mongoose';\nimport 'ts-node/register';\nimport 'tsconfig-paths/register';\nimport { TextEncoder, TextDecoder } from 'util';\n\n// Fix for whatwg-url global issue\nglobal.TextEncoder = TextEncoder as unknown as typeof globalThis.TextEncoder;\nglobal.TextDecoder = TextDecoder as unknown as typeof globalThis.TextDecoder;\n\n// Mock whatwg-url to avoid the TypeError\njest.mock('whatwg-url', () => ({\n  URL: class MockURL {\n    constructor(url: string, base?: string) {\n      this.href = url;\n      this.origin = base || '';\n      this.protocol = 'https:';\n      this.host = 'localhost';\n      this.hostname = 'localhost';\n      this.port = '';\n      this.pathname = '/';\n      this.search = '';\n      this.hash = '';\n    }\n    href: string;\n    origin: string;\n    protocol: string;\n    host: string;\n    hostname: string;\n    port: string;\n    pathname: string;\n    search: string;\n    hash: string;\n    toString() {\n      return this.href;\n    }\n  },\n  URLSearchParams: class MockURLSearchParams {\n    constructor(init?: string | Record<string, string> | string[][] | Iterable<[string, string]>) {\n      // Simple mock implementation\n    }\n    append(name: string, value: string) {}\n    delete(name: string) {}\n    get(name: string) {\n      return null;\n    }\n    has(name: string) {\n      return false;\n    }\n    set(name: string, value: string) {}\n    toString() {\n      return '';\n    }\n  },\n}));\n\n// Setup and teardown\nbeforeAll(async () => {\n  console.log('ðŸ” [DEBUG] Pre-loading mongoose...');\n  try {\n    await startInMemoryMongo();\n    console.log('âœ… [DEBUG] Mongoose loaded successfully in jest.setup.ts');\n  } catch (error) {\n    console.log('âŒ [DEBUG] Mongoose loading failed:', error);\n  }\n});\n\nafterAll(async () => {\n  try {\n    await stopInMemoryMongo();\n  } catch (e) {\n    // Ignore â€” some test suites mock mongoose\n  }\n  try {\n    if (mongoose.connection && typeof mongoose.connection.close === 'function') {\n      await mongoose.connection.close();\n    }\n  } catch (e) {\n    // Ignore â€” connection may already be closed or mocked\n  }\n});\n\n// Environment variables set at the top\n"],"version":3}
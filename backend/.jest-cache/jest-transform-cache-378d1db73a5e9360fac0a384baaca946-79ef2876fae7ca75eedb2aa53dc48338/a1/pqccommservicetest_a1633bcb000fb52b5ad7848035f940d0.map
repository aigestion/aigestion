{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\pqc-comm.service.test.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,4BAA0B;AAC1B,uEAAkE;AAClE,sDAAwC;AACxC,gDAAkC;AAClC,8DAAiC;AAEjC,QAAQ,CAAC,iCAAiC,EAAE,GAAG,EAAE;IAC/C,IAAI,UAA0B,CAAC;IAE/B,UAAU,CAAC,GAAG,EAAE;QACd,UAAU,GAAG,IAAI,iCAAc,EAAE,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,oDAAoD,EAAE,KAAK,IAAI,EAAE;QAClE,sCAAsC;QACtC,MAAM,UAAU,GAAG,MAAM,UAAU,CAAC,qBAAqB,EAAE,CAAC;QAE5D,qDAAqD;QACrD,MAAM,iBAAiB,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;QAC7C,MAAM,CAAC,gBAAgB,EAAE,aAAa,CAAC,GAAG,KAAK,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;QAEtG,MAAM,eAAe,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CACrC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,EAC7C,iBAAiB,CAAC,SAAS,CAC5B,CAAC;QAEF,qEAAqE;QACrE,MAAM,cAAc,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;QACjG,MAAM,gBAAgB,GAAG,qBAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAE1F,yDAAyD;QACzD,MAAM,gBAAgB,GAAG,MAAM,UAAU,CAAC,kBAAkB,CAC1D,UAAU,CAAC,OAAO,CAAC,OAAO,EAC1B,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,EACxD,UAAU,CAAC,GAAG,CAAC,OAAO,EACtB,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAC9C,CAAC;QAEF,kCAAkC;QAClC,MAAM,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAChD,OAAO,CAAC,GAAG,CAAC,uCAAuC,EAAE,gBAAgB,CAAC,CAAC;IACzE,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\pqc-comm.service.test.ts"],"sourcesContent":["import 'reflect-metadata';\r\nimport { PQCCommService } from '../src/services/pqc-comm.service';\r\nimport * as kyber from 'crystals-kyber';\r\nimport * as nacl from 'tweetnacl';\r\nimport crypto from 'node:crypto';\r\n\r\ndescribe('PQCCommService Hybrid Handshake', () => {\r\n  let pqcService: PQCCommService;\r\n\r\n  beforeEach(() => {\r\n    pqcService = new PQCCommService();\r\n  });\r\n\r\n  it('should derive the same symmetric key on both sides', async () => {\r\n    // 1. Server generates its hybrid keys\r\n    const serverKeys = await pqcService.generateHandshakeKeys();\r\n    \r\n    // 2. Client simulates receiving server's public keys\r\n    const clientClassicKeys = nacl.box.keyPair();\r\n    const [clientCiphertext, clientKyberSS] = kyber.Encrypt768(Buffer.from(serverKeys.pqc.public, 'hex'));\r\n    \r\n    const clientClassicSS = nacl.box.before(\r\n      Buffer.from(serverKeys.classic.public, 'hex'),\r\n      clientClassicKeys.secretKey\r\n    );\r\n    \r\n    // Client-side derivation (simulated manually to match service logic)\r\n    const combinedClient = Buffer.concat([Buffer.from(clientClassicSS), Buffer.from(clientKyberSS)]);\r\n    const clientDerivedKey = crypto.createHash('sha256').update(combinedClient).digest('hex');\r\n\r\n    // 3. Server receives client's public keys and ciphertext\r\n    const serverDerivedKey = await pqcService.deriveSymmetricKey(\r\n      serverKeys.classic.private,\r\n      Buffer.from(clientClassicKeys.publicKey).toString('hex'),\r\n      serverKeys.pqc.private,\r\n      Buffer.from(clientCiphertext).toString('hex')\r\n    );\r\n\r\n    // 4. ASSERT: Both keys must match\r\n    expect(serverDerivedKey).toBe(clientDerivedKey);\r\n    console.log('âœ… Hybrid PQC Key Derivation Verified:', serverDerivedKey);\r\n  });\r\n});\r\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\youtube.routes.ts","mappings":";;AAAA,qCAAiC;AACjC,6BAAwB;AAExB,iEAAuE;AACvE,sFAAiF;AACjF,4CAAyC;AAEzC,MAAM,aAAa,GAAG,IAAA,gBAAM,GAAE,CAAC;AAE/B,MAAM,gBAAgB,GAAG,OAAC,CAAC,MAAM,CAAC;IAChC,QAAQ,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE;IAC1B,cAAc,EAAE,OAAC,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE;CACnC,CAAC,CAAC;AAEH;;;;;;;;;;;;;;;;;;;;;;;;;;GA0BG;AACH,aAAa,CAAC,IAAI,CAAC,aAAa,EAAE,KAAK,EAAE,GAAQ,EAAE,GAAQ,EAAE,EAAE;IAC7D,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,CAAC;IAChC,IAAI,CAAC;QACH,MAAM,SAAS,GAAG,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACvD,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC;YACvB,OAAO,GAAG;iBACP,MAAM,CAAC,GAAG,CAAC;iBACX,IAAI,CACH,IAAA,6BAAU,EACR,eAAe,EACf,kBAAkB,EAClB,GAAG,EACH,SAAS,EACT,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,WAAW,CACtC,CACF,CAAC;QACN,CAAC;QAED,MAAM,EAAE,QAAQ,EAAE,cAAc,EAAE,GAAG,SAAS,CAAC,IAAI,CAAC;QACpD,MAAM,QAAQ,GAAG,kBAAkB,IAAI,CAAC,GAAG,EAAE,EAAE,CAAC;QAEhD,MAAM,GAAG,GAAG;YACV,QAAQ;YACR,cAAc;YACd,QAAQ;YACR,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;SACpC,CAAC;QAEF,MAAM,SAAS,GAAG,MAAM,uDAAyB,CAAC,uBAAuB,CAAC,GAAG,CAAC,CAAC;QAE/E,IAAI,SAAS,EAAE,CAAC;YACd,eAAM,CAAC,IAAI,CAAC,+BAA+B,QAAQ,OAAO,cAAc,EAAE,CAAC,CAAC;YAC5E,OAAO,GAAG,CAAC,IAAI,CACb,IAAA,gCAAa,EAAC,EAAE,OAAO,EAAE,0BAA0B,EAAE,KAAK,EAAE,QAAQ,EAAE,EAAE,GAAG,EAAE,SAAS,CAAC,CACxF,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,6BAAU,EAAC,qBAAqB,EAAE,aAAa,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;QAChG,CAAC;IACH,CAAC;IAAC,OAAO,KAAU,EAAE,CAAC;QACpB,eAAM,CAAC,KAAK,CAAC,KAAK,EAAE,8BAA8B,CAAC,CAAC;QACpD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAA,6BAAU,EAAC,KAAK,CAAC,OAAO,EAAE,gBAAgB,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;IAC3F,CAAC;AACH,CAAC,CAAC,CAAC;AAEH,kBAAe,aAAa,CAAC","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\routes\\youtube.routes.ts"],"sourcesContent":["import { Router } from 'express';\nimport { z } from 'zod';\n\nimport { buildError, buildResponse } from '../common/response-builder';\nimport { youtubeTranscriptionQueue } from '../queue/youtube-transcription.queue';\nimport { logger } from '../utils/logger';\n\nconst youtubeRouter = Router();\n\nconst TranscribeSchema = z.object({\n  videoUrl: z.string().url(),\n  recipientEmail: z.string().email(),\n});\n\n/**\n * @openapi\n * /youtube/transcribe:\n *   post:\n *     summary: Request a YouTube video transcription\n *     tags: [YouTube]\n *     requestBody:\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             type: object\n *             properties:\n *               videoUrl:\n *                 type: string\n *                 format: uri\n *               recipientEmail:\n *                 type: string\n *                 format: email\n *     responses:\n *       202:\n *         description: Transcription job queued\n *       400:\n *         description: Validation error\n *       500:\n *         description: Server error\n */\nyoutubeRouter.post('/transcribe', async (req: any, res: any) => {\n  const requestId = req.requestId;\n  try {\n    const validated = TranscribeSchema.safeParse(req.body);\n    if (!validated.success) {\n      return res\n        .status(400)\n        .json(\n          buildError(\n            'Invalid Input',\n            'VALIDATION_ERROR',\n            400,\n            requestId,\n            validated.error.flatten().fieldErrors,\n          ),\n        );\n    }\n\n    const { videoUrl, recipientEmail } = validated.data;\n    const fileName = `manual_request_${Date.now()}`;\n\n    const job = {\n      videoUrl,\n      recipientEmail,\n      fileName,\n      timestamp: new Date().toISOString(),\n    };\n\n    const published = await youtubeTranscriptionQueue.publishTranscriptionJob(job);\n\n    if (published) {\n      logger.info(`Transcription requested for ${videoUrl} by ${recipientEmail}`);\n      return res.json(\n        buildResponse({ message: 'Transcription job queued', jobId: fileName }, 202, requestId),\n      );\n    } else {\n      return res.status(500).json(buildError('Failed to queue job', 'QUEUE_ERROR', 500, requestId));\n    }\n  } catch (error: any) {\n    logger.error(error, 'Transcription request failed');\n    return res.status(500).json(buildError(error.message, 'INTERNAL_ERROR', 500, requestId));\n  }\n});\n\nexport default youtubeRouter;\n"],"version":3}
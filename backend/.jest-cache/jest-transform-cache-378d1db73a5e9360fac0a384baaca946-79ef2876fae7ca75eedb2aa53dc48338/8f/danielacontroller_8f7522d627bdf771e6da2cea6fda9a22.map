{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\daniela.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\daniela.controller.ts"],"sourcesContent":["import { Request, Response, NextFunction } from 'express';\nimport { injectable, inject } from 'inversify';\nimport { DanielaAIService } from '../services/daniela-ai.service';\nimport { buildResponse } from '../common/response-builder';\nimport { logger } from '../utils/logger';\n\nimport { TYPES } from '../types';\n\n/**\n * ðŸ’œ Daniela Controller\n * Provides REST endpoints for Daniela AI interactions.\n */\n@injectable()\nexport class DanielaController {\n  constructor(@inject(TYPES.DanielaAIService) private danielaService: DanielaAIService) {\n    // Bind methods for use as route handlers\n    this.chat = this.chat.bind(this);\n    this.getStatus = this.getStatus.bind(this);\n    this.getInsights = this.getInsights.bind(this);\n    this.getSystemStatus = this.getSystemStatus.bind(this);\n  }\n\n  /**\n   * Chat with Daniela\n   */\n  public async chat(req: Request, res: Response, next: NextFunction) {\n    try {\n      const { message, sessionId } = req.body;\n      const userId = (req as any).user?.id || 'anonymous';\n      const userName = (req as any).user?.name || 'User';\n      const userRole = (req as any).user?.role || 'user';\n\n      // We use the sessionId (from frontend) as the chatId for the service\n      const chatId = parseInt(sessionId, 10) || 0;\n\n      const response = await this.danielaService.processMessage(\n        chatId,\n        message,\n        userName,\n        userId,\n        userRole,\n      );\n\n      res.json(buildResponse({ response }, 200, (req as any).requestId));\n    } catch (error) {\n      logger.error('Error in DanielaController.chat:', error);\n      next(error);\n    }\n  }\n\n  /**\n   * Get Daniela's Status and Info\n   */\n  public async getStatus(req: Request, res: Response, next: NextFunction) {\n    try {\n      const info = this.danielaService.getDanielaInfo();\n      res.json(\n        buildResponse(\n          {\n            status: 'operational',\n            info,\n            version: '1.0.0-PRO',\n          },\n          200,\n          (req as any).requestId,\n        ),\n      );\n    } catch (error) {\n      next(error);\n    }\n  }\n\n  /**\n   * Get Strategic Insights for Daniela Dashboards\n   */\n  public async getInsights(req: Request, res: Response, next: NextFunction) {\n    try {\n      const userId = (req as any).user?.id || 'anonymous';\n      const insights = await this.danielaService.getInsights(userId);\n      res.json(buildResponse({ insights }, 200, (req as any).requestId));\n    } catch (error) {\n      logger.error('Error in DanielaController.getInsights:', error);\n      next(error);\n    }\n  }\n\n  /**\n   * Get System Status for Daniela Dashboards\n   */\n  public async getSystemStatus(req: Request, res: Response, next: NextFunction) {\n    try {\n      // For now, return the simulated/real metrics info\n      res.json(\n        buildResponse(\n          {\n            status: 'operational',\n            version: 'v2.4.0',\n            statistics: {\n              totalUsers: 12450,\n              activeConversations: 45,\n              messagesProcessed: 1500000,\n            },\n          },\n          200,\n          (req as any).requestId,\n        ),\n      );\n    } catch (error) {\n      next(error);\n    }\n  }\n}\n"],"version":3}
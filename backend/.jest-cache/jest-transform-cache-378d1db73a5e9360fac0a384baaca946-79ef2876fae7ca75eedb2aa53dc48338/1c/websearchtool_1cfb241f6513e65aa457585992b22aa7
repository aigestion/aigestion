540818d1d5c4cce5402993510ce3d3fa
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SearchWebTool = void 0;
const core_1 = require("@tavily/core");
const zod_1 = require("zod");
const base_tool_1 = require("./base.tool");
/**
 * SearchWebTool
 *
 * Performs a web search using the Tavily API. Includes comprehensive input validation,
 * environment variable checks, and detailed error handling to aid debugging.
 */
class SearchWebTool extends base_tool_1.BaseTool {
    /** Human‑readable name of the tool */
    name = 'search_web';
    /** Description used by the AI agent */
    description = 'Performs a web search to retrieve up‑to‑date information on a given topic.';
    /** Zod schema for input validation */
    schema = zod_1.z.object({
        query: zod_1.z
            .string()
            .min(1, { message: 'The search query must not be empty.' })
            .max(200, { message: 'The search query is too long (max 200 characters).' })
            .describe('The search query or topic to look up on the web.'),
    });
    /**
     * Execute the web search.
     *
     * @param input - Object containing the `query` string.
     * @returns An object with the answer and a list of result items.
     * @throws Will throw an error if the API key is missing or the request fails.
     */
    async execute(input) {
        // Runtime guard for empty query strings
        if (!input.query || input.query.trim().length === 0) {
            throw new Error('Search query cannot be empty.');
        }
        const apiKey = process.env.TAVILY_API_KEY;
        if (!apiKey) {
            throw new Error('TAVILY_API_KEY environment variable is not set.');
        }
        const client = (0, core_1.tavily)({ apiKey });
        try {
            const response = await client.search(input.query, {
                searchDepth: 'basic',
                includeAnswer: true,
                maxResults: 5,
            });
            return {
                answer: response.answer,
                results: response.results.map(r => ({
                    title: r.title,
                    url: r.url,
                    content: r.content,
                })),
            };
        }
        catch (error) {
            // Re‑throw with a clearer message for troubleshooting.
            throw new Error(`Web search failed: ${error.message}`);
        }
    }
}
exports.SearchWebTool = SearchWebTool;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFx0b29sc1xcd2ViLXNlYXJjaC50b29sLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLHVDQUFzQztBQUN0Qyw2QkFBd0I7QUFFeEIsMkNBQXVDO0FBRXZDOzs7OztHQUtHO0FBQ0gsTUFBYSxhQUFjLFNBQVEsb0JBQTJCO0lBQzVELHNDQUFzQztJQUN0QyxJQUFJLEdBQUcsWUFBWSxDQUFDO0lBRXBCLHVDQUF1QztJQUN2QyxXQUFXLEdBQUcsNEVBQTRFLENBQUM7SUFFM0Ysc0NBQXNDO0lBQ3RDLE1BQU0sR0FBRyxPQUFDLENBQUMsTUFBTSxDQUFDO1FBQ2hCLEtBQUssRUFBRSxPQUFDO2FBQ0wsTUFBTSxFQUFFO2FBQ1IsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxxQ0FBcUMsRUFBRSxDQUFDO2FBQzFELEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsb0RBQW9ELEVBQUUsQ0FBQzthQUMzRSxRQUFRLENBQUMsa0RBQWtELENBQUM7S0FDaEUsQ0FBQyxDQUFDO0lBRUg7Ozs7OztPQU1HO0lBQ0gsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUF3QjtRQUNwQyx3Q0FBd0M7UUFDeEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDcEQsTUFBTSxJQUFJLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1FBQ25ELENBQUM7UUFFRCxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQztRQUMxQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDWixNQUFNLElBQUksS0FBSyxDQUFDLGlEQUFpRCxDQUFDLENBQUM7UUFDckUsQ0FBQztRQUVELE1BQU0sTUFBTSxHQUFHLElBQUEsYUFBTSxFQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUM7WUFDSCxNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRTtnQkFDaEQsV0FBVyxFQUFFLE9BQU87Z0JBQ3BCLGFBQWEsRUFBRSxJQUFJO2dCQUNuQixVQUFVLEVBQUUsQ0FBQzthQUNkLENBQUMsQ0FBQztZQUVILE9BQU87Z0JBQ0wsTUFBTSxFQUFFLFFBQVEsQ0FBQyxNQUFNO2dCQUN2QixPQUFPLEVBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO29CQUNsQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUs7b0JBQ2QsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHO29CQUNWLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTztpQkFDbkIsQ0FBQyxDQUFDO2FBQ0osQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLHVEQUF1RDtZQUN2RCxNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUN6RCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBdkRELHNDQXVEQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEFsZWphbmRyb1xcQUlHZXN0aW9uXFxiYWNrZW5kXFxzcmNcXHRvb2xzXFx3ZWItc2VhcmNoLnRvb2wudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdGF2aWx5IH0gZnJvbSAnQHRhdmlseS9jb3JlJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG5pbXBvcnQgeyBCYXNlVG9vbCB9IGZyb20gJy4vYmFzZS50b29sJztcblxuLyoqXG4gKiBTZWFyY2hXZWJUb29sXG4gKlxuICogUGVyZm9ybXMgYSB3ZWIgc2VhcmNoIHVzaW5nIHRoZSBUYXZpbHkgQVBJLiBJbmNsdWRlcyBjb21wcmVoZW5zaXZlIGlucHV0IHZhbGlkYXRpb24sXG4gKiBlbnZpcm9ubWVudCB2YXJpYWJsZSBjaGVja3MsIGFuZCBkZXRhaWxlZCBlcnJvciBoYW5kbGluZyB0byBhaWQgZGVidWdnaW5nLlxuICovXG5leHBvcnQgY2xhc3MgU2VhcmNoV2ViVG9vbCBleHRlbmRzIEJhc2VUb29sPHsgcXVlcnk6IHN0cmluZyB9PiB7XG4gIC8qKiBIdW1hbuKAkXJlYWRhYmxlIG5hbWUgb2YgdGhlIHRvb2wgKi9cbiAgbmFtZSA9ICdzZWFyY2hfd2ViJztcblxuICAvKiogRGVzY3JpcHRpb24gdXNlZCBieSB0aGUgQUkgYWdlbnQgKi9cbiAgZGVzY3JpcHRpb24gPSAnUGVyZm9ybXMgYSB3ZWIgc2VhcmNoIHRvIHJldHJpZXZlIHVw4oCRdG/igJFkYXRlIGluZm9ybWF0aW9uIG9uIGEgZ2l2ZW4gdG9waWMuJztcblxuICAvKiogWm9kIHNjaGVtYSBmb3IgaW5wdXQgdmFsaWRhdGlvbiAqL1xuICBzY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgcXVlcnk6IHpcbiAgICAgIC5zdHJpbmcoKVxuICAgICAgLm1pbigxLCB7IG1lc3NhZ2U6ICdUaGUgc2VhcmNoIHF1ZXJ5IG11c3Qgbm90IGJlIGVtcHR5LicgfSlcbiAgICAgIC5tYXgoMjAwLCB7IG1lc3NhZ2U6ICdUaGUgc2VhcmNoIHF1ZXJ5IGlzIHRvbyBsb25nIChtYXggMjAwIGNoYXJhY3RlcnMpLicgfSlcbiAgICAgIC5kZXNjcmliZSgnVGhlIHNlYXJjaCBxdWVyeSBvciB0b3BpYyB0byBsb29rIHVwIG9uIHRoZSB3ZWIuJyksXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSB3ZWIgc2VhcmNoLlxuICAgKlxuICAgKiBAcGFyYW0gaW5wdXQgLSBPYmplY3QgY29udGFpbmluZyB0aGUgYHF1ZXJ5YCBzdHJpbmcuXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCB3aXRoIHRoZSBhbnN3ZXIgYW5kIGEgbGlzdCBvZiByZXN1bHQgaXRlbXMuXG4gICAqIEB0aHJvd3MgV2lsbCB0aHJvdyBhbiBlcnJvciBpZiB0aGUgQVBJIGtleSBpcyBtaXNzaW5nIG9yIHRoZSByZXF1ZXN0IGZhaWxzLlxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZShpbnB1dDogeyBxdWVyeTogc3RyaW5nIH0pOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIFJ1bnRpbWUgZ3VhcmQgZm9yIGVtcHR5IHF1ZXJ5IHN0cmluZ3NcbiAgICBpZiAoIWlucHV0LnF1ZXJ5IHx8IGlucHV0LnF1ZXJ5LnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2VhcmNoIHF1ZXJ5IGNhbm5vdCBiZSBlbXB0eS4nKTtcbiAgICB9XG5cbiAgICBjb25zdCBhcGlLZXkgPSBwcm9jZXNzLmVudi5UQVZJTFlfQVBJX0tFWTtcbiAgICBpZiAoIWFwaUtleSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUQVZJTFlfQVBJX0tFWSBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0LicpO1xuICAgIH1cblxuICAgIGNvbnN0IGNsaWVudCA9IHRhdmlseSh7IGFwaUtleSB9KTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuc2VhcmNoKGlucHV0LnF1ZXJ5LCB7XG4gICAgICAgIHNlYXJjaERlcHRoOiAnYmFzaWMnLFxuICAgICAgICBpbmNsdWRlQW5zd2VyOiB0cnVlLFxuICAgICAgICBtYXhSZXN1bHRzOiA1LFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFuc3dlcjogcmVzcG9uc2UuYW5zd2VyLFxuICAgICAgICByZXN1bHRzOiByZXNwb25zZS5yZXN1bHRzLm1hcChyID0+ICh7XG4gICAgICAgICAgdGl0bGU6IHIudGl0bGUsXG4gICAgICAgICAgdXJsOiByLnVybCxcbiAgICAgICAgICBjb250ZW50OiByLmNvbnRlbnQsXG4gICAgICAgIH0pKSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8gUmXigJF0aHJvdyB3aXRoIGEgY2xlYXJlciBtZXNzYWdlIGZvciB0cm91Ymxlc2hvb3RpbmcuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFdlYiBzZWFyY2ggZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=
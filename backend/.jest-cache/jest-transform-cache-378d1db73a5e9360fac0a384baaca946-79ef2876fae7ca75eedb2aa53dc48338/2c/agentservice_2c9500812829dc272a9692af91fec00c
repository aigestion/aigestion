864a2ef582e8d10162cd9b3bd2cfff89
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AgentService = void 0;
const inversify_1 = require("inversify");
const logger_1 = require("../utils/logger");
const ai_router_service_1 = require("./ai-router.service");
const vector_service_1 = require("./vector.service");
const types_1 = require("../types");
let AgentService = class AgentService {
    vectorService;
    semanticRouter;
    constructor(vectorService, semanticRouter) {
        this.vectorService = vectorService;
        this.semanticRouter = semanticRouter;
    }
    async processQuery(userId, query, context) {
        logger_1.logger.info(`Agent processing query for user ${userId}: ${query}`);
        // 1. Retrieve Long-Term Memory (Context)
        const memory = await this.vectorService.search(query, 5);
        const relevantContext = memory.map(m => m.content || m.text || '').join('\n');
        logger_1.logger.debug(`Retrieved ${memory.length} memory fragments`);
        // 2. Decide Strategy via Semantic Router
        const route = 'default'; // Simplified for now
        // 3. Execute Action (Placeholder for now)
        // Here we would switch based on 'route' (e.g. valid tool call, simple chat, etc.)
        return {
            query,
            route,
            context: relevantContext,
            response: `[Agent] Processed via vector memory. Route: ${route.type || route}`,
        };
    }
    async saveExperience(userId, content, metadata) {
        const doc = {
            id: `${userId}-${Date.now()}`,
            text: content,
            metadata: { ...metadata, userId },
        };
        await this.vectorService.upsert(doc);
        logger_1.logger.info(`Agent saved new experience for user ${userId}`);
    }
};
exports.AgentService = AgentService;
exports.AgentService = AgentService = __decorate([
    (0, inversify_1.injectable)(),
    __param(0, (0, inversify_1.inject)(types_1.TYPES.VectorService)),
    __param(1, (0, inversify_1.inject)(types_1.TYPES.SemanticRouterService)),
    __metadata("design:paramtypes", [typeof (_a = typeof vector_service_1.VectorService !== "undefined" && vector_service_1.VectorService) === "function" ? _a : Object, typeof (_b = typeof ai_router_service_1.SemanticRouterService !== "undefined" && ai_router_service_1.SemanticRouterService) === "function" ? _b : Object])
], AgentService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcYWdlbnQuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEseUNBQStDO0FBQy9DLDRDQUF5QztBQUN6QywyREFBNEQ7QUFDNUQscURBQWlEO0FBQ2pELG9DQUFpQztBQUcxQixJQUFNLFlBQVksR0FBbEIsTUFBTSxZQUFZO0lBRWdCO0lBQ1E7SUFGL0MsWUFDdUMsYUFBNEIsRUFDcEIsY0FBcUM7UUFEN0Msa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDcEIsbUJBQWMsR0FBZCxjQUFjLENBQXVCO0lBQ2pGLENBQUM7SUFFRyxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQWMsRUFBRSxLQUFhLEVBQUUsT0FBYTtRQUNwRSxlQUFNLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxNQUFNLEtBQUssS0FBSyxFQUFFLENBQUMsQ0FBQztRQUVuRSx5Q0FBeUM7UUFDekMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDekQsTUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFFLENBQVMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFdkYsZUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixDQUFDLENBQUM7UUFFNUQseUNBQXlDO1FBQ3pDLE1BQU0sS0FBSyxHQUFHLFNBQVMsQ0FBQyxDQUFDLHFCQUFxQjtRQUU5QywwQ0FBMEM7UUFDMUMsa0ZBQWtGO1FBRWxGLE9BQU87WUFDTCxLQUFLO1lBQ0wsS0FBSztZQUNMLE9BQU8sRUFBRSxlQUFlO1lBQ3hCLFFBQVEsRUFBRSwrQ0FBZ0QsS0FBYSxDQUFDLElBQUksSUFBSSxLQUFLLEVBQUU7U0FDeEYsQ0FBQztJQUNKLENBQUM7SUFFTSxLQUFLLENBQUMsY0FBYyxDQUFDLE1BQWMsRUFBRSxPQUFlLEVBQUUsUUFBYztRQUN6RSxNQUFNLEdBQUcsR0FBRztZQUNWLEVBQUUsRUFBRSxHQUFHLE1BQU0sSUFBSSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDN0IsSUFBSSxFQUFFLE9BQU87WUFDYixRQUFRLEVBQUUsRUFBRSxHQUFHLFFBQVEsRUFBRSxNQUFNLEVBQUU7U0FDbEMsQ0FBQztRQUNGLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckMsZUFBTSxDQUFDLElBQUksQ0FBQyx1Q0FBdUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUMvRCxDQUFDO0NBQ0YsQ0FBQTtBQXRDWSxvQ0FBWTt1QkFBWixZQUFZO0lBRHhCLElBQUEsc0JBQVUsR0FBRTtJQUdSLFdBQUEsSUFBQSxrQkFBTSxFQUFDLGFBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQTtJQUMzQixXQUFBLElBQUEsa0JBQU0sRUFBQyxhQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQTt5REFEZ0IsOEJBQWEsb0JBQWIsOEJBQWEsb0RBQ0oseUNBQXFCLG9CQUFyQix5Q0FBcUI7R0FIekUsWUFBWSxDQXNDeEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxBbGVqYW5kcm9cXEFJR2VzdGlvblxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcYWdlbnQuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpbmplY3RhYmxlLCBpbmplY3QgfSBmcm9tICdpbnZlcnNpZnknO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IFNlbWFudGljUm91dGVyU2VydmljZSB9IGZyb20gJy4vYWktcm91dGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVmVjdG9yU2VydmljZSB9IGZyb20gJy4vdmVjdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgVFlQRVMgfSBmcm9tICcuLi90eXBlcyc7XG5cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBBZ2VudFNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBAaW5qZWN0KFRZUEVTLlZlY3RvclNlcnZpY2UpIHByaXZhdGUgdmVjdG9yU2VydmljZTogVmVjdG9yU2VydmljZSxcbiAgICBAaW5qZWN0KFRZUEVTLlNlbWFudGljUm91dGVyU2VydmljZSkgcHJpdmF0ZSBzZW1hbnRpY1JvdXRlcjogU2VtYW50aWNSb3V0ZXJTZXJ2aWNlLFxuICApIHt9XG5cbiAgcHVibGljIGFzeW5jIHByb2Nlc3NRdWVyeSh1c2VySWQ6IHN0cmluZywgcXVlcnk6IHN0cmluZywgY29udGV4dD86IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgbG9nZ2VyLmluZm8oYEFnZW50IHByb2Nlc3NpbmcgcXVlcnkgZm9yIHVzZXIgJHt1c2VySWR9OiAke3F1ZXJ5fWApO1xuXG4gICAgLy8gMS4gUmV0cmlldmUgTG9uZy1UZXJtIE1lbW9yeSAoQ29udGV4dClcbiAgICBjb25zdCBtZW1vcnkgPSBhd2FpdCB0aGlzLnZlY3RvclNlcnZpY2Uuc2VhcmNoKHF1ZXJ5LCA1KTtcbiAgICBjb25zdCByZWxldmFudENvbnRleHQgPSBtZW1vcnkubWFwKG0gPT4gKG0gYXMgYW55KS5jb250ZW50IHx8IG0udGV4dCB8fCAnJykuam9pbignXFxuJyk7XG5cbiAgICBsb2dnZXIuZGVidWcoYFJldHJpZXZlZCAke21lbW9yeS5sZW5ndGh9IG1lbW9yeSBmcmFnbWVudHNgKTtcblxuICAgIC8vIDIuIERlY2lkZSBTdHJhdGVneSB2aWEgU2VtYW50aWMgUm91dGVyXG4gICAgY29uc3Qgcm91dGUgPSAnZGVmYXVsdCc7IC8vIFNpbXBsaWZpZWQgZm9yIG5vd1xuXG4gICAgLy8gMy4gRXhlY3V0ZSBBY3Rpb24gKFBsYWNlaG9sZGVyIGZvciBub3cpXG4gICAgLy8gSGVyZSB3ZSB3b3VsZCBzd2l0Y2ggYmFzZWQgb24gJ3JvdXRlJyAoZS5nLiB2YWxpZCB0b29sIGNhbGwsIHNpbXBsZSBjaGF0LCBldGMuKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHF1ZXJ5LFxuICAgICAgcm91dGUsXG4gICAgICBjb250ZXh0OiByZWxldmFudENvbnRleHQsXG4gICAgICByZXNwb25zZTogYFtBZ2VudF0gUHJvY2Vzc2VkIHZpYSB2ZWN0b3IgbWVtb3J5LiBSb3V0ZTogJHsocm91dGUgYXMgYW55KS50eXBlIHx8IHJvdXRlfWAsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzYXZlRXhwZXJpZW5jZSh1c2VySWQ6IHN0cmluZywgY29udGVudDogc3RyaW5nLCBtZXRhZGF0YT86IGFueSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRvYyA9IHtcbiAgICAgIGlkOiBgJHt1c2VySWR9LSR7RGF0ZS5ub3coKX1gLFxuICAgICAgdGV4dDogY29udGVudCxcbiAgICAgIG1ldGFkYXRhOiB7IC4uLm1ldGFkYXRhLCB1c2VySWQgfSxcbiAgICB9O1xuICAgIGF3YWl0IHRoaXMudmVjdG9yU2VydmljZS51cHNlcnQoZG9jKTtcbiAgICBsb2dnZXIuaW5mbyhgQWdlbnQgc2F2ZWQgbmV3IGV4cGVyaWVuY2UgZm9yIHVzZXIgJHt1c2VySWR9YCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==
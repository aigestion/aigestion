{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\centralized-logging.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\services\\centralized-logging.service.ts"],"sourcesContent":["import crypto from 'crypto';\nimport fs from 'fs/promises';\nimport { injectable } from 'inversify';\nimport type { RedisClientType } from 'redis';\nimport path from 'path';\nimport { getRedisClient } from '../cache/redis';\nimport { logger } from '../utils/logger';\nexport const CENTRAL_LOGGING_SERVICE_NAME = 'CentralizedLoggingService';\n\ninterface LogEntry {\n  id: string;\n  timestamp: Date;\n  level: 'debug' | 'info' | 'warn' | 'error' | 'critical';\n  service: string;\n  userId?: string;\n  sessionId?: string;\n  requestId?: string;\n  ipAddress?: string;\n  userAgent?: string;\n  message: string;\n  metadata: {\n    [key: string]: any;\n  };\n  stack?: string;\n  duration?: number;\n  tags: string[];\n}\n\ninterface LogQuery {\n  level?: string;\n  service?: string;\n  userId?: string;\n  sessionId?: string;\n  startTime?: Date;\n  endTime?: Date;\n  tags?: string[];\n  limit?: number;\n  offset?: number;\n  search?: string;\n}\n\ninterface LogStats {\n  totalLogs: number;\n  logsByLevel: { [key: string]: number };\n  logsByService: { [key: string]: number };\n  errorRate: number;\n  averageResponseTime: number;\n  topErrors: Array<{\n    message: string;\n    count: number;\n    level: string;\n    service: string;\n  }>;\n  recentActivity: Array<{\n    timestamp: Date;\n    level: string;\n    service: string;\n    message: string;\n  }>;\n}\n\n@injectable()\nexport class CentralizedLoggingService {\n  private readonly redis: RedisClientType;\n  private readonly logBuffer: LogEntry[] = [];\n  private readonly bufferSize = 1000;\n  private readonly flushInterval = 5000; // 5 seconds\n  private readonly logRetention = 30 * 24 * 60 * 60 * 1000; // 30 days\n  private readonly logDirectory = 'logs';\n  private readonly maxLogFiles = 100;\n\n  constructor() {\n    this.redis = getRedisClient();\n\n    this.initializeLogging();\n    this.startLogFlush();\n    this.startLogRotation();\n  }\n\n  private async initializeLogging() {\n    try {\n      // Create log directory\n      await fs.mkdir(this.logDirectory, { recursive: true });\n\n      // Create daily log files\n      const today = new Date().toISOString().split('T')[0];\n      const logFile = path.join(this.logDirectory, `nexus-${today}.log`);\n\n      // Check if log file exists\n      try {\n        await fs.access(logFile);\n      } catch {\n        // Create new log file with header\n        const header = `# NEXUS V1 Centralized Log - ${today}\\n`;\n        await fs.writeFile(logFile, header);\n      }\n\n      logger.info('Centralized logging service initialized');\n    } catch (error) {\n      logger.error('Failed to initialize centralized logging:', error);\n    }\n  }\n\n  /**\n   * Log an entry\n   */\n  public async log(entry: Omit<LogEntry, 'id' | 'timestamp'>): Promise<void> {\n    try {\n      const logEntry: LogEntry = {\n        ...entry,\n        id: this.generateLogId(),\n        timestamp: new Date(),\n      };\n\n      // Add to buffer\n      this.logBuffer.push(logEntry);\n\n      // Buffer management\n      if (this.logBuffer.length >= this.bufferSize) {\n        await this.flushLogs();\n      }\n\n      // Critical logs are flushed immediately\n      if (entry.level === 'critical') {\n        await this.flushLogs();\n        await this.sendAlert(logEntry);\n      }\n    } catch (error) {\n      logger.error('Failed to log entry:', error);\n    }\n  }\n\n  /**\n   * Query logs\n   */\n  public async queryLogs(query: LogQuery): Promise<{\n    logs: LogEntry[];\n    total: number;\n    hasMore: boolean;\n  }> {\n    try {\n      const cacheKey = this.generateQueryCacheKey(query);\n      const cached = await this.redis.get(cacheKey);\n\n      if (cached) {\n        const result = JSON.parse(cached);\n        return result;\n      }\n\n      // Query from file system (simplified implementation)\n      const logs = await this.queryLogsFromFile(query);\n      const total = logs.length;\n      const limit = query.limit || 100;\n      const offset = query.offset || 0;\n      const paginatedLogs = logs.slice(offset, offset + limit);\n      const hasMore = offset + limit < total;\n\n      const result = {\n        logs: paginatedLogs,\n        total,\n        hasMore,\n      };\n\n      // Cache result\n      await this.redis.setEx(cacheKey, 60, JSON.stringify(result));\n\n      return result;\n    } catch (error) {\n      logger.error('Failed to query logs:', error);\n      return { logs: [], total: 0, hasMore: false };\n    }\n  }\n\n  /**\n   * Get log statistics\n   */\n  public async getStats(timeRange: 'hour' | 'day' | 'week' | 'month' = 'day'): Promise<LogStats> {\n    try {\n      const now = new Date();\n      let startTime: Date;\n\n      switch (timeRange) {\n        case 'hour':\n          startTime = new Date(now.getTime() - 60 * 60 * 1000);\n          break;\n        case 'day':\n          startTime = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n          break;\n        case 'week':\n          startTime = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n          break;\n        case 'month':\n          startTime = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n          break;\n      }\n\n      const query: LogQuery = {\n        startTime,\n        endTime: now,\n        limit: 10000,\n      };\n\n      const { logs } = await this.queryLogs(query);\n\n      const stats: LogStats = {\n        totalLogs: logs.length,\n        logsByLevel: {},\n        logsByService: {},\n        errorRate: 0,\n        averageResponseTime: 0,\n        topErrors: [],\n        recentActivity: [],\n      };\n\n      // Calculate statistics\n      logs.forEach(log => {\n        // Count by level\n        stats.logsByLevel[log.level] = (stats.logsByLevel[log.level] || 0) + 1;\n\n        // Count by service\n        stats.logsByService[log.service] = (stats.logsByService[log.service] || 0) + 1;\n\n        // Calculate error rate\n        if (log.level === 'error' || log.level === 'critical') {\n          stats.errorRate++;\n        }\n\n        // Calculate average response time\n        if (log.duration) {\n          stats.averageResponseTime += log.duration;\n        }\n      });\n\n      // Finalize calculations\n      stats.errorRate = logs.length > 0 ? (stats.errorRate / logs.length) * 100 : 0;\n      stats.averageResponseTime = logs.length > 0 ? stats.averageResponseTime / logs.length : 0;\n\n      // Top errors\n      const errorLogs = logs.filter(log => log.level === 'error' || log.level === 'critical');\n      const errorCounts = new Map<\n        string,\n        { count: number; level: string; service: string; message: string }\n      >();\n\n      errorLogs.forEach(log => {\n        const key = `${log.service}:${log.message}`;\n        const existing = errorCounts.get(key);\n        if (existing) {\n          existing.count++;\n        } else {\n          errorCounts.set(key, {\n            count: 1,\n            level: log.level,\n            service: log.service,\n            message: log.message,\n          });\n        }\n      });\n\n      stats.topErrors = Array.from(errorCounts.values())\n        .sort((a, b) => b.count - a.count)\n        .slice(0, 10);\n\n      // Recent activity\n      stats.recentActivity = logs\n        .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())\n        .slice(0, 20)\n        .map(log => ({\n          timestamp: log.timestamp,\n          level: log.level,\n          service: log.service,\n          message: log.message,\n        }));\n\n      return stats;\n    } catch (error) {\n      logger.error('Failed to get log stats:', error);\n      return {\n        totalLogs: 0,\n        logsByLevel: {},\n        logsByService: {},\n        errorRate: 0,\n        averageResponseTime: 0,\n        topErrors: [],\n        recentActivity: [],\n      };\n    }\n  }\n\n  /**\n   * Search logs\n   */\n  public async searchLogs(\n    searchTerm: string,\n    options: Partial<LogQuery> = {},\n  ): Promise<LogEntry[]> {\n    try {\n      const query: LogQuery = {\n        search: searchTerm,\n        limit: 100,\n        ...options,\n      };\n\n      const { logs } = await this.queryLogs(query);\n      return logs;\n    } catch (error) {\n      logger.error('Failed to search logs:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Export logs\n   */\n  public async exportLogs(query: LogQuery, format: 'json' | 'csv' = 'json'): Promise<string> {\n    try {\n      const { logs } = await this.queryLogs({ ...query, limit: 10000 });\n\n      if (format === 'csv') {\n        const headers = [\n          'id',\n          'timestamp',\n          'level',\n          'service',\n          'userId',\n          'message',\n          'ipAddress',\n          'duration',\n        ];\n        const csvData = logs.map(log => [\n          log.id,\n          log.timestamp.toISOString(),\n          log.level,\n          log.service,\n          log.userId || '',\n          log.message.replace(/\"/g, '\"\"'), // Escape quotes\n          log.ipAddress || '',\n          log.duration || '',\n        ]);\n\n        return [headers, ...csvData].map(row => row.join(',')).join('\\n');\n      }\n\n      return JSON.stringify(logs, null, 2);\n    } catch (error) {\n      logger.error('Failed to export logs:', error);\n      return '';\n    }\n  }\n\n  /**\n   * Flush buffer to persistent storage\n   */\n  private async flushLogs(): Promise<void> {\n    try {\n      if (this.logBuffer.length === 0) {\n        return;\n      }\n\n      const logsToFlush = [...this.logBuffer];\n      this.logBuffer.length = 0; // Clear buffer\n\n      // Write to daily log file\n      const today = new Date().toISOString().split('T')[0];\n      const logFile = path.join(this.logDirectory, `nexus-${today}.log`);\n\n      const logLines = logsToFlush.map(\n        log =>\n          `${log.timestamp.toISOString()} [${log.level.toUpperCase()}] ${log.service}: ${\n            log.message\n          } ` +\n          `${log.userId ? `[user:${log.userId}]` : ''} ${\n            log.ipAddress ? `[ip:${log.ipAddress}]` : ''\n          } ` +\n          `${log.duration ? `[duration:${log.duration}ms]` : ''} ` +\n          `${\n            Object.keys(log.metadata).length > 0 ? `[metadata:${JSON.stringify(log.metadata)}]` : ''\n          }`,\n      );\n\n      await fs.appendFile(logFile, logLines.join('\\n') + '\\n');\n\n      // Store in Redis for quick access\n      for (const log of logsToFlush) {\n        const redisKey = `log:${log.service}:${log.id}`;\n        await this.redis.setEx(redisKey, 24 * 60 * 60, JSON.stringify(log));\n\n        // Add to service index\n        await this.redis.lPush(`logs:${log.service}:recent`, JSON.stringify(log));\n        await this.redis.lTrim(`logs:${log.service}:recent`, 0, 999); // Keep last 1000\n\n        // Add to level index if error or critical\n        if (log.level === 'error' || log.level === 'critical') {\n          await this.redis.lPush('logs:errors:recent', JSON.stringify(log));\n          await this.redis.lTrim('logs:errors:recent', 0, 999);\n        }\n      }\n\n      logger.debug(`Flushed ${logsToFlush.length} logs to storage`);\n    } catch (error) {\n      logger.error('Failed to flush logs:', error);\n    }\n  }\n\n  /**\n   * Query logs from file system\n   */\n  private async queryLogsFromFile(query: LogQuery): Promise<LogEntry[]> {\n    try {\n      const today = new Date().toISOString().split('T')[0];\n      const logFile = path.join(this.logDirectory, `nexus-${today}.log`);\n\n      const content = await fs.readFile(logFile, 'utf-8');\n      const lines = content.split('\\n').filter(line => line.trim() && !line.startsWith('#'));\n\n      const logs: LogEntry[] = [];\n\n      for (const line of lines) {\n        try {\n          const log = this.parseLogLine(line);\n          if (this.matchesQuery(log, query)) {\n            logs.push(log);\n          }\n        } catch (error) {\n          // Skip malformed lines\n        }\n      }\n\n      // Sort by timestamp (newest first)\n      logs.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\n\n      return logs;\n    } catch (error) {\n      logger.error('Failed to query logs from file:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Parse log line\n   */\n  private parseLogLine(line: string): LogEntry {\n    const timestampMatch = line.match(/^(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z)/);\n    const levelMatch = line.match(/\\[(DEBUG|INFO|WARN|ERROR|CRITICAL)\\]/);\n    const serviceMatch = line.match(/\\] ([^:]+):/);\n    const messageMatch = line.match(/: (.+?)(?: \\[|$)/);\n\n    const userIdMatch = line.match(/\\[user:([^\\]]+)\\]/);\n    const ipMatch = line.match(/\\[ip:([^\\]]+)\\]/);\n    const durationMatch = line.match(/\\[duration:(\\d+)ms\\]/);\n    const metadataMatch = line.match(/\\[metadata:([^\\]]+)\\]/);\n\n    return {\n      id: crypto.randomBytes(16).toString('hex'),\n      timestamp: timestampMatch ? new Date(timestampMatch[1]) : new Date(),\n      level: (levelMatch?.[1] || 'info').toLowerCase() as any,\n      service: serviceMatch?.[1] || 'unknown',\n      message: messageMatch?.[1] || line,\n      userId: userIdMatch?.[1],\n      ipAddress: ipMatch?.[1],\n      duration: durationMatch ? parseInt(durationMatch[1]) : undefined,\n      metadata: metadataMatch ? JSON.parse(metadataMatch[1]) : {},\n      tags: [],\n      sessionId: undefined,\n      requestId: undefined,\n      userAgent: undefined,\n      stack: undefined,\n    };\n  }\n\n  /**\n   * Check if log matches query\n   */\n  private matchesQuery(log: LogEntry, query: LogQuery): boolean {\n    if (query.level && log.level !== query.level) return false;\n    if (query.service && log.service !== query.service) return false;\n    if (query.userId && log.userId !== query.userId) return false;\n    if (query.startTime && log.timestamp < query.startTime) return false;\n    if (query.endTime && log.timestamp > query.endTime) return false;\n    if (query.search && !log.message.toLowerCase().includes(query.search.toLowerCase()))\n      return false;\n    if (query.tags && query.tags.length > 0 && !query.tags.some(tag => log.tags.includes(tag)))\n      return false;\n\n    return true;\n  }\n\n  /**\n   * Generate query cache key\n   */\n  private generateQueryCacheKey(query: LogQuery): string {\n    const key = `query:${JSON.stringify(query)}`;\n    return crypto.createHash('md5').update(key).digest('hex');\n  }\n\n  /**\n   * Generate log ID\n   */\n  private generateLogId(): string {\n    return `log_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Send alert for critical logs\n   */\n  private async sendAlert(log: LogEntry): Promise<void> {\n    try {\n      // This would integrate with your alerting system (Sentry, PagerDuty, etc.)\n      logger.error('CRITICAL ALERT', {\n        id: log.id,\n        service: log.service,\n        message: log.message,\n        userId: log.userId,\n        ipAddress: log.ipAddress,\n        metadata: log.metadata,\n      });\n\n      // Store alert for monitoring\n      await this.redis.setEx(\n        `alert:${log.id}`,\n        24 * 60 * 60, // 24 hours\n        JSON.stringify({\n          ...log,\n          alertLevel: 'critical',\n          sentAt: new Date(),\n        }),\n      );\n    } catch (error) {\n      logger.error('Failed to send alert:', error);\n    }\n  }\n\n  /**\n   * Start log flush interval\n   */\n  private startLogFlush(): void {\n    setInterval(() => {\n      this.flushLogs();\n    }, this.flushInterval);\n  }\n\n  /**\n   * Start log rotation\n   */\n  private startLogRotation(): void {\n    setInterval(\n      async () => {\n        await this.rotateLogs();\n      },\n      24 * 60 * 60 * 1000,\n    ); // Daily\n  }\n\n  /**\n   * Rotate old log files\n   */\n  private async rotateLogs(): Promise<void> {\n    try {\n      const files = await fs.readdir(this.logDirectory);\n      const logFiles = files.filter(file => file.startsWith('nexus-') && file.endsWith('.log'));\n\n      // Sort by date (oldest first)\n      logFiles.sort((a, b) => {\n        const dateA = a.split('-')[1].split('.')[0];\n        const dateB = b.split('-')[1].split('.')[0];\n        return dateA.localeCompare(dateB);\n      });\n\n      // Remove old files beyond retention period\n      const cutoffDate = new Date(Date.now() - this.logRetention);\n\n      for (const file of logFiles) {\n        if (logFiles.length > this.maxLogFiles) {\n          const filePath = path.join(this.logDirectory, file);\n          await fs.unlink(filePath);\n          logger.info(`Rotated old log file: ${file}`);\n          logFiles.shift(); // Remove from array\n        }\n\n        // Check file date\n        const fileDate = file.split('-')[1].split('.')[0];\n        const fileDateTime = new Date(fileDate);\n\n        if (fileDateTime < cutoffDate) {\n          const filePath = path.join(this.logDirectory, file);\n          await fs.unlink(filePath);\n          logger.info(`Rotated expired log file: ${file}`);\n        }\n      }\n\n      logger.info('Log rotation completed');\n    } catch (error) {\n      logger.error('Failed to rotate logs:', error);\n    }\n  }\n\n  /**\n   * Get recent logs for a service\n   */\n  public async getRecentLogs(service: string, limit: number = 100): Promise<LogEntry[]> {\n    try {\n      const logData = await this.redis.lRange(`logs:${service}:recent`, 0, limit - 1);\n      return logData.map(data => JSON.parse(data));\n    } catch (error) {\n      logger.error('Failed to get recent logs:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Get recent error logs\n   */\n  public async getRecentErrors(limit: number = 100): Promise<LogEntry[]> {\n    try {\n      const errorData = await this.redis.lRange('logs:errors:recent', 0, limit - 1);\n      return errorData.map(data => JSON.parse(data));\n    } catch (error) {\n      logger.error('Failed to get recent errors:', error);\n      return [];\n    }\n  }\n}\n"],"version":3}
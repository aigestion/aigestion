{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\docker\\DockerService.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\infrastructure\\docker\\DockerService.ts"],"sourcesContent":["import { exec } from 'child_process';\nimport { injectable } from 'inversify';\nimport { promisify } from 'util';\n\nimport { logger } from '../../utils/logger';\nimport { getCache, setCache } from '../../utils/redis';\n\nconst execAsync = promisify(exec);\n\n/**\n * üåå [GOD MODE] DockerService\n * Advanced container orchestration layer with structured metrics and caching.\n * Optimized for high-frequency environment monitoring and management.\n */\n@injectable()\nexport class DockerService {\n  private readonly CACHE_TTL = 5; // Seconds\n\n  /**\n   * Get all containers with advanced metadata\n   */\n  async getContainers(): Promise<any[]> {\n    const cacheKey = 'docker:containers:list';\n    const cachedData = await getCache(cacheKey);\n\n    if (cachedData) {\n      return JSON.parse(cachedData);\n    }\n\n    try {\n      const { stdout } = await execAsync('docker ps -a --format \"{{json .}}\"');\n      const containers = this.parseJsonStdout(stdout);\n\n      await setCache(cacheKey, JSON.stringify(containers), this.CACHE_TTL);\n      logger.debug('[DockerService] Containers list refreshed');\n      return containers;\n    } catch (error: any) {\n      this.handleError('getContainers', error);\n      return [];\n    }\n  }\n\n  /**\n   * Get container stats with millisecond precision\n   */\n  async getContainerStats(id: string): Promise<any> {\n    this.validateId(id);\n    try {\n      const { stdout } = await execAsync(`docker stats ${id} --no-stream --format \"{{json .}}\"`);\n      return JSON.parse(stdout.trim());\n    } catch (error) {\n      this.handleError(`getContainerStats(${id})`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Safe container operations (Start/Stop/Restart)\n   */\n  async startContainer(id: string): Promise<void> {\n    this.validateId(id);\n    try {\n      await execAsync(`docker start ${id}`);\n      logger.info(`[DockerService] üöÄ Container ${id} launched successfully`);\n    } catch (error) {\n      this.handleError('startContainer', error);\n      throw error;\n    }\n  }\n\n  async stopContainer(id: string): Promise<void> {\n    this.validateId(id);\n    try {\n      await execAsync(`docker stop ${id}`);\n      logger.info(`[DockerService] üõë Container ${id} halted cleanly`);\n    } catch (error) {\n      this.handleError('stopContainer', error);\n      throw error;\n    }\n  }\n\n  async restartContainer(id: string): Promise<void> {\n    this.validateId(id);\n    try {\n      await execAsync(`docker restart ${id}`);\n      logger.info(`[DockerService] ‚ôªÔ∏è  Container ${id} recycled successfully`);\n    } catch (error) {\n      this.handleError('restartContainer', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Resource inventory (Images/Volumes/Networks)\n   */\n  async getImages(): Promise<any[]> {\n    try {\n      const { stdout } = await execAsync('docker images --format \"{{json .}}\"');\n      return this.parseJsonStdout(stdout);\n    } catch (error) {\n      this.handleError('getImages', error);\n      return [];\n    }\n  }\n\n  async getVolumes(): Promise<any[]> {\n    try {\n      const { stdout } = await execAsync('docker volume ls --format \"{{json .}}\"');\n      return this.parseJsonStdout(stdout);\n    } catch (error) {\n      this.handleError('getVolumes', error);\n      return [];\n    }\n  }\n\n  async getNetworks(): Promise<any[]> {\n    try {\n      const { stdout } = await execAsync('docker network ls --format \"{{json .}}\"');\n      return this.parseJsonStdout(stdout);\n    } catch (error) {\n      this.handleError('getNetworks', error);\n      return [];\n    }\n  }\n\n  /**\n   * Private utilities and security guards\n   */\n  private parseJsonStdout(stdout: string): any[] {\n    return stdout\n      .trim()\n      .split('\\n')\n      .filter(Boolean)\n      .map(line => {\n        try {\n          return JSON.parse(line);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean);\n  }\n\n  private validateId(id: string): void {\n    // Simple regex to prevent command injection\n    if (!/^[a-zA-Z0-9_-]+$/.test(id)) {\n      throw new Error('Invalid Docker resource ID: Security validation failed');\n    }\n  }\n\n  private handleError(operation: string, error: any): void {\n    const message = error.message || 'Unknown Docker Error';\n    logger.error(`[DockerService] üí• Failure in ${operation}: ${message}`, { error });\n  }\n}\n"],"version":3}
{"file":"C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\NexusCommandController.ts","mappings":"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","names":[],"sources":["C:\\Users\\Alejandro\\AIGestion\\backend\\src\\controllers\\NexusCommandController.ts"],"sourcesContent":["import type { Request, Response } from 'express';\nimport { logger } from '../utils/logger';\nimport { neuralHealthService } from '../services/NeuralHealthService';\nimport { predictiveHealingService } from '../services/PredictiveHealingService';\n\n/**\n * Nexus Command Controller: The unified brain for processing high-level commands.\n */\nexport class NexusCommandController {\n  /**\n   * Execute a \"God Mode\" system command\n   */\n  public async executeCommand(req: Request, res: Response): Promise<void> {\n    const { command, params } = req.body;\n    const requestId = (req as any).requestId || 'unknown';\n\n    logger.info({ command, requestId }, 'Recibiendo comando Nexus God Mode');\n\n    try {\n      switch (command) {\n        case 'SYSTEM_PURGE':\n          await this.handleSystemPurge(res);\n          break;\n        case 'SYNC_VR_STATE':\n          await this.handleVRSync(params, res);\n          break;\n        case 'OVERRIDE_HEALTH':\n          await this.handleHealthOverride(params, res);\n          break;\n        default:\n          res.status(400).json({\n            success: false,\n            error: 'Comando no reconocido o fuera de los límites de autoridad.',\n          });\n      }\n    } catch (error) {\n      logger.error({ error, requestId }, 'Error ejecutando comando Nexus');\n      res\n        .status(500)\n        .json({ success: false, error: 'Fallo catastrófico en la ejecución del comando.' });\n    }\n  }\n\n  private async handleSystemPurge(res: Response) {\n    logger.warn('Iniciando PURGA DEL SISTEMA vía Nexus Command');\n    // Invocamos manualmente al servicio de curación predictiva para una limpieza profunda\n    await (predictiveHealingService as any).performEmergencyHealing({\n      sanityScore: 50,\n      memoryUsage: 95,\n      cpuUsage: 95,\n      status: 'CRITICAL',\n      uptime: process.uptime(),\n    });\n\n    res.json({ success: true, message: 'Purga del sistema completada y caches optimizados.' });\n  }\n\n  private async handleVRSync(params: any, res: Response) {\n    const { sessionId, state } = params;\n    logger.info({ sessionId }, 'Sincronizando estado VR Nexus');\n    // Lógica para persistir o emitir el estado VR a otros clientes\n    res.json({ success: true, message: 'Estado VR sincronizado globalmente.' });\n  }\n\n  private async handleHealthOverride(params: any, res: Response) {\n    const { targetStatus } = params;\n    logger.warn({ targetStatus }, 'Sobrescribiendo estado de salud del núcleo neural');\n    // Esto es una función de \"God Mode\" puro\n    res.json({ success: true, message: `Estado del sistema forzado a: ${targetStatus}` });\n  }\n\n  /**\n   * Get real-time neural health metrics\n   */\n  public async getNeuralStatus(_req: Request, res: Response): Promise<void> {\n    const metrics = neuralHealthService.getMetrics();\n    res.json(metrics);\n  }\n}\n\nexport const nexusCommandController = new NexusCommandController();\n"],"version":3}
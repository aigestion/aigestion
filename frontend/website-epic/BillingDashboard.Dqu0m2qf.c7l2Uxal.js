import{V as e,h as s,t as a,W as t,ax as r,ay as i,U as n}from"./index.QYzeauO3.CyjFagMG.js";import{$ as c}from"./main.D7wyvIZG.js";import"./charts.DvdfUCxK.DqWDX3HQ.js";import"./three.oqmhCI76.js";const l="http://localhost:5000/api/v1",o=new class{async getHeaders(){return{"Content-Type":"application/json"}}async getBillingSnapshot(){const e=await this.getHeaders(),s=await fetch(`${l}/billing/snapshot`,{method:"GET",headers:e});if(!s.ok)throw new Error("Failed to fetch billing snapshot");return s.json()}async createCheckoutSession(e){const s=await this.getHeaders(),a=await fetch(`${l}/billing/checkout`,{method:"POST",headers:s,body:JSON.stringify({priceId:e})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.message||"Failed to create checkout session")}return a.json()}async createPortalSession(){const e=await this.getHeaders(),s=await fetch(`${l}/billing/portal`,{method:"POST",headers:e});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to create portal session")}return s.json()}},d=[{name:"Esencial",priceId:"price_1QjKIJNHiQCSTOYx5Z...PLACHOLDER",price:"$490",frequency:"/mes",description:"Startups y pymes en crecimiento",features:["Automatización base","Panel de control","Soporte estándar","Implementación rápida"]},{name:"Evolución",priceId:"price_1QjKIJNHiQCSTOYx...PLACEHOLDER",price:"$1,490",frequency:"/mes",description:"Empresas con equipos multi-área",features:["IA aplicada por área","Integraciones CRM/ERP","Reportes avanzados","Onboarding guiado"],popular:!0},{name:"Soberano",priceId:"",price:"Cotización",frequency:"",description:"Corporativos y sector público",features:["Modelos privados","Gobernanza y compliance","Equipo dedicado","SLA premium"]}],x=()=>{const[l,x]=e.useState(!0),[p,h]=e.useState(null),[m,u]=e.useState(null),{notify:b}=c();e.useEffect(()=>{f()},[]);const f=async()=>{try{const e=await o.getBillingSnapshot();u(e)}catch(e){b("Error","No se pudo cargar la información de facturación.","error")}finally{x(!1)}};return l?s.jsx("div",{className:"min-h-screen bg-nexus-obsidian pt-24 flex items-center justify-center",children:s.jsx(a,{className:"w-12 h-12 text-nexus-cyan animate-spin"})}):s.jsx("div",{className:"min-h-screen bg-nexus-obsidian pt-24 pb-12 px-6",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-12",children:[s.jsxs("h1",{className:"text-4xl font-orbitron font-bold text-white mb-4",children:["Facturación y ",s.jsx("span",{className:"text-nexus-cyan text-glow",children:"Suscripción"})]}),s.jsx("p",{className:"text-nexus-silver/70",children:"Gestiona tu plan, método de pago e historial de facturación."})]}),s.jsx(t.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-white/5 border border-white/10 rounded-2xl p-8 mb-16 backdrop-blur-sm",children:s.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold text-white mb-2 flex items-center gap-3",children:["Estado de Suscripción",m?.hasActiveSubscription?s.jsx("span",{className:"bg-green-500/20 text-green-400 text-xs px-3 py-1 rounded-full border border-green-500/30",children:"ACTIVO"}):s.jsx("span",{className:"bg-yellow-500/20 text-yellow-400 text-xs px-3 py-1 rounded-full border border-yellow-500/30",children:"INACTIVO"})]}),m?.subscription?s.jsxs("p",{className:"text-nexus-silver",children:["Plan actual:"," ",s.jsx("span",{className:"text-white font-semibold",children:"month"===m.subscription.plan.interval?"Mensual":"Anual"})," ","• Renueva el"," ",new Date(1e3*m.subscription.current_period_end).toLocaleDateString()]}):s.jsx("p",{className:"text-nexus-silver",children:"No tienes una suscripción activa actualmente."})]}),m?.hasActiveSubscription&&s.jsxs("button",{onClick:async()=>{h("portal");try{const{url:e}=await o.createPortalSession();window.location.href=e}catch(e){b("Error",e.message||"Error al abrir el portal de facturación.","error"),h(null)}},disabled:"portal"===p,className:"flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl transition-all border border-white/10 disabled:opacity-50",children:["portal"===p?s.jsx(a,{className:"w-5 h-5 animate-spin"}):s.jsx(r,{className:"w-5 h-5"}),"Gestionar en Stripe"]})]})}),!m?.hasActiveSubscription&&s.jsx("div",{className:"grid lg:grid-cols-3 gap-8 mb-16",children:d.map((e,r)=>s.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*r},className:"relative p-8 rounded-3xl border backdrop-blur-md flex flex-col "+(e.popular?"border-nexus-cyan/50 bg-nexus-cyan/5 shadow-[0_0_30px_rgba(6,182,212,0.15)]":"border-white/10 bg-white/5"),children:[e.popular&&s.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-nexus-cyan text-black font-bold text-xs px-4 py-1 rounded-full tracking-wider uppercase",children:"Más Popular"}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-nexus-cyan font-orbitron tracking-widest text-sm uppercase mb-2",children:e.name}),s.jsxs("div",{className:"flex items-baseline gap-1",children:[s.jsx("span",{className:"text-4xl font-bold text-white",children:e.price}),s.jsx("span",{className:"text-nexus-silver/70 text-sm",children:e.frequency})]}),s.jsx("p",{className:"text-sm text-nexus-silver mt-4",children:e.description})]}),s.jsx("ul",{className:"space-y-4 mb-8 flex-1",children:e.features.map(e=>s.jsxs("li",{className:"flex items-start gap-3 text-sm text-nexus-silver/90",children:[s.jsx(i,{className:"w-5 h-5 text-nexus-cyan shrink-0"}),e]},e))}),s.jsx("button",{onClick:()=>(async e=>{if(e){h(e);try{const{url:s}=await o.createCheckoutSession(e);window.location.href=s}catch(s){b("Error",s.message||"Error al iniciar el checkout.","error"),h(null)}}else b("Contactar Ventas","Para el plan Soberano, por favor contáctanos directamente.","info")})(e.priceId),disabled:p===e.priceId,className:`w-full py-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${e.popular?"bg-nexus-cyan text-black hover:shadow-[0_0_20px_rgba(6,182,212,0.4)]":"bg-white text-black hover:bg-white/90"} disabled:opacity-50`,children:p===e.priceId?s.jsx(a,{className:"w-5 h-5 animate-spin"}):s.jsxs(s.Fragment,{children:[e.priceId?"Comenzar Ahora":"Contactar Ventas",e.priceId&&s.jsx(n,{className:"w-4 h-4"})]})})]},e.name))}),m?.invoices&&m.invoices.length>0&&s.jsxs("div",{className:"mt-12",children:[s.jsx("h3",{className:"text-2xl font-orbitron font-bold text-white mb-6",children:"Historial de Pagos"}),s.jsx("div",{className:"bg-white/5 border border-white/10 rounded-2xl overflow-hidden",children:s.jsxs("table",{className:"w-full text-left",children:[s.jsx("thead",{className:"bg-white/5 text-nexus-silver text-sm uppercase tracking-wider",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-6 font-normal",children:"Fecha"}),s.jsx("th",{className:"p-6 font-normal",children:"Monto"}),s.jsx("th",{className:"p-6 font-normal",children:"Estado"}),s.jsx("th",{className:"p-6 font-normal text-right",children:"Factura"})]})}),s.jsx("tbody",{className:"divide-y divide-white/5",children:m.invoices.map(e=>s.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[s.jsx("td",{className:"p-6 text-white",children:new Date(1e3*e.created).toLocaleDateString()}),s.jsxs("td",{className:"p-6 text-white font-mono",children:["$",(e.amount_paid/100).toFixed(2)," ",e.currency.toUpperCase()]}),s.jsx("td",{className:"p-6",children:s.jsx("span",{className:"bg-green-500/20 text-green-400 text-xs px-3 py-1 rounded-full border border-green-500/30 capitalize",children:e.status})}),s.jsx("td",{className:"p-6 text-right",children:s.jsxs("a",{href:e.pdf_url,target:"_blank",rel:"noreferrer",className:"text-nexus-cyan hover:underline text-sm inline-flex items-center gap-1",children:["Descargar ",s.jsx(r,{className:"w-3 h-3"})]})})]},e.id))})]})})]})]})})};export{x as BillingDashboard};

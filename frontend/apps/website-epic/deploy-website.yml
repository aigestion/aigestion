name: Deploy Website Epic to GitHub Pages
on:
  push:
    branches:
      - main
      master
  jobs:
    - name: Deploy to GitHub Pages
      runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18.x'
          cache: 'npm'
      - name: Install dependencies
        run: npm ci
      - name: Build application
        run: npm run build
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
      - name: Cache build artifacts
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-artifact
          path: ./dist
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    timeout-minutes: 10

  permissions:
    contents: read
    pages: write
    id-token: write

  # Enable Pages
  pages:
    branches:
      - main
    source: frontend/apps/src
    build:
      output: 'dist'
      base: '/'
    domain: aigestion.net

  # Custom domain configuration
  custom_domain: aigestion.net

  # SSL/TLS
  ssl:
    enforce: true

  # Jekyll configuration
  plugins:
    - jekyll-optional
    - jekyll-sitemap
    - jekyll-feed
    - jekyll-seo
    - jekyll-paginate

  # Exclude files from processing
  exclude:
    - frontend/apps/node_modules/
    - frontend/apps/.vite/
    - frontend/apps/dist/
    - frontend/apps/src/__tests__/
    - frontend/apps/src/__tests__/e2e/
    - frontend/apps/src/monitoring/
    - frontend/apps/src/security/
    - frontend/apps/src/testing/
    frontend/apps/src/patterns/

  # Include specific files
  include:
    - frontend/apps/public/
    - frontend/apps/src/
    - frontend/apps/manifest.json
    - frontend/apps/sw.js
    - frontend/apps/sw-advanced.js

# Additional build optimizations



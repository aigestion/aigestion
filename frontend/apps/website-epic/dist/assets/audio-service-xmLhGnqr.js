var e=Object.defineProperty,a=(a,t,s)=>((a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s)(a,"symbol"!=typeof t?t+"":t,s);import{r as t}from"./vendor-react-DzSuaLpV.js";const s=new class{constructor(){a(this,"audioCache",new Map),a(this,"isMuted",!1),a(this,"ambiencePlaying",null),a(this,"loadingPromises",new Map),a(this,"maxCacheSize",20),a(this,"preloadQueue",["hover_glass","click_activate","success_chime"]),this.preloadEssentialSounds()}async preloadEssentialSounds(){setTimeout(()=>{this.preloadQueue.forEach(async e=>{try{await this.loadSound(e)}catch(a){}})},1e3)}cleanupCache(){if(this.audioCache.size<=this.maxCacheSize)return;const e=Array.from(this.audioCache.entries());e.slice(0,e.length-this.maxCacheSize).forEach(([e])=>{const a=this.audioCache.get(e);a?.audio&&(a.audio.pause(),a.audio.src=""),this.audioCache.delete(e)})}loadSound(e){if(this.loadingPromises.has(e))return this.loadingPromises.get(e);const a=new Promise(a=>{const t=this.audioCache.get(e);if(t?.isLoaded)return void a(t.audio);const s=()=>{const e=new Audio;return e.volume=0,e};(a=>new Promise(t=>{const i=new Audio;i.src=a,i.volume=.3,i.preload="auto";const o=setTimeout(()=>{t(s())},5e3);i.addEventListener("canplaythrough",()=>{clearTimeout(o);const a={audio:i,isLoaded:!0,error:!1};this.audioCache.set(e,a),this.cleanupCache(),t(i)},{once:!0}),i.addEventListener("error",()=>{clearTimeout(o),t(s())},{once:!0}),i.load()}))(`/sounds/${e}.mp3`).then(t=>{this.loadingPromises.delete(e),a(t)})});return this.loadingPromises.set(e,a),a}async play(e){if(!this.isMuted)try{let t=this.audioCache.get(e)?.audio;t&&this.audioCache.get(e)?.isLoaded||(t=await this.loadSound(e));try{t.currentTime=0;const e=t.play();void 0!==e&&e.catch(e=>{e.name})}catch(a){}}catch(t){}}async startAmbience(){if(!this.isMuted&&!this.ambiencePlaying)try{const a=await this.loadSound("nexus_hum");if(0===a.volume)return;a.loop=!0,a.volume=.05;try{await a.play(),this.ambiencePlaying=a}catch(e){}}catch(e){}}stopAmbience(){this.ambiencePlaying&&(this.ambiencePlaying.pause(),this.ambiencePlaying.currentTime=0,this.ambiencePlaying=null)}toggleMute(){return this.isMuted=!this.isMuted,this.isMuted&&(this.stopAmbience(),this.audioCache.forEach(e=>{e.isLoaded&&e.audio.pause()})),this.isMuted}getMutedState(){return this.isMuted}getCacheStats(){const e=Array.from(this.audioCache.values());return{size:e.length,loaded:e.filter(e=>e.isLoaded&&!e.error).length,errors:e.filter(e=>e.error).length}}destroy(){this.stopAmbience(),this.audioCache.forEach(e=>{e.audio&&(e.audio.pause(),e.audio.src="")}),this.audioCache.clear(),this.loadingPromises.clear()}},i=()=>{const e=t.useCallback(e=>{s.play(e)},[]),a=t.useCallback(()=>e("hover_glass"),[e]),i=t.useCallback(()=>e("click_activate"),[e]),o=t.useCallback(()=>e("wuaw_subtle"),[e]),c=t.useCallback(()=>e("data_pulse"),[e]),r=t.useCallback(()=>e("success_chime"),[e]),u=t.useCallback(()=>e("error_buzzer"),[e]),n=t.useCallback(()=>e("menu_open"),[e]);return t.useEffect(()=>()=>{},[]),{play:e,playHover:a,playClick:i,playWuaw:o,playPulse:c,playSuccess:r,playError:u,playMenu:n,startAmbience:()=>s.startAmbience(),stopAmbience:()=>s.stopAmbience(),toggleMute:()=>s.toggleMute(),getMutedState:()=>s.getMutedState(),getCacheStats:()=>s.getCacheStats()}};export{s as a,i as u};

import{j as e}from"./vendor-3d-CTa5dsNI.js";import{r as t}from"./vendor-react-C91fTXKM.js";import{e as s}from"./main-CxnbXITZ.js";import{s as a}from"./useAuth-CdTKzB0b.js";import{G as r,T as n}from"./TiltCard-C6XZQ9v4.js";import{m as i,Q as o,ao as l,ab as c}from"./vendor-ui-KKjElUIq.js";import{m as d}from"./vendor-motion-DnYhxDjc.js";import"./index-D9FR0nMa.js";import"./vendor-data-CncgVCKE.js";const x="/api/v1";const p=new class{async getHeaders(){if(!a)return{"Content-Type":"application/json"};const{data:e}=await a.auth.getSession(),t=e.session?.access_token;return{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}}}async getBillingSnapshot(){const e=await this.getHeaders(),t=await fetch(`${x}/billing/snapshot`,{method:"GET",headers:e});if(!t.ok)throw new Error("Failed to fetch billing snapshot");return t.json()}async createCheckoutSession(e){const t=await this.getHeaders(),s=await fetch(`${x}/billing/checkout`,{method:"POST",headers:t,body:JSON.stringify({priceId:e})});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.message||"Failed to create checkout session")}return s.json()}async createPortalSession(){const e=await this.getHeaders(),t=await fetch(`${x}/billing/portal`,{method:"POST",headers:e});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.message||"Failed to create portal session")}return t.json()}},m=[{name:"Esencial",priceId:"price_1QjKIJNHiQCSTOYx5Z...PLACHOLDER",price:"$490",frequency:"/mes",description:"Startups y pymes en crecimiento",features:["Automatizaci\xf3n base","Panel de control","Soporte est\xe1ndar","Implementaci\xf3n r\xe1pida"]},{name:"Evoluci\xf3n",priceId:"price_1QjKIJNHiQCSTOYx...PLACEHOLDER",price:"$1,490",frequency:"/mes",description:"Empresas con equipos multi-\xe1rea",features:["IA aplicada por \xe1rea","Integraciones CRM/ERP","Reportes avanzados","Onboarding guiado"],popular:!0},{name:"Soberano",priceId:"",price:"Cotizaci\xf3n",frequency:"",description:"Corporativos y sector p\xfablico",features:["Modelos privados","Gobernanza y compliance","Equipo dedicado","SLA premium"]}],h=()=>{const[a,x]=t.useState(!0),[h,u]=t.useState(null),[b,g]=t.useState(null),{notify:f}=s();t.useEffect(()=>{j();"true"===new URLSearchParams(window.location.search).get("success")&&(f("\xa1Pago Exitoso!","Tu suscripci\xf3n ha sido activada.","success"),setTimeout(()=>{window.location.href="/client"},2e3))},[]);const j=async()=>{try{const e=await p.getBillingSnapshot();g(e)}catch(e){f("Error","No se pudo cargar la informaci\xf3n de facturaci\xf3n.","error")}finally{x(!1)}};return a?e.jsx("div",{className:"min-h-screen bg-nexus-obsidian pt-24 flex items-center justify-center",children:e.jsx(i,{className:"w-12 h-12 text-nexus-cyan animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-nexus-obsidian pt-24 pb-12 px-6 selection:bg-nexus-cyan/30 relative overflow-hidden",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-nexus-cyan/10 rounded-full blur-[100px]"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-nexus-violet/10 rounded-full blur-[100px]"})]}),e.jsxs("div",{className:"max-w-7xl mx-auto relative z-10",children:[e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-12 text-center md:text-left",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4 mb-6",children:[e.jsx(r,{text:"CENTRO DE",effect:"none",className:"text-5xl md:text-6xl font-bold"}),e.jsx(r,{text:"FACTURACI\xd3N",className:"text-5xl md:text-6xl font-bold text-nexus-cyan"})]}),e.jsx("p",{className:"text-nexus-silver/80 text-lg font-light tracking-wide max-w-2xl",children:"Gestiona tu soberan\xeda digital. Control total sobre tu plan, recursos e historial de inversiones de inteligencia."})]}),e.jsx(n,{tiltMaxAngleX:2,tiltMaxAngleY:2,className:"mb-20",children:e.jsxs("div",{className:"relative bg-black/40 backdrop-blur-xl border border-white/10 rounded-3xl p-8 overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-nexus-cyan/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-8 relative z-10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-orbitron text-white mb-3 flex items-center gap-4",children:["ESTADO DEL SISTEMA",b?.hasActiveSubscription?e.jsxs("span",{className:"flex items-center gap-2 bg-emerald-500/10 text-emerald-400 text-xs px-4 py-1.5 rounded-full border border-emerald-500/30 shadow-[0_0_15px_rgba(74,222,128,0.2)]",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400 animate-pulse"}),"OPERATIVO"]}):e.jsxs("span",{className:"flex items-center gap-2 bg-yellow-500/10 text-yellow-400 text-xs px-4 py-1.5 rounded-full border border-yellow-500/30",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-400"}),"INACTIVO"]})]}),b?.subscription?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-nexus-silver text-sm uppercase tracking-wider",children:"Nivel de Inteligencia Actual"}),e.jsxs("p",{className:"text-3xl font-bold text-white tracking-tight flex items-baseline gap-2",children:["month"===b.subscription.plan.interval?"MENSUAL":"ANUAL",e.jsxs("span",{className:"text-sm font-normal text-nexus-silver/60",children:["\u2022 Renueva:"," ",new Date(1e3*b.subscription.current_period_end).toLocaleDateString()]})]})]}):e.jsx("p",{className:"text-nexus-silver/80",children:"No hay protocolos de inteligencia activos actualmente."})]}),b?.hasActiveSubscription&&e.jsxs("button",{onClick:async()=>{u("portal");try{const{url:e}=await p.createPortalSession();window.location.href=e}catch(e){f("Error",e.message||"Error al abrir el portal de facturaci\xf3n.","error"),u(null)}},disabled:"portal"===h,className:"flex items-center gap-3 bg-nexus-cyan/10 hover:bg-nexus-cyan/20 text-nexus-cyan px-8 py-4 rounded-xl transition-all border border-nexus-cyan/50 shadow-[0_0_20px_rgba(6,182,212,0.15)] hover:shadow-[0_0_35px_rgba(6,182,212,0.3)] disabled:opacity-50 disabled:cursor-not-allowed group/btn",children:["portal"===h?e.jsx(i,{className:"w-5 h-5 animate-spin"}):e.jsx(o,{className:"w-5 h-5 group-hover/btn:rotate-45 transition-transform"}),e.jsx("span",{className:"font-orbitron tracking-wider text-sm font-bold",children:"GESTIONAR STRIPE"})]})]})]})}),!b?.hasActiveSubscription&&e.jsx("div",{className:"grid lg:grid-cols-3 gap-8 mb-20",children:m.map((t,s)=>e.jsx(n,{className:"h-full",tiltMaxAngleX:3,tiltMaxAngleY:3,children:e.jsxs("div",{className:"relative p-8 rounded-[2rem] border flex flex-col group overflow-hidden transition-all duration-500 h-full "+(t.popular?"bg-black/60 border-nexus-cyan/50 shadow-[0_0_40px_-5px_rgba(6,182,212,0.2)] hover:shadow-[0_0_60px_-5px_rgba(6,182,212,0.4)]":"bg-black/30 border-white/5 hover:border-white/20 hover:bg-black/50"),children:[t.popular&&e.jsx("div",{className:"absolute -top-20 -right-20 w-60 h-60 bg-nexus-cyan/20 rounded-full blur-[60px] pointer-events-none"}),t.popular&&e.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 bg-nexus-cyan text-black font-black text-[10px] px-6 py-1.5 rounded-b-xl tracking-[0.2em] uppercase shadow-[0_0_20px_rgba(6,182,212,0.6)] z-20",children:"Recomendado"}),e.jsxs("div",{className:"mb-8 relative z-10",children:[e.jsx("h3",{className:"font-orbitron tracking-[0.2em] text-sm uppercase mb-3 "+(t.popular?"text-nexus-cyan drop-shadow-[0_0_5px_rgba(6,182,212,0.8)]":"text-nexus-silver"),children:t.name}),e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"text-5xl font-bold text-white tracking-tight",children:t.price}),e.jsx("span",{className:"text-nexus-silver/60 text-sm font-light",children:t.frequency})]}),e.jsx("p",{className:"text-sm text-nexus-silver/70 mt-5 leading-relaxed font-light border-t border-white/5 pt-5",children:t.description})]}),e.jsx("ul",{className:"space-y-4 mb-10 flex-1 relative z-10",children:t.features.map(s=>e.jsxs("li",{className:"flex items-start gap-3 text-sm text-nexus-silver/90 group-hover:text-white transition-colors",children:[e.jsx("div",{className:"p-1 rounded-full shrink-0 "+(t.popular?"bg-nexus-cyan/10 text-nexus-cyan":"bg-white/10 text-white"),children:e.jsx(l,{className:"w-3 h-3"})}),s]},s))}),e.jsxs("button",{onClick:()=>(async e=>{if(e){u(e);try{const{url:t}=await p.createCheckoutSession(e);window.location.href=t}catch(t){f("Error",t.message||"Error al iniciar el checkout.","error"),u(null)}}else f("Contactar Ventas","Para el plan Soberano, por favor cont\xe1ctanos directamente.","info")})(t.priceId),disabled:h===t.priceId,className:`w-full py-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 relative overflow-hidden group/btn ${t.popular?"bg-nexus-cyan text-black hover:bg-cyan-300 shadow-[0_0_20px_rgba(6,182,212,0.4)]":"bg-white text-black hover:bg-gray-200"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent translate-x-[-200%] group-hover/btn:animate-shimmer"}),e.jsx("span",{className:"relative z-10 font-orbitron tracking-wider text-xs",children:h===t.priceId?e.jsx(i,{className:"w-5 h-5 animate-spin mx-auto"}):e.jsx(e.Fragment,{children:t.priceId?"INICIAR PROTOCOLO":"SOLICITAR ACCESO"})}),t.priceId&&!h&&e.jsx(c,{className:"w-4 h-4 relative z-10"})]})]})},t.name))}),b?.invoices&&b.invoices.length>0&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"mt-12",children:[e.jsxs("h3",{className:"text-2xl font-orbitron font-bold text-white mb-8 flex items-center gap-4",children:[e.jsx("span",{className:"w-1 h-8 bg-nexus-cyan rounded-full shadow-[0_0_15px_#06b6d4]"}),"HISTORIAL DE TRANSACCIONES"]}),e.jsx(n,{tiltMaxAngleX:1,tiltMaxAngleY:1,children:e.jsx("div",{className:"bg-black/40 border border-white/10 rounded-3xl overflow-hidden backdrop-blur-md",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-white/5 text-nexus-silver/60 text-xs uppercase tracking-[0.1em] font-orbitron",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-6 font-normal",children:"Ciclo"}),e.jsx("th",{className:"p-6 font-normal",children:"Inversi\xf3n"}),e.jsx("th",{className:"p-6 font-normal",children:"Estado"}),e.jsx("th",{className:"p-6 font-normal text-right",children:"Documento"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:b.invoices.map((t,s)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors group",children:[e.jsx("td",{className:"p-6 text-white group-hover:text-nexus-cyan transition-colors",children:new Date(1e3*t.created).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}),e.jsxs("td",{className:"p-6 text-white font-mono tracking-wider",children:["$",(t.amount_paid/100).toFixed(2)," ",e.jsx("span",{className:"text-xs text-nexus-silver",children:t.currency.toUpperCase()})]}),e.jsx("td",{className:"p-6",children:e.jsx("span",{className:"bg-emerald-500/10 text-emerald-400 text-[10px] uppercase font-bold px-3 py-1 rounded-full border border-emerald-500/20 shadow-[0_0_10px_rgba(74,222,128,0.1)]",children:"COMPLETADO"})}),e.jsx("td",{className:"p-6 text-right",children:e.jsxs("a",{href:t.pdf_url,target:"_blank",rel:"noreferrer",className:"text-nexus-silver hover:text-white transition-colors text-sm inline-flex items-center gap-2 group/link",children:[e.jsx("span",{className:"text-xs uppercase tracking-wider group-hover/link:underline decoration-nexus-cyan/50 underline-offset-4",children:"PDF"}),e.jsx(o,{className:"w-3 h-3 group-hover/link:text-nexus-cyan transition-colors"})]})})]},t.id))})]})})})]})]})]})};export{h as BillingDashboard};

<!DOCTYPE html>
<html>
<head>
    <title>CORS Proxy for Pollinations.ai</title>
    <meta charset="utf-8">
</head>
<body>
    <script>
        // Simple CORS proxy using JSONP
        function generateImage(prompt, options) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_' + Date.now() + '_' + Math.floor(Math.random() * 10000);
                const model = options.model === 'flux-pro' ? 'flux-realism' : 'flux';
                const url = `https://pollinations.ai/p/${encodeURIComponent(prompt)}?model=${model}&width=${options.width || 1024}&height=${options.height || 1024}&seed=${options.seed || Math.floor(Math.random() * 1000000)}&nologo=true&callback=${callbackName}`;
                
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function() {
                    resolve(img.src);
                };
                img.onerror = function() {
                    reject(new Error('Image load failed'));
                };
                
                // Try to load the image directly
                img.src = url;
                
                // Fallback to placeholder after timeout
                setTimeout(() => {
                    if (!img.complete) {
                        const hash = btoa(prompt + model).substring(0, 8);
                        const seed = hash.charCodeAt(0) % 1000;
                        resolve(`https://picsum.photos/seed/${seed}/1024/1024.jpg`);
                    }
                }, 10000);
            });
        }
        
        // Expose globally
        window.generateImage = generateImage;
    </script>
</body>
</html>
